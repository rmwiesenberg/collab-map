var q3=Object.defineProperty;var Y3=(n,e,t)=>e in n?q3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>Y3(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function uw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function K3(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),t}var Zd={exports:{}},Fo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lb;function Z3(){if(Lb)return Fo;Lb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,i,r){var l=null;if(r!==void 0&&(l=""+r),i.key!==void 0&&(l=""+i.key),"key"in i){r={};for(var c in i)c!=="key"&&(r[c]=i[c])}else r=i;return i=r.ref,{$$typeof:n,type:s,key:l,ref:i!==void 0?i:null,props:r}}return Fo.Fragment=e,Fo.jsx=t,Fo.jsxs=t,Fo}var Fb;function Q3(){return Fb||(Fb=1,Zd.exports=Z3()),Zd.exports}var nl=Q3(),Qd={exports:{}},Ce={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zb;function G3(){if(zb)return Ce;zb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function y(A){return A===null||typeof A!="object"?null:(A=_&&A[_]||A["@@iterator"],typeof A=="function"?A:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,S={};function R(A,L,K){this.props=A,this.context=L,this.refs=S,this.updater=K||b}R.prototype.isReactComponent={},R.prototype.setState=function(A,L){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,L,"setState")},R.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function k(){}k.prototype=R.prototype;function U(A,L,K){this.props=A,this.context=L,this.refs=S,this.updater=K||b}var P=U.prototype=new k;P.constructor=U,T(P,R.prototype),P.isPureReactComponent=!0;var D=Array.isArray,$={H:null,A:null,T:null,S:null},Z=Object.prototype.hasOwnProperty;function fe(A,L,K,ee,se,le){return K=le.ref,{$$typeof:n,type:A,key:L,ref:K!==void 0?K:null,props:le}}function ue(A,L){return fe(A.type,L,void 0,void 0,void 0,A.props)}function J(A){return typeof A=="object"&&A!==null&&A.$$typeof===n}function oe(A){var L={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(K){return L[K]})}var de=/\/+/g;function ve(A,L){return typeof A=="object"&&A!==null&&A.key!=null?oe(""+A.key):L.toString(36)}function be(){}function Se(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(be,be):(A.status="pending",A.then(function(L){A.status==="pending"&&(A.status="fulfilled",A.value=L)},function(L){A.status==="pending"&&(A.status="rejected",A.reason=L)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function We(A,L,K,ee,se){var le=typeof A;(le==="undefined"||le==="boolean")&&(A=null);var pe=!1;if(A===null)pe=!0;else switch(le){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(A.$$typeof){case n:case e:pe=!0;break;case g:return pe=A._init,We(pe(A._payload),L,K,ee,se)}}if(pe)return se=se(A),pe=ee===""?"."+ve(A,0):ee,D(se)?(K="",pe!=null&&(K=pe.replace(de,"$&/")+"/"),We(se,L,K,"",function(Ie){return Ie})):se!=null&&(J(se)&&(se=ue(se,K+(se.key==null||A&&A.key===se.key?"":(""+se.key).replace(de,"$&/")+"/")+pe)),L.push(se)),1;pe=0;var Re=ee===""?".":ee+":";if(D(A))for(var _e=0;_e<A.length;_e++)ee=A[_e],le=Re+ve(ee,_e),pe+=We(ee,L,K,le,se);else if(_e=y(A),typeof _e=="function")for(A=_e.call(A),_e=0;!(ee=A.next()).done;)ee=ee.value,le=Re+ve(ee,_e++),pe+=We(ee,L,K,le,se);else if(le==="object"){if(typeof A.then=="function")return We(Se(A),L,K,ee,se);throw L=String(A),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return pe}function C(A,L,K){if(A==null)return A;var ee=[],se=0;return We(A,ee,"","",function(le){return L.call(K,le,se++)}),ee}function N(A){if(A._status===-1){var L=A._result;L=L(),L.then(function(K){(A._status===0||A._status===-1)&&(A._status=1,A._result=K)},function(K){(A._status===0||A._status===-1)&&(A._status=2,A._result=K)}),A._status===-1&&(A._status=0,A._result=L)}if(A._status===1)return A._result.default;throw A._result}var I=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function Q(){}return Ce.Children={map:C,forEach:function(A,L,K){C(A,function(){L.apply(this,arguments)},K)},count:function(A){var L=0;return C(A,function(){L++}),L},toArray:function(A){return C(A,function(L){return L})||[]},only:function(A){if(!J(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},Ce.Component=R,Ce.Fragment=t,Ce.Profiler=i,Ce.PureComponent=U,Ce.StrictMode=s,Ce.Suspense=h,Ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Ce.act=function(){throw Error("act(...) is not supported in production builds of React.")},Ce.cache=function(A){return function(){return A.apply(null,arguments)}},Ce.cloneElement=function(A,L,K){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var ee=T({},A.props),se=A.key,le=void 0;if(L!=null)for(pe in L.ref!==void 0&&(le=void 0),L.key!==void 0&&(se=""+L.key),L)!Z.call(L,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&L.ref===void 0||(ee[pe]=L[pe]);var pe=arguments.length-2;if(pe===1)ee.children=K;else if(1<pe){for(var Re=Array(pe),_e=0;_e<pe;_e++)Re[_e]=arguments[_e+2];ee.children=Re}return fe(A.type,se,void 0,void 0,le,ee)},Ce.createContext=function(A){return A={$$typeof:l,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:r,_context:A},A},Ce.createElement=function(A,L,K){var ee,se={},le=null;if(L!=null)for(ee in L.key!==void 0&&(le=""+L.key),L)Z.call(L,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(se[ee]=L[ee]);var pe=arguments.length-2;if(pe===1)se.children=K;else if(1<pe){for(var Re=Array(pe),_e=0;_e<pe;_e++)Re[_e]=arguments[_e+2];se.children=Re}if(A&&A.defaultProps)for(ee in pe=A.defaultProps,pe)se[ee]===void 0&&(se[ee]=pe[ee]);return fe(A,le,void 0,void 0,null,se)},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(A){return{$$typeof:c,render:A}},Ce.isValidElement=J,Ce.lazy=function(A){return{$$typeof:g,_payload:{_status:-1,_result:A},_init:N}},Ce.memo=function(A,L){return{$$typeof:d,type:A,compare:L===void 0?null:L}},Ce.startTransition=function(A){var L=$.T,K={};$.T=K;try{var ee=A(),se=$.S;se!==null&&se(K,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(Q,I)}catch(le){I(le)}finally{$.T=L}},Ce.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Ce.use=function(A){return $.H.use(A)},Ce.useActionState=function(A,L,K){return $.H.useActionState(A,L,K)},Ce.useCallback=function(A,L){return $.H.useCallback(A,L)},Ce.useContext=function(A){return $.H.useContext(A)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(A,L){return $.H.useDeferredValue(A,L)},Ce.useEffect=function(A,L){return $.H.useEffect(A,L)},Ce.useId=function(){return $.H.useId()},Ce.useImperativeHandle=function(A,L,K){return $.H.useImperativeHandle(A,L,K)},Ce.useInsertionEffect=function(A,L){return $.H.useInsertionEffect(A,L)},Ce.useLayoutEffect=function(A,L){return $.H.useLayoutEffect(A,L)},Ce.useMemo=function(A,L){return $.H.useMemo(A,L)},Ce.useOptimistic=function(A,L){return $.H.useOptimistic(A,L)},Ce.useReducer=function(A,L,K){return $.H.useReducer(A,L,K)},Ce.useRef=function(A){return $.H.useRef(A)},Ce.useState=function(A){return $.H.useState(A)},Ce.useSyncExternalStore=function(A,L,K){return $.H.useSyncExternalStore(A,L,K)},Ce.useTransition=function(){return $.H.useTransition()},Ce.version="19.0.0",Ce}var Vb;function t_(){return Vb||(Vb=1,Qd.exports=G3()),Qd.exports}var rt=t_(),Gd={exports:{}},zo={},Jd={exports:{}},eg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jb;function J3(){return jb||(jb=1,function(n){function e(C,N){var I=C.length;C.push(N);e:for(;0<I;){var Q=I-1>>>1,A=C[Q];if(0<i(A,N))C[Q]=N,C[I]=A,I=Q;else break e}}function t(C){return C.length===0?null:C[0]}function s(C){if(C.length===0)return null;var N=C[0],I=C.pop();if(I!==N){C[0]=I;e:for(var Q=0,A=C.length,L=A>>>1;Q<L;){var K=2*(Q+1)-1,ee=C[K],se=K+1,le=C[se];if(0>i(ee,I))se<A&&0>i(le,ee)?(C[Q]=le,C[se]=I,Q=se):(C[Q]=ee,C[K]=I,Q=K);else if(se<A&&0>i(le,I))C[Q]=le,C[se]=I,Q=se;else break e}}return N}function i(C,N){var I=C.sortIndex-N.sortIndex;return I!==0?I:C.id-N.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var h=[],d=[],g=1,_=null,y=3,b=!1,T=!1,S=!1,R=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;function P(C){for(var N=t(d);N!==null;){if(N.callback===null)s(d);else if(N.startTime<=C)s(d),N.sortIndex=N.expirationTime,e(h,N);else break;N=t(d)}}function D(C){if(S=!1,P(C),!T)if(t(h)!==null)T=!0,Se();else{var N=t(d);N!==null&&We(D,N.startTime-C)}}var $=!1,Z=-1,fe=5,ue=-1;function J(){return!(n.unstable_now()-ue<fe)}function oe(){if($){var C=n.unstable_now();ue=C;var N=!0;try{e:{T=!1,S&&(S=!1,k(Z),Z=-1),b=!0;var I=y;try{t:{for(P(C),_=t(h);_!==null&&!(_.expirationTime>C&&J());){var Q=_.callback;if(typeof Q=="function"){_.callback=null,y=_.priorityLevel;var A=Q(_.expirationTime<=C);if(C=n.unstable_now(),typeof A=="function"){_.callback=A,P(C),N=!0;break t}_===t(h)&&s(h),P(C)}else s(h);_=t(h)}if(_!==null)N=!0;else{var L=t(d);L!==null&&We(D,L.startTime-C),N=!1}}break e}finally{_=null,y=I,b=!1}N=void 0}}finally{N?de():$=!1}}}var de;if(typeof U=="function")de=function(){U(oe)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,be=ve.port2;ve.port1.onmessage=oe,de=function(){be.postMessage(null)}}else de=function(){R(oe,0)};function Se(){$||($=!0,de())}function We(C,N){Z=R(function(){C(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(C){C.callback=null},n.unstable_continueExecution=function(){T||b||(T=!0,Se())},n.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fe=0<C?Math.floor(1e3/C):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_getFirstCallbackNode=function(){return t(h)},n.unstable_next=function(C){switch(y){case 1:case 2:case 3:var N=3;break;default:N=y}var I=y;y=N;try{return C()}finally{y=I}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(C,N){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var I=y;y=C;try{return N()}finally{y=I}},n.unstable_scheduleCallback=function(C,N,I){var Q=n.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?Q+I:Q):I=Q,C){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=I+A,C={id:g++,callback:N,priorityLevel:C,startTime:I,expirationTime:A,sortIndex:-1},I>Q?(C.sortIndex=I,e(d,C),t(h)===null&&C===t(d)&&(S?(k(Z),Z=-1):S=!0,We(D,I-Q))):(C.sortIndex=A,e(h,C),T||b||(T=!0,Se())),C},n.unstable_shouldYield=J,n.unstable_wrapCallback=function(C){var N=y;return function(){var I=y;y=N;try{return C.apply(this,arguments)}finally{y=I}}}}(eg)),eg}var $b;function eE(){return $b||($b=1,Jd.exports=J3()),Jd.exports}var tg={exports:{}},Vt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hb;function tE(){if(Hb)return Vt;Hb=1;var n=t_();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(h,d,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:_==null?null:""+_,children:h,containerInfo:d,implementation:g}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Vt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Vt.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return r(h,d,null,g)},Vt.flushSync=function(h){var d=l.T,g=s.p;try{if(l.T=null,s.p=2,h)return h()}finally{l.T=d,s.p=g,s.d.f()}},Vt.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},Vt.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Vt.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,_=c(g,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,b=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):g==="script"&&s.d.X(h,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Vt.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=c(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},Vt.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,_=c(g,d.crossOrigin);s.d.L(h,g,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Vt.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=c(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},Vt.requestFormReset=function(h){s.d.r(h)},Vt.unstable_batchedUpdates=function(h,d){return h(d)},Vt.useFormState=function(h,d,g){return l.H.useFormState(h,d,g)},Vt.useFormStatus=function(){return l.H.useHostTransitionStatus()},Vt.version="19.0.0",Vt}var Wb;function nE(){if(Wb)return tg.exports;Wb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),tg.exports=tE(),tg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xb;function sE(){if(Xb)return zo;Xb=1;var n=eE(),e=t_(),t=nE();function s(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}var r=Symbol.for("react.element"),l=Symbol.for("react.transitional.element"),c=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),y=Symbol.for("react.consumer"),b=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),D=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function Z(a){return a===null||typeof a!="object"?null:(a=$&&a[$]||a["@@iterator"],typeof a=="function"?a:null)}var fe=Symbol.for("react.client.reference");function ue(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===fe?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case h:return"Fragment";case c:return"Portal";case g:return"Profiler";case d:return"StrictMode";case S:return"Suspense";case R:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case b:return(a.displayName||"Context")+".Provider";case y:return(a._context.displayName||"Context")+".Consumer";case T:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case k:return o=a.displayName||null,o!==null?o:ue(a.type)||"Memo";case U:o=a._payload,a=a._init;try{return ue(a(o))}catch{}}return null}var J=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=Object.assign,de,ve;function be(a){if(de===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);de=o&&o[1]||"",ve=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+de+a+ve}var Se=!1;function We(a,o){if(!a||Se)return"";Se=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(G){var Y=G}Reflect.construct(a,[],re)}else{try{re.call()}catch(G){Y=G}a.call(re.prototype)}}else{try{throw Error()}catch(G){Y=G}(re=a())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(G){if(G&&Y&&typeof G.stack=="string")return[G.stack,Y.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=f.DetermineComponentFrameRoot(),v=m[0],x=m[1];if(v&&x){var M=v.split(`
`),V=x.split(`
`);for(p=f=0;f<M.length&&!M[f].includes("DetermineComponentFrameRoot");)f++;for(;p<V.length&&!V[p].includes("DetermineComponentFrameRoot");)p++;if(f===M.length||p===V.length)for(f=M.length-1,p=V.length-1;1<=f&&0<=p&&M[f]!==V[p];)p--;for(;1<=f&&0<=p;f--,p--)if(M[f]!==V[p]){if(f!==1||p!==1)do if(f--,p--,0>p||M[f]!==V[p]){var te=`
`+M[f].replace(" at new "," at ");return a.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",a.displayName)),te}while(1<=f&&0<=p);break}}}finally{Se=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?be(u):""}function C(a){switch(a.tag){case 26:case 27:case 5:return be(a.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 15:return a=We(a.type,!1),a;case 11:return a=We(a.type.render,!1),a;case 1:return a=We(a.type,!0),a;default:return""}}function N(a){try{var o="";do o+=C(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function I(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function Q(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function A(a){if(I(a)!==a)throw Error(s(188))}function L(a){var o=a.alternate;if(!o){if(o=I(a),o===null)throw Error(s(188));return o!==a?null:a}for(var u=a,f=o;;){var p=u.return;if(p===null)break;var m=p.alternate;if(m===null){if(f=p.return,f!==null){u=f;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===u)return A(p),a;if(m===f)return A(p),o;m=m.sibling}throw Error(s(188))}if(u.return!==f.return)u=p,f=m;else{for(var v=!1,x=p.child;x;){if(x===u){v=!0,u=p,f=m;break}if(x===f){v=!0,f=p,u=m;break}x=x.sibling}if(!v){for(x=m.child;x;){if(x===u){v=!0,u=m,f=p;break}if(x===f){v=!0,f=m,u=p;break}x=x.sibling}if(!v)throw Error(s(189))}}if(u.alternate!==f)throw Error(s(190))}if(u.tag!==3)throw Error(s(188));return u.stateNode.current===u?a:o}function K(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=K(a),o!==null)return o;a=a.sibling}return null}var ee=Array.isArray,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},pe=[],Re=-1;function _e(a){return{current:a}}function Ie(a){0>Re||(a.current=pe[Re],pe[Re]=null,Re--)}function Te(a,o){Re++,pe[Re]=a.current,a.current=o}var Lt=_e(null),Mn=_e(null),Pn=_e(null),xi=_e(null);function Be(a,o){switch(Te(Pn,o),Te(Mn,a),Te(Lt,null),a=o.nodeType,a){case 9:case 11:o=(o=o.documentElement)&&(o=o.namespaceURI)?db(o):0;break;default:if(a=a===8?o.parentNode:o,o=a.tagName,a=a.namespaceURI)a=db(a),o=gb(a,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}Ie(Lt),Te(Lt,o)}function ke(){Ie(Lt),Ie(Mn),Ie(Pn)}function zh(a){a.memoizedState!==null&&Te(xi,a);var o=Lt.current,u=gb(o,a.type);o!==u&&(Te(Mn,a),Te(Lt,u))}function Pl(a){Mn.current===a&&(Ie(Lt),Ie(Mn)),xi.current===a&&(Ie(xi),No._currentValue=le)}var Vh=Object.prototype.hasOwnProperty,jh=n.unstable_scheduleCallback,$h=n.unstable_cancelCallback,AA=n.unstable_shouldYield,EA=n.unstable_requestPaint,Wn=n.unstable_now,RA=n.unstable_getCurrentPriorityLevel,nm=n.unstable_ImmediatePriority,sm=n.unstable_UserBlockingPriority,Il=n.unstable_NormalPriority,CA=n.unstable_LowPriority,im=n.unstable_IdlePriority,OA=n.log,MA=n.unstable_setDisableYieldValue,ja=null,nn=null;function PA(a){if(nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(ja,a,void 0,(a.current.flags&128)===128)}catch{}}function Is(a){if(typeof OA=="function"&&MA(a),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(ja,a)}catch{}}var sn=Math.clz32?Math.clz32:NA,IA=Math.log,kA=Math.LN2;function NA(a){return a>>>=0,a===0?32:31-(IA(a)/kA|0)|0}var kl=128,Nl=4194304;function Si(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Dl(a,o){var u=a.pendingLanes;if(u===0)return 0;var f=0,p=a.suspendedLanes,m=a.pingedLanes,v=a.warmLanes;a=a.finishedLanes!==0;var x=u&134217727;return x!==0?(u=x&~p,u!==0?f=Si(u):(m&=x,m!==0?f=Si(m):a||(v=x&~v,v!==0&&(f=Si(v))))):(x=u&~p,x!==0?f=Si(x):m!==0?f=Si(m):a||(v=u&~v,v!==0&&(f=Si(v)))),f===0?0:o!==0&&o!==f&&(o&p)===0&&(p=f&-f,v=o&-o,p>=v||p===32&&(v&4194176)!==0)?o:f}function $a(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function DA(a,o){switch(a){case 1:case 2:case 4:case 8:return o+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rm(){var a=kl;return kl<<=1,(kl&4194176)===0&&(kl=128),a}function am(){var a=Nl;return Nl<<=1,(Nl&62914560)===0&&(Nl=4194304),a}function Hh(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Ha(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function BA(a,o,u,f,p,m){var v=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var x=a.entanglements,M=a.expirationTimes,V=a.hiddenUpdates;for(u=v&~u;0<u;){var te=31-sn(u),re=1<<te;x[te]=0,M[te]=-1;var Y=V[te];if(Y!==null)for(V[te]=null,te=0;te<Y.length;te++){var G=Y[te];G!==null&&(G.lane&=-536870913)}u&=~re}f!==0&&om(a,f,0),m!==0&&p===0&&a.tag!==0&&(a.suspendedLanes|=m&~(v&~o))}function om(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-sn(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194218}function lm(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-sn(u),p=1<<f;p&o|a[f]&o&&(a[f]|=o),u&=~p}}function cm(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function um(){var a=se.p;return a!==0?a:(a=window.event,a===void 0?32:Ib(a.type))}function UA(a,o){var u=se.p;try{return se.p=a,o()}finally{se.p=u}}var ks=Math.random().toString(36).slice(2),Ft="__reactFiber$"+ks,Qt="__reactProps$"+ks,pr="__reactContainer$"+ks,Wh="__reactEvents$"+ks,LA="__reactListeners$"+ks,FA="__reactHandles$"+ks,hm="__reactResources$"+ks,Wa="__reactMarker$"+ks;function Xh(a){delete a[Ft],delete a[Qt],delete a[Wh],delete a[LA],delete a[FA]}function Ai(a){var o=a[Ft];if(o)return o;for(var u=a.parentNode;u;){if(o=u[pr]||u[Ft]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=mb(a);a!==null;){if(u=a[Ft])return u;a=mb(a)}return o}a=u,u=a.parentNode}return null}function _r(a){if(a=a[Ft]||a[pr]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function Xa(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(s(33))}function mr(a){var o=a[hm];return o||(o=a[hm]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function At(a){a[Wa]=!0}var fm=new Set,dm={};function Ei(a,o){yr(a,o),yr(a+"Capture",o)}function yr(a,o){for(dm[a]=o,a=0;a<o.length;a++)fm.add(o[a])}var as=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gm={},pm={};function VA(a){return Vh.call(pm,a)?!0:Vh.call(gm,a)?!1:zA.test(a)?pm[a]=!0:(gm[a]=!0,!1)}function Bl(a,o,u){if(VA(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Ul(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function os(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}function dn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function _m(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function jA(a){var o=_m(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,m=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return p.call(this)},set:function(v){f=""+v,m.call(this,v)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(v){f=""+v},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Ll(a){a._valueTracker||(a._valueTracker=jA(a))}function mm(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=_m(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function Fl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var $A=/[\n"\\]/g;function gn(a){return a.replace($A,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function qh(a,o,u,f,p,m,v,x){a.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?a.type=v:a.removeAttribute("type"),o!=null?v==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+dn(o)):a.value!==""+dn(o)&&(a.value=""+dn(o)):v!=="submit"&&v!=="reset"||a.removeAttribute("value"),o!=null?Yh(a,v,dn(o)):u!=null?Yh(a,v,dn(u)):f!=null&&a.removeAttribute("value"),p==null&&m!=null&&(a.defaultChecked=!!m),p!=null&&(a.checked=p&&typeof p!="function"&&typeof p!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?a.name=""+dn(x):a.removeAttribute("name")}function ym(a,o,u,f,p,m,v,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(a.type=m),o!=null||u!=null){if(!(m!=="submit"&&m!=="reset"||o!=null))return;u=u!=null?""+dn(u):"",o=o!=null?""+dn(o):u,x||o===a.value||(a.value=o),a.defaultValue=o}f=f??p,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=x?a.checked:!!f,a.defaultChecked=!!f,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(a.name=v)}function Yh(a,o,u){o==="number"&&Fl(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function br(a,o,u,f){if(a=a.options,o){o={};for(var p=0;p<u.length;p++)o["$"+u[p]]=!0;for(u=0;u<a.length;u++)p=o.hasOwnProperty("$"+a[u].value),a[u].selected!==p&&(a[u].selected=p),p&&f&&(a[u].defaultSelected=!0)}else{for(u=""+dn(u),o=null,p=0;p<a.length;p++){if(a[p].value===u){a[p].selected=!0,f&&(a[p].defaultSelected=!0);return}o!==null||a[p].disabled||(o=a[p])}o!==null&&(o.selected=!0)}}function bm(a,o,u){if(o!=null&&(o=""+dn(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+dn(u):""}function vm(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(s(92));if(ee(f)){if(1<f.length)throw Error(s(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=dn(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function vr(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var HA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tm(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||HA.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function wm(a,o,u){if(o!=null&&typeof o!="object")throw Error(s(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var p in o)f=o[p],o.hasOwnProperty(p)&&u[p]!==f&&Tm(a,p,f)}else for(var m in o)o.hasOwnProperty(m)&&Tm(a,m,o[m])}function Kh(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var WA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),XA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zl(a){return XA.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Zh=null;function Qh(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Tr=null,wr=null;function xm(a){var o=_r(a);if(o&&(a=o.stateNode)){var u=a[Qt]||null;e:switch(a=o.stateNode,o.type){case"input":if(qh(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+gn(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var p=f[Qt]||null;if(!p)throw Error(s(90));qh(f,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&mm(f)}break e;case"textarea":bm(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&br(a,!!u.multiple,o,!1)}}}var Gh=!1;function Sm(a,o,u){if(Gh)return a(o,u);Gh=!0;try{var f=a(o);return f}finally{if(Gh=!1,(Tr!==null||wr!==null)&&(xc(),Tr&&(o=Tr,a=wr,wr=Tr=null,xm(o),a)))for(o=0;o<a.length;o++)xm(a[o])}}function qa(a,o){var u=a.stateNode;if(u===null)return null;var f=u[Qt]||null;if(f===null)return null;u=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(s(231,o,typeof u));return u}var Jh=!1;if(as)try{var Ya={};Object.defineProperty(Ya,"passive",{get:function(){Jh=!0}}),window.addEventListener("test",Ya,Ya),window.removeEventListener("test",Ya,Ya)}catch{Jh=!1}var Ns=null,ef=null,Vl=null;function Am(){if(Vl)return Vl;var a,o=ef,u=o.length,f,p="value"in Ns?Ns.value:Ns.textContent,m=p.length;for(a=0;a<u&&o[a]===p[a];a++);var v=u-a;for(f=1;f<=v&&o[u-f]===p[m-f];f++);return Vl=p.slice(a,1<f?1-f:void 0)}function jl(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function $l(){return!0}function Em(){return!1}function Gt(a){function o(u,f,p,m,v){this._reactName=u,this._targetInst=p,this.type=f,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var x in a)a.hasOwnProperty(x)&&(u=a[x],this[x]=u?u(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?$l:Em,this.isPropagationStopped=Em,this}return oe(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=$l)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=$l)},persist:function(){},isPersistent:$l}),o}var Ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hl=Gt(Ri),Ka=oe({},Ri,{view:0,detail:0}),qA=Gt(Ka),tf,nf,Za,Wl=oe({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rf,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Za&&(Za&&a.type==="mousemove"?(tf=a.screenX-Za.screenX,nf=a.screenY-Za.screenY):nf=tf=0,Za=a),tf)},movementY:function(a){return"movementY"in a?a.movementY:nf}}),Rm=Gt(Wl),YA=oe({},Wl,{dataTransfer:0}),KA=Gt(YA),ZA=oe({},Ka,{relatedTarget:0}),sf=Gt(ZA),QA=oe({},Ri,{animationName:0,elapsedTime:0,pseudoElement:0}),GA=Gt(QA),JA=oe({},Ri,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),e2=Gt(JA),t2=oe({},Ri,{data:0}),Cm=Gt(t2),n2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},i2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function r2(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=i2[a])?!!o[a]:!1}function rf(){return r2}var a2=oe({},Ka,{key:function(a){if(a.key){var o=n2[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=jl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?s2[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rf,charCode:function(a){return a.type==="keypress"?jl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?jl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),o2=Gt(a2),l2=oe({},Wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Om=Gt(l2),c2=oe({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rf}),u2=Gt(c2),h2=oe({},Ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),f2=Gt(h2),d2=oe({},Wl,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),g2=Gt(d2),p2=oe({},Ri,{newState:0,oldState:0}),_2=Gt(p2),m2=[9,13,27,32],af=as&&"CompositionEvent"in window,Qa=null;as&&"documentMode"in document&&(Qa=document.documentMode);var y2=as&&"TextEvent"in window&&!Qa,Mm=as&&(!af||Qa&&8<Qa&&11>=Qa),Pm=" ",Im=!1;function km(a,o){switch(a){case"keyup":return m2.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var xr=!1;function b2(a,o){switch(a){case"compositionend":return Nm(o);case"keypress":return o.which!==32?null:(Im=!0,Pm);case"textInput":return a=o.data,a===Pm&&Im?null:a;default:return null}}function v2(a,o){if(xr)return a==="compositionend"||!af&&km(a,o)?(a=Am(),Vl=ef=Ns=null,xr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Mm&&o.locale!=="ko"?null:o.data;default:return null}}var T2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dm(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!T2[a.type]:o==="textarea"}function Bm(a,o,u,f){Tr?wr?wr.push(f):wr=[f]:Tr=f,o=Cc(o,"onChange"),0<o.length&&(u=new Hl("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var Ga=null,Ja=null;function w2(a){lb(a,0)}function Xl(a){var o=Xa(a);if(mm(o))return a}function Um(a,o){if(a==="change")return o}var Lm=!1;if(as){var of;if(as){var lf="oninput"in document;if(!lf){var Fm=document.createElement("div");Fm.setAttribute("oninput","return;"),lf=typeof Fm.oninput=="function"}of=lf}else of=!1;Lm=of&&(!document.documentMode||9<document.documentMode)}function zm(){Ga&&(Ga.detachEvent("onpropertychange",Vm),Ja=Ga=null)}function Vm(a){if(a.propertyName==="value"&&Xl(Ja)){var o=[];Bm(o,Ja,a,Qh(a)),Sm(w2,o)}}function x2(a,o,u){a==="focusin"?(zm(),Ga=o,Ja=u,Ga.attachEvent("onpropertychange",Vm)):a==="focusout"&&zm()}function S2(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Xl(Ja)}function A2(a,o){if(a==="click")return Xl(o)}function E2(a,o){if(a==="input"||a==="change")return Xl(o)}function R2(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var rn=typeof Object.is=="function"?Object.is:R2;function eo(a,o){if(rn(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var p=u[f];if(!Vh.call(o,p)||!rn(a[p],o[p]))return!1}return!0}function jm(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function $m(a,o){var u=jm(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=jm(u)}}function Hm(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?Hm(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function Wm(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Fl(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Fl(a.document)}return o}function cf(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}function C2(a,o){var u=Wm(o);o=a.focusedElem;var f=a.selectionRange;if(u!==o&&o&&o.ownerDocument&&Hm(o.ownerDocument.documentElement,o)){if(f!==null&&cf(o)){if(a=f.start,u=f.end,u===void 0&&(u=a),"selectionStart"in o)o.selectionStart=a,o.selectionEnd=Math.min(u,o.value.length);else if(u=(a=o.ownerDocument||document)&&a.defaultView||window,u.getSelection){u=u.getSelection();var p=o.textContent.length,m=Math.min(f.start,p);f=f.end===void 0?m:Math.min(f.end,p),!u.extend&&m>f&&(p=f,f=m,m=p),p=$m(o,m);var v=$m(o,f);p&&v&&(u.rangeCount!==1||u.anchorNode!==p.node||u.anchorOffset!==p.offset||u.focusNode!==v.node||u.focusOffset!==v.offset)&&(a=a.createRange(),a.setStart(p.node,p.offset),u.removeAllRanges(),m>f?(u.addRange(a),u.extend(v.node,v.offset)):(a.setEnd(v.node,v.offset),u.addRange(a)))}}for(a=[],u=o;u=u.parentNode;)u.nodeType===1&&a.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<a.length;o++)u=a[o],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var O2=as&&"documentMode"in document&&11>=document.documentMode,Sr=null,uf=null,to=null,hf=!1;function Xm(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;hf||Sr==null||Sr!==Fl(f)||(f=Sr,"selectionStart"in f&&cf(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),to&&eo(to,f)||(to=f,f=Cc(uf,"onSelect"),0<f.length&&(o=new Hl("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=Sr)))}function Ci(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Ar={animationend:Ci("Animation","AnimationEnd"),animationiteration:Ci("Animation","AnimationIteration"),animationstart:Ci("Animation","AnimationStart"),transitionrun:Ci("Transition","TransitionRun"),transitionstart:Ci("Transition","TransitionStart"),transitioncancel:Ci("Transition","TransitionCancel"),transitionend:Ci("Transition","TransitionEnd")},ff={},qm={};as&&(qm=document.createElement("div").style,"AnimationEvent"in window||(delete Ar.animationend.animation,delete Ar.animationiteration.animation,delete Ar.animationstart.animation),"TransitionEvent"in window||delete Ar.transitionend.transition);function Oi(a){if(ff[a])return ff[a];if(!Ar[a])return a;var o=Ar[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in qm)return ff[a]=o[u];return a}var Ym=Oi("animationend"),Km=Oi("animationiteration"),Zm=Oi("animationstart"),M2=Oi("transitionrun"),P2=Oi("transitionstart"),I2=Oi("transitioncancel"),Qm=Oi("transitionend"),Gm=new Map,Jm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function In(a,o){Gm.set(a,o),Ei(o,[a])}var pn=[],Er=0,df=0;function ql(){for(var a=Er,o=df=Er=0;o<a;){var u=pn[o];pn[o++]=null;var f=pn[o];pn[o++]=null;var p=pn[o];pn[o++]=null;var m=pn[o];if(pn[o++]=null,f!==null&&p!==null){var v=f.pending;v===null?p.next=p:(p.next=v.next,v.next=p),f.pending=p}m!==0&&ey(u,p,m)}}function Yl(a,o,u,f){pn[Er++]=a,pn[Er++]=o,pn[Er++]=u,pn[Er++]=f,df|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function gf(a,o,u,f){return Yl(a,o,u,f),Kl(a)}function Ds(a,o){return Yl(a,null,null,o),Kl(a)}function ey(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var p=!1,m=a.return;m!==null;)m.childLanes|=u,f=m.alternate,f!==null&&(f.childLanes|=u),m.tag===22&&(a=m.stateNode,a===null||a._visibility&1||(p=!0)),a=m,m=m.return;p&&o!==null&&a.tag===3&&(m=a.stateNode,p=31-sn(u),m=m.hiddenUpdates,a=m[p],a===null?m[p]=[o]:a.push(o),o.lane=u|536870912)}function Kl(a){if(50<Ro)throw Ro=0,vd=null,Error(s(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Rr={},ty=new WeakMap;function _n(a,o){if(typeof a=="object"&&a!==null){var u=ty.get(a);return u!==void 0?u:(o={value:a,source:o,stack:N(o)},ty.set(a,o),o)}return{value:a,source:o,stack:N(o)}}var Cr=[],Or=0,Zl=null,Ql=0,mn=[],yn=0,Mi=null,ls=1,cs="";function Pi(a,o){Cr[Or++]=Ql,Cr[Or++]=Zl,Zl=a,Ql=o}function ny(a,o,u){mn[yn++]=ls,mn[yn++]=cs,mn[yn++]=Mi,Mi=a;var f=ls;a=cs;var p=32-sn(f)-1;f&=~(1<<p),u+=1;var m=32-sn(o)+p;if(30<m){var v=p-p%5;m=(f&(1<<v)-1).toString(32),f>>=v,p-=v,ls=1<<32-sn(o)+p|u<<p|f,cs=m+a}else ls=1<<m|u<<p|f,cs=a}function pf(a){a.return!==null&&(Pi(a,1),ny(a,1,0))}function _f(a){for(;a===Zl;)Zl=Cr[--Or],Cr[Or]=null,Ql=Cr[--Or],Cr[Or]=null;for(;a===Mi;)Mi=mn[--yn],mn[yn]=null,cs=mn[--yn],mn[yn]=null,ls=mn[--yn],mn[yn]=null}var qt=null,It=null,Ve=!1,kn=null,Xn=!1,mf=Error(s(519));function Ii(a){var o=Error(s(418,""));throw io(_n(o,a)),mf}function sy(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[Ft]=a,o[Qt]=f,u){case"dialog":Ue("cancel",o),Ue("close",o);break;case"iframe":case"object":case"embed":Ue("load",o);break;case"video":case"audio":for(u=0;u<Oo.length;u++)Ue(Oo[u],o);break;case"source":Ue("error",o);break;case"img":case"image":case"link":Ue("error",o),Ue("load",o);break;case"details":Ue("toggle",o);break;case"input":Ue("invalid",o),ym(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),Ll(o);break;case"select":Ue("invalid",o);break;case"textarea":Ue("invalid",o),vm(o,f.value,f.defaultValue,f.children),Ll(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||fb(o.textContent,u)?(f.popover!=null&&(Ue("beforetoggle",o),Ue("toggle",o)),f.onScroll!=null&&Ue("scroll",o),f.onScrollEnd!=null&&Ue("scrollend",o),f.onClick!=null&&(o.onclick=Oc),o=!0):o=!1,o||Ii(a)}function iy(a){for(qt=a.return;qt;)switch(qt.tag){case 3:case 27:Xn=!0;return;case 5:case 13:Xn=!1;return;default:qt=qt.return}}function no(a){if(a!==qt)return!1;if(!Ve)return iy(a),Ve=!0,!1;var o=!1,u;if((u=a.tag!==3&&a.tag!==27)&&((u=a.tag===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||Ud(a.type,a.memoizedProps)),u=!u),u&&(o=!0),o&&It&&Ii(a),iy(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));e:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){It=Dn(a.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}It=null}}else It=qt?Dn(a.stateNode.nextSibling):null;return!0}function so(){It=qt=null,Ve=!1}function io(a){kn===null?kn=[a]:kn.push(a)}var ro=Error(s(460)),ry=Error(s(474)),yf={then:function(){}};function ay(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Gl(){}function oy(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(Gl,Gl),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,a===ro?Error(s(483)):a;default:if(typeof o.status=="string")o.then(Gl,Gl);else{if(a=Je,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var p=o;p.status="fulfilled",p.value=f}},function(f){if(o.status==="pending"){var p=o;p.status="rejected",p.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,a===ro?Error(s(483)):a}throw ao=o,ro}}var ao=null;function ly(){if(ao===null)throw Error(s(459));var a=ao;return ao=null,a}var Mr=null,oo=0;function Jl(a){var o=oo;return oo+=1,Mr===null&&(Mr=[]),oy(Mr,a,o)}function lo(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function ec(a,o){throw o.$$typeof===r?Error(s(525)):(a=Object.prototype.toString.call(o),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function cy(a){var o=a._init;return o(a._payload)}function uy(a){function o(W,B){if(a){var q=W.deletions;q===null?(W.deletions=[B],W.flags|=16):q.push(B)}}function u(W,B){if(!a)return null;for(;B!==null;)o(W,B),B=B.sibling;return null}function f(W){for(var B=new Map;W!==null;)W.key!==null?B.set(W.key,W):B.set(W.index,W),W=W.sibling;return B}function p(W,B){return W=qs(W,B),W.index=0,W.sibling=null,W}function m(W,B,q){return W.index=q,a?(q=W.alternate,q!==null?(q=q.index,q<B?(W.flags|=33554434,B):q):(W.flags|=33554434,B)):(W.flags|=1048576,B)}function v(W){return a&&W.alternate===null&&(W.flags|=33554434),W}function x(W,B,q,ie){return B===null||B.tag!==6?(B=fd(q,W.mode,ie),B.return=W,B):(B=p(B,q),B.return=W,B)}function M(W,B,q,ie){var ge=q.type;return ge===h?te(W,B,q.props.children,ie,q.key):B!==null&&(B.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===U&&cy(ge)===B.type)?(B=p(B,q.props),lo(B,q),B.return=W,B):(B=yc(q.type,q.key,q.props,null,W.mode,ie),lo(B,q),B.return=W,B)}function V(W,B,q,ie){return B===null||B.tag!==4||B.stateNode.containerInfo!==q.containerInfo||B.stateNode.implementation!==q.implementation?(B=dd(q,W.mode,ie),B.return=W,B):(B=p(B,q.children||[]),B.return=W,B)}function te(W,B,q,ie,ge){return B===null||B.tag!==7?(B=ji(q,W.mode,ie,ge),B.return=W,B):(B=p(B,q),B.return=W,B)}function re(W,B,q){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=fd(""+B,W.mode,q),B.return=W,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case l:return q=yc(B.type,B.key,B.props,null,W.mode,q),lo(q,B),q.return=W,q;case c:return B=dd(B,W.mode,q),B.return=W,B;case U:var ie=B._init;return B=ie(B._payload),re(W,B,q)}if(ee(B)||Z(B))return B=ji(B,W.mode,q,null),B.return=W,B;if(typeof B.then=="function")return re(W,Jl(B),q);if(B.$$typeof===b)return re(W,pc(W,B),q);ec(W,B)}return null}function Y(W,B,q,ie){var ge=B!==null?B.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return ge!==null?null:x(W,B,""+q,ie);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case l:return q.key===ge?M(W,B,q,ie):null;case c:return q.key===ge?V(W,B,q,ie):null;case U:return ge=q._init,q=ge(q._payload),Y(W,B,q,ie)}if(ee(q)||Z(q))return ge!==null?null:te(W,B,q,ie,null);if(typeof q.then=="function")return Y(W,B,Jl(q),ie);if(q.$$typeof===b)return Y(W,B,pc(W,q),ie);ec(W,q)}return null}function G(W,B,q,ie,ge){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return W=W.get(q)||null,x(B,W,""+ie,ge);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case l:return W=W.get(ie.key===null?q:ie.key)||null,M(B,W,ie,ge);case c:return W=W.get(ie.key===null?q:ie.key)||null,V(B,W,ie,ge);case U:var Pe=ie._init;return ie=Pe(ie._payload),G(W,B,q,ie,ge)}if(ee(ie)||Z(ie))return W=W.get(q)||null,te(B,W,ie,ge,null);if(typeof ie.then=="function")return G(W,B,q,Jl(ie),ge);if(ie.$$typeof===b)return G(W,B,q,pc(B,ie),ge);ec(B,ie)}return null}function me(W,B,q,ie){for(var ge=null,Pe=null,ye=B,we=B=0,Ct=null;ye!==null&&we<q.length;we++){ye.index>we?(Ct=ye,ye=null):Ct=ye.sibling;var je=Y(W,ye,q[we],ie);if(je===null){ye===null&&(ye=Ct);break}a&&ye&&je.alternate===null&&o(W,ye),B=m(je,B,we),Pe===null?ge=je:Pe.sibling=je,Pe=je,ye=Ct}if(we===q.length)return u(W,ye),Ve&&Pi(W,we),ge;if(ye===null){for(;we<q.length;we++)ye=re(W,q[we],ie),ye!==null&&(B=m(ye,B,we),Pe===null?ge=ye:Pe.sibling=ye,Pe=ye);return Ve&&Pi(W,we),ge}for(ye=f(ye);we<q.length;we++)Ct=G(ye,W,we,q[we],ie),Ct!==null&&(a&&Ct.alternate!==null&&ye.delete(Ct.key===null?we:Ct.key),B=m(Ct,B,we),Pe===null?ge=Ct:Pe.sibling=Ct,Pe=Ct);return a&&ye.forEach(function(ei){return o(W,ei)}),Ve&&Pi(W,we),ge}function Ae(W,B,q,ie){if(q==null)throw Error(s(151));for(var ge=null,Pe=null,ye=B,we=B=0,Ct=null,je=q.next();ye!==null&&!je.done;we++,je=q.next()){ye.index>we?(Ct=ye,ye=null):Ct=ye.sibling;var ei=Y(W,ye,je.value,ie);if(ei===null){ye===null&&(ye=Ct);break}a&&ye&&ei.alternate===null&&o(W,ye),B=m(ei,B,we),Pe===null?ge=ei:Pe.sibling=ei,Pe=ei,ye=Ct}if(je.done)return u(W,ye),Ve&&Pi(W,we),ge;if(ye===null){for(;!je.done;we++,je=q.next())je=re(W,je.value,ie),je!==null&&(B=m(je,B,we),Pe===null?ge=je:Pe.sibling=je,Pe=je);return Ve&&Pi(W,we),ge}for(ye=f(ye);!je.done;we++,je=q.next())je=G(ye,W,we,je.value,ie),je!==null&&(a&&je.alternate!==null&&ye.delete(je.key===null?we:je.key),B=m(je,B,we),Pe===null?ge=je:Pe.sibling=je,Pe=je);return a&&ye.forEach(function(X3){return o(W,X3)}),Ve&&Pi(W,we),ge}function ct(W,B,q,ie){if(typeof q=="object"&&q!==null&&q.type===h&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case l:e:{for(var ge=q.key;B!==null;){if(B.key===ge){if(ge=q.type,ge===h){if(B.tag===7){u(W,B.sibling),ie=p(B,q.props.children),ie.return=W,W=ie;break e}}else if(B.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===U&&cy(ge)===B.type){u(W,B.sibling),ie=p(B,q.props),lo(ie,q),ie.return=W,W=ie;break e}u(W,B);break}else o(W,B);B=B.sibling}q.type===h?(ie=ji(q.props.children,W.mode,ie,q.key),ie.return=W,W=ie):(ie=yc(q.type,q.key,q.props,null,W.mode,ie),lo(ie,q),ie.return=W,W=ie)}return v(W);case c:e:{for(ge=q.key;B!==null;){if(B.key===ge)if(B.tag===4&&B.stateNode.containerInfo===q.containerInfo&&B.stateNode.implementation===q.implementation){u(W,B.sibling),ie=p(B,q.children||[]),ie.return=W,W=ie;break e}else{u(W,B);break}else o(W,B);B=B.sibling}ie=dd(q,W.mode,ie),ie.return=W,W=ie}return v(W);case U:return ge=q._init,q=ge(q._payload),ct(W,B,q,ie)}if(ee(q))return me(W,B,q,ie);if(Z(q)){if(ge=Z(q),typeof ge!="function")throw Error(s(150));return q=ge.call(q),Ae(W,B,q,ie)}if(typeof q.then=="function")return ct(W,B,Jl(q),ie);if(q.$$typeof===b)return ct(W,B,pc(W,q),ie);ec(W,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,B!==null&&B.tag===6?(u(W,B.sibling),ie=p(B,q),ie.return=W,W=ie):(u(W,B),ie=fd(q,W.mode,ie),ie.return=W,W=ie),v(W)):u(W,B)}return function(W,B,q,ie){try{oo=0;var ge=ct(W,B,q,ie);return Mr=null,ge}catch(ye){if(ye===ro)throw ye;var Pe=wn(29,ye,null,W.mode);return Pe.lanes=ie,Pe.return=W,Pe}finally{}}}var ki=uy(!0),hy=uy(!1),Pr=_e(null),tc=_e(0);function fy(a,o){a=vs,Te(tc,a),Te(Pr,o),vs=a|o.baseLanes}function bf(){Te(tc,vs),Te(Pr,Pr.current)}function vf(){vs=tc.current,Ie(Pr),Ie(tc)}var bn=_e(null),qn=null;function Bs(a){var o=a.alternate;Te(Tt,Tt.current&1),Te(bn,a),qn===null&&(o===null||Pr.current!==null||o.memoizedState!==null)&&(qn=a)}function dy(a){if(a.tag===22){if(Te(Tt,Tt.current),Te(bn,a),qn===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(qn=a)}}else Us()}function Us(){Te(Tt,Tt.current),Te(bn,bn.current)}function us(a){Ie(bn),qn===a&&(qn=null),Ie(Tt)}var Tt=_e(0);function nc(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var k2=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},N2=n.unstable_scheduleCallback,D2=n.unstable_NormalPriority,wt={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Tf(){return{controller:new k2,data:new Map,refCount:0}}function co(a){a.refCount--,a.refCount===0&&N2(D2,function(){a.controller.abort()})}var uo=null,wf=0,Ir=0,kr=null;function B2(a,o){if(uo===null){var u=uo=[];wf=0,Ir=Cd(),kr={status:"pending",value:void 0,then:function(f){u.push(f)}}}return wf++,o.then(gy,gy),o}function gy(){if(--wf===0&&uo!==null){kr!==null&&(kr.status="fulfilled");var a=uo;uo=null,Ir=0,kr=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function U2(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var p=0;p<u.length;p++)(0,u[p])(o)},function(p){for(f.status="rejected",f.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),f}var py=J.S;J.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&B2(a,o),py!==null&&py(a,o)};var Ni=_e(null);function xf(){var a=Ni.current;return a!==null?a:Je.pooledCache}function sc(a,o){o===null?Te(Ni,Ni.current):Te(Ni,o.pool)}function _y(){var a=xf();return a===null?null:{parent:wt._currentValue,pool:a}}var Ls=0,Me=null,Xe=null,gt=null,ic=!1,Nr=!1,Di=!1,rc=0,ho=0,Dr=null,L2=0;function dt(){throw Error(s(321))}function Sf(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!rn(a[u],o[u]))return!1;return!0}function Af(a,o,u,f,p,m){return Ls=m,Me=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,J.H=a===null||a.memoizedState===null?Bi:Fs,Di=!1,m=u(f,p),Di=!1,Nr&&(m=yy(o,u,f,p)),my(a),m}function my(a){J.H=Yn;var o=Xe!==null&&Xe.next!==null;if(Ls=0,gt=Xe=Me=null,ic=!1,ho=0,Dr=null,o)throw Error(s(300));a===null||Et||(a=a.dependencies,a!==null&&gc(a)&&(Et=!0))}function yy(a,o,u,f){Me=a;var p=0;do{if(Nr&&(Dr=null),ho=0,Nr=!1,25<=p)throw Error(s(301));if(p+=1,gt=Xe=null,a.updateQueue!=null){var m=a.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}J.H=Ui,m=o(u,f)}while(Nr);return m}function F2(){var a=J.H,o=a.useState()[0];return o=typeof o.then=="function"?fo(o):o,a=a.useState()[0],(Xe!==null?Xe.memoizedState:null)!==a&&(Me.flags|=1024),o}function Ef(){var a=rc!==0;return rc=0,a}function Rf(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function Cf(a){if(ic){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}ic=!1}Ls=0,gt=Xe=Me=null,Nr=!1,ho=rc=0,Dr=null}function Jt(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Me.memoizedState=gt=a:gt=gt.next=a,gt}function pt(){if(Xe===null){var a=Me.alternate;a=a!==null?a.memoizedState:null}else a=Xe.next;var o=gt===null?Me.memoizedState:gt.next;if(o!==null)gt=o,Xe=a;else{if(a===null)throw Me.alternate===null?Error(s(467)):Error(s(310));Xe=a,a={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},gt===null?Me.memoizedState=gt=a:gt=gt.next=a}return gt}var ac;ac=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function fo(a){var o=ho;return ho+=1,Dr===null&&(Dr=[]),a=oy(Dr,a,o),o=Me,(gt===null?o.memoizedState:gt.next)===null&&(o=o.alternate,J.H=o===null||o.memoizedState===null?Bi:Fs),a}function oc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return fo(a);if(a.$$typeof===b)return zt(a)}throw Error(s(438,String(a)))}function Of(a){var o=null,u=Me.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=Me.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(p){return p.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=ac(),Me.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=D;return o.index++,u}function hs(a,o){return typeof o=="function"?o(a):o}function lc(a){var o=pt();return Mf(o,Xe,a)}function Mf(a,o,u){var f=a.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=u;var p=a.baseQueue,m=f.pending;if(m!==null){if(p!==null){var v=p.next;p.next=m.next,m.next=v}o.baseQueue=p=m,f.pending=null}if(m=a.baseState,p===null)a.memoizedState=m;else{o=p.next;var x=v=null,M=null,V=o,te=!1;do{var re=V.lane&-536870913;if(re!==V.lane?(Fe&re)===re:(Ls&re)===re){var Y=V.revertLane;if(Y===0)M!==null&&(M=M.next={lane:0,revertLane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),re===Ir&&(te=!0);else if((Ls&Y)===Y){V=V.next,Y===Ir&&(te=!0);continue}else re={lane:0,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},M===null?(x=M=re,v=m):M=M.next=re,Me.lanes|=Y,Ys|=Y;re=V.action,Di&&u(m,re),m=V.hasEagerState?V.eagerState:u(m,re)}else Y={lane:re,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},M===null?(x=M=Y,v=m):M=M.next=Y,Me.lanes|=re,Ys|=re;V=V.next}while(V!==null&&V!==o);if(M===null?v=m:M.next=x,!rn(m,a.memoizedState)&&(Et=!0,te&&(u=kr,u!==null)))throw u;a.memoizedState=m,a.baseState=v,a.baseQueue=M,f.lastRenderedState=m}return p===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function Pf(a){var o=pt(),u=o.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=a;var f=u.dispatch,p=u.pending,m=o.memoizedState;if(p!==null){u.pending=null;var v=p=p.next;do m=a(m,v.action),v=v.next;while(v!==p);rn(m,o.memoizedState)||(Et=!0),o.memoizedState=m,o.baseQueue===null&&(o.baseState=m),u.lastRenderedState=m}return[m,f]}function by(a,o,u){var f=Me,p=pt(),m=Ve;if(m){if(u===void 0)throw Error(s(407));u=u()}else u=o();var v=!rn((Xe||p).memoizedState,u);if(v&&(p.memoizedState=u,Et=!0),p=p.queue,Nf(wy.bind(null,f,p,a),[a]),p.getSnapshot!==o||v||gt!==null&&gt.memoizedState.tag&1){if(f.flags|=2048,Br(9,Ty.bind(null,f,p,u,o),{destroy:void 0},null),Je===null)throw Error(s(349));m||(Ls&60)!==0||vy(f,o,u)}return u}function vy(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=Me.updateQueue,o===null?(o=ac(),Me.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function Ty(a,o,u,f){o.value=u,o.getSnapshot=f,xy(o)&&Sy(a)}function wy(a,o,u){return u(function(){xy(o)&&Sy(a)})}function xy(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!rn(a,u)}catch{return!0}}function Sy(a){var o=Ds(a,2);o!==null&&Yt(o,a,2)}function If(a){var o=Jt();if(typeof a=="function"){var u=a;if(a=u(),Di){Is(!0);try{u()}finally{Is(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:a},o}function Ay(a,o,u,f){return a.baseState=u,Mf(a,Xe,typeof f=="function"?f:hs)}function z2(a,o,u,f,p){if(hc(a))throw Error(s(485));if(a=o.action,a!==null){var m={payload:p,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};J.T!==null?u(!0):m.isTransition=!1,f(m),u=o.pending,u===null?(m.next=o.pending=m,Ey(o,m)):(m.next=u.next,o.pending=u.next=m)}}function Ey(a,o){var u=o.action,f=o.payload,p=a.state;if(o.isTransition){var m=J.T,v={};J.T=v;try{var x=u(p,f),M=J.S;M!==null&&M(v,x),Ry(a,o,x)}catch(V){kf(a,o,V)}finally{J.T=m}}else try{m=u(p,f),Ry(a,o,m)}catch(V){kf(a,o,V)}}function Ry(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){Cy(a,o,f)},function(f){return kf(a,o,f)}):Cy(a,o,u)}function Cy(a,o,u){o.status="fulfilled",o.value=u,Oy(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,Ey(a,u)))}function kf(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,Oy(o),o=o.next;while(o!==f)}a.action=null}function Oy(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function My(a,o){return o}function Py(a,o){if(Ve){var u=Je.formState;if(u!==null){e:{var f=Me;if(Ve){if(It){t:{for(var p=It,m=Xn;p.nodeType!==8;){if(!m){p=null;break t}if(p=Dn(p.nextSibling),p===null){p=null;break t}}m=p.data,p=m==="F!"||m==="F"?p:null}if(p){It=Dn(p.nextSibling),f=p.data==="F!";break e}}Ii(f)}f=!1}f&&(o=u[0])}}return u=Jt(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:My,lastRenderedState:o},u.queue=f,u=Ky.bind(null,Me,f),f.dispatch=u,f=If(!1),m=Ff.bind(null,Me,!1,f.queue),f=Jt(),p={state:o,dispatch:null,action:a,pending:null},f.queue=p,u=z2.bind(null,Me,p,m,u),p.dispatch=u,f.memoizedState=a,[o,u,!1]}function Iy(a){var o=pt();return ky(o,Xe,a)}function ky(a,o,u){o=Mf(a,o,My)[0],a=lc(hs)[0],o=typeof o=="object"&&o!==null&&typeof o.then=="function"?fo(o):o;var f=pt(),p=f.queue,m=p.dispatch;return u!==f.memoizedState&&(Me.flags|=2048,Br(9,V2.bind(null,p,u),{destroy:void 0},null)),[o,m,a]}function V2(a,o){a.action=o}function Ny(a){var o=pt(),u=Xe;if(u!==null)return ky(o,u,a);pt(),o=o.memoizedState,u=pt();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function Br(a,o,u,f){return a={tag:a,create:o,inst:u,deps:f,next:null},o=Me.updateQueue,o===null&&(o=ac(),Me.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function Dy(){return pt().memoizedState}function cc(a,o,u,f){var p=Jt();Me.flags|=a,p.memoizedState=Br(1|o,u,{destroy:void 0},f===void 0?null:f)}function uc(a,o,u,f){var p=pt();f=f===void 0?null:f;var m=p.memoizedState.inst;Xe!==null&&f!==null&&Sf(f,Xe.memoizedState.deps)?p.memoizedState=Br(o,u,m,f):(Me.flags|=a,p.memoizedState=Br(1|o,u,m,f))}function By(a,o){cc(8390656,8,a,o)}function Nf(a,o){uc(2048,8,a,o)}function Uy(a,o){return uc(4,2,a,o)}function Ly(a,o){return uc(4,4,a,o)}function Fy(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function zy(a,o,u){u=u!=null?u.concat([a]):null,uc(4,4,Fy.bind(null,o,a),u)}function Df(){}function Vy(a,o){var u=pt();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&Sf(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function jy(a,o){var u=pt();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&Sf(o,f[1]))return f[0];if(f=a(),Di){Is(!0);try{a()}finally{Is(!1)}}return u.memoizedState=[f,o],f}function Bf(a,o,u){return u===void 0||(Ls&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=H0(),Me.lanes|=a,Ys|=a,u)}function $y(a,o,u,f){return rn(u,o)?u:Pr.current!==null?(a=Bf(a,u,f),rn(a,o)||(Et=!0),a):(Ls&42)===0?(Et=!0,a.memoizedState=u):(a=H0(),Me.lanes|=a,Ys|=a,o)}function Hy(a,o,u,f,p){var m=se.p;se.p=m!==0&&8>m?m:8;var v=J.T,x={};J.T=x,Ff(a,!1,o,u);try{var M=p(),V=J.S;if(V!==null&&V(x,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var te=U2(M,f);go(a,o,te,cn(a))}else go(a,o,f,cn(a))}catch(re){go(a,o,{then:function(){},status:"rejected",reason:re},cn())}finally{se.p=m,J.T=v}}function j2(){}function Uf(a,o,u,f){if(a.tag!==5)throw Error(s(476));var p=Wy(a).queue;Hy(a,p,o,le,u===null?j2:function(){return Xy(a),u(f)})}function Wy(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:le},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function Xy(a){var o=Wy(a).next.queue;go(a,o,{},cn())}function Lf(){return zt(No)}function qy(){return pt().memoizedState}function Yy(){return pt().memoizedState}function $2(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=cn();a=js(u);var f=$s(o,a,u);f!==null&&(Yt(f,o,u),mo(f,o,u)),o={cache:Tf()},a.payload=o;return}o=o.return}}function H2(a,o,u){var f=cn();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},hc(a)?Zy(o,u):(u=gf(a,o,u,f),u!==null&&(Yt(u,a,f),Qy(u,o,f)))}function Ky(a,o,u){var f=cn();go(a,o,u,f)}function go(a,o,u,f){var p={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(hc(a))Zy(o,p);else{var m=a.alternate;if(a.lanes===0&&(m===null||m.lanes===0)&&(m=o.lastRenderedReducer,m!==null))try{var v=o.lastRenderedState,x=m(v,u);if(p.hasEagerState=!0,p.eagerState=x,rn(x,v))return Yl(a,o,p,0),Je===null&&ql(),!1}catch{}finally{}if(u=gf(a,o,p,f),u!==null)return Yt(u,a,f),Qy(u,o,f),!0}return!1}function Ff(a,o,u,f){if(f={lane:2,revertLane:Cd(),action:f,hasEagerState:!1,eagerState:null,next:null},hc(a)){if(o)throw Error(s(479))}else o=gf(a,u,f,2),o!==null&&Yt(o,a,2)}function hc(a){var o=a.alternate;return a===Me||o!==null&&o===Me}function Zy(a,o){Nr=ic=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function Qy(a,o,u){if((u&4194176)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,lm(a,u)}}var Yn={readContext:zt,use:oc,useCallback:dt,useContext:dt,useEffect:dt,useImperativeHandle:dt,useLayoutEffect:dt,useInsertionEffect:dt,useMemo:dt,useReducer:dt,useRef:dt,useState:dt,useDebugValue:dt,useDeferredValue:dt,useTransition:dt,useSyncExternalStore:dt,useId:dt};Yn.useCacheRefresh=dt,Yn.useMemoCache=dt,Yn.useHostTransitionStatus=dt,Yn.useFormState=dt,Yn.useActionState=dt,Yn.useOptimistic=dt;var Bi={readContext:zt,use:oc,useCallback:function(a,o){return Jt().memoizedState=[a,o===void 0?null:o],a},useContext:zt,useEffect:By,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,cc(4194308,4,Fy.bind(null,o,a),u)},useLayoutEffect:function(a,o){return cc(4194308,4,a,o)},useInsertionEffect:function(a,o){cc(4,2,a,o)},useMemo:function(a,o){var u=Jt();o=o===void 0?null:o;var f=a();if(Di){Is(!0);try{a()}finally{Is(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=Jt();if(u!==void 0){var p=u(o);if(Di){Is(!0);try{u(o)}finally{Is(!1)}}}else p=o;return f.memoizedState=f.baseState=p,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:p},f.queue=a,a=a.dispatch=H2.bind(null,Me,a),[f.memoizedState,a]},useRef:function(a){var o=Jt();return a={current:a},o.memoizedState=a},useState:function(a){a=If(a);var o=a.queue,u=Ky.bind(null,Me,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:Df,useDeferredValue:function(a,o){var u=Jt();return Bf(u,a,o)},useTransition:function(){var a=If(!1);return a=Hy.bind(null,Me,a.queue,!0,!1),Jt().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=Me,p=Jt();if(Ve){if(u===void 0)throw Error(s(407));u=u()}else{if(u=o(),Je===null)throw Error(s(349));(Fe&60)!==0||vy(f,o,u)}p.memoizedState=u;var m={value:u,getSnapshot:o};return p.queue=m,By(wy.bind(null,f,m,a),[a]),f.flags|=2048,Br(9,Ty.bind(null,f,m,u,o),{destroy:void 0},null),u},useId:function(){var a=Jt(),o=Je.identifierPrefix;if(Ve){var u=cs,f=ls;u=(f&~(1<<32-sn(f)-1)).toString(32)+u,o=":"+o+"R"+u,u=rc++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=L2++,o=":"+o+"r"+u.toString(32)+":";return a.memoizedState=o},useCacheRefresh:function(){return Jt().memoizedState=$2.bind(null,Me)}};Bi.useMemoCache=Of,Bi.useHostTransitionStatus=Lf,Bi.useFormState=Py,Bi.useActionState=Py,Bi.useOptimistic=function(a){var o=Jt();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Ff.bind(null,Me,!0,u),u.dispatch=o,[a,o]};var Fs={readContext:zt,use:oc,useCallback:Vy,useContext:zt,useEffect:Nf,useImperativeHandle:zy,useInsertionEffect:Uy,useLayoutEffect:Ly,useMemo:jy,useReducer:lc,useRef:Dy,useState:function(){return lc(hs)},useDebugValue:Df,useDeferredValue:function(a,o){var u=pt();return $y(u,Xe.memoizedState,a,o)},useTransition:function(){var a=lc(hs)[0],o=pt().memoizedState;return[typeof a=="boolean"?a:fo(a),o]},useSyncExternalStore:by,useId:qy};Fs.useCacheRefresh=Yy,Fs.useMemoCache=Of,Fs.useHostTransitionStatus=Lf,Fs.useFormState=Iy,Fs.useActionState=Iy,Fs.useOptimistic=function(a,o){var u=pt();return Ay(u,Xe,a,o)};var Ui={readContext:zt,use:oc,useCallback:Vy,useContext:zt,useEffect:Nf,useImperativeHandle:zy,useInsertionEffect:Uy,useLayoutEffect:Ly,useMemo:jy,useReducer:Pf,useRef:Dy,useState:function(){return Pf(hs)},useDebugValue:Df,useDeferredValue:function(a,o){var u=pt();return Xe===null?Bf(u,a,o):$y(u,Xe.memoizedState,a,o)},useTransition:function(){var a=Pf(hs)[0],o=pt().memoizedState;return[typeof a=="boolean"?a:fo(a),o]},useSyncExternalStore:by,useId:qy};Ui.useCacheRefresh=Yy,Ui.useMemoCache=Of,Ui.useHostTransitionStatus=Lf,Ui.useFormState=Ny,Ui.useActionState=Ny,Ui.useOptimistic=function(a,o){var u=pt();return Xe!==null?Ay(u,Xe,a,o):(u.baseState=a,[a,u.queue.dispatch])};function zf(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:oe({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Vf={isMounted:function(a){return(a=a._reactInternals)?I(a)===a:!1},enqueueSetState:function(a,o,u){a=a._reactInternals;var f=cn(),p=js(f);p.payload=o,u!=null&&(p.callback=u),o=$s(a,p,f),o!==null&&(Yt(o,a,f),mo(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=cn(),p=js(f);p.tag=1,p.payload=o,u!=null&&(p.callback=u),o=$s(a,p,f),o!==null&&(Yt(o,a,f),mo(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=cn(),f=js(u);f.tag=2,o!=null&&(f.callback=o),o=$s(a,f,u),o!==null&&(Yt(o,a,u),mo(o,a,u))}};function Gy(a,o,u,f,p,m,v){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,m,v):o.prototype&&o.prototype.isPureReactComponent?!eo(u,f)||!eo(p,m):!0}function Jy(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&Vf.enqueueReplaceState(o,o.state,null)}function Li(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=oe({},u));for(var p in a)u[p]===void 0&&(u[p]=a[p])}return u}var fc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function e0(a){fc(a)}function t0(a){console.error(a)}function n0(a){fc(a)}function dc(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function s0(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function jf(a,o,u){return u=js(u),u.tag=3,u.payload={element:null},u.callback=function(){dc(a,o)},u}function i0(a){return a=js(a),a.tag=3,a}function r0(a,o,u,f){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var m=f.value;a.payload=function(){return p(m)},a.callback=function(){s0(o,u,f)}}var v=u.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(a.callback=function(){s0(o,u,f),typeof p!="function"&&(Ks===null?Ks=new Set([this]):Ks.add(this));var x=f.stack;this.componentDidCatch(f.value,{componentStack:x!==null?x:""})})}function W2(a,o,u,f,p){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&_o(o,u,p,!0),u=bn.current,u!==null){switch(u.tag){case 13:return qn===null?xd():u.alternate===null&&lt===0&&(lt=3),u.flags&=-257,u.flags|=65536,u.lanes=p,f===yf?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),Ad(a,f,p)),!1;case 22:return u.flags|=65536,f===yf?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),Ad(a,f,p)),!1}throw Error(s(435,u.tag))}return Ad(a,f,p),xd(),!1}if(Ve)return o=bn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=p,f!==mf&&(a=Error(s(422),{cause:f}),io(_n(a,u)))):(f!==mf&&(o=Error(s(423),{cause:f}),io(_n(o,u))),a=a.current.alternate,a.flags|=65536,p&=-p,a.lanes|=p,f=_n(f,u),p=jf(a.stateNode,f,p),sd(a,p),lt!==4&&(lt=2)),!1;var m=Error(s(520),{cause:f});if(m=_n(m,u),Ao===null?Ao=[m]:Ao.push(m),lt!==4&&(lt=2),o===null)return!0;f=_n(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=p&-p,u.lanes|=a,a=jf(u.stateNode,f,a),sd(u,a),!1;case 1:if(o=u.type,m=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Ks===null||!Ks.has(m))))return u.flags|=65536,p&=-p,u.lanes|=p,p=i0(p),r0(p,a,u,f),sd(u,p),!1}u=u.return}while(u!==null);return!1}var a0=Error(s(461)),Et=!1;function kt(a,o,u,f){o.child=a===null?hy(o,null,u,f):ki(o,a.child,u,f)}function o0(a,o,u,f,p){u=u.render;var m=o.ref;if("ref"in f){var v={};for(var x in f)x!=="ref"&&(v[x]=f[x])}else v=f;return zi(o),f=Af(a,o,u,v,m,p),x=Ef(),a!==null&&!Et?(Rf(a,o,p),fs(a,o,p)):(Ve&&x&&pf(o),o.flags|=1,kt(a,o,f,p),o.child)}function l0(a,o,u,f,p){if(a===null){var m=u.type;return typeof m=="function"&&!hd(m)&&m.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=m,c0(a,o,m,f,p)):(a=yc(u.type,null,f,o,o.mode,p),a.ref=o.ref,a.return=o,o.child=a)}if(m=a.child,!Qf(a,p)){var v=m.memoizedProps;if(u=u.compare,u=u!==null?u:eo,u(v,f)&&a.ref===o.ref)return fs(a,o,p)}return o.flags|=1,a=qs(m,f),a.ref=o.ref,a.return=o,o.child=a}function c0(a,o,u,f,p){if(a!==null){var m=a.memoizedProps;if(eo(m,f)&&a.ref===o.ref)if(Et=!1,o.pendingProps=f=m,Qf(a,p))(a.flags&131072)!==0&&(Et=!0);else return o.lanes=a.lanes,fs(a,o,p)}return $f(a,o,u,f,p)}function u0(a,o,u){var f=o.pendingProps,p=f.children,m=(o.stateNode._pendingVisibility&2)!==0,v=a!==null?a.memoizedState:null;if(po(a,o),f.mode==="hidden"||m){if((o.flags&128)!==0){if(f=v!==null?v.baseLanes|u:u,a!==null){for(p=o.child=a.child,m=0;p!==null;)m=m|p.lanes|p.childLanes,p=p.sibling;o.childLanes=m&~f}else o.childLanes=0,o.child=null;return h0(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&sc(o,v!==null?v.cachePool:null),v!==null?fy(o,v):bf(),dy(o);else return o.lanes=o.childLanes=536870912,h0(a,o,v!==null?v.baseLanes|u:u,u)}else v!==null?(sc(o,v.cachePool),fy(o,v),Us(),o.memoizedState=null):(a!==null&&sc(o,null),bf(),Us());return kt(a,o,p,u),o.child}function h0(a,o,u,f){var p=xf();return p=p===null?null:{parent:wt._currentValue,pool:p},o.memoizedState={baseLanes:u,cachePool:p},a!==null&&sc(o,null),bf(),dy(o),a!==null&&_o(a,o,f,!0),null}function po(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=2097664);else{if(typeof u!="function"&&typeof u!="object")throw Error(s(284));(a===null||a.ref!==u)&&(o.flags|=2097664)}}function $f(a,o,u,f,p){return zi(o),u=Af(a,o,u,f,void 0,p),f=Ef(),a!==null&&!Et?(Rf(a,o,p),fs(a,o,p)):(Ve&&f&&pf(o),o.flags|=1,kt(a,o,u,p),o.child)}function f0(a,o,u,f,p,m){return zi(o),o.updateQueue=null,u=yy(o,f,u,p),my(a),f=Ef(),a!==null&&!Et?(Rf(a,o,m),fs(a,o,m)):(Ve&&f&&pf(o),o.flags|=1,kt(a,o,u,m),o.child)}function d0(a,o,u,f,p){if(zi(o),o.stateNode===null){var m=Rr,v=u.contextType;typeof v=="object"&&v!==null&&(m=zt(v)),m=new u(f,m),o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Vf,o.stateNode=m,m._reactInternals=o,m=o.stateNode,m.props=f,m.state=o.memoizedState,m.refs={},td(o),v=u.contextType,m.context=typeof v=="object"&&v!==null?zt(v):Rr,m.state=o.memoizedState,v=u.getDerivedStateFromProps,typeof v=="function"&&(zf(o,u,v,f),m.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&Vf.enqueueReplaceState(m,m.state,null),bo(o,f,m,p),yo(),m.state=o.memoizedState),typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){m=o.stateNode;var x=o.memoizedProps,M=Li(u,x);m.props=M;var V=m.context,te=u.contextType;v=Rr,typeof te=="object"&&te!==null&&(v=zt(te));var re=u.getDerivedStateFromProps;te=typeof re=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=o.pendingProps!==x,te||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||V!==v)&&Jy(o,m,f,v),Vs=!1;var Y=o.memoizedState;m.state=Y,bo(o,f,m,p),yo(),V=o.memoizedState,x||Y!==V||Vs?(typeof re=="function"&&(zf(o,u,re,f),V=o.memoizedState),(M=Vs||Gy(o,u,M,f,Y,V,v))?(te||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(o.flags|=4194308)):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=V),m.props=f,m.state=V,m.context=v,f=M):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{m=o.stateNode,nd(a,o),v=o.memoizedProps,te=Li(u,v),m.props=te,re=o.pendingProps,Y=m.context,V=u.contextType,M=Rr,typeof V=="object"&&V!==null&&(M=zt(V)),x=u.getDerivedStateFromProps,(V=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==re||Y!==M)&&Jy(o,m,f,M),Vs=!1,Y=o.memoizedState,m.state=Y,bo(o,f,m,p),yo();var G=o.memoizedState;v!==re||Y!==G||Vs||a!==null&&a.dependencies!==null&&gc(a.dependencies)?(typeof x=="function"&&(zf(o,u,x,f),G=o.memoizedState),(te=Vs||Gy(o,u,te,f,Y,G,M)||a!==null&&a.dependencies!==null&&gc(a.dependencies))?(V||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(f,G,M),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(f,G,M)),typeof m.componentDidUpdate=="function"&&(o.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===a.memoizedProps&&Y===a.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===a.memoizedProps&&Y===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=G),m.props=f,m.state=G,m.context=M,f=te):(typeof m.componentDidUpdate!="function"||v===a.memoizedProps&&Y===a.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===a.memoizedProps&&Y===a.memoizedState||(o.flags|=1024),f=!1)}return m=f,po(a,o),f=(o.flags&128)!==0,m||f?(m=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:m.render(),o.flags|=1,a!==null&&f?(o.child=ki(o,a.child,null,p),o.child=ki(o,null,u,p)):kt(a,o,u,p),o.memoizedState=m.state,a=o.child):a=fs(a,o,p),a}function g0(a,o,u,f){return so(),o.flags|=256,kt(a,o,u,f),o.child}var Hf={dehydrated:null,treeContext:null,retryLane:0};function Wf(a){return{baseLanes:a,cachePool:_y()}}function Xf(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=xn),a}function p0(a,o,u){var f=o.pendingProps,p=!1,m=(o.flags&128)!==0,v;if((v=m)||(v=a!==null&&a.memoizedState===null?!1:(Tt.current&2)!==0),v&&(p=!0,o.flags&=-129),v=(o.flags&32)!==0,o.flags&=-33,a===null){if(Ve){if(p?Bs(o):Us(),Ve){var x=It,M;if(M=x){e:{for(M=x,x=Xn;M.nodeType!==8;){if(!x){x=null;break e}if(M=Dn(M.nextSibling),M===null){x=null;break e}}x=M}x!==null?(o.memoizedState={dehydrated:x,treeContext:Mi!==null?{id:ls,overflow:cs}:null,retryLane:536870912},M=wn(18,null,null,0),M.stateNode=x,M.return=o,o.child=M,qt=o,It=null,M=!0):M=!1}M||Ii(o)}if(x=o.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return x.data==="$!"?o.lanes=16:o.lanes=536870912,null;us(o)}return x=f.children,f=f.fallback,p?(Us(),p=o.mode,x=Yf({mode:"hidden",children:x},p),f=ji(f,p,u,null),x.return=o,f.return=o,x.sibling=f,o.child=x,p=o.child,p.memoizedState=Wf(u),p.childLanes=Xf(a,v,u),o.memoizedState=Hf,f):(Bs(o),qf(o,x))}if(M=a.memoizedState,M!==null&&(x=M.dehydrated,x!==null)){if(m)o.flags&256?(Bs(o),o.flags&=-257,o=Kf(a,o,u)):o.memoizedState!==null?(Us(),o.child=a.child,o.flags|=128,o=null):(Us(),p=f.fallback,x=o.mode,f=Yf({mode:"visible",children:f.children},x),p=ji(p,x,u,null),p.flags|=2,f.return=o,p.return=o,f.sibling=p,o.child=f,ki(o,a.child,null,u),f=o.child,f.memoizedState=Wf(u),f.childLanes=Xf(a,v,u),o.memoizedState=Hf,o=p);else if(Bs(o),x.data==="$!"){if(v=x.nextSibling&&x.nextSibling.dataset,v)var V=v.dgst;v=V,f=Error(s(419)),f.stack="",f.digest=v,io({value:f,source:null,stack:null}),o=Kf(a,o,u)}else if(Et||_o(a,o,u,!1),v=(u&a.childLanes)!==0,Et||v){if(v=Je,v!==null){if(f=u&-u,(f&42)!==0)f=1;else switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=64;break;case 268435456:f=134217728;break;default:f=0}if(f=(f&(v.suspendedLanes|u))!==0?0:f,f!==0&&f!==M.retryLane)throw M.retryLane=f,Ds(a,f),Yt(v,a,f),a0}x.data==="$?"||xd(),o=Kf(a,o,u)}else x.data==="$?"?(o.flags|=128,o.child=a.child,o=a3.bind(null,a),x._reactRetry=o,o=null):(a=M.treeContext,It=Dn(x.nextSibling),qt=o,Ve=!0,kn=null,Xn=!1,a!==null&&(mn[yn++]=ls,mn[yn++]=cs,mn[yn++]=Mi,ls=a.id,cs=a.overflow,Mi=o),o=qf(o,f.children),o.flags|=4096);return o}return p?(Us(),p=f.fallback,x=o.mode,M=a.child,V=M.sibling,f=qs(M,{mode:"hidden",children:f.children}),f.subtreeFlags=M.subtreeFlags&31457280,V!==null?p=qs(V,p):(p=ji(p,x,u,null),p.flags|=2),p.return=o,f.return=o,f.sibling=p,o.child=f,f=p,p=o.child,x=a.child.memoizedState,x===null?x=Wf(u):(M=x.cachePool,M!==null?(V=wt._currentValue,M=M.parent!==V?{parent:V,pool:V}:M):M=_y(),x={baseLanes:x.baseLanes|u,cachePool:M}),p.memoizedState=x,p.childLanes=Xf(a,v,u),o.memoizedState=Hf,f):(Bs(o),u=a.child,a=u.sibling,u=qs(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(v=o.deletions,v===null?(o.deletions=[a],o.flags|=16):v.push(a)),o.child=u,o.memoizedState=null,u)}function qf(a,o){return o=Yf({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Yf(a,o){return V0(a,o,0,null)}function Kf(a,o,u){return ki(o,a.child,null,u),a=qf(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function _0(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),Jf(a.return,o,u)}function Zf(a,o,u,f,p){var m=a.memoizedState;m===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:p}:(m.isBackwards=o,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=u,m.tailMode=p)}function m0(a,o,u){var f=o.pendingProps,p=f.revealOrder,m=f.tail;if(kt(a,o,f.children,u),f=Tt.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&_0(a,u,o);else if(a.tag===19)_0(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(Te(Tt,f),p){case"forwards":for(u=o.child,p=null;u!==null;)a=u.alternate,a!==null&&nc(a)===null&&(p=u),u=u.sibling;u=p,u===null?(p=o.child,o.child=null):(p=u.sibling,u.sibling=null),Zf(o,!1,p,u,m);break;case"backwards":for(u=null,p=o.child,o.child=null;p!==null;){if(a=p.alternate,a!==null&&nc(a)===null){o.child=p;break}a=p.sibling,p.sibling=u,u=p,p=a}Zf(o,!0,u,null,m);break;case"together":Zf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function fs(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Ys|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(_o(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(s(153));if(o.child!==null){for(a=o.child,u=qs(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=qs(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function Qf(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&gc(a)))}function X2(a,o,u){switch(o.tag){case 3:Be(o,o.stateNode.containerInfo),zs(o,wt,a.memoizedState.cache),so();break;case 27:case 5:zh(o);break;case 4:Be(o,o.stateNode.containerInfo);break;case 10:zs(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Bs(o),o.flags|=128,null):(u&o.child.childLanes)!==0?p0(a,o,u):(Bs(o),a=fs(a,o,u),a!==null?a.sibling:null);Bs(o);break;case 19:var p=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(_o(a,o,u,!1),f=(u&o.childLanes)!==0),p){if(f)return m0(a,o,u);o.flags|=128}if(p=o.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Te(Tt,Tt.current),f)break;return null;case 22:case 23:return o.lanes=0,u0(a,o,u);case 24:zs(o,wt,a.memoizedState.cache)}return fs(a,o,u)}function y0(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)Et=!0;else{if(!Qf(a,u)&&(o.flags&128)===0)return Et=!1,X2(a,o,u);Et=(a.flags&131072)!==0}else Et=!1,Ve&&(o.flags&1048576)!==0&&ny(o,Ql,o.index);switch(o.lanes=0,o.tag){case 16:e:{a=o.pendingProps;var f=o.elementType,p=f._init;if(f=p(f._payload),o.type=f,typeof f=="function")hd(f)?(a=Li(f,a),o.tag=1,o=d0(null,o,f,a,u)):(o.tag=0,o=$f(null,o,f,a,u));else{if(f!=null){if(p=f.$$typeof,p===T){o.tag=11,o=o0(null,o,f,a,u);break e}else if(p===k){o.tag=14,o=l0(null,o,f,a,u);break e}}throw o=ue(f)||f,Error(s(306,o,""))}}return o;case 0:return $f(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,p=Li(f,o.pendingProps),d0(a,o,f,p,u);case 3:e:{if(Be(o,o.stateNode.containerInfo),a===null)throw Error(s(387));var m=o.pendingProps;p=o.memoizedState,f=p.element,nd(a,o),bo(o,m,null,u);var v=o.memoizedState;if(m=v.cache,zs(o,wt,m),m!==p.cache&&ed(o,[wt],u,!0),yo(),m=v.element,p.isDehydrated)if(p={element:m,isDehydrated:!1,cache:v.cache},o.updateQueue.baseState=p,o.memoizedState=p,o.flags&256){o=g0(a,o,m,u);break e}else if(m!==f){f=_n(Error(s(424)),o),io(f),o=g0(a,o,m,u);break e}else for(It=Dn(o.stateNode.containerInfo.firstChild),qt=o,Ve=!0,kn=null,Xn=!0,u=hy(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(so(),m===f){o=fs(a,o,u);break e}kt(a,o,m,u)}o=o.child}return o;case 26:return po(a,o),a===null?(u=Tb(o.type,null,o.pendingProps,null))?o.memoizedState=u:Ve||(u=o.type,a=o.pendingProps,f=Mc(Pn.current).createElement(u),f[Ft]=o,f[Qt]=a,Nt(f,u,a),At(f),o.stateNode=f):o.memoizedState=Tb(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return zh(o),a===null&&Ve&&(f=o.stateNode=yb(o.type,o.pendingProps,Pn.current),qt=o,Xn=!0,It=Dn(f.firstChild)),f=o.pendingProps.children,a!==null||Ve?kt(a,o,f,u):o.child=ki(o,null,f,u),po(a,o),o.child;case 5:return a===null&&Ve&&((p=f=It)&&(f=w3(f,o.type,o.pendingProps,Xn),f!==null?(o.stateNode=f,qt=o,It=Dn(f.firstChild),Xn=!1,p=!0):p=!1),p||Ii(o)),zh(o),p=o.type,m=o.pendingProps,v=a!==null?a.memoizedProps:null,f=m.children,Ud(p,m)?f=null:v!==null&&Ud(p,v)&&(o.flags|=32),o.memoizedState!==null&&(p=Af(a,o,F2,null,null,u),No._currentValue=p),po(a,o),kt(a,o,f,u),o.child;case 6:return a===null&&Ve&&((a=u=It)&&(u=x3(u,o.pendingProps,Xn),u!==null?(o.stateNode=u,qt=o,It=null,a=!0):a=!1),a||Ii(o)),null;case 13:return p0(a,o,u);case 4:return Be(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=ki(o,null,f,u):kt(a,o,f,u),o.child;case 11:return o0(a,o,o.type,o.pendingProps,u);case 7:return kt(a,o,o.pendingProps,u),o.child;case 8:return kt(a,o,o.pendingProps.children,u),o.child;case 12:return kt(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,zs(o,o.type,f.value),kt(a,o,f.children,u),o.child;case 9:return p=o.type._context,f=o.pendingProps.children,zi(o),p=zt(p),f=f(p),o.flags|=1,kt(a,o,f,u),o.child;case 14:return l0(a,o,o.type,o.pendingProps,u);case 15:return c0(a,o,o.type,o.pendingProps,u);case 19:return m0(a,o,u);case 22:return u0(a,o,u);case 24:return zi(o),f=zt(wt),a===null?(p=xf(),p===null&&(p=Je,m=Tf(),p.pooledCache=m,m.refCount++,m!==null&&(p.pooledCacheLanes|=u),p=m),o.memoizedState={parent:f,cache:p},td(o),zs(o,wt,p)):((a.lanes&u)!==0&&(nd(a,o),bo(o,null,null,u),yo()),p=a.memoizedState,m=o.memoizedState,p.parent!==f?(p={parent:f,cache:f},o.memoizedState=p,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=p),zs(o,wt,f)):(f=m.cache,zs(o,wt,f),f!==p.cache&&ed(o,[wt],u,!0))),kt(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}var Gf=_e(null),Fi=null,ds=null;function zs(a,o,u){Te(Gf,o._currentValue),o._currentValue=u}function gs(a){a._currentValue=Gf.current,Ie(Gf)}function Jf(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function ed(a,o,u,f){var p=a.child;for(p!==null&&(p.return=a);p!==null;){var m=p.dependencies;if(m!==null){var v=p.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=p;for(var M=0;M<o.length;M++)if(x.context===o[M]){m.lanes|=u,x=m.alternate,x!==null&&(x.lanes|=u),Jf(m.return,u,a),f||(v=null);break e}m=x.next}}else if(p.tag===18){if(v=p.return,v===null)throw Error(s(341));v.lanes|=u,m=v.alternate,m!==null&&(m.lanes|=u),Jf(v,u,a),v=null}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===a){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}}function _o(a,o,u,f){a=null;for(var p=o,m=!1;p!==null;){if(!m){if((p.flags&524288)!==0)m=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var v=p.alternate;if(v===null)throw Error(s(387));if(v=v.memoizedProps,v!==null){var x=p.type;rn(p.pendingProps.value,v.value)||(a!==null?a.push(x):a=[x])}}else if(p===xi.current){if(v=p.alternate,v===null)throw Error(s(387));v.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(a!==null?a.push(No):a=[No])}p=p.return}a!==null&&ed(o,a,u,f),o.flags|=262144}function gc(a){for(a=a.firstContext;a!==null;){if(!rn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function zi(a){Fi=a,ds=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function zt(a){return b0(Fi,a)}function pc(a,o){return Fi===null&&zi(a),b0(a,o)}function b0(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},ds===null){if(a===null)throw Error(s(308));ds=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else ds=ds.next=o;return u}var Vs=!1;function td(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nd(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function js(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function $s(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(it&2)!==0){var p=f.pending;return p===null?o.next=o:(o.next=p.next,p.next=o),f.pending=o,o=Kl(a),ey(a,null,u),o}return Yl(a,f,o,u),Kl(a)}function mo(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194176)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,lm(a,u)}}function sd(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var p=null,m=null;if(u=u.firstBaseUpdate,u!==null){do{var v={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};m===null?p=m=v:m=m.next=v,u=u.next}while(u!==null);m===null?p=m=o:m=m.next=o}else p=m=o;u={baseState:f.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var id=!1;function yo(){if(id){var a=kr;if(a!==null)throw a}}function bo(a,o,u,f){id=!1;var p=a.updateQueue;Vs=!1;var m=p.firstBaseUpdate,v=p.lastBaseUpdate,x=p.shared.pending;if(x!==null){p.shared.pending=null;var M=x,V=M.next;M.next=null,v===null?m=V:v.next=V,v=M;var te=a.alternate;te!==null&&(te=te.updateQueue,x=te.lastBaseUpdate,x!==v&&(x===null?te.firstBaseUpdate=V:x.next=V,te.lastBaseUpdate=M))}if(m!==null){var re=p.baseState;v=0,te=V=M=null,x=m;do{var Y=x.lane&-536870913,G=Y!==x.lane;if(G?(Fe&Y)===Y:(f&Y)===Y){Y!==0&&Y===Ir&&(id=!0),te!==null&&(te=te.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var me=a,Ae=x;Y=o;var ct=u;switch(Ae.tag){case 1:if(me=Ae.payload,typeof me=="function"){re=me.call(ct,re,Y);break e}re=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Ae.payload,Y=typeof me=="function"?me.call(ct,re,Y):me,Y==null)break e;re=oe({},re,Y);break e;case 2:Vs=!0}}Y=x.callback,Y!==null&&(a.flags|=64,G&&(a.flags|=8192),G=p.callbacks,G===null?p.callbacks=[Y]:G.push(Y))}else G={lane:Y,tag:x.tag,payload:x.payload,callback:x.callback,next:null},te===null?(V=te=G,M=re):te=te.next=G,v|=Y;if(x=x.next,x===null){if(x=p.shared.pending,x===null)break;G=x,x=G.next,G.next=null,p.lastBaseUpdate=G,p.shared.pending=null}}while(!0);te===null&&(M=re),p.baseState=M,p.firstBaseUpdate=V,p.lastBaseUpdate=te,m===null&&(p.shared.lanes=0),Ys|=v,a.lanes=v,a.memoizedState=re}}function v0(a,o){if(typeof a!="function")throw Error(s(191,a));a.call(o)}function T0(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)v0(u[a],o)}function vo(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var p=f.next;u=p;do{if((u.tag&a)===a){f=void 0;var m=u.create,v=u.inst;f=m(),v.destroy=f}u=u.next}while(u!==p)}}catch(x){Ze(o,o.return,x)}}function Hs(a,o,u){try{var f=o.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var m=p.next;f=m;do{if((f.tag&a)===a){var v=f.inst,x=v.destroy;if(x!==void 0){v.destroy=void 0,p=o;var M=u;try{x()}catch(V){Ze(p,M,V)}}}f=f.next}while(f!==m)}}catch(V){Ze(o,o.return,V)}}function w0(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{T0(o,u)}catch(f){Ze(a,a.return,f)}}}function x0(a,o,u){u.props=Li(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){Ze(a,o,f)}}function Vi(a,o){try{var u=a.ref;if(u!==null){var f=a.stateNode;switch(a.tag){case 26:case 27:case 5:var p=f;break;default:p=f}typeof u=="function"?a.refCleanup=u(p):u.current=p}}catch(m){Ze(a,o,m)}}function an(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(p){Ze(a,o,p)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){Ze(a,o,p)}else u.current=null}function S0(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(p){Ze(a,a.return,p)}}function A0(a,o,u){try{var f=a.stateNode;m3(f,a.type,u,o),f[Qt]=o}catch(p){Ze(a,a.return,p)}}function E0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27||a.tag===4}function rd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||E0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==27&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ad(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(a,o):u.insertBefore(a,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(a,u)):(o=u,o.appendChild(a)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Oc));else if(f!==4&&f!==27&&(a=a.child,a!==null))for(ad(a,o,u),a=a.sibling;a!==null;)ad(a,o,u),a=a.sibling}function _c(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&f!==27&&(a=a.child,a!==null))for(_c(a,o,u),a=a.sibling;a!==null;)_c(a,o,u),a=a.sibling}var ps=!1,ot=!1,od=!1,R0=typeof WeakSet=="function"?WeakSet:Set,Rt=null,C0=!1;function q2(a,o){if(a=a.containerInfo,Dd=Bc,a=Wm(a),cf(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var p=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{u.nodeType,m.nodeType}catch{u=null;break e}var v=0,x=-1,M=-1,V=0,te=0,re=a,Y=null;t:for(;;){for(var G;re!==u||p!==0&&re.nodeType!==3||(x=v+p),re!==m||f!==0&&re.nodeType!==3||(M=v+f),re.nodeType===3&&(v+=re.nodeValue.length),(G=re.firstChild)!==null;)Y=re,re=G;for(;;){if(re===a)break t;if(Y===u&&++V===p&&(x=v),Y===m&&++te===f&&(M=v),(G=re.nextSibling)!==null)break;re=Y,Y=re.parentNode}re=G}u=x===-1||M===-1?null:{start:x,end:M}}else u=null}u=u||{start:0,end:0}}else u=null;for(Bd={focusedElem:a,selectionRange:u},Bc=!1,Rt=o;Rt!==null;)if(o=Rt,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Rt=a;else for(;Rt!==null;){switch(o=Rt,m=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&m!==null){a=void 0,u=o,p=m.memoizedProps,m=m.memoizedState,f=u.stateNode;try{var me=Li(u.type,p,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(me,m),f.__reactInternalSnapshotBeforeUpdate=a}catch(Ae){Ze(u,u.return,Ae)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)zd(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":zd(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=o.sibling,a!==null){a.return=o.return,Rt=a;break}Rt=o.return}return me=C0,C0=!1,me}function O0(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:ms(a,u),f&4&&vo(5,u);break;case 1:if(ms(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(x){Ze(u,u.return,x)}else{var p=Li(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(p,o,a.__reactInternalSnapshotBeforeUpdate)}catch(x){Ze(u,u.return,x)}}f&64&&w0(u),f&512&&Vi(u,u.return);break;case 3:if(ms(a,u),f&64&&(f=u.updateQueue,f!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{T0(f,a)}catch(x){Ze(u,u.return,x)}}break;case 26:ms(a,u),f&512&&Vi(u,u.return);break;case 27:case 5:ms(a,u),o===null&&f&4&&S0(u),f&512&&Vi(u,u.return);break;case 12:ms(a,u);break;case 13:ms(a,u),f&4&&I0(a,u);break;case 22:if(p=u.memoizedState!==null||ps,!p){o=o!==null&&o.memoizedState!==null||ot;var m=ps,v=ot;ps=p,(ot=o)&&!v?Ws(a,u,(u.subtreeFlags&8772)!==0):ms(a,u),ps=m,ot=v}f&512&&(u.memoizedProps.mode==="manual"?Vi(u,u.return):an(u,u.return));break;default:ms(a,u)}}function M0(a){var o=a.alternate;o!==null&&(a.alternate=null,M0(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Xh(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var _t=null,on=!1;function _s(a,o,u){for(u=u.child;u!==null;)P0(a,o,u),u=u.sibling}function P0(a,o,u){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(ja,u)}catch{}switch(u.tag){case 26:ot||an(u,o),_s(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ot||an(u,o);var f=_t,p=on;for(_t=u.stateNode,_s(a,o,u),u=u.stateNode,o=u.attributes;o.length;)u.removeAttributeNode(o[0]);Xh(u),_t=f,on=p;break;case 5:ot||an(u,o);case 6:p=_t;var m=on;if(_t=null,_s(a,o,u),_t=p,on=m,_t!==null)if(on)try{a=_t,f=u.stateNode,a.nodeType===8?a.parentNode.removeChild(f):a.removeChild(f)}catch(v){Ze(u,o,v)}else try{_t.removeChild(u.stateNode)}catch(v){Ze(u,o,v)}break;case 18:_t!==null&&(on?(o=_t,u=u.stateNode,o.nodeType===8?Fd(o.parentNode,u):o.nodeType===1&&Fd(o,u),Lo(o)):Fd(_t,u.stateNode));break;case 4:f=_t,p=on,_t=u.stateNode.containerInfo,on=!0,_s(a,o,u),_t=f,on=p;break;case 0:case 11:case 14:case 15:ot||Hs(2,u,o),ot||Hs(4,u,o),_s(a,o,u);break;case 1:ot||(an(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&x0(u,o,f)),_s(a,o,u);break;case 21:_s(a,o,u);break;case 22:ot||an(u,o),ot=(f=ot)||u.memoizedState!==null,_s(a,o,u),ot=f;break;default:_s(a,o,u)}}function I0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Lo(a)}catch(u){Ze(o,o.return,u)}}function Y2(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new R0),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new R0),o;default:throw Error(s(435,a.tag))}}function ld(a,o){var u=Y2(a);o.forEach(function(f){var p=o3.bind(null,a,f);u.has(f)||(u.add(f),f.then(p,p))})}function vn(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var p=u[f],m=a,v=o,x=v;e:for(;x!==null;){switch(x.tag){case 27:case 5:_t=x.stateNode,on=!1;break e;case 3:_t=x.stateNode.containerInfo,on=!0;break e;case 4:_t=x.stateNode.containerInfo,on=!0;break e}x=x.return}if(_t===null)throw Error(s(160));P0(m,v,p),_t=null,on=!1,m=p.alternate,m!==null&&(m.return=null),p.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)k0(o,a),o=o.sibling}var Nn=null;function k0(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:vn(o,a),Tn(a),f&4&&(Hs(3,a,a.return),vo(3,a),Hs(5,a,a.return));break;case 1:vn(o,a),Tn(a),f&512&&(ot||u===null||an(u,u.return)),f&64&&ps&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var p=Nn;if(vn(o,a),Tn(a),f&512&&(ot||u===null||an(u,u.return)),f&4){var m=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){e:{f=a.type,u=a.memoizedProps,p=p.ownerDocument||p;t:switch(f){case"title":m=p.getElementsByTagName("title")[0],(!m||m[Wa]||m[Ft]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=p.createElement(f),p.head.insertBefore(m,p.querySelector("head > title"))),Nt(m,f,u),m[Ft]=a,At(m),f=m;break e;case"link":var v=Sb("link","href",p).get(f+(u.href||""));if(v){for(var x=0;x<v.length;x++)if(m=v[x],m.getAttribute("href")===(u.href==null?null:u.href)&&m.getAttribute("rel")===(u.rel==null?null:u.rel)&&m.getAttribute("title")===(u.title==null?null:u.title)&&m.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){v.splice(x,1);break t}}m=p.createElement(f),Nt(m,f,u),p.head.appendChild(m);break;case"meta":if(v=Sb("meta","content",p).get(f+(u.content||""))){for(x=0;x<v.length;x++)if(m=v[x],m.getAttribute("content")===(u.content==null?null:""+u.content)&&m.getAttribute("name")===(u.name==null?null:u.name)&&m.getAttribute("property")===(u.property==null?null:u.property)&&m.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&m.getAttribute("charset")===(u.charSet==null?null:u.charSet)){v.splice(x,1);break t}}m=p.createElement(f),Nt(m,f,u),p.head.appendChild(m);break;default:throw Error(s(468,f))}m[Ft]=a,At(m),f=m}a.stateNode=f}else Ab(p,a.type,a.stateNode);else a.stateNode=xb(p,f,a.memoizedProps);else m!==f?(m===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):m.count--,f===null?Ab(p,a.type,a.stateNode):xb(p,f,a.memoizedProps)):f===null&&a.stateNode!==null&&A0(a,a.memoizedProps,u.memoizedProps)}break;case 27:if(f&4&&a.alternate===null){p=a.stateNode,m=a.memoizedProps;try{for(var M=p.firstChild;M;){var V=M.nextSibling,te=M.nodeName;M[Wa]||te==="HEAD"||te==="BODY"||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&M.rel.toLowerCase()==="stylesheet"||p.removeChild(M),M=V}for(var re=a.type,Y=p.attributes;Y.length;)p.removeAttributeNode(Y[0]);Nt(p,re,m),p[Ft]=a,p[Qt]=m}catch(me){Ze(a,a.return,me)}}case 5:if(vn(o,a),Tn(a),f&512&&(ot||u===null||an(u,u.return)),a.flags&32){p=a.stateNode;try{vr(p,"")}catch(me){Ze(a,a.return,me)}}f&4&&a.stateNode!=null&&(p=a.memoizedProps,A0(a,p,u!==null?u.memoizedProps:p)),f&1024&&(od=!0);break;case 6:if(vn(o,a),Tn(a),f&4){if(a.stateNode===null)throw Error(s(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(me){Ze(a,a.return,me)}}break;case 3:if(kc=null,p=Nn,Nn=Pc(o.containerInfo),vn(o,a),Nn=p,Tn(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Lo(o.containerInfo)}catch(me){Ze(a,a.return,me)}od&&(od=!1,N0(a));break;case 4:f=Nn,Nn=Pc(a.stateNode.containerInfo),vn(o,a),Tn(a),Nn=f;break;case 12:vn(o,a),Tn(a);break;case 13:vn(o,a),Tn(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(md=Wn()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,ld(a,f)));break;case 22:if(f&512&&(ot||u===null||an(u,u.return)),M=a.memoizedState!==null,V=u!==null&&u.memoizedState!==null,te=ps,re=ot,ps=te||M,ot=re||V,vn(o,a),ot=re,ps=te,Tn(a),o=a.stateNode,o._current=a,o._visibility&=-3,o._visibility|=o._pendingVisibility&2,f&8192&&(o._visibility=M?o._visibility&-2:o._visibility|1,M&&(o=ps||ot,u===null||V||o||Ur(a)),a.memoizedProps===null||a.memoizedProps.mode!=="manual"))e:for(u=null,o=a;;){if(o.tag===5||o.tag===26||o.tag===27){if(u===null){V=u=o;try{if(p=V.stateNode,M)m=p.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none";else{v=V.stateNode,x=V.memoizedProps.style;var G=x!=null&&x.hasOwnProperty("display")?x.display:null;v.style.display=G==null||typeof G=="boolean"?"":(""+G).trim()}}catch(me){Ze(V,V.return,me)}}}else if(o.tag===6){if(u===null){V=o;try{V.stateNode.nodeValue=M?"":V.memoizedProps}catch(me){Ze(V,V.return,me)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,ld(a,u))));break;case 19:vn(o,a),Tn(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,ld(a,f)));break;case 21:break;default:vn(o,a),Tn(a)}}function Tn(a){var o=a.flags;if(o&2){try{if(a.tag!==27){e:{for(var u=a.return;u!==null;){if(E0(u)){var f=u;break e}u=u.return}throw Error(s(160))}switch(f.tag){case 27:var p=f.stateNode,m=rd(a);_c(a,m,p);break;case 5:var v=f.stateNode;f.flags&32&&(vr(v,""),f.flags&=-33);var x=rd(a);_c(a,x,v);break;case 3:case 4:var M=f.stateNode.containerInfo,V=rd(a);ad(a,V,M);break;default:throw Error(s(161))}}}catch(te){Ze(a,a.return,te)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function N0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;N0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function ms(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)O0(a,o.alternate,o),o=o.sibling}function Ur(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:Hs(4,o,o.return),Ur(o);break;case 1:an(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&x0(o,o.return,u),Ur(o);break;case 26:case 27:case 5:an(o,o.return),Ur(o);break;case 22:an(o,o.return),o.memoizedState===null&&Ur(o);break;default:Ur(o)}a=a.sibling}}function Ws(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,p=a,m=o,v=m.flags;switch(m.tag){case 0:case 11:case 15:Ws(p,m,u),vo(4,m);break;case 1:if(Ws(p,m,u),f=m,p=f.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(V){Ze(f,f.return,V)}if(f=m,p=f.updateQueue,p!==null){var x=f.stateNode;try{var M=p.shared.hiddenCallbacks;if(M!==null)for(p.shared.hiddenCallbacks=null,p=0;p<M.length;p++)v0(M[p],x)}catch(V){Ze(f,f.return,V)}}u&&v&64&&w0(m),Vi(m,m.return);break;case 26:case 27:case 5:Ws(p,m,u),u&&f===null&&v&4&&S0(m),Vi(m,m.return);break;case 12:Ws(p,m,u);break;case 13:Ws(p,m,u),u&&v&4&&I0(p,m);break;case 22:m.memoizedState===null&&Ws(p,m,u),Vi(m,m.return);break;default:Ws(p,m,u)}o=o.sibling}}function cd(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&co(u))}function ud(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&co(a))}function Xs(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)D0(a,o,u,f),o=o.sibling}function D0(a,o,u,f){var p=o.flags;switch(o.tag){case 0:case 11:case 15:Xs(a,o,u,f),p&2048&&vo(9,o);break;case 3:Xs(a,o,u,f),p&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&co(a)));break;case 12:if(p&2048){Xs(a,o,u,f),a=o.stateNode;try{var m=o.memoizedProps,v=m.id,x=m.onPostCommit;typeof x=="function"&&x(v,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(M){Ze(o,o.return,M)}}else Xs(a,o,u,f);break;case 23:break;case 22:m=o.stateNode,o.memoizedState!==null?m._visibility&4?Xs(a,o,u,f):To(a,o):m._visibility&4?Xs(a,o,u,f):(m._visibility|=4,Lr(a,o,u,f,(o.subtreeFlags&10256)!==0)),p&2048&&cd(o.alternate,o);break;case 24:Xs(a,o,u,f),p&2048&&ud(o.alternate,o);break;default:Xs(a,o,u,f)}}function Lr(a,o,u,f,p){for(p=p&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var m=a,v=o,x=u,M=f,V=v.flags;switch(v.tag){case 0:case 11:case 15:Lr(m,v,x,M,p),vo(8,v);break;case 23:break;case 22:var te=v.stateNode;v.memoizedState!==null?te._visibility&4?Lr(m,v,x,M,p):To(m,v):(te._visibility|=4,Lr(m,v,x,M,p)),p&&V&2048&&cd(v.alternate,v);break;case 24:Lr(m,v,x,M,p),p&&V&2048&&ud(v.alternate,v);break;default:Lr(m,v,x,M,p)}o=o.sibling}}function To(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,p=f.flags;switch(f.tag){case 22:To(u,f),p&2048&&cd(f.alternate,f);break;case 24:To(u,f),p&2048&&ud(f.alternate,f);break;default:To(u,f)}o=o.sibling}}var wo=8192;function Fr(a){if(a.subtreeFlags&wo)for(a=a.child;a!==null;)B0(a),a=a.sibling}function B0(a){switch(a.tag){case 26:Fr(a),a.flags&wo&&a.memoizedState!==null&&B3(Nn,a.memoizedState,a.memoizedProps);break;case 5:Fr(a);break;case 3:case 4:var o=Nn;Nn=Pc(a.stateNode.containerInfo),Fr(a),Nn=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=wo,wo=16777216,Fr(a),wo=o):Fr(a));break;default:Fr(a)}}function U0(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function xo(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Rt=f,F0(f,a)}U0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)L0(a),a=a.sibling}function L0(a){switch(a.tag){case 0:case 11:case 15:xo(a),a.flags&2048&&Hs(9,a,a.return);break;case 3:xo(a);break;case 12:xo(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&4&&(a.return===null||a.return.tag!==13)?(o._visibility&=-5,mc(a)):xo(a);break;default:xo(a)}}function mc(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Rt=f,F0(f,a)}U0(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:Hs(8,o,o.return),mc(o);break;case 22:u=o.stateNode,u._visibility&4&&(u._visibility&=-5,mc(o));break;default:mc(o)}a=a.sibling}}function F0(a,o){for(;Rt!==null;){var u=Rt;switch(u.tag){case 0:case 11:case 15:Hs(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:co(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Rt=f;else e:for(u=a;Rt!==null;){f=Rt;var p=f.sibling,m=f.return;if(M0(f),f===u){Rt=null;break e}if(p!==null){p.return=m,Rt=p;break e}Rt=m}}}function K2(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wn(a,o,u,f){return new K2(a,o,u,f)}function hd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function qs(a,o){var u=a.alternate;return u===null?(u=wn(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&31457280,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function z0(a,o){a.flags&=31457282;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function yc(a,o,u,f,p,m){var v=0;if(f=a,typeof a=="function")hd(a)&&(v=1);else if(typeof a=="string")v=N3(a,u,Lt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case h:return ji(u.children,p,m,o);case d:v=8,p|=24;break;case g:return a=wn(12,u,o,p|2),a.elementType=g,a.lanes=m,a;case S:return a=wn(13,u,o,p),a.elementType=S,a.lanes=m,a;case R:return a=wn(19,u,o,p),a.elementType=R,a.lanes=m,a;case P:return V0(u,p,m,o);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case _:case b:v=10;break e;case y:v=9;break e;case T:v=11;break e;case k:v=14;break e;case U:v=16,f=null;break e}v=29,u=Error(s(130,a===null?"null":typeof a,"")),f=null}return o=wn(v,u,o,p),o.elementType=a,o.type=f,o.lanes=m,o}function ji(a,o,u,f){return a=wn(7,a,f,o),a.lanes=u,a}function V0(a,o,u,f){a=wn(22,a,f,o),a.elementType=P,a.lanes=u;var p={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var m=p._current;if(m===null)throw Error(s(456));if((p._pendingVisibility&2)===0){var v=Ds(m,2);v!==null&&(p._pendingVisibility|=2,Yt(v,m,2))}},attach:function(){var m=p._current;if(m===null)throw Error(s(456));if((p._pendingVisibility&2)!==0){var v=Ds(m,2);v!==null&&(p._pendingVisibility&=-3,Yt(v,m,2))}}};return a.stateNode=p,a}function fd(a,o,u){return a=wn(6,a,null,o),a.lanes=u,a}function dd(a,o,u){return o=wn(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}function ys(a){a.flags|=4}function j0(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Eb(o)){if(o=bn.current,o!==null&&((Fe&4194176)===Fe?qn!==null:(Fe&62914560)!==Fe&&(Fe&536870912)===0||o!==qn))throw ao=yf,ry;a.flags|=8192}}function bc(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?am():536870912,a.lanes|=o,Vr|=o)}function So(a,o){if(!Ve)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function st(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var p=a.child;p!==null;)u|=p.lanes|p.childLanes,f|=p.subtreeFlags&31457280,f|=p.flags&31457280,p.return=a,p=p.sibling;else for(p=a.child;p!==null;)u|=p.lanes|p.childLanes,f|=p.subtreeFlags,f|=p.flags,p.return=a,p=p.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function Z2(a,o,u){var f=o.pendingProps;switch(_f(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(o),null;case 1:return st(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),gs(wt),ke(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(no(o)?ys(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,kn!==null&&(Td(kn),kn=null))),st(o),null;case 26:return u=o.memoizedState,a===null?(ys(o),u!==null?(st(o),j0(o,u)):(st(o),o.flags&=-16777217)):u?u!==a.memoizedState?(ys(o),st(o),j0(o,u)):(st(o),o.flags&=-16777217):(a.memoizedProps!==f&&ys(o),st(o),o.flags&=-16777217),null;case 27:Pl(o),u=Pn.current;var p=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&ys(o);else{if(!f){if(o.stateNode===null)throw Error(s(166));return st(o),null}a=Lt.current,no(o)?sy(o):(a=yb(p,f,u),o.stateNode=a,ys(o))}return st(o),null;case 5:if(Pl(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&ys(o);else{if(!f){if(o.stateNode===null)throw Error(s(166));return st(o),null}if(a=Lt.current,no(o))sy(o);else{switch(p=Mc(Pn.current),a){case 1:a=p.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=p.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=p.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?p.createElement("select",{is:f.is}):p.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?p.createElement(u,{is:f.is}):p.createElement(u)}}a[Ft]=o,a[Qt]=f;e:for(p=o.child;p!==null;){if(p.tag===5||p.tag===6)a.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===o)break e;for(;p.sibling===null;){if(p.return===null||p.return===o)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}o.stateNode=a;e:switch(Nt(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&ys(o)}}return st(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&ys(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(s(166));if(a=Pn.current,no(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,p=qt,p!==null)switch(p.tag){case 27:case 5:f=p.memoizedProps}a[Ft]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||fb(a.nodeValue,u)),a||Ii(o)}else a=Mc(a).createTextNode(f),a[Ft]=o,o.stateNode=a}return st(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(p=no(o),f!==null&&f.dehydrated!==null){if(a===null){if(!p)throw Error(s(318));if(p=o.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));p[Ft]=o}else so(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;st(o),p=!1}else kn!==null&&(Td(kn),kn=null),p=!0;if(!p)return o.flags&256?(us(o),o):(us(o),null)}if(us(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,p=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(p=f.alternate.memoizedState.cachePool.pool);var m=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(m=f.memoizedState.cachePool.pool),m!==p&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),bc(o,o.updateQueue),st(o),null;case 4:return ke(),a===null&&Id(o.stateNode.containerInfo),st(o),null;case 10:return gs(o.type),st(o),null;case 19:if(Ie(Tt),p=o.memoizedState,p===null)return st(o),null;if(f=(o.flags&128)!==0,m=p.rendering,m===null)if(f)So(p,!1);else{if(lt!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(m=nc(a),m!==null){for(o.flags|=128,So(p,!1),a=m.updateQueue,o.updateQueue=a,bc(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)z0(u,a),u=u.sibling;return Te(Tt,Tt.current&1|2),o.child}a=a.sibling}p.tail!==null&&Wn()>vc&&(o.flags|=128,f=!0,So(p,!1),o.lanes=4194304)}else{if(!f)if(a=nc(m),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,bc(o,a),So(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!Ve)return st(o),null}else 2*Wn()-p.renderingStartTime>vc&&u!==536870912&&(o.flags|=128,f=!0,So(p,!1),o.lanes=4194304);p.isBackwards?(m.sibling=o.child,o.child=m):(a=p.last,a!==null?a.sibling=m:o.child=m,p.last=m)}return p.tail!==null?(o=p.tail,p.rendering=o,p.tail=o.sibling,p.renderingStartTime=Wn(),o.sibling=null,a=Tt.current,Te(Tt,f?a&1|2:a&1),o):(st(o),null);case 22:case 23:return us(o),vf(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(st(o),o.subtreeFlags&6&&(o.flags|=8192)):st(o),u=o.updateQueue,u!==null&&bc(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&Ie(Ni),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),gs(wt),st(o),null;case 25:return null}throw Error(s(156,o.tag))}function Q2(a,o){switch(_f(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return gs(wt),ke(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Pl(o),null;case 13:if(us(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(s(340));so()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Ie(Tt),null;case 4:return ke(),null;case 10:return gs(o.type),null;case 22:case 23:return us(o),vf(),a!==null&&Ie(Ni),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return gs(wt),null;case 25:return null;default:return null}}function $0(a,o){switch(_f(o),o.tag){case 3:gs(wt),ke();break;case 26:case 27:case 5:Pl(o);break;case 4:ke();break;case 13:us(o);break;case 19:Ie(Tt);break;case 10:gs(o.type);break;case 22:case 23:us(o),vf(),a!==null&&Ie(Ni);break;case 24:gs(wt)}}var G2={getCacheForType:function(a){var o=zt(wt),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},J2=typeof WeakMap=="function"?WeakMap:Map,it=0,Je=null,Ne=null,Fe=0,et=0,ln=null,bs=!1,zr=!1,gd=!1,vs=0,lt=0,Ys=0,$i=0,pd=0,xn=0,Vr=0,Ao=null,Kn=null,_d=!1,md=0,vc=1/0,Tc=null,Ks=null,wc=!1,Hi=null,Eo=0,yd=0,bd=null,Ro=0,vd=null;function cn(){if((it&2)!==0&&Fe!==0)return Fe&-Fe;if(J.T!==null){var a=Ir;return a!==0?a:Cd()}return um()}function H0(){xn===0&&(xn=(Fe&536870912)===0||Ve?rm():536870912);var a=bn.current;return a!==null&&(a.flags|=32),xn}function Yt(a,o,u){(a===Je&&et===2||a.cancelPendingCommit!==null)&&(jr(a,0),Ts(a,Fe,xn,!1)),Ha(a,u),((it&2)===0||a!==Je)&&(a===Je&&((it&2)===0&&($i|=u),lt===4&&Ts(a,Fe,xn,!1)),Zn(a))}function W0(a,o,u){if((it&6)!==0)throw Error(s(327));var f=!u&&(o&60)===0&&(o&a.expiredLanes)===0||$a(a,o),p=f?n3(a,o):Sd(a,o,!0),m=f;do{if(p===0){zr&&!f&&Ts(a,o,0,!1);break}else if(p===6)Ts(a,o,0,!bs);else{if(u=a.current.alternate,m&&!e3(u)){p=Sd(a,o,!1),m=!1;continue}if(p===2){if(m=o,a.errorRecoveryDisabledLanes&m)var v=0;else v=a.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){o=v;e:{var x=a;p=Ao;var M=x.current.memoizedState.isDehydrated;if(M&&(jr(x,v).flags|=256),v=Sd(x,v,!1),v!==2){if(gd&&!M){x.errorRecoveryDisabledLanes|=m,$i|=m,p=4;break e}m=Kn,Kn=p,m!==null&&Td(m)}p=v}if(m=!1,p!==2)continue}}if(p===1){jr(a,0),Ts(a,o,0,!0);break}e:{switch(f=a,p){case 0:case 1:throw Error(s(345));case 4:if((o&4194176)===o){Ts(f,o,xn,!bs);break e}break;case 2:Kn=null;break;case 3:case 5:break;default:throw Error(s(329))}if(f.finishedWork=u,f.finishedLanes=o,(o&62914560)===o&&(m=md+300-Wn(),10<m)){if(Ts(f,o,xn,!bs),Dl(f,0)!==0)break e;f.timeoutHandle=pb(X0.bind(null,f,u,Kn,Tc,_d,o,xn,$i,Vr,bs,2,-0,0),m);break e}X0(f,u,Kn,Tc,_d,o,xn,$i,Vr,bs,0,-0,0)}}break}while(!0);Zn(a)}function Td(a){Kn===null?Kn=a:Kn.push.apply(Kn,a)}function X0(a,o,u,f,p,m,v,x,M,V,te,re,Y){var G=o.subtreeFlags;if((G&8192||(G&16785408)===16785408)&&(ko={stylesheets:null,count:0,unsuspend:D3},B0(o),o=U3(),o!==null)){a.cancelPendingCommit=o(J0.bind(null,a,u,f,p,v,x,M,1,re,Y)),Ts(a,m,v,!V);return}J0(a,u,f,p,v,x,M,te,re,Y)}function e3(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var p=u[f],m=p.getSnapshot;p=p.value;try{if(!rn(m(),p))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ts(a,o,u,f){o&=~pd,o&=~$i,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var p=o;0<p;){var m=31-sn(p),v=1<<m;f[m]=-1,p&=~v}u!==0&&om(a,u,o)}function xc(){return(it&6)===0?(Co(0),!1):!0}function wd(){if(Ne!==null){if(et===0)var a=Ne.return;else a=Ne,ds=Fi=null,Cf(a),Mr=null,oo=0,a=Ne;for(;a!==null;)$0(a.alternate,a),a=a.return;Ne=null}}function jr(a,o){a.finishedWork=null,a.finishedLanes=0;var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,b3(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),wd(),Je=a,Ne=u=qs(a.current,null),Fe=o,et=0,ln=null,bs=!1,zr=$a(a,o),gd=!1,Vr=xn=pd=$i=Ys=lt=0,Kn=Ao=null,_d=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var p=31-sn(f),m=1<<p;o|=a[p],f&=~m}return vs=o,ql(),u}function q0(a,o){Me=null,J.H=Yn,o===ro?(o=ly(),et=3):o===ry?(o=ly(),et=4):et=o===a0?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ln=o,Ne===null&&(lt=1,dc(a,_n(o,a.current)))}function Y0(){var a=J.H;return J.H=Yn,a===null?Yn:a}function K0(){var a=J.A;return J.A=G2,a}function xd(){lt=4,bs||(Fe&4194176)!==Fe&&bn.current!==null||(zr=!0),(Ys&134217727)===0&&($i&134217727)===0||Je===null||Ts(Je,Fe,xn,!1)}function Sd(a,o,u){var f=it;it|=2;var p=Y0(),m=K0();(Je!==a||Fe!==o)&&(Tc=null,jr(a,o)),o=!1;var v=lt;e:do try{if(et!==0&&Ne!==null){var x=Ne,M=ln;switch(et){case 8:wd(),v=6;break e;case 3:case 2:case 6:bn.current===null&&(o=!0);var V=et;if(et=0,ln=null,$r(a,x,M,V),u&&zr){v=0;break e}break;default:V=et,et=0,ln=null,$r(a,x,M,V)}}t3(),v=lt;break}catch(te){q0(a,te)}while(!0);return o&&a.shellSuspendCounter++,ds=Fi=null,it=f,J.H=p,J.A=m,Ne===null&&(Je=null,Fe=0,ql()),v}function t3(){for(;Ne!==null;)Z0(Ne)}function n3(a,o){var u=it;it|=2;var f=Y0(),p=K0();Je!==a||Fe!==o?(Tc=null,vc=Wn()+500,jr(a,o)):zr=$a(a,o);e:do try{if(et!==0&&Ne!==null){o=Ne;var m=ln;t:switch(et){case 1:et=0,ln=null,$r(a,o,m,1);break;case 2:if(ay(m)){et=0,ln=null,Q0(o);break}o=function(){et===2&&Je===a&&(et=7),Zn(a)},m.then(o,o);break e;case 3:et=7;break e;case 4:et=5;break e;case 7:ay(m)?(et=0,ln=null,Q0(o)):(et=0,ln=null,$r(a,o,m,7));break;case 5:var v=null;switch(Ne.tag){case 26:v=Ne.memoizedState;case 5:case 27:var x=Ne;if(!v||Eb(v)){et=0,ln=null;var M=x.sibling;if(M!==null)Ne=M;else{var V=x.return;V!==null?(Ne=V,Sc(V)):Ne=null}break t}}et=0,ln=null,$r(a,o,m,5);break;case 6:et=0,ln=null,$r(a,o,m,6);break;case 8:wd(),lt=6;break e;default:throw Error(s(462))}}s3();break}catch(te){q0(a,te)}while(!0);return ds=Fi=null,J.H=f,J.A=p,it=u,Ne!==null?0:(Je=null,Fe=0,ql(),lt)}function s3(){for(;Ne!==null&&!AA();)Z0(Ne)}function Z0(a){var o=y0(a.alternate,a,vs);a.memoizedProps=a.pendingProps,o===null?Sc(a):Ne=o}function Q0(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=f0(u,o,o.pendingProps,o.type,void 0,Fe);break;case 11:o=f0(u,o,o.pendingProps,o.type.render,o.ref,Fe);break;case 5:Cf(o);default:$0(u,o),o=Ne=z0(o,vs),o=y0(u,o,vs)}a.memoizedProps=a.pendingProps,o===null?Sc(a):Ne=o}function $r(a,o,u,f){ds=Fi=null,Cf(o),Mr=null,oo=0;var p=o.return;try{if(W2(a,p,o,u,Fe)){lt=1,dc(a,_n(u,a.current)),Ne=null;return}}catch(m){if(p!==null)throw Ne=p,m;lt=1,dc(a,_n(u,a.current)),Ne=null;return}o.flags&32768?(Ve||f===1?a=!0:zr||(Fe&536870912)!==0?a=!1:(bs=a=!0,(f===2||f===3||f===6)&&(f=bn.current,f!==null&&f.tag===13&&(f.flags|=16384))),G0(o,a)):Sc(o)}function Sc(a){var o=a;do{if((o.flags&32768)!==0){G0(o,bs);return}a=o.return;var u=Z2(o.alternate,o,vs);if(u!==null){Ne=u;return}if(o=o.sibling,o!==null){Ne=o;return}Ne=o=a}while(o!==null);lt===0&&(lt=5)}function G0(a,o){do{var u=Q2(a.alternate,a);if(u!==null){u.flags&=32767,Ne=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){Ne=a;return}Ne=a=u}while(a!==null);lt=6,Ne=null}function J0(a,o,u,f,p,m,v,x,M,V){var te=J.T,re=se.p;try{se.p=2,J.T=null,i3(a,o,u,f,re,p,m,v,x,M,V)}finally{J.T=te,se.p=re}}function i3(a,o,u,f,p,m,v,x){do Hr();while(Hi!==null);if((it&6)!==0)throw Error(s(327));var M=a.finishedWork;if(f=a.finishedLanes,M===null)return null;if(a.finishedWork=null,a.finishedLanes=0,M===a.current)throw Error(s(177));a.callbackNode=null,a.callbackPriority=0,a.cancelPendingCommit=null;var V=M.lanes|M.childLanes;if(V|=df,BA(a,f,V,m,v,x),a===Je&&(Ne=Je=null,Fe=0),(M.subtreeFlags&10256)===0&&(M.flags&10256)===0||wc||(wc=!0,yd=V,bd=u,l3(Il,function(){return Hr(),null})),u=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||u?(u=J.T,J.T=null,m=se.p,se.p=2,v=it,it|=4,q2(a,M),k0(M,a),C2(Bd,a.containerInfo),Bc=!!Dd,Bd=Dd=null,a.current=M,O0(a,M.alternate,M),EA(),it=v,se.p=m,J.T=u):a.current=M,wc?(wc=!1,Hi=a,Eo=f):eb(a,V),V=a.pendingLanes,V===0&&(Ks=null),PA(M.stateNode),Zn(a),o!==null)for(p=a.onRecoverableError,M=0;M<o.length;M++)V=o[M],p(V.value,{componentStack:V.stack});return(Eo&3)!==0&&Hr(),V=a.pendingLanes,(f&4194218)!==0&&(V&42)!==0?a===vd?Ro++:(Ro=0,vd=a):Ro=0,Co(0),null}function eb(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,co(o)))}function Hr(){if(Hi!==null){var a=Hi,o=yd;yd=0;var u=cm(Eo),f=J.T,p=se.p;try{if(se.p=32>u?32:u,J.T=null,Hi===null)var m=!1;else{u=bd,bd=null;var v=Hi,x=Eo;if(Hi=null,Eo=0,(it&6)!==0)throw Error(s(331));var M=it;if(it|=4,L0(v.current),D0(v,v.current,x,u),it=M,Co(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(ja,v)}catch{}m=!0}return m}finally{se.p=p,J.T=f,eb(a,o)}}return!1}function tb(a,o,u){o=_n(u,o),o=jf(a.stateNode,o,2),a=$s(a,o,2),a!==null&&(Ha(a,2),Zn(a))}function Ze(a,o,u){if(a.tag===3)tb(a,a,u);else for(;o!==null;){if(o.tag===3){tb(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ks===null||!Ks.has(f))){a=_n(u,a),u=i0(2),f=$s(o,u,2),f!==null&&(r0(u,f,o,a),Ha(f,2),Zn(f));break}}o=o.return}}function Ad(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new J2;var p=new Set;f.set(o,p)}else p=f.get(o),p===void 0&&(p=new Set,f.set(o,p));p.has(u)||(gd=!0,p.add(u),a=r3.bind(null,a,o,u),o.then(a,a))}function r3(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Je===a&&(Fe&u)===u&&(lt===4||lt===3&&(Fe&62914560)===Fe&&300>Wn()-md?(it&2)===0&&jr(a,0):pd|=u,Vr===Fe&&(Vr=0)),Zn(a)}function nb(a,o){o===0&&(o=am()),a=Ds(a,o),a!==null&&(Ha(a,o),Zn(a))}function a3(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),nb(a,u)}function o3(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,p=a.memoizedState;p!==null&&(u=p.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(s(314))}f!==null&&f.delete(o),nb(a,u)}function l3(a,o){return jh(a,o)}var Ac=null,Wr=null,Ed=!1,Ec=!1,Rd=!1,Wi=0;function Zn(a){a!==Wr&&a.next===null&&(Wr===null?Ac=Wr=a:Wr=Wr.next=a),Ec=!0,Ed||(Ed=!0,u3(c3))}function Co(a,o){if(!Rd&&Ec){Rd=!0;do for(var u=!1,f=Ac;f!==null;){if(a!==0){var p=f.pendingLanes;if(p===0)var m=0;else{var v=f.suspendedLanes,x=f.pingedLanes;m=(1<<31-sn(42|a)+1)-1,m&=p&~(v&~x),m=m&201326677?m&201326677|1:m?m|2:0}m!==0&&(u=!0,rb(f,m))}else m=Fe,m=Dl(f,f===Je?m:0),(m&3)===0||$a(f,m)||(u=!0,rb(f,m));f=f.next}while(u);Rd=!1}}function c3(){Ec=Ed=!1;var a=0;Wi!==0&&(y3()&&(a=Wi),Wi=0);for(var o=Wn(),u=null,f=Ac;f!==null;){var p=f.next,m=sb(f,o);m===0?(f.next=null,u===null?Ac=p:u.next=p,p===null&&(Wr=u)):(u=f,(a!==0||(m&3)!==0)&&(Ec=!0)),f=p}Co(a)}function sb(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,p=a.expirationTimes,m=a.pendingLanes&-62914561;0<m;){var v=31-sn(m),x=1<<v,M=p[v];M===-1?((x&u)===0||(x&f)!==0)&&(p[v]=DA(x,o)):M<=o&&(a.expiredLanes|=x),m&=~x}if(o=Je,u=Fe,u=Dl(a,a===o?u:0),f=a.callbackNode,u===0||a===o&&et===2||a.cancelPendingCommit!==null)return f!==null&&f!==null&&$h(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||$a(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&$h(f),cm(u)){case 2:case 8:u=sm;break;case 32:u=Il;break;case 268435456:u=im;break;default:u=Il}return f=ib.bind(null,a),u=jh(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&$h(f),a.callbackPriority=2,a.callbackNode=null,2}function ib(a,o){var u=a.callbackNode;if(Hr()&&a.callbackNode!==u)return null;var f=Fe;return f=Dl(a,a===Je?f:0),f===0?null:(W0(a,f,o),sb(a,Wn()),a.callbackNode!=null&&a.callbackNode===u?ib.bind(null,a):null)}function rb(a,o){if(Hr())return null;W0(a,o,!0)}function u3(a){v3(function(){(it&6)!==0?jh(nm,a):a()})}function Cd(){return Wi===0&&(Wi=rm()),Wi}function ab(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:zl(""+a)}function ob(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function h3(a,o,u,f,p){if(o==="submit"&&u&&u.stateNode===p){var m=ab((p[Qt]||null).action),v=f.submitter;v&&(o=(o=v[Qt]||null)?ab(o.formAction):v.getAttribute("formAction"),o!==null&&(m=o,v=null));var x=new Hl("action","action",null,f,p);a.push({event:x,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Wi!==0){var M=v?ob(p,v):new FormData(p);Uf(u,{pending:!0,data:M,method:p.method,action:m},null,M)}}else typeof m=="function"&&(x.preventDefault(),M=v?ob(p,v):new FormData(p),Uf(u,{pending:!0,data:M,method:p.method,action:m},m,M))},currentTarget:p}]})}}for(var Od=0;Od<Jm.length;Od++){var Md=Jm[Od],f3=Md.toLowerCase(),d3=Md[0].toUpperCase()+Md.slice(1);In(f3,"on"+d3)}In(Ym,"onAnimationEnd"),In(Km,"onAnimationIteration"),In(Zm,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(M2,"onTransitionRun"),In(P2,"onTransitionStart"),In(I2,"onTransitionCancel"),In(Qm,"onTransitionEnd"),yr("onMouseEnter",["mouseout","mouseover"]),yr("onMouseLeave",["mouseout","mouseover"]),yr("onPointerEnter",["pointerout","pointerover"]),yr("onPointerLeave",["pointerout","pointerover"]),Ei("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ei("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ei("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ei("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ei("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ei("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),g3=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Oo));function lb(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],p=f.event;f=f.listeners;e:{var m=void 0;if(o)for(var v=f.length-1;0<=v;v--){var x=f[v],M=x.instance,V=x.currentTarget;if(x=x.listener,M!==m&&p.isPropagationStopped())break e;m=x,p.currentTarget=V;try{m(p)}catch(te){fc(te)}p.currentTarget=null,m=M}else for(v=0;v<f.length;v++){if(x=f[v],M=x.instance,V=x.currentTarget,x=x.listener,M!==m&&p.isPropagationStopped())break e;m=x,p.currentTarget=V;try{m(p)}catch(te){fc(te)}p.currentTarget=null,m=M}}}}function Ue(a,o){var u=o[Wh];u===void 0&&(u=o[Wh]=new Set);var f=a+"__bubble";u.has(f)||(cb(o,a,2,!1),u.add(f))}function Pd(a,o,u){var f=0;o&&(f|=4),cb(u,a,f,o)}var Rc="_reactListening"+Math.random().toString(36).slice(2);function Id(a){if(!a[Rc]){a[Rc]=!0,fm.forEach(function(u){u!=="selectionchange"&&(g3.has(u)||Pd(u,!1,a),Pd(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Rc]||(o[Rc]=!0,Pd("selectionchange",!1,o))}}function cb(a,o,u,f){switch(Ib(o)){case 2:var p=z3;break;case 8:p=V3;break;default:p=Wd}u=p.bind(null,o,u,a),p=void 0,!Jh||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(p=!0),f?p!==void 0?a.addEventListener(o,u,{capture:!0,passive:p}):a.addEventListener(o,u,!0):p!==void 0?a.addEventListener(o,u,{passive:p}):a.addEventListener(o,u,!1)}function kd(a,o,u,f,p){var m=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var v=f.tag;if(v===3||v===4){var x=f.stateNode.containerInfo;if(x===p||x.nodeType===8&&x.parentNode===p)break;if(v===4)for(v=f.return;v!==null;){var M=v.tag;if((M===3||M===4)&&(M=v.stateNode.containerInfo,M===p||M.nodeType===8&&M.parentNode===p))return;v=v.return}for(;x!==null;){if(v=Ai(x),v===null)return;if(M=v.tag,M===5||M===6||M===26||M===27){f=m=v;continue e}x=x.parentNode}}f=f.return}Sm(function(){var V=m,te=Qh(u),re=[];e:{var Y=Gm.get(a);if(Y!==void 0){var G=Hl,me=a;switch(a){case"keypress":if(jl(u)===0)break e;case"keydown":case"keyup":G=o2;break;case"focusin":me="focus",G=sf;break;case"focusout":me="blur",G=sf;break;case"beforeblur":case"afterblur":G=sf;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=Rm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=KA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=u2;break;case Ym:case Km:case Zm:G=GA;break;case Qm:G=f2;break;case"scroll":case"scrollend":G=qA;break;case"wheel":G=g2;break;case"copy":case"cut":case"paste":G=e2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=Om;break;case"toggle":case"beforetoggle":G=_2}var Ae=(o&4)!==0,ct=!Ae&&(a==="scroll"||a==="scrollend"),W=Ae?Y!==null?Y+"Capture":null:Y;Ae=[];for(var B=V,q;B!==null;){var ie=B;if(q=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||q===null||W===null||(ie=qa(B,W),ie!=null&&Ae.push(Mo(B,ie,q))),ct)break;B=B.return}0<Ae.length&&(Y=new G(Y,me,null,u,te),re.push({event:Y,listeners:Ae}))}}if((o&7)===0){e:{if(Y=a==="mouseover"||a==="pointerover",G=a==="mouseout"||a==="pointerout",Y&&u!==Zh&&(me=u.relatedTarget||u.fromElement)&&(Ai(me)||me[pr]))break e;if((G||Y)&&(Y=te.window===te?te:(Y=te.ownerDocument)?Y.defaultView||Y.parentWindow:window,G?(me=u.relatedTarget||u.toElement,G=V,me=me?Ai(me):null,me!==null&&(ct=I(me),Ae=me.tag,me!==ct||Ae!==5&&Ae!==27&&Ae!==6)&&(me=null)):(G=null,me=V),G!==me)){if(Ae=Rm,ie="onMouseLeave",W="onMouseEnter",B="mouse",(a==="pointerout"||a==="pointerover")&&(Ae=Om,ie="onPointerLeave",W="onPointerEnter",B="pointer"),ct=G==null?Y:Xa(G),q=me==null?Y:Xa(me),Y=new Ae(ie,B+"leave",G,u,te),Y.target=ct,Y.relatedTarget=q,ie=null,Ai(te)===V&&(Ae=new Ae(W,B+"enter",me,u,te),Ae.target=q,Ae.relatedTarget=ct,ie=Ae),ct=ie,G&&me)t:{for(Ae=G,W=me,B=0,q=Ae;q;q=Xr(q))B++;for(q=0,ie=W;ie;ie=Xr(ie))q++;for(;0<B-q;)Ae=Xr(Ae),B--;for(;0<q-B;)W=Xr(W),q--;for(;B--;){if(Ae===W||W!==null&&Ae===W.alternate)break t;Ae=Xr(Ae),W=Xr(W)}Ae=null}else Ae=null;G!==null&&ub(re,Y,G,Ae,!1),me!==null&&ct!==null&&ub(re,ct,me,Ae,!0)}}e:{if(Y=V?Xa(V):window,G=Y.nodeName&&Y.nodeName.toLowerCase(),G==="select"||G==="input"&&Y.type==="file")var ge=Um;else if(Dm(Y))if(Lm)ge=E2;else{ge=S2;var Pe=x2}else G=Y.nodeName,!G||G.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?V&&Kh(V.elementType)&&(ge=Um):ge=A2;if(ge&&(ge=ge(a,V))){Bm(re,ge,u,te);break e}Pe&&Pe(a,Y,V),a==="focusout"&&V&&Y.type==="number"&&V.memoizedProps.value!=null&&Yh(Y,"number",Y.value)}switch(Pe=V?Xa(V):window,a){case"focusin":(Dm(Pe)||Pe.contentEditable==="true")&&(Sr=Pe,uf=V,to=null);break;case"focusout":to=uf=Sr=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":hf=!1,Xm(re,u,te);break;case"selectionchange":if(O2)break;case"keydown":case"keyup":Xm(re,u,te)}var ye;if(af)e:{switch(a){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else xr?km(a,u)&&(we="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(we="onCompositionStart");we&&(Mm&&u.locale!=="ko"&&(xr||we!=="onCompositionStart"?we==="onCompositionEnd"&&xr&&(ye=Am()):(Ns=te,ef="value"in Ns?Ns.value:Ns.textContent,xr=!0)),Pe=Cc(V,we),0<Pe.length&&(we=new Cm(we,a,null,u,te),re.push({event:we,listeners:Pe}),ye?we.data=ye:(ye=Nm(u),ye!==null&&(we.data=ye)))),(ye=y2?b2(a,u):v2(a,u))&&(we=Cc(V,"onBeforeInput"),0<we.length&&(Pe=new Cm("onBeforeInput","beforeinput",null,u,te),re.push({event:Pe,listeners:we}),Pe.data=ye)),h3(re,a,V,u,te)}lb(re,o)})}function Mo(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Cc(a,o){for(var u=o+"Capture",f=[];a!==null;){var p=a,m=p.stateNode;p=p.tag,p!==5&&p!==26&&p!==27||m===null||(p=qa(a,u),p!=null&&f.unshift(Mo(a,p,m)),p=qa(a,o),p!=null&&f.push(Mo(a,p,m))),a=a.return}return f}function Xr(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function ub(a,o,u,f,p){for(var m=o._reactName,v=[];u!==null&&u!==f;){var x=u,M=x.alternate,V=x.stateNode;if(x=x.tag,M!==null&&M===f)break;x!==5&&x!==26&&x!==27||V===null||(M=V,p?(V=qa(u,m),V!=null&&v.unshift(Mo(u,V,M))):p||(V=qa(u,m),V!=null&&v.push(Mo(u,V,M)))),u=u.return}v.length!==0&&a.push({event:o,listeners:v})}var p3=/\r\n?/g,_3=/\u0000|\uFFFD/g;function hb(a){return(typeof a=="string"?a:""+a).replace(p3,`
`).replace(_3,"")}function fb(a,o){return o=hb(o),hb(a)===o}function Oc(){}function qe(a,o,u,f,p,m){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||vr(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&vr(a,""+f);break;case"className":Ul(a,"class",f);break;case"tabIndex":Ul(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Ul(a,u,f);break;case"style":wm(a,f,m);break;case"data":if(o!=="object"){Ul(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=zl(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(u==="formAction"?(o!=="input"&&qe(a,o,"name",p.name,p,null),qe(a,o,"formEncType",p.formEncType,p,null),qe(a,o,"formMethod",p.formMethod,p,null),qe(a,o,"formTarget",p.formTarget,p,null)):(qe(a,o,"encType",p.encType,p,null),qe(a,o,"method",p.method,p,null),qe(a,o,"target",p.target,p,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=zl(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=Oc);break;case"onScroll":f!=null&&Ue("scroll",a);break;case"onScrollEnd":f!=null&&Ue("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(u=f.__html,u!=null){if(p.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=zl(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":Ue("beforetoggle",a),Ue("toggle",a),Bl(a,"popover",f);break;case"xlinkActuate":os(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":os(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":os(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":os(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":os(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":os(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":os(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":os(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":os(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Bl(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=WA.get(u)||u,Bl(a,u,f))}}function Nd(a,o,u,f,p,m){switch(u){case"style":wm(a,f,m);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(u=f.__html,u!=null){if(p.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"children":typeof f=="string"?vr(a,f):(typeof f=="number"||typeof f=="bigint")&&vr(a,""+f);break;case"onScroll":f!=null&&Ue("scroll",a);break;case"onScrollEnd":f!=null&&Ue("scrollend",a);break;case"onClick":f!=null&&(a.onclick=Oc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!dm.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),o=u.slice(2,p?u.length-7:void 0),m=a[Qt]||null,m=m!=null?m[u]:null,typeof m=="function"&&a.removeEventListener(o,m,p),typeof f=="function")){typeof m!="function"&&m!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,p);break e}u in a?a[u]=f:f===!0?a.setAttribute(u,""):Bl(a,u,f)}}}function Nt(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ue("error",a),Ue("load",a);var f=!1,p=!1,m;for(m in u)if(u.hasOwnProperty(m)){var v=u[m];if(v!=null)switch(m){case"src":f=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:qe(a,o,m,v,u,null)}}p&&qe(a,o,"srcSet",u.srcSet,u,null),f&&qe(a,o,"src",u.src,u,null);return;case"input":Ue("invalid",a);var x=m=v=p=null,M=null,V=null;for(f in u)if(u.hasOwnProperty(f)){var te=u[f];if(te!=null)switch(f){case"name":p=te;break;case"type":v=te;break;case"checked":M=te;break;case"defaultChecked":V=te;break;case"value":m=te;break;case"defaultValue":x=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(s(137,o));break;default:qe(a,o,f,te,u,null)}}ym(a,m,x,M,V,v,p,!1),Ll(a);return;case"select":Ue("invalid",a),f=v=m=null;for(p in u)if(u.hasOwnProperty(p)&&(x=u[p],x!=null))switch(p){case"value":m=x;break;case"defaultValue":v=x;break;case"multiple":f=x;default:qe(a,o,p,x,u,null)}o=m,u=v,a.multiple=!!f,o!=null?br(a,!!f,o,!1):u!=null&&br(a,!!f,u,!0);return;case"textarea":Ue("invalid",a),m=p=f=null;for(v in u)if(u.hasOwnProperty(v)&&(x=u[v],x!=null))switch(v){case"value":f=x;break;case"defaultValue":p=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(s(91));break;default:qe(a,o,v,x,u,null)}vm(a,f,p,m),Ll(a);return;case"option":for(M in u)if(u.hasOwnProperty(M)&&(f=u[M],f!=null))switch(M){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:qe(a,o,M,f,u,null)}return;case"dialog":Ue("cancel",a),Ue("close",a);break;case"iframe":case"object":Ue("load",a);break;case"video":case"audio":for(f=0;f<Oo.length;f++)Ue(Oo[f],a);break;case"image":Ue("error",a),Ue("load",a);break;case"details":Ue("toggle",a);break;case"embed":case"source":case"link":Ue("error",a),Ue("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in u)if(u.hasOwnProperty(V)&&(f=u[V],f!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:qe(a,o,V,f,u,null)}return;default:if(Kh(o)){for(te in u)u.hasOwnProperty(te)&&(f=u[te],f!==void 0&&Nd(a,o,te,f,u,void 0));return}}for(x in u)u.hasOwnProperty(x)&&(f=u[x],f!=null&&qe(a,o,x,f,u,null))}function m3(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,m=null,v=null,x=null,M=null,V=null,te=null;for(G in u){var re=u[G];if(u.hasOwnProperty(G)&&re!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":M=re;default:f.hasOwnProperty(G)||qe(a,o,G,null,f,re)}}for(var Y in f){var G=f[Y];if(re=u[Y],f.hasOwnProperty(Y)&&(G!=null||re!=null))switch(Y){case"type":m=G;break;case"name":p=G;break;case"checked":V=G;break;case"defaultChecked":te=G;break;case"value":v=G;break;case"defaultValue":x=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(s(137,o));break;default:G!==re&&qe(a,o,Y,G,f,re)}}qh(a,v,x,M,V,te,m,p);return;case"select":G=v=x=Y=null;for(m in u)if(M=u[m],u.hasOwnProperty(m)&&M!=null)switch(m){case"value":break;case"multiple":G=M;default:f.hasOwnProperty(m)||qe(a,o,m,null,f,M)}for(p in f)if(m=f[p],M=u[p],f.hasOwnProperty(p)&&(m!=null||M!=null))switch(p){case"value":Y=m;break;case"defaultValue":x=m;break;case"multiple":v=m;default:m!==M&&qe(a,o,p,m,f,M)}o=x,u=v,f=G,Y!=null?br(a,!!u,Y,!1):!!f!=!!u&&(o!=null?br(a,!!u,o,!0):br(a,!!u,u?[]:"",!1));return;case"textarea":G=Y=null;for(x in u)if(p=u[x],u.hasOwnProperty(x)&&p!=null&&!f.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:qe(a,o,x,null,f,p)}for(v in f)if(p=f[v],m=u[v],f.hasOwnProperty(v)&&(p!=null||m!=null))switch(v){case"value":Y=p;break;case"defaultValue":G=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(s(91));break;default:p!==m&&qe(a,o,v,p,f,m)}bm(a,Y,G);return;case"option":for(var me in u)if(Y=u[me],u.hasOwnProperty(me)&&Y!=null&&!f.hasOwnProperty(me))switch(me){case"selected":a.selected=!1;break;default:qe(a,o,me,null,f,Y)}for(M in f)if(Y=f[M],G=u[M],f.hasOwnProperty(M)&&Y!==G&&(Y!=null||G!=null))switch(M){case"selected":a.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:qe(a,o,M,Y,f,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ae in u)Y=u[Ae],u.hasOwnProperty(Ae)&&Y!=null&&!f.hasOwnProperty(Ae)&&qe(a,o,Ae,null,f,Y);for(V in f)if(Y=f[V],G=u[V],f.hasOwnProperty(V)&&Y!==G&&(Y!=null||G!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,o));break;default:qe(a,o,V,Y,f,G)}return;default:if(Kh(o)){for(var ct in u)Y=u[ct],u.hasOwnProperty(ct)&&Y!==void 0&&!f.hasOwnProperty(ct)&&Nd(a,o,ct,void 0,f,Y);for(te in f)Y=f[te],G=u[te],!f.hasOwnProperty(te)||Y===G||Y===void 0&&G===void 0||Nd(a,o,te,Y,f,G);return}}for(var W in u)Y=u[W],u.hasOwnProperty(W)&&Y!=null&&!f.hasOwnProperty(W)&&qe(a,o,W,null,f,Y);for(re in f)Y=f[re],G=u[re],!f.hasOwnProperty(re)||Y===G||Y==null&&G==null||qe(a,o,re,Y,f,G)}var Dd=null,Bd=null;function Mc(a){return a.nodeType===9?a:a.ownerDocument}function db(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gb(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function Ud(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ld=null;function y3(){var a=window.event;return a&&a.type==="popstate"?a===Ld?!1:(Ld=a,!0):(Ld=null,!1)}var pb=typeof setTimeout=="function"?setTimeout:void 0,b3=typeof clearTimeout=="function"?clearTimeout:void 0,_b=typeof Promise=="function"?Promise:void 0,v3=typeof queueMicrotask=="function"?queueMicrotask:typeof _b<"u"?function(a){return _b.resolve(null).then(a).catch(T3)}:pb;function T3(a){setTimeout(function(){throw a})}function Fd(a,o){var u=o,f=0;do{var p=u.nextSibling;if(a.removeChild(u),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(f===0){a.removeChild(p),Lo(o);return}f--}else u!=="$"&&u!=="$?"&&u!=="$!"||f++;u=p}while(u);Lo(o)}function zd(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":zd(u),Xh(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function w3(a,o,u,f){for(;a.nodeType===1;){var p=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[Wa])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(m=a.getAttribute("rel"),m==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(m!==p.rel||a.getAttribute("href")!==(p.href==null?null:p.href)||a.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||a.getAttribute("title")!==(p.title==null?null:p.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(m=a.getAttribute("src"),(m!==(p.src==null?null:p.src)||a.getAttribute("type")!==(p.type==null?null:p.type)||a.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&m&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var m=p.name==null?null:""+p.name;if(p.type==="hidden"&&a.getAttribute("name")===m)return a}else return a;if(a=Dn(a.nextSibling),a===null)break}return null}function x3(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Dn(a.nextSibling),a===null))return null;return a}function Dn(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}function mb(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function yb(a,o,u){switch(o=Mc(u),a){case"html":if(a=o.documentElement,!a)throw Error(s(452));return a;case"head":if(a=o.head,!a)throw Error(s(453));return a;case"body":if(a=o.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}var Sn=new Map,bb=new Set;function Pc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.ownerDocument}var ws=se.d;se.d={f:S3,r:A3,D:E3,C:R3,L:C3,m:O3,X:P3,S:M3,M:I3};function S3(){var a=ws.f(),o=xc();return a||o}function A3(a){var o=_r(a);o!==null&&o.tag===5&&o.type==="form"?Xy(o):ws.r(a)}var qr=typeof document>"u"?null:document;function vb(a,o,u){var f=qr;if(f&&typeof o=="string"&&o){var p=gn(o);p='link[rel="'+a+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),bb.has(p)||(bb.add(p),a={rel:a,crossOrigin:u,href:o},f.querySelector(p)===null&&(o=f.createElement("link"),Nt(o,"link",a),At(o),f.head.appendChild(o)))}}function E3(a){ws.D(a),vb("dns-prefetch",a,null)}function R3(a,o){ws.C(a,o),vb("preconnect",a,o)}function C3(a,o,u){ws.L(a,o,u);var f=qr;if(f&&a&&o){var p='link[rel="preload"][as="'+gn(o)+'"]';o==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+gn(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+gn(u.imageSizes)+'"]')):p+='[href="'+gn(a)+'"]';var m=p;switch(o){case"style":m=Yr(a);break;case"script":m=Kr(a)}Sn.has(m)||(a=oe({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Sn.set(m,a),f.querySelector(p)!==null||o==="style"&&f.querySelector(Po(m))||o==="script"&&f.querySelector(Io(m))||(o=f.createElement("link"),Nt(o,"link",a),At(o),f.head.appendChild(o)))}}function O3(a,o){ws.m(a,o);var u=qr;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",p='link[rel="modulepreload"][as="'+gn(f)+'"][href="'+gn(a)+'"]',m=p;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Kr(a)}if(!Sn.has(m)&&(a=oe({rel:"modulepreload",href:a},o),Sn.set(m,a),u.querySelector(p)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Io(m)))return}f=u.createElement("link"),Nt(f,"link",a),At(f),u.head.appendChild(f)}}}function M3(a,o,u){ws.S(a,o,u);var f=qr;if(f&&a){var p=mr(f).hoistableStyles,m=Yr(a);o=o||"default";var v=p.get(m);if(!v){var x={loading:0,preload:null};if(v=f.querySelector(Po(m)))x.loading=5;else{a=oe({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Sn.get(m))&&Vd(a,u);var M=v=f.createElement("link");At(M),Nt(M,"link",a),M._p=new Promise(function(V,te){M.onload=V,M.onerror=te}),M.addEventListener("load",function(){x.loading|=1}),M.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Ic(v,o,f)}v={type:"stylesheet",instance:v,count:1,state:x},p.set(m,v)}}}function P3(a,o){ws.X(a,o);var u=qr;if(u&&a){var f=mr(u).hoistableScripts,p=Kr(a),m=f.get(p);m||(m=u.querySelector(Io(p)),m||(a=oe({src:a,async:!0},o),(o=Sn.get(p))&&jd(a,o),m=u.createElement("script"),At(m),Nt(m,"link",a),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(p,m))}}function I3(a,o){ws.M(a,o);var u=qr;if(u&&a){var f=mr(u).hoistableScripts,p=Kr(a),m=f.get(p);m||(m=u.querySelector(Io(p)),m||(a=oe({src:a,async:!0,type:"module"},o),(o=Sn.get(p))&&jd(a,o),m=u.createElement("script"),At(m),Nt(m,"link",a),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(p,m))}}function Tb(a,o,u,f){var p=(p=Pn.current)?Pc(p):null;if(!p)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Yr(u.href),u=mr(p).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Yr(u.href);var m=mr(p).hoistableStyles,v=m.get(a);if(v||(p=p.ownerDocument||p,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(a,v),(m=p.querySelector(Po(a)))&&!m._p&&(v.instance=m,v.state.loading=5),Sn.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Sn.set(a,u),m||k3(p,a,u,v.state))),o&&f===null)throw Error(s(528,""));return v}if(o&&f!==null)throw Error(s(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Kr(u),u=mr(p).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Yr(a){return'href="'+gn(a)+'"'}function Po(a){return'link[rel="stylesheet"]['+a+"]"}function wb(a){return oe({},a,{"data-precedence":a.precedence,precedence:null})}function k3(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Nt(o,"link",u),At(o),a.head.appendChild(o))}function Kr(a){return'[src="'+gn(a)+'"]'}function Io(a){return"script[async]"+a}function xb(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+gn(u.href)+'"]');if(f)return o.instance=f,At(f),f;var p=oe({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),At(f),Nt(f,"style",p),Ic(f,u.precedence,a),o.instance=f;case"stylesheet":p=Yr(u.href);var m=a.querySelector(Po(p));if(m)return o.state.loading|=4,o.instance=m,At(m),m;f=wb(u),(p=Sn.get(p))&&Vd(f,p),m=(a.ownerDocument||a).createElement("link"),At(m);var v=m;return v._p=new Promise(function(x,M){v.onload=x,v.onerror=M}),Nt(m,"link",f),o.state.loading|=4,Ic(m,u.precedence,a),o.instance=m;case"script":return m=Kr(u.src),(p=a.querySelector(Io(m)))?(o.instance=p,At(p),p):(f=u,(p=Sn.get(m))&&(f=oe({},u),jd(f,p)),a=a.ownerDocument||a,p=a.createElement("script"),At(p),Nt(p,"link",f),a.head.appendChild(p),o.instance=p);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Ic(f,u.precedence,a));return o.instance}function Ic(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=f.length?f[f.length-1]:null,m=p,v=0;v<f.length;v++){var x=f[v];if(x.dataset.precedence===o)m=x;else if(m!==p)break}m?m.parentNode.insertBefore(a,m.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function Vd(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function jd(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var kc=null;function Sb(a,o,u){if(kc===null){var f=new Map,p=kc=new Map;p.set(u,f)}else p=kc,f=p.get(u),f||(f=new Map,p.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),p=0;p<u.length;p++){var m=u[p];if(!(m[Wa]||m[Ft]||a==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(o)||"";v=a+v;var x=f.get(v);x?x.push(m):f.set(v,[m])}}return f}function Ab(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function N3(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Eb(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var ko=null;function D3(){}function B3(a,o,u){if(ko===null)throw Error(s(475));var f=ko;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var p=Yr(u.href),m=a.querySelector(Po(p));if(m){a=m._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Nc.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=m,At(m);return}m=a.ownerDocument||a,u=wb(u),(p=Sn.get(p))&&Vd(u,p),m=m.createElement("link"),At(m);var v=m;v._p=new Promise(function(x,M){v.onload=x,v.onerror=M}),Nt(m,"link",u),o.instance=m}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Nc.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function U3(){if(ko===null)throw Error(s(475));var a=ko;return a.stylesheets&&a.count===0&&$d(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&$d(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function Nc(){if(this.count--,this.count===0){if(this.stylesheets)$d(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Dc=null;function $d(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Dc=new Map,o.forEach(L3,a),Dc=null,Nc.call(a))}function L3(a,o){if(!(o.state.loading&4)){var u=Dc.get(a);if(u)var f=u.get(null);else{u=new Map,Dc.set(a,u);for(var p=a.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<p.length;m++){var v=p[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(u.set(v.dataset.precedence,v),f=v)}f&&u.set(null,f)}p=o.instance,v=p.getAttribute("data-precedence"),m=u.get(v)||f,m===f&&u.set(null,p),u.set(v,p),this.count++,f=Nc.bind(this),p.addEventListener("load",f),p.addEventListener("error",f),m?m.parentNode.insertBefore(p,m.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(p,a.firstChild)),o.state.loading|=4}}var No={$$typeof:b,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function F3(a,o,u,f,p,m,v,x){this.tag=1,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hh(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hh(0),this.hiddenUpdates=Hh(null),this.identifierPrefix=f,this.onUncaughtError=p,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function Rb(a,o,u,f,p,m,v,x,M,V,te,re){return a=new F3(a,o,u,v,x,M,V,re),o=1,m===!0&&(o|=24),m=wn(3,null,null,o),a.current=m,m.stateNode=a,o=Tf(),o.refCount++,a.pooledCache=o,o.refCount++,m.memoizedState={element:f,isDehydrated:u,cache:o},td(m),a}function Cb(a){return a?(a=Rr,a):Rr}function Ob(a,o,u,f,p,m){p=Cb(p),f.context===null?f.context=p:f.pendingContext=p,f=js(o),f.payload={element:u},m=m===void 0?null:m,m!==null&&(f.callback=m),u=$s(a,f,o),u!==null&&(Yt(u,a,o),mo(u,a,o))}function Mb(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function Hd(a,o){Mb(a,o),(a=a.alternate)&&Mb(a,o)}function Pb(a){if(a.tag===13){var o=Ds(a,67108864);o!==null&&Yt(o,a,67108864),Hd(a,67108864)}}var Bc=!0;function z3(a,o,u,f){var p=J.T;J.T=null;var m=se.p;try{se.p=2,Wd(a,o,u,f)}finally{se.p=m,J.T=p}}function V3(a,o,u,f){var p=J.T;J.T=null;var m=se.p;try{se.p=8,Wd(a,o,u,f)}finally{se.p=m,J.T=p}}function Wd(a,o,u,f){if(Bc){var p=Xd(f);if(p===null)kd(a,o,f,Uc,u),kb(a,f);else if($3(p,a,o,u,f))f.stopPropagation();else if(kb(a,f),o&4&&-1<j3.indexOf(a)){for(;p!==null;){var m=_r(p);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=Si(m.pendingLanes);if(v!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;v;){var M=1<<31-sn(v);x.entanglements[1]|=M,v&=~M}Zn(m),(it&6)===0&&(vc=Wn()+500,Co(0))}}break;case 13:x=Ds(m,2),x!==null&&Yt(x,m,2),xc(),Hd(m,2)}if(m=Xd(f),m===null&&kd(a,o,f,Uc,u),m===p)break;p=m}p!==null&&f.stopPropagation()}else kd(a,o,f,null,u)}}function Xd(a){return a=Qh(a),qd(a)}var Uc=null;function qd(a){if(Uc=null,a=Ai(a),a!==null){var o=I(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=Q(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Uc=a,null}function Ib(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(RA()){case nm:return 2;case sm:return 8;case Il:case CA:return 32;case im:return 268435456;default:return 32}default:return 32}}var Yd=!1,Zs=null,Qs=null,Gs=null,Do=new Map,Bo=new Map,Js=[],j3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function kb(a,o){switch(a){case"focusin":case"focusout":Zs=null;break;case"dragenter":case"dragleave":Qs=null;break;case"mouseover":case"mouseout":Gs=null;break;case"pointerover":case"pointerout":Do.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bo.delete(o.pointerId)}}function Uo(a,o,u,f,p,m){return a===null||a.nativeEvent!==m?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:m,targetContainers:[p]},o!==null&&(o=_r(o),o!==null&&Pb(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,p!==null&&o.indexOf(p)===-1&&o.push(p),a)}function $3(a,o,u,f,p){switch(o){case"focusin":return Zs=Uo(Zs,a,o,u,f,p),!0;case"dragenter":return Qs=Uo(Qs,a,o,u,f,p),!0;case"mouseover":return Gs=Uo(Gs,a,o,u,f,p),!0;case"pointerover":var m=p.pointerId;return Do.set(m,Uo(Do.get(m)||null,a,o,u,f,p)),!0;case"gotpointercapture":return m=p.pointerId,Bo.set(m,Uo(Bo.get(m)||null,a,o,u,f,p)),!0}return!1}function Nb(a){var o=Ai(a.target);if(o!==null){var u=I(o);if(u!==null){if(o=u.tag,o===13){if(o=Q(u),o!==null){a.blockedOn=o,UA(a.priority,function(){if(u.tag===13){var f=cn(),p=Ds(u,f);p!==null&&Yt(p,u,f),Hd(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Lc(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Xd(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);Zh=f,u.target.dispatchEvent(f),Zh=null}else return o=_r(u),o!==null&&Pb(o),a.blockedOn=u,!1;o.shift()}return!0}function Db(a,o,u){Lc(a)&&u.delete(o)}function H3(){Yd=!1,Zs!==null&&Lc(Zs)&&(Zs=null),Qs!==null&&Lc(Qs)&&(Qs=null),Gs!==null&&Lc(Gs)&&(Gs=null),Do.forEach(Db),Bo.forEach(Db)}function Fc(a,o){a.blockedOn===o&&(a.blockedOn=null,Yd||(Yd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,H3)))}var zc=null;function Bb(a){zc!==a&&(zc=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){zc===a&&(zc=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],p=a[o+2];if(typeof f!="function"){if(qd(f||u)===null)continue;break}var m=_r(u);m!==null&&(a.splice(o,3),o-=3,Uf(m,{pending:!0,data:p,method:u.method,action:f},f,p))}}))}function Lo(a){function o(M){return Fc(M,a)}Zs!==null&&Fc(Zs,a),Qs!==null&&Fc(Qs,a),Gs!==null&&Fc(Gs,a),Do.forEach(o),Bo.forEach(o);for(var u=0;u<Js.length;u++){var f=Js[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Js.length&&(u=Js[0],u.blockedOn===null);)Nb(u),u.blockedOn===null&&Js.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var p=u[f],m=u[f+1],v=p[Qt]||null;if(typeof m=="function")v||Bb(u);else if(v){var x=null;if(m&&m.hasAttribute("formAction")){if(p=m,v=m[Qt]||null)x=v.formAction;else if(qd(p)!==null)continue}else x=v.action;typeof x=="function"?u[f+1]=x:(u.splice(f,3),f-=3),Bb(u)}}}function Kd(a){this._internalRoot=a}Vc.prototype.render=Kd.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(s(409));var u=o.current,f=cn();Ob(u,f,a,o,null,null)},Vc.prototype.unmount=Kd.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;a.tag===0&&Hr(),Ob(a.current,2,null,a,null,null),xc(),o[pr]=null}};function Vc(a){this._internalRoot=a}Vc.prototype.unstable_scheduleHydration=function(a){if(a){var o=um();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Js.length&&o!==0&&o<Js[u].priority;u++);Js.splice(u,0,a),u===0&&Nb(a)}};var Ub=e.version;if(Ub!=="19.0.0")throw Error(s(527,Ub,"19.0.0"));se.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=L(o),a=a!==null?K(a):null,a=a===null?null:a.stateNode,a};var W3={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:J,findFiberByHostInstance:Ai,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jc.isDisabled&&jc.supportsFiber)try{ja=jc.inject(W3),nn=jc}catch{}}return zo.createRoot=function(a,o){if(!i(a))throw Error(s(299));var u=!1,f="",p=e0,m=t0,v=n0,x=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(p=o.onUncaughtError),o.onCaughtError!==void 0&&(m=o.onCaughtError),o.onRecoverableError!==void 0&&(v=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(x=o.unstable_transitionCallbacks)),o=Rb(a,1,!1,null,null,u,f,p,m,v,x,null),a[pr]=o.current,Id(a.nodeType===8?a.parentNode:a),new Kd(o)},zo.hydrateRoot=function(a,o,u){if(!i(a))throw Error(s(299));var f=!1,p="",m=e0,v=t0,x=n0,M=null,V=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(m=u.onUncaughtError),u.onCaughtError!==void 0&&(v=u.onCaughtError),u.onRecoverableError!==void 0&&(x=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(M=u.unstable_transitionCallbacks),u.formState!==void 0&&(V=u.formState)),o=Rb(a,1,!0,o,u??null,f,p,m,v,x,M,V),o.context=Cb(null),u=o.current,f=cn(),p=js(f),p.callback=null,$s(u,p,f),o.current.lanes=f,Ha(o,f),Zn(o),a[pr]=o.current,Id(a),new Vc(o)},zo.version="19.0.0",zo}var qb;function iE(){if(qb)return Gd.exports;qb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Gd.exports=sE(),Gd.exports}var rE=iE();function Nu(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const ng={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global},Yb=ng.window||ng.self||ng.global||{},n_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Kb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Kb&&parseFloat(Kb[1]);const $c=globalThis,Zr=globalThis.process||{},aE=globalThis.navigator||{};function hw(n){var s,i;if(typeof window<"u"&&((s=window.process)==null?void 0:s.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function ur(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||hw()}function oE(n){return ur()?hw()?"Electron":(aE.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const fw="4.1.0";function lE(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class cE{constructor(e,t,s="sessionStorage"){this.storage=lE(s),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function uE(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function hE(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Du;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Du||(Du={}));const fE=10;function Zb(n){return typeof n!="string"?n:(n=n.toUpperCase(),Du[n]||Du.WHITE)}function dE(n,e,t){return!ur&&typeof n=="string"&&(e&&(n=`\x1B[${Zb(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Zb(t)+fE}m${n}\x1B[49m`)),n}function gE(n,e=["constructor"]){const t=Object.getPrototypeOf(n),s=Object.getOwnPropertyNames(t),i=n;for(const r of s){const l=i[r];typeof l=="function"&&(e.find(c=>r===c)||(i[r]=l.bind(n)))}}function s_(n,e){if(!n)throw new Error("Assertion failed")}function Qr(){var e,t,s;let n;if(ur()&&$c.performance)n=(t=(e=$c==null?void 0:$c.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Zr){const i=(s=Zr==null?void 0:Zr.hrtime)==null?void 0:s.call(Zr);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const Gr={debug:ur()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},pE={enabled:!0,level:0};function Jr(){}const Qb={},Gb={once:!0};class Al{constructor({id:e}={id:""}){this.VERSION=fw,this._startTs=Qr(),this._deltaTs=Qr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new cE(`__probe-${this.id}__`,pE),this.timeStamp(`${this.id} started`),gE(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Qr()-this._startTs).toPrecision(10))}getDelta(){return Number((Qr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Gr.warn,arguments,Gb)}error(e){return this._getLogFunction(0,e,Gr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gr.debug||Gr.info,arguments,Gb)}table(e,t,s){return t?this._getLogFunction(e,t,console.table||Jr,s&&[s],{tag:mE(t)}):Jr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Jr)}group(e,t,s={collapsed:!1}){const i=Jb({logLevel:e,message:t,opts:s}),{collapsed:r}=s;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,s={}){return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Jr)}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=dw(e)}_getLogFunction(e,t,s,i,r){if(this._shouldLog(e)){r=Jb({logLevel:e,message:t,args:i,opts:r}),s=s||r.method,s_(s),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Qr();const l=r.tag||r.message;if(r.once&&l)if(!Qb[l])Qb[l]=Qr();else return Jr;return t=_E(this.id,r.message,r),s.bind(console,t,...r.args)}return Jr}}Al.VERSION=fw;function dw(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return s_(Number.isFinite(e)&&e>=0),e}function Jb(n){const{logLevel:e,message:t}=n;n.logLevel=dw(e);const s=n.args?Array.from(n.args):[];for(;s.length&&s.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&s.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return s_(i==="string"||i==="object"),Object.assign(n,{args:s},n.opts)}function _E(n,e,t){if(typeof e=="string"){const s=t.time?hE(uE(t.total)):"";e=t.time?`${n}: ${s}  ${e}`:`${n}: ${e}`,e=dE(e,t.color,t.background)}return e}function mE(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const sg="4.3.2",yE=sg[0]>="0"&&sg[0]<="9"?`v${sg}`:"";function bE(){const n=new Al({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=yE,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const vE=bE();function TE(n,e){return gw(n||{},e)}function gw(n,e,t=0){if(t>3)return e;const s={...n};for(const[i,r]of Object.entries(e))r&&typeof r=="object"&&!Array.isArray(r)?s[i]=gw(s[i]||{},e[i],t+1):s[i]=e[i];return s}const wE="latest";function xE(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const SE=xE();function vi(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const er=typeof process!="object"||String(process)!=="[object process]"||process.browser,AE=typeof window<"u"&&typeof window.orientation<"u",ev=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ev&&parseFloat(ev[1]);class EE{constructor(e,t){w(this,"name");w(this,"workerThread");w(this,"isRunning",!0);w(this,"result");w(this,"_resolve",()=>{});w(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((s,i)=>{this._resolve=s,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){vi(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){vi(this.isRunning),this.isRunning=!1,this._reject(e)}}class ig{terminate(){}}const rg=new Map;function RE(n){vi(n.source&&!n.url||!n.source&&n.url);let e=rg.get(n.source||n.url);return e||(n.url&&(e=CE(n.url),rg.set(n.url,e)),n.source&&(e=pw(n.source),rg.set(n.source,e))),vi(e),e}function CE(n){if(!n.startsWith("http"))return n;const e=OE(n);return pw(e)}function pw(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function OE(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function _w(n,e=!0,t){const s=t||new Set;if(n){if(tv(n))s.add(n);else if(tv(n.buffer))s.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)_w(n[i],e,s)}}return t===void 0?Array.from(s):[]}function tv(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const ag=()=>{};class Zg{constructor(e){w(this,"name");w(this,"source");w(this,"url");w(this,"terminated",!1);w(this,"worker");w(this,"onMessage");w(this,"onError");w(this,"_loadableURL","");const{name:t,source:s,url:i}=e;vi(s||i),this.name=t,this.source=s,this.url=i,this.onMessage=ag,this.onError=r=>console.log(r),this.worker=er?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&er||typeof ig<"u"&&!er}destroy(){this.onMessage=ag,this.onError=ag,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||_w(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=RE({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new ig(s,{eval:!1})}else if(this.source)e=new ig(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class ME{constructor(e){w(this,"name","unnamed");w(this,"source");w(this,"url");w(this,"maxConcurrency",1);w(this,"maxMobileConcurrency",1);w(this,"onDebug",()=>{});w(this,"reuseWorkers",!0);w(this,"props",{});w(this,"jobQueue",[]);w(this,"idleQueue",[]);w(this,"count",0);w(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Zg.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,r,l)=>i.done(l),s=(i,r)=>i.error(r)){const i=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:s,onStart:r}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new EE(t.name,e);e.onMessage=i=>t.onMessage(s,i.type,i.payload),e.onError=i=>t.onError(s,i),t.onStart(s);try{await s.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!er||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Zg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return AE?this.maxMobileConcurrency:this.maxConcurrency}}const PE={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ui=class ui{constructor(e){w(this,"props");w(this,"workerPools",new Map);this.props={...PE},this.setProps(e),this.workerPools=new Map}static isSupported(){return Zg.isSupported()}static getWorkerFarm(e={}){return ui._workerFarm=ui._workerFarm||new ui({}),ui._workerFarm.setProps(e),ui._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:s,url:i}=e;let r=this.workerPools.get(t);return r||(r=new ME({name:t,source:s,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};w(ui,"_workerFarm");let Bu=ui;function IE(n,e={}){const t=e[n.id]||{},s=er?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(er?i=`modules/${n.module}/dist/${s}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let r=n.version;r==="latest"&&(r=wE);const l=r?`@${r}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${s}`}return vi(i),i}function kE(n,e=SE){vi(n,"no worker provided");const t=n.version;return!(!e||!t)}function NE(n,e){return!Bu.isSupported()||!er&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function DE(n,e,t,s,i){const r=n.id,l=IE(n,t),h=Bu.getWorkerFarm(t).getWorkerPool({name:r,url:l});t=JSON.parse(JSON.stringify(t)),s=JSON.parse(JSON.stringify(s||{}));const d=await h.startJob("process-on-worker",BE.bind(null,i));return d.postMessage("process",{input:e,options:t,context:s}),await(await d.result).result}async function BE(n,e,t,s){switch(t){case"done":e.done(s);break;case"error":e.error(new Error(s.error));break;case"process":const{id:i,input:r,options:l}=s;try{const c=await n(r,l);e.postMessage("done",{id:i,result:c})}catch(c){const h=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function UE(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const s=new Uint8Array(n),i=new Uint8Array(e);for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0}function LE(...n){return FE(n)}function FE(n){const e=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),t=e.reduce((r,l)=>r+l.byteLength,0),s=new Uint8Array(t);let i=0;for(const r of e)s.set(r,i),i+=r.byteLength;return s.buffer}async function zE(n){const e=[];for await(const t of n)e.push(t);return LE(...e)}function nv(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class sv{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=nv(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(nv()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class El{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:s}=e;let i=this.stats[t];return i||(e instanceof sv?i=e:i=new sv(t,s),this.stats[t]=i),i}}const VE="Queued Requests",jE="Active Requests",$E="Cancelled Requests",HE="Queued Requests Ever",WE="Active Requests Ever",XE={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class qE{constructor(e={}){w(this,"props");w(this,"stats");w(this,"activeRequestCount",0);w(this,"requestQueue",[]);w(this,"requestMap",new Map);w(this,"updateTimer",null);this.props={...XE,...e},this.stats=new El({id:this.props.id}),this.stats.get(VE),this.stats.get(jE),this.stats.get($E),this.stats.get(HE),this.stats.get(WE)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const s={handle:e,priority:0,getPriority:t},i=new Promise(r=>(s.resolve=r,s));return this.requestQueue.push(s),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:s}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const s=e[t];this._updateRequest(s)||(e.splice(t,1),this.requestMap.delete(s.handle),t--)}e.sort((t,s)=>t.priority-s.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let YE="";const iv={};function KE(n){for(const e in iv)if(n.startsWith(e)){const t=iv[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${YE}${n}`),n}function ZE(n){return n&&typeof n=="object"&&n.isBuffer}function mw(n){if(ZE(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function yw(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function QE(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const GE=n=>typeof n=="boolean",sl=n=>typeof n=="function",Rl=n=>n!==null&&typeof n=="object",rv=n=>Rl(n)&&n.constructor==={}.constructor,JE=n=>!!n&&typeof n[Symbol.iterator]=="function",eR=n=>n&&typeof n[Symbol.asyncIterator]=="function",hr=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,fr=n=>typeof Blob<"u"&&n instanceof Blob,tR=n=>n&&typeof n=="object"&&n.isBuffer,nR=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Rl(n)&&sl(n.tee)&&sl(n.cancel)&&sl(n.getReader),sR=n=>Rl(n)&&sl(n.read)&&sl(n.pipe)&&GE(n.readable),bw=n=>nR(n)||sR(n);class iR extends Error{constructor(t,s){super(t);w(this,"reason");w(this,"url");w(this,"response");this.reason=s.reason,this.url=s.url,this.response=s.response}}const rR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,aR=/^([-\w.]+\/[-\w.+]+)/;function av(n,e){return n.toLowerCase()===e.toLowerCase()}function oR(n){const e=aR.exec(n);return e?e[1]:n}function ov(n){const e=rR.exec(n);return e?e[1]:""}const vw=/\?.*/;function lR(n){const e=n.match(vw);return e&&e[0]}function i_(n){return n.replace(vw,"")}function cR(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Ah(n){return hr(n)?n.url:fr(n)?n.name||"":typeof n=="string"?n:""}function r_(n){if(hr(n)){const e=n,t=e.headers.get("content-type")||"",s=i_(e.url);return oR(t)||ov(s)}return fr(n)?n.type||"":typeof n=="string"?ov(n):""}function uR(n){return hr(n)?n.headers["content-length"]||-1:fr(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Tw(n){if(hr(n))return n;const e={},t=uR(n);t>=0&&(e["content-length"]=String(t));const s=Ah(n),i=r_(n);i&&(e["content-type"]=i);const r=await dR(n);r&&(e["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:s}),l}async function hR(n){if(!n.ok)throw await fR(n)}async function fR(n){const e=cR(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const s={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");s.reason=!n.bodyUsed&&(i!=null&&i.includes("application/json"))?await n.json():await n.text()}catch{}return new iR(t,s)}async function dR(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(s=>{const i=new FileReader;i.onload=r=>{var l;return s((l=r==null?void 0:r.target)==null?void 0:l.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${gR(t)}`}return null}function gR(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.byteLength;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function pR(n){return!_R(n)&&!mR(n)}function _R(n){return n.startsWith("http:")||n.startsWith("https:")}function mR(n){return n.startsWith("data:")}async function lv(n,e){var t,s;if(typeof n=="string"){const i=KE(n);return pR(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(s=globalThis.loaders)==null?void 0:s.fetchNode(i,e):await fetch(i,e)}return await Tw(n)}const cv=new Al({id:"loaders.gl"});class yR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class bR{constructor(){w(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const ww={fetch:null,mimeType:void 0,nothrow:!1,log:new bR,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:n_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},vR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xw(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function Sw(){const n=xw();return n.globalOptions=n.globalOptions||{...ww},n.globalOptions}function TR(n,e,t,s){return t=t||[],t=Array.isArray(t)?t:[t],wR(n,t),SR(e,n,s)}function wR(n,e){uv(n,null,ww,vR,e);for(const t of e){const s=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},r=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};uv(s,t.id,i,r,e)}}function uv(n,e,t,s,i){const r=e||"Top level",l=e?`${e}.`:"";for(const c in n){const h=!e&&Rl(n[c]),d=c==="baseUri"&&!e,g=c==="workerUrl"&&e;if(!(c in t)&&!d&&!g){if(c in s)cv.warn(`${r} loader option '${l}${c}' no longer supported, use '${s[c]}'`)();else if(!h){const _=xR(c,i);cv.warn(`${r} loader option '${l}${c}' not recognized. ${_}`)()}}}}function xR(n,e){const t=n.toLowerCase();let s="";for(const i of e)for(const r in i.options){if(n===r)return`Did you mean '${i.id}.${r}'?`;const l=r.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(s=s||`Did you mean '${i.id}.${r}'?`)}return s}function SR(n,e,t){const i={...n.options||{}};return AR(i,t),i.log===null&&(i.log=new yR),hv(i,Sw()),hv(i,e),i}function hv(n,e){for(const t in e)if(t in e){const s=e[t];rv(s)&&rv(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function AR(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function a_(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function o_(n){Nu(n,"null loader"),Nu(a_(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Aw=()=>{const n=xw();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function ER(n){const e=Aw();n=Array.isArray(n)?n:[n];for(const t of n){const s=o_(t);e.find(i=>s===i)||e.unshift(s)}}function RR(){return Aw()}const CR=/\.([^.]+)$/;async function OR(n,e=[],t,s){if(!Ew(n))return null;let i=fv(n,e,{...t,nothrow:!0},s);if(i)return i;if(fr(n)&&(n=await n.slice(0,10).arrayBuffer(),i=fv(n,e,t,s)),!i&&!(t!=null&&t.nothrow))throw new Error(Rw(n));return i}function fv(n,e=[],t,s){if(!Ew(n))return null;if(e&&!Array.isArray(e))return o_(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...RR()),PR(i);const r=MR(n,i,t,s);if(!r&&!(t!=null&&t.nothrow))throw new Error(Rw(n));return r}function MR(n,e,t,s){const i=Ah(n),r=r_(n),l=i_(i)||(s==null?void 0:s.url);let c=null,h="";return t!=null&&t.mimeType&&(c=og(e,t==null?void 0:t.mimeType),h=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),c=c||IR(e,l),h=h||(c?`matched url ${l}`:""),c=c||og(e,r),h=h||(c?`matched MIME type ${r}`:""),c=c||NR(e,n),h=h||(c?`matched initial data ${Cw(n)}`:""),t!=null&&t.fallbackMimeType&&(c=c||og(e,t==null?void 0:t.fallbackMimeType),h=h||(c?`matched fallback MIME type ${r}`:"")),h&&vE.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${h}.`),c}function Ew(n){return!(n instanceof Response&&n.status===204)}function Rw(n){const e=Ah(n),t=r_(n);let s="No valid loader found (";s+=e?`${yw(e)}, `:"no url provided, ",s+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=n?Cw(n):"";return s+=i?` first bytes: "${i}"`:"first bytes: not available",s+=")",s}function PR(n){for(const e of n)o_(e)}function IR(n,e){const t=e&&CR.exec(e),s=t&&t[1];return s?kR(n,s):null}function kR(n,e){e=e.toLowerCase();for(const t of n)for(const s of t.extensions)if(s.toLowerCase()===e)return t;return null}function og(n,e){var t;for(const s of n)if((t=s.mimeTypes)!=null&&t.some(i=>av(e,i))||av(e,`application/x.${s.id}`))return s;return null}function NR(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(DR(e,t))return t}else if(ArrayBuffer.isView(e)){if(dv(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&dv(e,0,t))return t;return null}function DR(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>n.startsWith(s))}function dv(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>BR(n,e,t,i))}function BR(n,e,t,s){if(s instanceof ArrayBuffer)return UE(s,n,s.byteLength);switch(typeof s){case"function":return s(n);case"string":const i=Qg(n,e,s.length);return s===i;default:return!1}}function Cw(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Qg(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Qg(n,0,e):""}function Qg(n,e,t){if(n.byteLength<e+t)return"";const s=new DataView(n);let i="";for(let r=0;r<t;r++)i+=String.fromCharCode(s.getUint8(e+r));return i}const UR=256*1024;function*LR(n,e){const t=(e==null?void 0:e.chunkSize)||UR;let s=0;const i=new TextEncoder;for(;s<n.length;){const r=Math.min(n.length-s,t),l=n.slice(s,s+r);s+=r,yield i.encode(l)}}const FR=256*1024;function*zR(n,e={}){const{chunkSize:t=FR}=e;let s=0;for(;s<n.byteLength;){const i=Math.min(n.byteLength-s,t),r=new ArrayBuffer(i),l=new Uint8Array(n,s,i);new Uint8Array(r).set(l),s+=i,yield r}}const VR=1024*1024;async function*jR(n,e){const t=(e==null?void 0:e.chunkSize)||VR;let s=0;for(;s<n.size;){const i=s+t,r=await n.slice(s,i).arrayBuffer();s=i,yield r}}function gv(n,e){return n_?$R(n,e):HR(n)}async function*$R(n,e){const t=n.getReader();let s;try{for(;;){const i=s||t.read();e!=null&&e._streamReadAhead&&(s=t.read());const{done:r,value:l}=await i;if(r)return;yield mw(l)}}catch{t.releaseLock()}}async function*HR(n,e){for await(const t of n)yield mw(t)}function WR(n,e){if(typeof n=="string")return LR(n,e);if(n instanceof ArrayBuffer)return zR(n,e);if(fr(n))return jR(n,e);if(bw(n))return gv(n,e);if(hr(n))return gv(n.body,e);throw new Error("makeIterator")}const Ow="Cannot convert supplied data type";function XR(n,e,t){if(e.text&&typeof n=="string")return n;if(tR(n)&&(n=n.buffer),n instanceof ArrayBuffer){const s=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let s=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==s.byteLength)&&(s=s.slice(n.byteOffset,n.byteOffset+i)),s}throw new Error(Ow)}async function qR(n,e,t){const s=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||s)return XR(n,e);if(fr(n)&&(n=await Tw(n)),hr(n)){const i=n;return await hR(i),e.binary?await i.arrayBuffer():await i.text()}if(bw(n)&&(n=WR(n,t)),JE(n)||eR(n))return zE(n);throw new Error(Ow)}function Mw(n,e){const t=Sw(),s=n||t;return typeof s.fetch=="function"?s.fetch:Rl(s.fetch)?i=>lv(i,s.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:lv}function YR(n,e,t){if(t)return t;const s={fetch:Mw(e,n),...n};if(s.url){const i=i_(s.url);s.baseUrl=i,s.queryString=lR(s.url),s.filename=yw(i),s.baseUrl=QE(i)}return Array.isArray(s.loaders)||(s.loaders=null),s}function KR(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const s=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...s]:s}return t&&t.length?t:void 0}async function Uu(n,e,t,s){e&&!Array.isArray(e)&&!a_(e)&&(s=void 0,t=e,e=void 0),n=await n,t=t||{};const i=Ah(n),l=KR(e,s),c=await OR(n,l,t);return c?(t=TR(t,c,l,i),s=YR({url:i,_parse:Uu,loaders:l},t,s||null),await ZR(c,n,t,s)):null}async function ZR(n,e,t,s){if(kE(n),t=TE(n.options,t),hr(e)){const r=e,{ok:l,redirected:c,status:h,statusText:d,type:g,url:_}=r,y=Object.fromEntries(r.headers.entries());s.response={headers:y,ok:l,redirected:c,status:h,statusText:d,type:g,url:_}}e=await qR(e,n,t);const i=n;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,s);if(NE(n,t))return await DE(n,e,t,s,Uu);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,s);if(i.parse)return await i.parse(e,t,s);throw vi(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Lu(n,e,t,s){let i,r;!Array.isArray(e)&&!a_(e)?(i=[],r=e):(i=e,r=t);const l=Mw(r);let c=n;return typeof n=="string"&&(c=await l(n)),fr(n)&&(c=await l(n)),Array.isArray(i)?await Uu(c,i,r):await Uu(c,i,r)}const QR="4.3.2";var cw;const GR=(cw=globalThis.loaders)==null?void 0:cw.parseImageNode,Gg=typeof Image<"u",Jg=typeof ImageBitmap<"u",JR=!!GR,ep=n_?!0:JR;function eC(n){switch(n){case"auto":return Jg||Gg||ep;case"imagebitmap":return Jg;case"image":return Gg;case"data":return ep;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function tC(){if(Jg)return"imagebitmap";if(Gg)return"image";if(ep)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function nC(n){const e=iC(n);if(!e)throw new Error("Not an image");return e}function sC(n){switch(nC(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function iC(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const rC=/^data:image\/svg\+xml/,aC=/\.svg((\?|#).*)?$/;function l_(n){return n&&(rC.test(n)||aC.test(n))}function oC(n,e){if(l_(e)){let s=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return Pw(n,e)}function Pw(n,e){if(l_(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Iw(n,e,t){const s=oC(n,t),i=self.URL||self.webkitURL,r=typeof s!="string"&&i.createObjectURL(s);try{return await lC(r||s,e)}finally{r&&i.revokeObjectURL(r)}}async function lC(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((s,i)=>{try{t.onload=()=>s(t),t.onerror=r=>{const l=r instanceof Error?r.message:"error";i(new Error(l))}}catch(r){i(r)}})}const cC={};let pv=!0;async function uC(n,e,t){let s;l_(t)?s=await Iw(n,e,t):s=Pw(n,t);const i=e&&e.imagebitmap;return await hC(s,i)}async function hC(n,e=null){if((fC(e)||!pv)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),pv=!1}return await createImageBitmap(n)}function fC(n){for(const e in n||cC)return!1;return!0}function dC(n){return!mC(n,"ftyp",4)||(n[8]&96)===0?null:gC(n)}function gC(n){switch(pC(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function pC(n,e,t){return String.fromCharCode(...n.slice(e,t))}function _C(n){return[...n].map(e=>e.charCodeAt(0))}function mC(n,e,t=0){const s=_C(e);for(let i=0;i<s.length;++i)if(s[i]!==n[i+t])return!1;return!0}const ns=!1,il=!0;function kw(n){const e=Cl(n);return bC(e)||wC(e)||vC(e)||TC(e)||yC(e)}function yC(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=dC(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function bC(n){const e=Cl(n);return e.byteLength>=24&&e.getUint32(0,ns)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ns),height:e.getUint32(20,ns)}:null}function vC(n){const e=Cl(n);return e.byteLength>=10&&e.getUint32(0,ns)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,il),height:e.getUint16(8,il)}:null}function TC(n){const e=Cl(n);return e.byteLength>=14&&e.getUint16(0,ns)===16973&&e.getUint32(2,il)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,il),height:e.getUint32(22,il)}:null}function wC(n){const e=Cl(n);if(!(e.byteLength>=3&&e.getUint16(0,ns)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:i}=xC();let r=2;for(;r+9<e.byteLength;){const l=e.getUint16(r,ns);if(i.has(l))return{mimeType:"image/jpeg",height:e.getUint16(r+5,ns),width:e.getUint16(r+7,ns)};if(!s.has(l))return null;r+=2,r+=e.getUint16(r,ns)}return null}function xC(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Cl(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function SC(n,e){var i;const{mimeType:t}=kw(n)||{},s=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Nu(s),await s(n,t)}async function AC(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:r}=t||{},l=EC(i);let c;switch(l){case"imagebitmap":c=await uC(n,e,r);break;case"image":c=await Iw(n,e,r);break;case"data":c=await SC(n);break;default:Nu(!1)}return i==="data"&&(c=sC(c)),c}function EC(n){switch(n){case"auto":case"data":return tC();default:return eC(n),n}}const RC=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],CC=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],OC={image:{type:"auto",decode:!0}},MC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:QR,mimeTypes:CC,extensions:RC,parse:AC,tests:[n=>!!kw(new DataView(n))],options:OC},De=new Al({id:"deck"});let tp={};function PC(n){tp=n}function Wt(n,e,t,s){De.level>0&&tp[n]&&tp[n].call(null,e,t,s)}function IC(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const kC={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:IC,parseTextSync:JSON.parse};function NC(){const n="9.1.5",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(De.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:De,_registerLoggers:PC},ER([kC,[MC,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const DC=NC();function c_(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const lg={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function BC(n){const e={};for(const[t,s]of Object.entries(n))e[t]=UC(s);return e}function UC(n){let e=_v(n);if(e!=="object")return{value:n,...lg[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...lg[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=_v(n.value),{...n,...lg[e],type:e}):{type:"object",value:null};throw new Error("props")}function _v(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const LC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,FC=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,zC={vertex:LC,fragment:FC},mv=/void\s+main\s*\([^)]*\)\s*\{\n?/,yv=/}\n?[^{}]*$/,cg=[],Tu="__LUMA_INJECT_DECLARATIONS__";function VC(n){const e={vertex:{},fragment:{}};for(const t in n){let s=n[t];const i=jC(t);typeof s=="string"&&(s={order:0,injection:s}),e[i][t]=s}return e}function jC(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Fu(n,e,t,s=!1){const i=e==="vertex";for(const r in t){const l=t[r];l.sort((h,d)=>h.order-d.order),cg.length=l.length;for(let h=0,d=l.length;h<d;++h)cg[h]=l[h].injection;const c=`${cg.join(`
`)}
`;switch(r){case"vs:#decl":i&&(n=n.replace(Tu,c));break;case"vs:#main-start":i&&(n=n.replace(mv,h=>h+c));break;case"vs:#main-end":i&&(n=n.replace(yv,h=>c+h));break;case"fs:#decl":i||(n=n.replace(Tu,c));break;case"fs:#main-start":i||(n=n.replace(mv,h=>h+c));break;case"fs:#main-end":i||(n=n.replace(yv,h=>c+h));break;default:n=n.replace(r,h=>h+c)}}return n=n.replace(Tu,""),s&&(n=n.replace(/\}\s*$/,r=>r+zC[e])),n}function zu(n){n.map(e=>$C(e))}function $C(n){if(n.instance)return;zu(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:s={}}=n,i={normalizedInjections:VC(s),parsedDeprecations:HC(t)};e&&(i.propValidators=BC(e)),n.instance=i;let r={};e&&(r=Object.entries(e).reduce((l,[c,h])=>{const d=h==null?void 0:h.value;return d&&(l[c]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...r}}function Nw(n,e,t){var s;(s=n.deprecations)==null||s.forEach(i=>{var r;(r=i.regex)!=null&&r.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function HC(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function u_(n){zu(n);const e={},t={};Dw({modules:n,level:0,moduleMap:e,moduleDepth:t});const s=Object.keys(t).sort((i,r)=>t[r]-t[i]).map(i=>e[i]);return zu(s),s}function Dw(n){const{modules:e,level:t,moduleMap:s,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)s[r.name]=r,(i[r.name]===void 0||i[r.name]<t)&&(i[r.name]=t);for(const r of e)r.dependencies&&Dw({modules:r.dependencies,level:t+1,moduleMap:s,moduleDepth:i})}function WC(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function XC(n,e){var s;if(Number(((s=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:s[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=bv(n,qC),n;case"fragment":return n=bv(n,YC),n;default:throw new Error(e)}}const Bw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qC=[...Bw,[np("attribute"),"in $1"],[np("varying"),"out $1"]],YC=[...Bw,[np("varying"),"in $1"]];function bv(n,e){for(const[t,s]of e)n=n.replace(t,s);return n}function np(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Uw(n,e){let t="";for(const s in n){const i=n[s];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[s]){const r=e[s];r.sort((l,c)=>l.order-c.order);for(const l of r)t+=`  ${l.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function Lw(n){const e={vertex:{},fragment:{}};for(const t of n){let s,i;typeof t!="string"?(s=t,i=s.hook):(s={},i=t),i=i.trim();const[r,l]=i.split(":"),c=i.replace(/\(.+/,""),h=Object.assign(s,{signature:l});switch(r){case"vs":e.vertex[c]=h;break;case"fs":e.fragment[c]=h;break;default:throw new Error(r)}}return e}function KC(n,e){return{name:ZC(n,e),language:"glsl",version:QC(n)}}function ZC(n,e="unnamed"){const s=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return s?s[1]:e}function QC(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const s=parseInt(t[1],10);Number.isFinite(s)&&(e=s)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Fw=`

${Tu}
`,GC=`precision highp float;
`;function JC(n){const e=u_(n.modules||[]);return{source:tO(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:zw(e)}}function eO(n){const{vs:e,fs:t}=n,s=u_(n.modules||[]);return{vs:vv(n.platformInfo,{...n,source:e,stage:"vertex",modules:s}),fs:vv(n.platformInfo,{...n,source:t,stage:"fragment",modules:s}),getUniforms:zw(s)}}function tO(n,e){var S;const{source:t,stage:s,modules:i,hookFunctions:r=[],inject:l={},log:c}=e;c_(typeof t=="string","shader source must be a string");const h=t;let d="";const g=Lw(r),_={},y={},b={};for(const R in l){const k=typeof l[R]=="string"?{injection:l[R],order:0}:l[R],U=/^(v|f)s:(#)?([\w-]+)$/.exec(R);if(U){const P=U[2],D=U[3];P?D==="decl"?y[R]=[k]:b[R]=[k]:_[R]=[k]}else b[R]=[k]}const T=i;for(const R of T){c&&Nw(R,h,c);const k=Vw(R,"wgsl");d+=k;const U=((S=R.injections)==null?void 0:S[s])||{};for(const P in U){const D=/^(v|f)s:#([\w-]+)$/.exec(P);if(D){const Z=D[2]==="decl"?y:b;Z[P]=Z[P]||[],Z[P].push(U[P])}else _[P]=_[P]||[],_[P].push(U[P])}}return d+=Fw,d=Fu(d,s,y),d+=Uw(g[s],_),d+=h,d=Fu(d,s,b),d}function vv(n,e){var fe;const{id:t,source:s,stage:i,language:r="glsl",modules:l,defines:c={},hookFunctions:h=[],inject:d={},prologue:g=!0,log:_}=e;c_(typeof s=="string","shader source must be a string");const y=r==="glsl"?KC(s).version:-1,b=n.shaderLanguageVersion,T=y===100?"#version 100":"#version 300 es",R=s.split(`
`).slice(1).join(`
`),k={};l.forEach(ue=>{Object.assign(k,ue.defines)}),Object.assign(k,c);let U="";switch(r){case"wgsl":break;case"glsl":U=g?`${T}

// ----- PROLOGUE -------------------------
${nO({id:t,source:s,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${WC(n)}
${i==="fragment"?GC:""}

// ----- APPLICATION DEFINES -------------------------

${sO(k)}

`:`${T}
`;break}const P=Lw(h),D={},$={},Z={};for(const ue in d){const J=typeof d[ue]=="string"?{injection:d[ue],order:0}:d[ue],oe=/^(v|f)s:(#)?([\w-]+)$/.exec(ue);if(oe){const de=oe[2],ve=oe[3];de?ve==="decl"?$[ue]=[J]:Z[ue]=[J]:D[ue]=[J]}else Z[ue]=[J]}for(const ue of l){_&&Nw(ue,R,_);const J=Vw(ue,i);U+=J;const oe=((fe=ue.instance)==null?void 0:fe.normalizedInjections[i])||{};for(const de in oe){const ve=/^(v|f)s:#([\w-]+)$/.exec(de);if(ve){const Se=ve[2]==="decl"?$:Z;Se[de]=Se[de]||[],Se[de].push(oe[de])}else D[de]=D[de]||[],D[de].push(oe[de])}}return U+="// ----- MAIN SHADER SOURCE -------------------------",U+=Fw,U=Fu(U,i,$),U+=Uw(P[i],D),U+=R,U=Fu(U,i,Z),r==="glsl"&&y!==b&&(U=XC(U,i)),U.trim()}function zw(n){return function(t){var i;const s={};for(const r of n){const l=(i=r.getUniforms)==null?void 0:i.call(r,t,s);Object.assign(s,l)}return s}}function nO(n){const{id:e,source:t,stage:s}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${s}`:""}function sO(n={}){let e="";for(const t in n){const s=n[t];(s||Number.isFinite(s))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function Vw(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:c_(!1)}if(!n.name)throw new Error("Shader module must have a name");const s=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${s}
`),i+=`${t}
`,i}const iO=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,rO=/^\s*\#\s*endif\s*$/;function aO(n,e){var l;const t=n.split(`
`),s=[];let i=!0,r=null;for(const c of t){const h=c.match(iO),d=c.match(rO);h?(r=h[1],i=!!((l=e==null?void 0:e.defines)!=null&&l[r])):d?i=!0:i&&s.push(c)}return s.join(`
`)}const Gi=class Gi{constructor(){w(this,"_hookFunctions",[]);w(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Gi.defaultShaderAssembler=Gi.defaultShaderAssembler||new Gi,Gi.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),s=this._hookFunctions,{source:i,getUniforms:r}=JC({...e,source:e.source,modules:t,hookFunctions:s});return{source:e.platformInfo.shaderLanguage==="wgsl"?aO(i):i,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),s=this._hookFunctions;return{...eO({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:s}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),s={};let i=0;for(let r=0,l=this._defaultModules.length;r<l;++r){const c=this._defaultModules[r],h=c.name;t[i++]=c,s[h]=!0}for(let r=0,l=e.length;r<l;++r){const c=e[r],h=c.name;s[h]||(t[i++]=c,s[h]=!0)}return t.length=i,zu(t),t}};w(Gi,"defaultShaderAssembler");let Vu=Gi;const oO=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,lO=`#version 300 es
${oO}`;function cO(n){const{input:e,inputChannels:t,output:s}={};if(!e)return lO;if(!t)throw new Error("inputChannels");const i=uO(t),r=hO(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${s};
void main() {
  ${s} = ${r};
}`}function uO(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function hO(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class fO{constructor(){w(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new El({id:e})),this.stats.get(e)}}const jw=new fO,ae=new Al({id:"luma.gl"}),ug={};function Eh(n="id"){ug[n]=ug[n]||1;const e=ug[n]++;return`${n}-${e}`}var Kg;let Ke=(Kg=class{constructor(e,t,s){w(this,"id");w(this,"props");w(this,"userData",{});w(this,"_device");w(this,"destroyed",!1);w(this,"allocatedBytes",0);w(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=dO(t,s);const i=this.props.id!=="undefined"?this.props.id:Eh(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const s=this._device.statsManager.getStats("Resource Counts");s.get("GPU Memory").addCount(e),s.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},w(Kg,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Kg);function dO(n,e){const t={...e};for(const s in n)n[s]!==void 0&&(t[s]=n[s]);return t}var yt;let at=(yt=class extends Ke{constructor(t,s){const i={...s};(s.usage||0)&yt.INDEX&&!s.indexType&&(s.data instanceof Uint32Array?i.indexType="uint32":s.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,yt.defaultProps);w(this,"usage");w(this,"indexType");w(this,"updateTimestamp");w(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,s){throw new Error("not implemented")}_setDebugData(t,s,i){const r=ArrayBuffer.isView(t)?t.buffer:t,l=Math.min(t?t.byteLength:i,yt.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(l):s===0&&i===r.byteLength?this.debugData=r.slice(0,l):this.debugData=r.slice(s,s+l)}},w(yt,"defaultProps",{...Ke.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),w(yt,"MAP_READ",1),w(yt,"MAP_WRITE",2),w(yt,"COPY_SRC",4),w(yt,"COPY_DST",8),w(yt,"INDEX",16),w(yt,"VERTEX",32),w(yt,"UNIFORM",64),w(yt,"STORAGE",128),w(yt,"INDIRECT",256),w(yt,"QUERY_RESOLVE",512),w(yt,"DEBUG_DATA_MAX_LENGTH",32),yt);function $w(n){const e=Tv[n],t=gO(e),s=n.includes("norm"),i=!s&&!n.startsWith("float"),r=n.startsWith("s");return{dataType:Tv[n],byteLength:t,integer:i,signed:r,normalized:s}}function gO(n){return pO[n]}const Tv={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},pO={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},jt="texture-compression-bc",Ye="texture-compression-astc",Qn="texture-compression-etc2",_O="texture-compression-etc1-webgl",Hc="texture-compression-pvrtc-webgl",hg="texture-compression-atc-webgl",Wc="float32-renderable-webgl",fg="float16-renderable-webgl",mO="rgb9e5ufloat-renderable-webgl",dg="snorm8-renderable-webgl",Vo="norm16-renderable-webgl",gg="snorm16-renderable-webgl",Xc="float32-filterable",wv="float16-filterable-webgl";function Hw(n){const e=yO[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const yO={r8unorm:{},r8snorm:{render:dg},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:dg},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:fg,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Vo},"r16snorm-webgl":{f:gg},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:dg},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:fg,filter:wv},"rg16unorm-webgl":{render:Vo},"rg16snorm-webgl":{render:gg},r32uint:{},r32sint:{},r32float:{render:Wc,filter:Xc},rgb9e5ufloat:{channels:"rgb",packed:!0,render:mO},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Wc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Vo},"rgb16snorm-webgl":{f:Vo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Xc},rgba16uint:{},rgba16sint:{},rgba16float:{render:fg,filter:wv},"rgba16unorm-webgl":{render:Vo},"rgba16snorm-webgl":{render:gg},"rgb32float-webgl":{render:Wc,filter:Xc},rgba32uint:{},rgba32sint:{},rgba32float:{render:Wc,filter:Xc},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:jt},"bc1-rgb-unorm-srgb-webgl":{f:jt},"bc1-rgba-unorm":{f:jt},"bc1-rgba-unorm-srgb":{f:jt},"bc2-rgba-unorm":{f:jt},"bc2-rgba-unorm-srgb":{f:jt},"bc3-rgba-unorm":{f:jt},"bc3-rgba-unorm-srgb":{f:jt},"bc4-r-unorm":{f:jt},"bc4-r-snorm":{f:jt},"bc5-rg-unorm":{f:jt},"bc5-rg-snorm":{f:jt},"bc6h-rgb-ufloat":{f:jt},"bc6h-rgb-float":{f:jt},"bc7-rgba-unorm":{f:jt},"bc7-rgba-unorm-srgb":{f:jt},"etc2-rgb8unorm":{f:Qn},"etc2-rgb8unorm-srgb":{f:Qn},"etc2-rgb8a1unorm":{f:Qn},"etc2-rgb8a1unorm-srgb":{f:Qn},"etc2-rgba8unorm":{f:Qn},"etc2-rgba8unorm-srgb":{f:Qn},"eac-r11unorm":{f:Qn},"eac-r11snorm":{f:Qn},"eac-rg11unorm":{f:Qn},"eac-rg11snorm":{f:Qn},"astc-4x4-unorm":{f:Ye},"astc-4x4-unorm-srgb":{f:Ye},"astc-5x4-unorm":{f:Ye},"astc-5x4-unorm-srgb":{f:Ye},"astc-5x5-unorm":{f:Ye},"astc-5x5-unorm-srgb":{f:Ye},"astc-6x5-unorm":{f:Ye},"astc-6x5-unorm-srgb":{f:Ye},"astc-6x6-unorm":{f:Ye},"astc-6x6-unorm-srgb":{f:Ye},"astc-8x5-unorm":{f:Ye},"astc-8x5-unorm-srgb":{f:Ye},"astc-8x6-unorm":{f:Ye},"astc-8x6-unorm-srgb":{f:Ye},"astc-8x8-unorm":{f:Ye},"astc-8x8-unorm-srgb":{f:Ye},"astc-10x5-unorm":{f:Ye},"astc-10x5-unorm-srgb":{f:Ye},"astc-10x6-unorm":{f:Ye},"astc-10x6-unorm-srgb":{f:Ye},"astc-10x8-unorm":{f:Ye},"astc-10x8-unorm-srgb":{f:Ye},"astc-10x10-unorm":{f:Ye},"astc-10x10-unorm-srgb":{f:Ye},"astc-12x10-unorm":{f:Ye},"astc-12x10-unorm-srgb":{f:Ye},"astc-12x12-unorm":{f:Ye},"astc-12x12-unorm-srgb":{f:Ye},"pvrtc-rgb4unorm-webgl":{f:Hc},"pvrtc-rgba4unorm-webgl":{f:Hc},"pvrtc-rbg2unorm-webgl":{f:Hc},"pvrtc-rgba2unorm-webgl":{f:Hc},"etc1-rbg-unorm-webgl":{f:_O},"atc-rgb-unorm-webgl":{f:hg},"atc-rgba-unorm-webgl":{f:hg},"atc-rgbai-unorm-webgl":{f:hg}},bO=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],vO=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function Ww(n){return bO.some(e=>n.startsWith(e))}function h_(n){let e=TO(n);if(Ww(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const s=wO(n);s&&(e.blockWidth=s.blockWidth,e.blockHeight=s.blockHeight)}const t=vO.exec(n);if(t){const[,s,i,r,l,c]=t,h=`${r}${i}`,d=$w(h),g=d.byteLength*8,_=s.length,y=[g,_>=2?g:0,_>=3?g:0,_>=4?g:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:_,channels:s,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*s.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function TO(n){var r;const e=Hw(n),t=e.bytesPerPixel||1,s=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((r=e.channels)==null?void 0:r.length)||1,bytesPerPixel:t,bitsPerChannel:s,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function wO(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,s,i]=t;return{blockWidth:Number(s),blockHeight:Number(i)}}return null}function xO(n){const e=Hw(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},s=h_(n),i=n.startsWith("depth")||n.startsWith("stencil"),r=s==null?void 0:s.signed,l=s==null?void 0:s.integer,c=s==null?void 0:s.webgl;return t.render&&(t.render=!r),t.filter&&(t.filter=!i&&!r&&!l&&!c),t}class SO{}class AO{constructor(e=[],t){w(this,"features");w(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const uh=class uh{constructor(e){w(this,"id");w(this,"props");w(this,"userData",{});w(this,"statsManager",jw);w(this,"timestamp",0);w(this,"_reused",!1);w(this,"_lumaData",{});this.props={...uh.defaultProps,...e},this.id=this.props.id||Eh(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=xO(e),s=l=>(typeof l=="string"?this.features.has(l):l)??!0,i=s(t.create),r={format:e,create:i,render:i&&s(t.render),filter:i&&s(t.filter),blend:i&&s(t.blend),store:i&&s(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(r)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Ww(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&at.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ae.warn("indices buffer content must be of integer type")()),t}};w(uh,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ae.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ae.get("debug")||void 0,debugShaders:ae.get("debug-shaders")||void 0,debugFramebuffers:!!ae.get("debug-framebuffers"),debugWebGL:!!ae.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let mi=uh;const EO=ur()&&typeof document<"u",RO=()=>EO&&document.readyState==="complete",CO="set luma.log.level=1 (or higher) to trace rendering",xv="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",hi=class hi{constructor(){w(this,"stats",jw);w(this,"log",ae);w(this,"VERSION","9.1.5");w(this,"spector");w(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ae.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ae.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ae.error("This version of luma.gl has already been initialized")()}ae.log(1,`${this.VERSION} - ${CO}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,s])=>s).filter(s=>{var i;return(i=s.isSupported)==null?void 0:i.call(s)}).map(s=>s.type)}getBestAvailableAdapter(e=[]){var s,i,r,l;const t=this.getAdapterMap(e);return(i=(s=t.get("webgpu"))==null?void 0:s.isSupported)!=null&&i.call(s)?"webgpu":(l=(r=t.get("webgl"))==null?void 0:r.isSupported)!=null&&l.call(r)?"webgl":null}setDefaultDeviceProps(e){Object.assign(hi.defaultProps,e)}async createDevice(e={}){var c;e={...hi.defaultProps,...e},e.waitForPageLoad&&await hi.pageLoaded;const t=this.getAdapterMap(e.adapters);let s=e.type||"";s==="best-available"&&(s=this.getBestAvailableAdapter(e.adapters)||s);const r=(this.getAdapterMap(e.adapters)||t).get(s),l=await((c=r==null?void 0:r.create)==null?void 0:c.call(r,e));if(l)return l;throw new Error(xv)}async attachDevice(e){var l;const t=this.getAdapterMap(e.adapters);let s="";e.handle instanceof WebGL2RenderingContext&&(s="webgl"),e.createCanvasContext&&await hi.pageLoaded,e.handle===null&&(s="unknown");const i=t.get(s),r=await((l=i==null?void 0:i.attach)==null?void 0:l.call(i,null));if(r)return r;throw new Error(xv)}enforceWebGL2(e=!0,t=[]){var r;const i=this.getAdapterMap(t).get("webgl");i||ae.warn("enforceWebGL2: webgl adapter not found")(),(r=i==null?void 0:i.enforceWebGL2)==null||r.call(i,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const s of e)t.set(s.type,s);return t}registerDevices(e){ae.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const s=t.adapter;s&&this.preregisteredAdapters.set(s.type,s)}}};w(hi,"defaultProps",{...mi.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),w(hi,"pageLoaded",OO().then(()=>{ae.probe(2,"DOM is loaded")()}));let sp=hi;const ip=new sp;function OO(){return RO()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class MO{}const hh=class hh{constructor(e){w(this,"id");w(this,"props");w(this,"canvas");w(this,"htmlCanvas");w(this,"offscreenCanvas");w(this,"type");w(this,"width",1);w(this,"height",1);w(this,"resizeObserver");w(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...hh.defaultProps,...e},e=this.props,!ur()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=IO(e.canvas):this.canvas=e.canvas;else{const t=kO(e),s=PO((e==null?void 0:e.container)||null);s.insertBefore(t,s.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const s of t)s.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),s=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return s?t/s:1}catch{return 1}}cssToDevicePixels(e,t=!0){const s=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return NO(e,s,i,r,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let s="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!s||!i)&&(ae.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,s=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==s||r.clientHeight!==i||r.devicePixelRatio!==e){let l=e;const c=Math.floor(s*l),h=Math.floor(i*l);if(this.htmlCanvas.width=c,this.htmlCanvas.height=h,this.device.gl){const[g,_]=this.getDrawingBufferSize();(g!==c||_!==h)&&(l=Math.min(g/s,_/i),this.htmlCanvas.width=Math.floor(s*l),this.htmlCanvas.height=Math.floor(i*l),ae.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=s,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};w(hh,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let rp=hh;function PO(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function IO(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function kO(n){const{width:e,height:t}=n,s=document.createElement("canvas");return s.id=Eh("lumagl-auto-created-canvas"),s.width=e||1,s.height=t||1,s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(t)?`${t}px`:"100%",s}function NO(n,e,t,s,i){const r=n,l=Sv(r[0],e,t);let c=Av(r[1],e,s,i),h=Sv(r[0]+1,e,t);const d=h===t-1?h:h-1;h=Av(r[1]+1,e,s,i);let g;return i?(h=h===0?h:h+1,g=c,c=h):g=h===s-1?h:h-1,{x:l,y:c,width:Math.max(d-l+1,1),height:Math.max(g-c+1,1)}}function Sv(n,e,t){return Math.min(Math.round(n*e),t-1)}function Av(n,e,t,s){return s?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Dt=class Dt extends Ke{constructor(t,s){s=Dt.normalizeProps(t,s);super(t,s,Dt.defaultProps);w(this,"dimension");w(this,"format");w(this,"width");w(this,"height");w(this,"depth");w(this,"mipLevels");w(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Dt.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Dt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const s=t==null?void 0:t.data;return ArrayBuffer.isView(s)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Dt.getTextureDataSize(t[0]);if(Dt.isExternalImage(t))return Dt.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,s){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:s.width,height:s.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,s){return Math.floor(Math.log2(Math.max(t,s)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,s){var h,d;const i={...s},r=((d=(h=t==null?void 0:t.props)==null?void 0:h._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,r);const{width:l,height:c}=i;return typeof l=="number"&&(i.width=Math.max(1,Math.ceil(l))),typeof c=="number"&&(i.height=Math.max(1,Math.ceil(c))),i}};w(Dt,"COPY_SRC",1),w(Dt,"COPY_DST",2),w(Dt,"TEXTURE",4),w(Dt,"STORAGE",8),w(Dt,"RENDER_ATTACHMENT",16),w(Dt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),w(Dt,"defaultProps",{...Ke.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),w(Dt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ht=Dt;const fh=class fh extends Ke{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,fh.defaultProps)}};w(fh,"defaultProps",{...Ke.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let ju=fh;function DO(n,e,t){let s="";const i=e.split(/\r?\n/),r=n.slice().sort((l,c)=>l.lineNum-c.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let l=0;for(let c=1;c<=i.length;c++)for(s+=Xw(i[c-1],c,t);r.length>l&&r[l].lineNum===c;){const h=r[l++];s+=Ev(h,i,h.lineNum,{...t,inlineSource:!1})}return s;case"issues":case"no":for(const c of n)s+=Ev(c,i,c.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return s}}function Ev(n,e,t,s){if(s!=null&&s.inlineSource){const r=BO(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${r}${l}${n.type.toUpperCase()}: ${n.message}

`}const i=n.type==="error"?"red":"#8B4000";return s!=null&&s.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function BO(n,e,t){let s="";for(let i=e-2;i<=e;i++){const r=n[i-1];r!==void 0&&(s+=Xw(r,e,t))}return s}function Xw(n,e,t){const s=t!=null&&t.html?LO(n):n;return`${UO(String(e),4)}: ${s}${t!=null&&t.html?"<br/>":`
`}`}function UO(n,e){let t="";for(let s=n.length;s<e;++s)t+=" ";return t+n}function LO(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const dh=class dh extends Ke{constructor(t,s){s={...s,debugShaders:s.debugShaders||t.props.debugShaders||"errors"};super(t,{id:FO(s),...s},dh.defaultProps);w(this,"stage");w(this,"source");w(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const s=await this.getCompilationInfo();t==="warnings"&&(s==null?void 0:s.length)===0||this._displayShaderLog(s)}_displayShaderLog(t){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const s=qw(this.source),i=`${this.stage} ${s}`;let r=DO(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),c.onclick=()=>{const g=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(g)}}};w(dh,"defaultProps",{...Ke.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let $u=dh;function FO(n){return qw(n.source)||n.id||Eh(`unnamed ${n.stage}-shader`)}function qw(n,e="unnamed"){const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return s?s[1]:e}const gl=class gl extends Ke{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=gl.normalizeProps(e,t),super(e,t,gl.defaultProps)}static normalizeProps(e,t){var r,l;const s=((l=(r=e==null?void 0:e.props)==null?void 0:r._resourceDefaults)==null?void 0:l.sampler)||{};return{...t,...s}}};w(gl,"defaultProps",{...Ke.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Hu=gl;const gh=class gh extends Ke{constructor(t,s={}){super(t,s,gh.defaultProps);w(this,"width");w(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const s=this.colorAttachments.map(r=>r.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:s,depthStencilAttachment:i})}resize(t){let s=!t;if(t){const[i,r]=Array.isArray(t)?t:[t.width,t.height];s=s||r!==this.height||i!==this.width,this.width=i,this.height=r}s&&(ae.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((s,i)=>{if(typeof s=="string"){const r=this.createColorTexture(s,i);return this.attachResource(r),r.view}return s instanceof ht?s.view:s});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const s=this.createDepthStencilTexture(t);this.attachResource(s),this.depthStencilAttachment=s.view}else t instanceof ht?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,s){return this.device.createTexture({id:`${this.id}-color-attachment-${s}`,usage:ht.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ht.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,s){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const r=this.colorAttachments[i].texture.clone({width:t,height:s});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:s});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};w(gh,"defaultProps",{...Ke.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Wu=gh;const ph=class ph extends Ke{constructor(t,s){super(t,s,ph.defaultProps);w(this,"shaderLayout");w(this,"bufferLayout");w(this,"linkStatus","pending");w(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};w(ph,"defaultProps",{...Ke.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Ea=ph;const Ln=class Ln extends Ke{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Ln.normalizeProps(e,t),super(e,t,Ln.defaultProps)}static normalizeProps(e,t){var r;return{...(r=e.props._resourceDefaults)==null?void 0:r.renderPass,...t}}};w(Ln,"defaultClearColor",[0,0,0,1]),w(Ln,"defaultClearDepth",1),w(Ln,"defaultClearStencil",0),w(Ln,"defaultProps",{...Ke.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ln.defaultClearColor,clearColors:void 0,clearDepth:Ln.defaultClearDepth,clearStencil:Ln.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let ap=Ln;const _h=class _h extends Ke{constructor(t,s){super(t,s,_h.defaultProps);w(this,"hash","");w(this,"shaderLayout");this.shaderLayout=s.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};w(_h,"defaultProps",{...Ke.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Xu=_h;const mh=class mh extends Ke{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,mh.defaultProps)}};w(mh,"defaultProps",{...Ke.defaultProps,measureExecutionTime:void 0});let op=mh;const yh=class yh extends Ke{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,yh.defaultProps)}};w(yh,"defaultProps",{...Ke.defaultProps});let lp=yh;function zO(n){const[e,t]=jO[n],s=e==="i32"||e==="u32",i=e!=="u32",r=$O[e]*t,l=VO(e,t);return{dataType:e,components:t,defaultVertexFormat:l,byteLength:r,integer:s,signed:i}}function VO(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const jO={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},$O={f32:4,f16:2,i32:4,u32:4};function Yw(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,s]=n.split("x"),i=t,r=s?parseInt(s):1,l=$w(i),c={type:i,components:r,byteLength:l.byteLength*r,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(c.webglOnly=!0),c}function Kw(n,e){const t={};for(const s of n.attributes){const i=WO(n,e,s.name);i&&(t[s.name]=i)}return t}function HO(n,e,t=16){const s=Kw(n,e),i=new Array(t).fill(null);for(const r of Object.values(s))i[r.location]=r;return i}function WO(n,e,t){const s=XO(n,t),i=qO(e,t);if(!s)return null;const r=zO(s.type),l=(i==null?void 0:i.vertexFormat)||r.defaultVertexFormat,c=Yw(l);return{attributeName:(i==null?void 0:i.attributeName)||s.name,bufferName:(i==null?void 0:i.bufferName)||s.name,location:s.location,shaderType:s.type,shaderDataType:r.dataType,shaderComponents:r.components,vertexFormat:l,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:r.integer,stepMode:(i==null?void 0:i.stepMode)||s.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function XO(n,e){const t=n.attributes.find(s=>s.name===e);return t||ae.warn(`shader layout attribute "${e}" not present in shader`),t||null}function qO(n,e){YO(n);let t=KO(n,e);return t||(t=ZO(n,e),t)?t:(ae.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function YO(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ae.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function KO(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function ZO(n,e){var t;for(const s of n){let i=s.byteStride;if(typeof s.byteStride!="number")for(const l of s.attributes||[]){const c=Yw(l.format);i+=c.byteLength}const r=(t=s.attributes)==null?void 0:t.find(l=>l.attribute===e);if(r)return{attributeName:r.attribute,bufferName:s.name,stepMode:s.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:i}}return null}const bh=class bh extends Ke{constructor(t,s){super(t,s,bh.defaultProps);w(this,"maxVertexAttributes");w(this,"attributeInfos");w(this,"indexBuffer",null);w(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:r}=s.renderPipeline||{};if(!i||!r)throw new Error("VertexArray");this.attributeInfos=HO(i,r,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,s){this.device.reportError(new Error("constant attributes not supported"))}};w(bh,"defaultProps",{...Ke.defaultProps,renderPipeline:null});let cp=bh;const vh=class vh extends Ke{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,vh.defaultProps)}};w(vh,"defaultProps",{...Ke.defaultProps,layout:void 0,buffers:{}});let up=vh;const Th=class Th extends Ke{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Th.defaultProps)}};w(Th,"defaultProps",{...Ke.defaultProps,type:void 0,count:void 0});let hp=Th;const QO={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function GO(n){return QO[n]}function JO(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let qc;function Zw(n){return(!qc||qc.byteLength<n)&&(qc=new ArrayBuffer(n)),qc}function eM(n,e){const t=Zw(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function tM(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function qu(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":tM(n)}const Rv=1024;class nM{constructor(e){w(this,"layout",{});w(this,"byteLength");let t=0;for(const[i,r]of Object.entries(e)){const l=GO(r),{type:c,components:h}=l;t=JO(t,h);const d=t;t+=h,this.layout[i]={type:c,size:h,offset:d}}t+=(4-t%4)%4;const s=t*4;this.byteLength=Math.max(s,Rv)}getData(e){const t=Math.max(this.byteLength,Rv),s=Zw(t),i={i32:new Int32Array(s),u32:new Uint32Array(s),f32:new Float32Array(s),f16:new Uint16Array(s)};for(const[r,l]of Object.entries(e)){const c=this.layout[r];if(!c){ae.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:h,size:d,offset:g}=c,_=i[h];if(d===1){if(typeof l!="number"&&typeof l!="boolean"){ae.warn(`Supplied value for single component uniform ${r} is not a number: ${l}`)();continue}_[g]=Number(l)}else{if(!qu(l)){ae.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${l}`)();continue}_.set(l,g)}}return new Uint8Array(s)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function sM(n,e,t=16){if(n!==e)return!1;const s=n,i=e;if(!qu(s))return!1;if(qu(i)&&s.length===i.length){for(let r=0;r<s.length;++r)if(i[r]!==s[r])return!1}return!0}function iM(n){return qu(n)?n.slice():n}class rM{constructor(e){w(this,"name");w(this,"uniforms",{});w(this,"modifiedUniforms",{});w(this,"modified",!0);w(this,"bindingLayout",{});w(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const s=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(r=>r.type==="uniform"&&r.name===(e==null?void 0:e.name));if(!s)throw new Error(e==null?void 0:e.name);const i=s;for(const r of i.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[t,s]of Object.entries(e))this._setUniform(t,s),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${s}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){sM(this.uniforms[e],t)||(this.uniforms[e]=iM(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class aM{constructor(e){w(this,"uniformBlocks",new Map);w(this,"uniformBufferLayouts",new Map);w(this,"uniformBuffers",new Map);for(const[t,s]of Object.entries(e)){const i=t,r=new nM(s.uniformTypes||{});this.uniformBufferLayouts.set(i,r);const l=new rM({name:t});l.setUniforms(s.defaultUniforms||{}),this.uniformBlocks.set(i,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[s,i]of Object.entries(e))(t=this.uniformBlocks.get(s))==null||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var s,i;const t=((s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(t)}createUniformBuffer(e,t,s){s&&this.setUniforms(s);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:at.UNIFORM|at.COPY_DST,byteLength:i}),l=this.getUniformBufferData(t);return r.write(l),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const s=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:at.UNIFORM|at.COPY_DST,byteLength:s});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const s=this.updateUniformBuffer(t);e||(e=s)}return e&&ae.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var r;const t=this.uniformBlocks.get(e);let s=this.uniformBuffers.get(e),i=!1;if(s&&(t!=null&&t.needsRedraw)){i||(i=t.needsRedraw);const l=this.getUniformBufferData(e);s=this.uniformBuffers.get(e),s==null||s.write(l);const c=(r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms();ae.log(4,`Writing to uniform buffer ${String(e)}`,l,c)()}return i}}function Qw(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Gw(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function oM(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const s=e;let i=Qw(n);if(i==="uint8"&&t&&s===1)return"unorm8-webgl";if(i==="uint8"&&t&&s===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(s===1||s===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${s}`}if(i==="uint16"||i==="sint16"){if(s===1||s===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${s}`}return s===1?i:`${i}x${s}`}class pg{constructor(e){w(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(s=>s.attribute):[e.name]}mergeBufferLayouts(e,t){const s=[...e];for(const i of t){const r=s.findIndex(l=>l.name===i.name);r<0?s.push(i):s[r]=i}return s}}class An{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class Cv{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class di extends An{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class yi extends An{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class rr extends An{constructor(e,t,s,i){super(e,s),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var li;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(li||(li={}));class Yc{constructor(e,t,s,i,r,l,c){this.name=e,this.type=t,this.group=s,this.binding=i,this.attributes=r,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class lM{constructor(e,t){this.name=e,this.type=t}}class cM{constructor(e,t,s,i){this.name=e,this.type=t,this.locationType=s,this.location=i,this.interpolation=null}}class Ov{constructor(e,t,s,i){this.name=e,this.type=t,this.locationType=s,this.location=i}}class uM{constructor(e,t,s,i){this.name=e,this.type=t,this.attributes=s,this.id=i}}class hM{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s}}class fM{constructor(e,t=null,s){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=s}}class dM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const Jw=new Float32Array(1),gM=new Int32Array(Jw.buffer),$t=new Uint16Array(1);function pM(n){Jw[0]=n;const e=gM[0],t=e>>31&1;let s=e>>23&255,i=8388607&e;if(s===255)return $t[0]=t<<15|31744|(i!==0?512:0),$t[0];if(s===0){if(i===0)return $t[0]=t<<15,$t[0];i|=8388608;let r=113;for(;!(8388608&i);)i<<=1,r--;return s=127-r,i&=8388607,s>0?(i=(i>>126-s)+(i>>127-s&1),$t[0]=t<<15|s<<10|i>>13,$t[0]):($t[0]=t<<15,$t[0])}return s=s-127+15,s>=31?($t[0]=t<<15|31744,$t[0]):s<=0?s<-10?($t[0]=t<<15,$t[0]):(i=(8388608|i)>>1-s,$t[0]=t<<15|i>>13,$t[0]):(i>>=13,$t[0]=t<<15|s<<10|i,$t[0])}const f_=new Uint32Array(1),ex=new Float32Array(f_.buffer,0,1);function Mv(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return f_[0]=e,ex[0]}function _M(n,e,t,s,i,r,l,c,h){const d=s*(l>>=i)*(r>>=i)+t*l+e*c;switch(h){case"r8unorm":return[$e(n,d,"8unorm",1)[0]];case"r8snorm":return[$e(n,d,"8snorm",1)[0]];case"r8uint":return[$e(n,d,"8uint",1)[0]];case"r8sint":return[$e(n,d,"8sint",1)[0]];case"rg8unorm":{const g=$e(n,d,"8unorm",2);return[g[0],g[1]]}case"rg8snorm":{const g=$e(n,d,"8snorm",2);return[g[0],g[1]]}case"rg8uint":{const g=$e(n,d,"8uint",2);return[g[0],g[1]]}case"rg8sint":{const g=$e(n,d,"8sint",2);return[g[0],g[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const g=$e(n,d,"8unorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8snorm":{const g=$e(n,d,"8snorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8uint":{const g=$e(n,d,"8uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba8sint":{const g=$e(n,d,"8sint",4);return[g[0],g[1],g[2],g[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const g=$e(n,d,"8unorm",4);return[g[2],g[1],g[0],g[3]]}case"r16uint":return[$e(n,d,"16uint",1)[0]];case"r16sint":return[$e(n,d,"16sint",1)[0]];case"r16float":return[$e(n,d,"16float",1)[0]];case"rg16uint":{const g=$e(n,d,"16uint",2);return[g[0],g[1]]}case"rg16sint":{const g=$e(n,d,"16sint",2);return[g[0],g[1]]}case"rg16float":{const g=$e(n,d,"16float",2);return[g[0],g[1]]}case"rgba16uint":{const g=$e(n,d,"16uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16sint":{const g=$e(n,d,"16sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16float":{const g=$e(n,d,"16float",4);return[g[0],g[1],g[2],g[3]]}case"r32uint":return[$e(n,d,"32uint",1)[0]];case"r32sint":return[$e(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[$e(n,d,"32float",1)[0]];case"rg32uint":{const g=$e(n,d,"32uint",2);return[g[0],g[1]]}case"rg32sint":{const g=$e(n,d,"32sint",2);return[g[0],g[1]]}case"rg32float":{const g=$e(n,d,"32float",2);return[g[0],g[1]]}case"rgba32uint":{const g=$e(n,d,"32uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32sint":{const g=$e(n,d,"32sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32float":{const g=$e(n,d,"32float",4);return[g[0],g[1],g[2],g[3]]}case"rg11b10ufloat":{const g=new Uint32Array(n.buffer,d,1)[0],_=(4192256&g)>>11,y=(4290772992&g)>>22;return[Mv(2047&g),Mv(_),function(b){const T=112+(b>>5&31)<<23|(31&b)<<18;return f_[0]=T,ex[0]}(y),1]}}return null}function $e(n,e,t,s){const i=[0,0,0,0];for(let d=0;d<s;++d)switch(t){case"8unorm":i[d]=n[e]/255,e++;break;case"8snorm":i[d]=n[e]/255*2-1,e++;break;case"8uint":i[d]=n[e],e++;break;case"8sint":i[d]=n[e]-127,e++;break;case"16uint":i[d]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":i[d]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(r=n[e]|n[e+1]<<8,l=void 0,c=void 0,h=void 0,l=(32768&r)>>15,h=1023&r,(c=(31744&r)>>10)==0?(l?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):c==31?h?NaN:1/0*(l?-1:1):(l?-1:1)*Math.pow(2,c-15)*(1+h/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(n.buffer,e,1)[0],e+=4}var r,l,c,h;return i}function He(n,e,t,s,i){for(let r=0;r<s;++r)switch(t){case"8unorm":n[e]=255*i[r],e++;break;case"8snorm":n[e]=.5*(i[r]+1)*255,e++;break;case"8uint":n[e]=i[r],e++;break;case"8sint":n[e]=i[r]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=i[r],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=i[r],e+=2;break;case"16float":{const l=pM(i[r]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=i[r],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=i[r],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=i[r],e+=4}return i}const _g={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class On{constructor(){this.id=On._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Yu.instance);for(const s of e)s instanceof Array?this.searchBlock(s,t):s.search(t);t(Ku.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}On._id=0;class Yu extends On{}Yu.instance=new Yu;class Ku extends On{}Ku.instance=new Ku;const tx=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class nt extends On{constructor(){super()}}class _l extends nt{constructor(e,t,s,i,r,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=s,this.body=i,this.startLine=r,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class mM extends nt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class nx extends nt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class fp extends nt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class sx extends nt{constructor(e,t,s,i){super(),this.init=e,this.condition=t,this.increment=s,this.body=i}get astNodeType(){return"for"}search(e){var t,s,i;(t=this.init)===null||t===void 0||t.search(e),(s=this.condition)===null||s===void 0||s.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Rs extends nt{constructor(e,t,s,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=i,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class d_ extends nt{constructor(e,t,s){super(),this.attributes=null,this.name=e,this.type=t,this.value=s}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class rl extends nt{constructor(e,t,s,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=i,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class wu extends nt{constructor(e,t,s,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=i,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var da,Ko,X,z;(n=>{n.increment="++",n.decrement="--"})(da||(da={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(da||(da={}));class ix extends nt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Ko||(Ko={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Ko||(Ko={}));class rx extends nt{constructor(e,t,s){super(),this.operator=e,this.variable=t,this.value=s}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class g_ extends nt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return tx.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class ax extends nt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class ox extends nt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class lx extends nt{constructor(e,t,s,i){super(),this.condition=e,this.body=t,this.elseif=s,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class cx extends nt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class yM extends nt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class bM extends nt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ux extends nt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class p_ extends nt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class vM extends nt{constructor(){super()}get astNodeType(){return"discard"}}class hx extends nt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class fx extends nt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ne extends nt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const i=ne._priority.get(t.name);ne._priority.get(e[s].name)<i&&(t=e[s])}return t.name==="x32"?ne.i32:t}getTypeName(){return this.name}}ne.x32=new ne("x32"),ne.f32=new ne("f32"),ne.i32=new ne("i32"),ne.u32=new ne("u32"),ne.f16=new ne("f16"),ne.bool=new ne("bool"),ne.void=new ne("void"),ne._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Pv extends ne{constructor(e){super(e)}}class As extends ne{constructor(e,t,s,i){super(e),this.members=t,this.startLine=s,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class H extends ne{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}H.vec2f=new H("vec2",ne.f32,null),H.vec3f=new H("vec3",ne.f32,null),H.vec4f=new H("vec4",ne.f32,null),H.vec2i=new H("vec2",ne.i32,null),H.vec3i=new H("vec3",ne.i32,null),H.vec4i=new H("vec4",ne.i32,null),H.vec2u=new H("vec2",ne.u32,null),H.vec3u=new H("vec3",ne.u32,null),H.vec4u=new H("vec4",ne.u32,null),H.vec2h=new H("vec2",ne.f16,null),H.vec3h=new H("vec3",ne.f16,null),H.vec4h=new H("vec4",ne.f16,null),H.vec2b=new H("vec2",ne.bool,null),H.vec3b=new H("vec3",ne.bool,null),H.vec4b=new H("vec4",ne.bool,null),H.mat2x2f=new H("mat2x2",ne.f32,null),H.mat2x3f=new H("mat2x3",ne.f32,null),H.mat2x4f=new H("mat2x4",ne.f32,null),H.mat3x2f=new H("mat3x2",ne.f32,null),H.mat3x3f=new H("mat3x3",ne.f32,null),H.mat3x4f=new H("mat3x4",ne.f32,null),H.mat4x2f=new H("mat4x2",ne.f32,null),H.mat4x3f=new H("mat4x3",ne.f32,null),H.mat4x4f=new H("mat4x4",ne.f32,null),H.mat2x2h=new H("mat2x2",ne.f16,null),H.mat2x3h=new H("mat2x3",ne.f16,null),H.mat2x4h=new H("mat2x4",ne.f16,null),H.mat3x2h=new H("mat3x2",ne.f16,null),H.mat3x3h=new H("mat3x3",ne.f16,null),H.mat3x4h=new H("mat3x4",ne.f16,null),H.mat4x2h=new H("mat4x2",ne.f16,null),H.mat4x3h=new H("mat4x3",ne.f16,null),H.mat4x4h=new H("mat4x4",ne.f16,null),H.mat2x2i=new H("mat2x2",ne.i32,null),H.mat2x3i=new H("mat2x3",ne.i32,null),H.mat2x4i=new H("mat2x4",ne.i32,null),H.mat3x2i=new H("mat3x2",ne.i32,null),H.mat3x3i=new H("mat3x3",ne.i32,null),H.mat3x4i=new H("mat3x4",ne.i32,null),H.mat4x2i=new H("mat4x2",ne.i32,null),H.mat4x3i=new H("mat4x3",ne.i32,null),H.mat4x4i=new H("mat4x4",ne.i32,null),H.mat2x2u=new H("mat2x2",ne.u32,null),H.mat2x3u=new H("mat2x3",ne.u32,null),H.mat2x4u=new H("mat2x4",ne.u32,null),H.mat3x2u=new H("mat3x2",ne.u32,null),H.mat3x3u=new H("mat3x3",ne.u32,null),H.mat3x4u=new H("mat3x4",ne.u32,null),H.mat4x2u=new H("mat4x2",ne.u32,null),H.mat4x3u=new H("mat4x3",ne.u32,null),H.mat4x4u=new H("mat4x4",ne.u32,null);class mg extends ne{constructor(e,t,s,i){super(e),this.storage=t,this.type=s,this.access=i}get astNodeType(){return"pointer"}}class al extends ne{constructor(e,t,s,i){super(e),this.attributes=t,this.format=s,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Zo extends ne{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"sampler"}}class is extends On{constructor(){super(),this.postfix=null}}class ar extends is{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ts extends is{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class __ extends is{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return tx.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class fn extends is{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class dx extends is{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const s=e.evalExpression(this.initializer,e.context);return s!==null&&this.postfix?s.getSubData(e,this.postfix,e.context):s}return null}search(e){this.initializer.search(e)}}class xt extends is{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof F}get isVector(){return this.value instanceof O||this.value instanceof xe}get scalarValue(){return this.value instanceof F?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof O||this.value instanceof xe?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class gx extends is{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Ra extends is{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class px extends is{constructor(){super()}}class bt extends px{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Un extends px{constructor(e,t,s){super(),this.operator=e,this.left=t,this.right=s}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?ne.f32:e.name==="u32"||t.name==="u32"?ne.u32:ne.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class _x extends On{constructor(e){super(),this.body=e}}class xu extends is{constructor(){super()}get astNodeType(){return"default"}}class mx extends _x{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class yx extends _x{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Iv extends On{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"argument"}}class TM extends On{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class kv extends On{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"member"}}class bx extends On{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Cn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Cn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,s,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,s){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Cn._id=0;class dp extends Cn{constructor(){super(new An("void",null),null)}toString(){return"void"}}dp.void=new dp;class ea extends Cn{constructor(e){super(new An("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,s,i){this.reference.setDataValue(e,t,s,i)}getSubData(e,t,s){return t?this.reference.getSubData(e,t,s):this}}class F extends Cn{constructor(e,t,s=null){super(t,s),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new F(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new F(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new F(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,s,i){if(s)return void console.error("SetDataValue: Scalar data does not support postfix",s);if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);let r=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?r=Math.floor(r):this.typeInfo.name==="bool"&&(r=r?1:0),this.data[0]=r}getSubData(e,t,s){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function wM(n,e,t){const s=e.length;return s===2?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):s===3?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):s===4?t==="f32"?new O(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new O(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new O(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new O(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class O extends Cn{constructor(e,t,s=null){if(super(t,s),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new O(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new O(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new O(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,s,i){s instanceof ar?console.error("TODO: Set vector postfix"):t instanceof O?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof rr)i=this.typeInfo.format||i;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?i=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?i=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?i=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?i=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let r=this;for(;t!==null&&r!==null;){if(t instanceof Ra){const l=t.index;let c=-1;if(l instanceof xt){if(!(l.value instanceof F))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const h=e.evalExpression(l,s);if(!(h instanceof F))return console.error("GetSubData: Unknown index type",l),null;c=h.value}if(c<0||c>=r.data.length)return console.error("GetSubData: Index out of range",c),null;if(r.data instanceof Float32Array){const h=new Float32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new F(h,i)}if(r.data instanceof Int32Array){const h=new Int32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new F(h,i)}if(r.data instanceof Uint32Array){const h=new Uint32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new F(h,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof ar))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;h=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new F(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new F(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new F(d,i,this)}}const c=[];for(const h of l)h==="x"||h==="r"?c.push(this.data[0]):h==="y"||h==="g"?c.push(this.data[1]):h==="z"||h==="b"?c.push(this.data[2]):h==="w"||h==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);r=wM(e,c,i.name)}t=t.postfix}return r}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class xe extends Cn{constructor(e,t,s=null){super(t,s),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new xe(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,s,i){s instanceof ar?console.error("TODO: Set matrix postfix"):t instanceof xe?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof rr)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof Ra){const r=t.index;let l=-1;if(r instanceof xt){if(!(r.value instanceof F))return console.error(`GetDataValue: Invalid array index ${r.value}`),null;l=r.value.value}else{const d=e.evalExpression(r,s);if(!(d instanceof F))return console.error("GetDataValue: Unknown index type",r),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=i.endsWith("h")?"h":"f";let h;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")h=new O(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${c}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")h=new O(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${c}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;h=new O(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${c}`))}return t.postfix?h.getSubData(e,t.postfix,s):h}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ft extends Cn{constructor(e,t,s=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=s}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new ft(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,s,i){if(t===null)return void console.log("setDataValue: NULL data.");let r=this.offset,l=this.typeInfo;for(;s;){if(s instanceof Ra)if(l instanceof yi){const c=s.index;if(c instanceof xt){if(!(c.value instanceof F))return void console.error(`SetDataValue: Invalid index type ${c.value}`);r+=c.value.value*l.stride}else{const h=e.evalExpression(c,i);if(!(h instanceof F))return void console.error("SetDataValue: Unknown index type",c);r+=h.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(s instanceof ar))return void console.error("SetDataValue: Unknown postfix type",s);{const c=s.value;if(l instanceof di){let h=!1;for(const d of l.members)if(d.name===c){r+=d.offset,l=d.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof An){const h=l.getTypeName();let d=0;if(c==="x"||c==="r")d=0;else if(c==="y"||c==="g")d=1;else if(c==="z"||c==="b")d=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);d=3}if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);const g=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,r,2)[d]=g):h==="vec3f"?void(new Float32Array(this.buffer,r,3)[d]=g):h==="vec4f"?void(new Float32Array(this.buffer,r,4)[d]=g):h==="vec2i"?void(new Int32Array(this.buffer,r,2)[d]=g):h==="vec3i"?void(new Int32Array(this.buffer,r,3)[d]=g):h==="vec4i"?void(new Int32Array(this.buffer,r,4)[d]=g):h==="vec2u"?void(new Uint32Array(this.buffer,r,2)[d]=g):h==="vec3u"?void(new Uint32Array(this.buffer,r,3)[d]=g):h==="vec4u"?void(new Uint32Array(this.buffer,r,4)[d]=g):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}s=s.postfix}this.setData(e,t,l,r,i)}setData(e,t,s,i,r){const l=s.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool")if(l!=="vec2f"&&l!=="vec2h")if(l!=="vec3f"&&l!=="vec3h")if(l!=="vec4f"&&l!=="vec4h")if(l!=="vec2i")if(l!=="vec3i")if(l!=="vec4i")if(l!=="vec2u")if(l!=="vec3u")if(l!=="vec4u")if(l!=="vec2b")if(l!=="vec3b")if(l!=="vec4b")if(l!=="mat2x2f"&&l!=="mat2x2h")if(l!=="mat2x3f"&&l!=="mat2x3h")if(l!=="mat2x4f"&&l!=="mat2x4h")if(l!=="mat3x2f"&&l!=="mat3x2h")if(l!=="mat3x3f"&&l!=="mat3x3h")if(l!=="mat3x4f"&&l!=="mat3x4h")if(l!=="mat4x2f"&&l!=="mat4x2h")if(l!=="mat4x3f"&&l!=="mat4x3h")if(l!=="mat4x4f"&&l!=="mat4x4h")if(t instanceof ft){if(s===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`);else{const c=new Float32Array(this.buffer,i,16);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11],c[12]=t.data[12],c[13]=t.data[13],c[14]=t.data[14],c[15]=t.data[15]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11],c[12]=t[12],c[13]=t[13],c[14]=t[14],c[15]=t[15])}else{const c=new Float32Array(this.buffer,i,12);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,i,8);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,i,12);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,i,9);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8])}else{const c=new Float32Array(this.buffer,i,6);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,i,8);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,i,6);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,i,4);t instanceof xe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,4);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,3);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,i,2);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Uint32Array(this.buffer,i,4);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,3);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,i,2);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Int32Array(this.buffer,i,4);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Int32Array(this.buffer,i,3);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Int32Array(this.buffer,i,2);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Float32Array(this.buffer,i,4);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Float32Array(this.buffer,i,3);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Float32Array(this.buffer,i,2);t instanceof O?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else t instanceof F&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,s){var i,r,l;if(t===null)return this;let c=this.offset,h=this.typeInfo;for(;t;){if(t instanceof Ra){const g=t.index,_=e.evalExpression(g,s);let y=0;if(_ instanceof F?y=_.value:console.error("GetDataValue: Invalid index type",g),h instanceof yi)c+=y*h.stride,h=h.format;else{const b=h.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(c+=16*y,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(t instanceof ar))return console.error("GetDataValue: Unknown postfix type",t),null;{const g=t.value;if(h instanceof di){let _=!1;for(const y of h.members)if(y.name===g){c+=y.offset,h=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${g} not found`),null}else if(h instanceof An){const _=h.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(g.length>0&&g.length<5){let y="f";const b=[];for(let T=0;T<g.length;++T){const S=g[T].toLowerCase();let R=0;if(S==="x"||S==="r")R=0;else if(S==="y"||S==="g")R=1;else if(S==="z"||S==="b")R=2;else{if(S!=="w"&&S!=="a")return console.error(`Unknown member ${g}`),null;R=3}if(g.length===1){if(_.endsWith("f"))return this.buffer.byteLength<c+4*R+4?(console.log("Insufficient buffer data"),null):new F(new Float32Array(this.buffer,c+4*R,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new F(new Float32Array(this.buffer,c+4*R,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new F(new Int32Array(this.buffer,c+4*R,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new F(new Int32Array(this.buffer,c+4*R,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new F(new Uint32Array(this.buffer,c+4*R,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")b.push(new Float32Array(this.buffer,c,2)[R]);else if(_==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const k=new Float32Array(this.buffer,c,3);b.push(k[R])}else if(_==="vec4f")b.push(new Float32Array(this.buffer,c,4)[R]);else if(_==="vec2i")y="i",b.push(new Int32Array(this.buffer,c,2)[R]);else if(_==="vec3i")y="i",b.push(new Int32Array(this.buffer,c,3)[R]);else if(_==="vec4i")y="i",b.push(new Int32Array(this.buffer,c,4)[R]);else if(_==="vec2u"){y="u";const k=new Uint32Array(this.buffer,c,2);b.push(k[R])}else _==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,c,3)[R])):_==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,c,4)[R]))}return b.length===2?h=e.getTypeInfo(`vec2${y}`):b.length===3?h=e.getTypeInfo(`vec3${y}`):b.length===4?h=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new O(b,h,null)}return console.error(`GetDataValue: Unknown member ${g}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const d=h.getTypeName();return d==="f32"?new F(new Float32Array(this.buffer,c,1),h,this):d==="i32"?new F(new Int32Array(this.buffer,c,1),h,this):d==="u32"?new F(new Uint32Array(this.buffer,c,1),h,this):d==="vec2f"?new O(new Float32Array(this.buffer,c,2),h,this):d==="vec3f"?new O(new Float32Array(this.buffer,c,3),h,this):d==="vec4f"?new O(new Float32Array(this.buffer,c,4),h,this):d==="vec2i"?new O(new Int32Array(this.buffer,c,2),h,this):d==="vec3i"?new O(new Int32Array(this.buffer,c,3),h,this):d==="vec4i"?new O(new Int32Array(this.buffer,c,4),h,this):d==="vec2u"?new O(new Uint32Array(this.buffer,c,2),h,this):d==="vec3u"?new O(new Uint32Array(this.buffer,c,3),h,this):d==="vec4u"?new O(new Uint32Array(this.buffer,c,4),h,this):h instanceof rr&&h.name==="atomic"?((i=h.format)===null||i===void 0?void 0:i.name)==="u32"?new F(new Uint32Array(this.buffer,c,1)[0],h.format,this):((r=h.format)===null||r===void 0?void 0:r.name)==="i32"?new F(new Int32Array(this.buffer,c,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=h.format)===null||l===void 0?void 0:l.name}`),null):new ft(this.buffer,h,c,this)}toString(){let e="";if(this.typeInfo instanceof yi)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let s=1;s<t.length/2;++s)e+=`, [${t[2*s]}, ${t[2*s+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}, ${t[s+3]}]`}else e="[...]";else this.typeInfo instanceof di?e+="{...}":e="[...]";return e}}class Es extends Cn{constructor(e,t,s,i){super(t,null),this.data=e,this.descriptor=s,this.view=i}clone(){return new Es(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>0?(e=s[0])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.width)!==null&&t!==void 0?t:0}get height(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>1?(e=s[1])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>2?(e=s[2])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let s=0;s<t.length;++s)t[s]=Math.max(1,t[s]>>e);return t}get texelByteSize(){const e=this.format,t=_g[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=_g[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=_g[e],s=this.width;if(!e||s<=0||!t)return-1;const i=this.height,r=this.depthOrArrayLayers,l=this.dimension;return s/t.blockWidth*(l==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t,s=0,i=0){const r=this.texelByteSize,l=this.bytesPerRow,c=this.height,h=this.data[i];return _M(new Uint8Array(h),e,t,s,i,c,l,r,this.format)}setPixel(e,t,s,i,r){const l=this.texelByteSize,c=this.bytesPerRow,h=this.height,d=this.data[i];(function(g,_,y,b,T,S,R,k,U,P){const D=b*(R>>=T)*(S>>=T)+y*R+_*k;switch(U){case"r8unorm":return void He(g,D,"8unorm",1,P);case"r8snorm":return void He(g,D,"8snorm",1,P);case"r8uint":return void He(g,D,"8uint",1,P);case"r8sint":return void He(g,D,"8sint",1,P);case"rg8unorm":return void He(g,D,"8unorm",2,P);case"rg8snorm":return void He(g,D,"8snorm",2,P);case"rg8uint":return void He(g,D,"8uint",2,P);case"rg8sint":return void He(g,D,"8sint",2,P);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void He(g,D,"8unorm",4,P);case"rgba8snorm":return void He(g,D,"8snorm",4,P);case"rgba8uint":return void He(g,D,"8uint",4,P);case"rgba8sint":return void He(g,D,"8sint",4,P);case"r16uint":return void He(g,D,"16uint",1,P);case"r16sint":return void He(g,D,"16sint",1,P);case"r16float":return void He(g,D,"16float",1,P);case"rg16uint":return void He(g,D,"16uint",2,P);case"rg16sint":return void He(g,D,"16sint",2,P);case"rg16float":return void He(g,D,"16float",2,P);case"rgba16uint":return void He(g,D,"16uint",4,P);case"rgba16sint":return void He(g,D,"16sint",4,P);case"rgba16float":return void He(g,D,"16float",4,P);case"r32uint":return void He(g,D,"32uint",1,P);case"r32sint":return void He(g,D,"32sint",1,P);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void He(g,D,"32float",1,P);case"rg32uint":return void He(g,D,"32uint",2,P);case"rg32sint":return void He(g,D,"32sint",2,P);case"rg32float":return void He(g,D,"32float",2,P);case"rgba32uint":return void He(g,D,"32uint",4,P);case"rgba32sint":return void He(g,D,"32sint",4,P);case"rgba32float":return void He(g,D,"32float",4,P);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,s,i,h,c,l,this.format,r)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(z||(z={}));class j{constructor(e,t,s){this.name=e,this.type=t,this.rule=s}toString(){return this.name}}class E{}X=E,E.none=new j("",z.reserved,""),E.eof=new j("EOF",z.token,""),E.reserved={asm:new j("asm",z.reserved,"asm"),bf16:new j("bf16",z.reserved,"bf16"),do:new j("do",z.reserved,"do"),enum:new j("enum",z.reserved,"enum"),f16:new j("f16",z.reserved,"f16"),f64:new j("f64",z.reserved,"f64"),handle:new j("handle",z.reserved,"handle"),i8:new j("i8",z.reserved,"i8"),i16:new j("i16",z.reserved,"i16"),i64:new j("i64",z.reserved,"i64"),mat:new j("mat",z.reserved,"mat"),premerge:new j("premerge",z.reserved,"premerge"),regardless:new j("regardless",z.reserved,"regardless"),typedef:new j("typedef",z.reserved,"typedef"),u8:new j("u8",z.reserved,"u8"),u16:new j("u16",z.reserved,"u16"),u64:new j("u64",z.reserved,"u64"),unless:new j("unless",z.reserved,"unless"),using:new j("using",z.reserved,"using"),vec:new j("vec",z.reserved,"vec"),void:new j("void",z.reserved,"void")},E.keywords={array:new j("array",z.keyword,"array"),atomic:new j("atomic",z.keyword,"atomic"),bool:new j("bool",z.keyword,"bool"),f32:new j("f32",z.keyword,"f32"),i32:new j("i32",z.keyword,"i32"),mat2x2:new j("mat2x2",z.keyword,"mat2x2"),mat2x3:new j("mat2x3",z.keyword,"mat2x3"),mat2x4:new j("mat2x4",z.keyword,"mat2x4"),mat3x2:new j("mat3x2",z.keyword,"mat3x2"),mat3x3:new j("mat3x3",z.keyword,"mat3x3"),mat3x4:new j("mat3x4",z.keyword,"mat3x4"),mat4x2:new j("mat4x2",z.keyword,"mat4x2"),mat4x3:new j("mat4x3",z.keyword,"mat4x3"),mat4x4:new j("mat4x4",z.keyword,"mat4x4"),ptr:new j("ptr",z.keyword,"ptr"),sampler:new j("sampler",z.keyword,"sampler"),sampler_comparison:new j("sampler_comparison",z.keyword,"sampler_comparison"),struct:new j("struct",z.keyword,"struct"),texture_1d:new j("texture_1d",z.keyword,"texture_1d"),texture_2d:new j("texture_2d",z.keyword,"texture_2d"),texture_2d_array:new j("texture_2d_array",z.keyword,"texture_2d_array"),texture_3d:new j("texture_3d",z.keyword,"texture_3d"),texture_cube:new j("texture_cube",z.keyword,"texture_cube"),texture_cube_array:new j("texture_cube_array",z.keyword,"texture_cube_array"),texture_multisampled_2d:new j("texture_multisampled_2d",z.keyword,"texture_multisampled_2d"),texture_storage_1d:new j("texture_storage_1d",z.keyword,"texture_storage_1d"),texture_storage_2d:new j("texture_storage_2d",z.keyword,"texture_storage_2d"),texture_storage_2d_array:new j("texture_storage_2d_array",z.keyword,"texture_storage_2d_array"),texture_storage_3d:new j("texture_storage_3d",z.keyword,"texture_storage_3d"),texture_depth_2d:new j("texture_depth_2d",z.keyword,"texture_depth_2d"),texture_depth_2d_array:new j("texture_depth_2d_array",z.keyword,"texture_depth_2d_array"),texture_depth_cube:new j("texture_depth_cube",z.keyword,"texture_depth_cube"),texture_depth_cube_array:new j("texture_depth_cube_array",z.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new j("texture_depth_multisampled_2d",z.keyword,"texture_depth_multisampled_2d"),texture_external:new j("texture_external",z.keyword,"texture_external"),u32:new j("u32",z.keyword,"u32"),vec2:new j("vec2",z.keyword,"vec2"),vec3:new j("vec3",z.keyword,"vec3"),vec4:new j("vec4",z.keyword,"vec4"),bitcast:new j("bitcast",z.keyword,"bitcast"),block:new j("block",z.keyword,"block"),break:new j("break",z.keyword,"break"),case:new j("case",z.keyword,"case"),continue:new j("continue",z.keyword,"continue"),continuing:new j("continuing",z.keyword,"continuing"),default:new j("default",z.keyword,"default"),diagnostic:new j("diagnostic",z.keyword,"diagnostic"),discard:new j("discard",z.keyword,"discard"),else:new j("else",z.keyword,"else"),enable:new j("enable",z.keyword,"enable"),fallthrough:new j("fallthrough",z.keyword,"fallthrough"),false:new j("false",z.keyword,"false"),fn:new j("fn",z.keyword,"fn"),for:new j("for",z.keyword,"for"),function:new j("function",z.keyword,"function"),if:new j("if",z.keyword,"if"),let:new j("let",z.keyword,"let"),const:new j("const",z.keyword,"const"),loop:new j("loop",z.keyword,"loop"),while:new j("while",z.keyword,"while"),private:new j("private",z.keyword,"private"),read:new j("read",z.keyword,"read"),read_write:new j("read_write",z.keyword,"read_write"),return:new j("return",z.keyword,"return"),requires:new j("requires",z.keyword,"requires"),storage:new j("storage",z.keyword,"storage"),switch:new j("switch",z.keyword,"switch"),true:new j("true",z.keyword,"true"),alias:new j("alias",z.keyword,"alias"),type:new j("type",z.keyword,"type"),uniform:new j("uniform",z.keyword,"uniform"),var:new j("var",z.keyword,"var"),override:new j("override",z.keyword,"override"),workgroup:new j("workgroup",z.keyword,"workgroup"),write:new j("write",z.keyword,"write"),r8unorm:new j("r8unorm",z.keyword,"r8unorm"),r8snorm:new j("r8snorm",z.keyword,"r8snorm"),r8uint:new j("r8uint",z.keyword,"r8uint"),r8sint:new j("r8sint",z.keyword,"r8sint"),r16uint:new j("r16uint",z.keyword,"r16uint"),r16sint:new j("r16sint",z.keyword,"r16sint"),r16float:new j("r16float",z.keyword,"r16float"),rg8unorm:new j("rg8unorm",z.keyword,"rg8unorm"),rg8snorm:new j("rg8snorm",z.keyword,"rg8snorm"),rg8uint:new j("rg8uint",z.keyword,"rg8uint"),rg8sint:new j("rg8sint",z.keyword,"rg8sint"),r32uint:new j("r32uint",z.keyword,"r32uint"),r32sint:new j("r32sint",z.keyword,"r32sint"),r32float:new j("r32float",z.keyword,"r32float"),rg16uint:new j("rg16uint",z.keyword,"rg16uint"),rg16sint:new j("rg16sint",z.keyword,"rg16sint"),rg16float:new j("rg16float",z.keyword,"rg16float"),rgba8unorm:new j("rgba8unorm",z.keyword,"rgba8unorm"),rgba8unorm_srgb:new j("rgba8unorm_srgb",z.keyword,"rgba8unorm_srgb"),rgba8snorm:new j("rgba8snorm",z.keyword,"rgba8snorm"),rgba8uint:new j("rgba8uint",z.keyword,"rgba8uint"),rgba8sint:new j("rgba8sint",z.keyword,"rgba8sint"),bgra8unorm:new j("bgra8unorm",z.keyword,"bgra8unorm"),bgra8unorm_srgb:new j("bgra8unorm_srgb",z.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new j("rgb10a2unorm",z.keyword,"rgb10a2unorm"),rg11b10float:new j("rg11b10float",z.keyword,"rg11b10float"),rg32uint:new j("rg32uint",z.keyword,"rg32uint"),rg32sint:new j("rg32sint",z.keyword,"rg32sint"),rg32float:new j("rg32float",z.keyword,"rg32float"),rgba16uint:new j("rgba16uint",z.keyword,"rgba16uint"),rgba16sint:new j("rgba16sint",z.keyword,"rgba16sint"),rgba16float:new j("rgba16float",z.keyword,"rgba16float"),rgba32uint:new j("rgba32uint",z.keyword,"rgba32uint"),rgba32sint:new j("rgba32sint",z.keyword,"rgba32sint"),rgba32float:new j("rgba32float",z.keyword,"rgba32float"),static_assert:new j("static_assert",z.keyword,"static_assert")},E.tokens={decimal_float_literal:new j("decimal_float_literal",z.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new j("hex_float_literal",z.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new j("int_literal",z.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new j("uint_literal",z.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new j("name",z.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new j("ident",z.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new j("and",z.token,"&"),and_and:new j("and_and",z.token,"&&"),arrow:new j("arrow ",z.token,"->"),attr:new j("attr",z.token,"@"),forward_slash:new j("forward_slash",z.token,"/"),bang:new j("bang",z.token,"!"),bracket_left:new j("bracket_left",z.token,"["),bracket_right:new j("bracket_right",z.token,"]"),brace_left:new j("brace_left",z.token,"{"),brace_right:new j("brace_right",z.token,"}"),colon:new j("colon",z.token,":"),comma:new j("comma",z.token,","),equal:new j("equal",z.token,"="),equal_equal:new j("equal_equal",z.token,"=="),not_equal:new j("not_equal",z.token,"!="),greater_than:new j("greater_than",z.token,">"),greater_than_equal:new j("greater_than_equal",z.token,">="),shift_right:new j("shift_right",z.token,">>"),less_than:new j("less_than",z.token,"<"),less_than_equal:new j("less_than_equal",z.token,"<="),shift_left:new j("shift_left",z.token,"<<"),modulo:new j("modulo",z.token,"%"),minus:new j("minus",z.token,"-"),minus_minus:new j("minus_minus",z.token,"--"),period:new j("period",z.token,"."),plus:new j("plus",z.token,"+"),plus_plus:new j("plus_plus",z.token,"++"),or:new j("or",z.token,"|"),or_or:new j("or_or",z.token,"||"),paren_left:new j("paren_left",z.token,"("),paren_right:new j("paren_right",z.token,")"),semicolon:new j("semicolon",z.token,";"),star:new j("star",z.token,"*"),tilde:new j("tilde",z.token,"~"),underscore:new j("underscore",z.token,"_"),xor:new j("xor",z.token,"^"),plus_equal:new j("plus_equal",z.token,"+="),minus_equal:new j("minus_equal",z.token,"-="),times_equal:new j("times_equal",z.token,"*="),division_equal:new j("division_equal",z.token,"/="),modulo_equal:new j("modulo_equal",z.token,"%="),and_equal:new j("and_equal",z.token,"&="),or_equal:new j("or_equal",z.token,"|="),xor_equal:new j("xor_equal",z.token,"^="),shift_right_equal:new j("shift_right_equal",z.token,">>="),shift_left_equal:new j("shift_left_equal",z.token,"<<=")},E.simpleTokens={"@":X.tokens.attr,"{":X.tokens.brace_left,"}":X.tokens.brace_right,":":X.tokens.colon,",":X.tokens.comma,"(":X.tokens.paren_left,")":X.tokens.paren_right,";":X.tokens.semicolon},E.literalTokens={"&":X.tokens.and,"&&":X.tokens.and_and,"->":X.tokens.arrow,"/":X.tokens.forward_slash,"!":X.tokens.bang,"[":X.tokens.bracket_left,"]":X.tokens.bracket_right,"=":X.tokens.equal,"==":X.tokens.equal_equal,"!=":X.tokens.not_equal,">":X.tokens.greater_than,">=":X.tokens.greater_than_equal,">>":X.tokens.shift_right,"<":X.tokens.less_than,"<=":X.tokens.less_than_equal,"<<":X.tokens.shift_left,"%":X.tokens.modulo,"-":X.tokens.minus,"--":X.tokens.minus_minus,".":X.tokens.period,"+":X.tokens.plus,"++":X.tokens.plus_plus,"|":X.tokens.or,"||":X.tokens.or_or,"*":X.tokens.star,"~":X.tokens.tilde,_:X.tokens.underscore,"^":X.tokens.xor,"+=":X.tokens.plus_equal,"-=":X.tokens.minus_equal,"*=":X.tokens.times_equal,"/=":X.tokens.division_equal,"%=":X.tokens.modulo_equal,"&=":X.tokens.and_equal,"|=":X.tokens.or_equal,"^=":X.tokens.xor_equal,">>=":X.tokens.shift_right_equal,"<<=":X.tokens.shift_left_equal},E.regexTokens={decimal_float_literal:X.tokens.decimal_float_literal,hex_float_literal:X.tokens.hex_float_literal,int_literal:X.tokens.int_literal,uint_literal:X.tokens.uint_literal,ident:X.tokens.ident},E.storage_class=[X.keywords.function,X.keywords.private,X.keywords.workgroup,X.keywords.uniform,X.keywords.storage],E.access_mode=[X.keywords.read,X.keywords.write,X.keywords.read_write],E.sampler_type=[X.keywords.sampler,X.keywords.sampler_comparison],E.sampled_texture_type=[X.keywords.texture_1d,X.keywords.texture_2d,X.keywords.texture_2d_array,X.keywords.texture_3d,X.keywords.texture_cube,X.keywords.texture_cube_array],E.multisampled_texture_type=[X.keywords.texture_multisampled_2d],E.storage_texture_type=[X.keywords.texture_storage_1d,X.keywords.texture_storage_2d,X.keywords.texture_storage_2d_array,X.keywords.texture_storage_3d],E.depth_texture_type=[X.keywords.texture_depth_2d,X.keywords.texture_depth_2d_array,X.keywords.texture_depth_cube,X.keywords.texture_depth_cube_array,X.keywords.texture_depth_multisampled_2d],E.texture_external_type=[X.keywords.texture_external],E.any_texture_type=[...X.sampled_texture_type,...X.multisampled_texture_type,...X.storage_texture_type,...X.depth_texture_type,...X.texture_external_type],E.texel_format=[X.keywords.r8unorm,X.keywords.r8snorm,X.keywords.r8uint,X.keywords.r8sint,X.keywords.r16uint,X.keywords.r16sint,X.keywords.r16float,X.keywords.rg8unorm,X.keywords.rg8snorm,X.keywords.rg8uint,X.keywords.rg8sint,X.keywords.r32uint,X.keywords.r32sint,X.keywords.r32float,X.keywords.rg16uint,X.keywords.rg16sint,X.keywords.rg16float,X.keywords.rgba8unorm,X.keywords.rgba8unorm_srgb,X.keywords.rgba8snorm,X.keywords.rgba8uint,X.keywords.rgba8sint,X.keywords.bgra8unorm,X.keywords.bgra8unorm_srgb,X.keywords.rgb10a2unorm,X.keywords.rg11b10float,X.keywords.rg32uint,X.keywords.rg32sint,X.keywords.rg32float,X.keywords.rgba16uint,X.keywords.rgba16sint,X.keywords.rgba16float,X.keywords.rgba32uint,X.keywords.rgba32sint,X.keywords.rgba32float],E.const_literal=[X.tokens.int_literal,X.tokens.uint_literal,X.tokens.decimal_float_literal,X.tokens.hex_float_literal,X.keywords.true,X.keywords.false],E.literal_or_ident=[X.tokens.ident,X.tokens.int_literal,X.tokens.uint_literal,X.tokens.decimal_float_literal,X.tokens.hex_float_literal,X.tokens.name],E.element_count_expression=[X.tokens.int_literal,X.tokens.uint_literal,X.tokens.ident],E.template_types=[X.keywords.vec2,X.keywords.vec3,X.keywords.vec4,X.keywords.mat2x2,X.keywords.mat2x3,X.keywords.mat2x4,X.keywords.mat3x2,X.keywords.mat3x3,X.keywords.mat3x4,X.keywords.mat4x2,X.keywords.mat4x3,X.keywords.mat4x4,X.keywords.atomic,X.keywords.bitcast,...X.any_texture_type],E.attribute_name=[X.tokens.ident,X.keywords.block,X.keywords.diagnostic],E.assignment_operators=[X.tokens.equal,X.tokens.plus_equal,X.tokens.minus_equal,X.tokens.times_equal,X.tokens.division_equal,X.tokens.modulo_equal,X.tokens.and_equal,X.tokens.or_equal,X.tokens.xor_equal,X.tokens.shift_right_equal,X.tokens.shift_left_equal],E.increment_operators=[X.tokens.plus_plus,X.tokens.minus_minus];class Nv{constructor(e,t,s,i,r){this.type=e,this.lexeme=t,this.line=s,this.start=i,this.end=r}toString(){return this.lexeme}isTemplateType(){return E.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==E.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class xM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Nv(E.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=E.simpleTokens[e];if(t)return this._addToken(t),!0;let s=E.none;const i=this._isAlpha(e),r=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(i){const l=E.keywords[e];if(l)return this._addToken(l),!0}if(i||r)return this._addToken(E.tokens.ident),!0;for(;;){let l=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(E.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(E.tokens.minus_minus),!0;const h=this._tokens.length-1;if((E.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==E.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(e==">"&&(c==">"||c=="=")){let h=!1,d=this._tokens.length-1;for(let g=0;g<5&&d>=0&&E.assignment_operators.indexOf(this._tokens[d].type)===-1;++g,--d)if(this._tokens[d].type===E.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(l),!0}if(l===E.none){let h=e,d=0;const g=2;for(let _=0;_<g;++_)if(h+=this._peekAhead(_),l=this._findType(h),l!==E.none){d=_;break}if(l===E.none)return s!==E.none&&(this._current--,this._addToken(s),!0);e=h,this._current+=d+1}if(s=l,this._isAtEnd())break;e+=this._advance()}return s!==E.none&&(this._addToken(s),!0)}_findType(e){for(const s in E.regexTokens){const i=E.regexTokens[s];if(this._match(e,i.rule))return i}return E.literalTokens[e]||E.none}_match(e,t){const s=t.exec(e);return s&&s.index==0&&s[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Nv(e,t,this._line,this._start,this._current))}}function ce(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const Zu=new Float32Array(1),SM=new Uint32Array(Zu.buffer),AM=new Uint32Array(Zu.buffer),Qu=new Int32Array(1),EM=new Float32Array(Qu.buffer),RM=new Uint32Array(Qu.buffer),Gu=new Uint32Array(1),CM=new Float32Array(Gu.buffer),OM=new Int32Array(Gu.buffer);function Dv(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Zu[0]=n,SM[0];if(t==="u32")return Zu[0]=n,AM[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Qu[0]=n,EM[0];if(t==="u32")return Qu[0]=n,RM[0]}else if(e==="u32"){if(t==="f32")return Gu[0]=n,CM[0];if(t==="i32"||t==="x32")return Gu[0]=n,OM[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class MM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Kc{constructor(e,t){this.align=e,this.size=t}}class ss{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new dM,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof _l&&this._functions.set(t.name,new MM(t));for(const t of e)if(t instanceof As){const s=this.getTypeInfo(t,null);s instanceof di&&this.structs.push(s)}for(const t of e)if(t instanceof p_)this.aliases.push(this._getAliasInfo(t));else if(t instanceof d_){const s=t,i=this._getAttributeNum(s.attributes,"id",0),r=s.type!=null?this.getTypeInfo(s.type,s.attributes):null;this.overrides.push(new uM(s.name,r,s.attributes,i))}else if(this._isUniformVar(t)){const s=t,i=this._getAttributeNum(s.attributes,"group",0),r=this._getAttributeNum(s.attributes,"binding",0),l=this.getTypeInfo(s.type,s.attributes),c=new Yc(s.name,l,i,r,s.attributes,li.Uniform,s.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(t)){const s=t,i=this._getAttributeNum(s.attributes,"group",0),r=this._getAttributeNum(s.attributes,"binding",0),l=this.getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),h=new Yc(s.name,l,i,r,s.attributes,c?li.StorageTexture:li.Storage,s.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(t)){const s=t,i=this._getAttributeNum(s.attributes,"group",0),r=this._getAttributeNum(s.attributes,"binding",0),l=this.getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),h=new Yc(s.name,l,i,r,s.attributes,c?li.StorageTexture:li.Texture,s.access);h.access||(h.access="read"),c?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(t)){const s=t,i=this._getAttributeNum(s.attributes,"group",0),r=this._getAttributeNum(s.attributes,"binding",0),l=this.getTypeInfo(s.type,s.attributes),c=new Yc(s.name,l,i,r,s.attributes,li.Sampler,s.access);this.samplers.push(c)}else if(t instanceof _l){const s=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),l=s||i||r,c=new fM(t.name,l==null?void 0:l.name,t.attributes);c.attributes=t.attributes,c.startLine=t.startLine,c.endLine=t.endLine,this.functions.push(c),this._functions.get(t.name).info=c,l&&(this._functions.get(t.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(t,!!l),c.inputs=this._getInputs(t.args),c.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(c)),c.arguments=t.args.map(h=>new hM(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),c.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(s=>{var i,r,l;if(s instanceof bx){if(s.value)if(ce(s.value))for(const c of s.value)for(const h of this.overrides)c===h.name&&((i=t.info)===null||i===void 0||i.overrides.push(h));else for(const c of this.overrides)s.value===c.name&&((r=t.info)===null||r===void 0||r.overrides.push(c))}else if(s instanceof fn)for(const c of this.overrides)s.name===c.name&&((l=t.info)===null||l===void 0||l.overrides.push(c))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var s;for(const i of e.calls){const r=(s=this._functions.get(i.name))===null||s===void 0?void 0:s.info;r&&t.add(r)}}findResource(e,t,s){if(s){for(const i of this.entry.compute)if(i.name===s){for(const r of i.resources)if(r.group==e&&r.binding==t)return r}for(const i of this.entry.vertex)if(i.name===s){for(const r of i.resources)if(r.group==e&&r.binding==t)return r}for(const i of this.entry.fragment)if(i.name===s){for(const r of i.resources)if(r.group==e&&r.binding==t)return r}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const s=[],i=this,r=[];return e.search(l=>{if(l instanceof Yu)r.push({});else if(l instanceof Ku)r.pop();else if(l instanceof Rs){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),r.length>0&&(r[r.length-1][c.name]=c)}else if(l instanceof ts){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof rl){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),r.length>0&&(r[r.length-1][c.name]=c)}else if(l instanceof fn){const c=l;if(r.length>0&&r[r.length-1][c.name])return;const h=i._findResource(c.name);h&&s.push(h)}else if(l instanceof __){const c=l,h=i._functions.get(c.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,t)),s.push(...h.resources))}else if(l instanceof g_){const c=l,h=i._functions.get(c.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,t)),s.push(...h.resources))}}),[...new Map(s.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(s,i){s>=e.length&&(e.length=s+1),e[s]===void 0&&(e[s]=[]),i>=e[s].length&&(e[s].length=i+1)}for(const s of this.uniforms)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.storage)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.textures)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.samplers)t(s.group,s.binding),e[s.group][s.binding]=s;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof As)this._getStructOutputs(e,t);else{const s=this._getOutputInfo(e);s!==null&&t.push(s)}return t}_getStructOutputs(e,t){for(const s of e.members)if(s.type instanceof As)this._getStructOutputs(s.type,t);else{const i=this._getAttribute(s,"location")||this._getAttribute(s,"builtin");if(i!==null){const r=this.getTypeInfo(s.type,s.type.attributes),l=this._parseInt(i.value),c=new Ov(s.name,r,i.name,l);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Ov("",s,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const s of e)if(s.type instanceof As)this._getStructInputs(s.type,t);else{const i=this._getInputInfo(s);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const s of e.members)if(s.type instanceof As)this._getStructInputs(s.type,t);else{const i=this._getInputInfo(s);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),l=new cM(e.name,i,t.name,r);return s!==null&&(l.interpolation=this._parseString(s.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new lM(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof al){const i=e,r=i.format?this.getTypeInfo(i.format,i.attributes):null,l=new yi(i.name,t);return l.format=r,l.count=i.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof As){const i=e,r=new di(i.name,t);r.startLine=i.startLine,r.endLine=i.endLine;for(const l of i.members){const c=this.getTypeInfo(l.type,l.attributes);r.members.push(new Cv(l.name,c,l.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Zo){const i=e,r=i.format instanceof ne,l=i.format?r?this.getTypeInfo(i.format,null):new An(i.format,null):null,c=new rr(i.name,l,t,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof H){const i=e,r=i.format?this.getTypeInfo(i.format,null):null,l=new rr(i.name,r,t,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const s=new An(e.name,t);return this._types.set(e,s),this._updateTypeInfo(s),s}_updateTypeInfo(e){var t,s,i;const r=this._getTypeSize(e);if(e.size=(t=r==null?void 0:r.size)!==null&&t!==void 0?t:0,e instanceof yi&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((s=l==null?void 0:l.size)!==null&&s!==void 0?s:0,(i=l==null?void 0:l.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof di&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let s=0,i=0,r=0,l=0;for(let c=0,h=e.members.length;c<h;++c){const d=e.members[c],g=this._getTypeSize(d);if(!g)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=g.align,y=g.size;s=this._roundUp(_,s+i),i=y,r=s,l=Math.max(l,_),d.offset=s,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,r+i),e.align=l}_getTypeSize(e){var t,s;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Cv&&(e=e.type),e instanceof An){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=ss._typeInfo[e.name];if(l!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Kc(Math.max(r,l.align/c),Math.max(i,l.size/c))}}{const l=ss._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const c=e.name[e.name.length-1]==="h"?2:1;return new Kc(Math.max(r,l.align/c),Math.max(i,l.size/c))}}if(e instanceof yi){let l=e,c=8,h=8;const d=this._getTypeSize(l.format);return d!==null&&(h=d.size,c=d.align),h=l.count*this._getAttributeNum((s=e==null?void 0:e.attributes)!==null&&s!==void 0?s:null,"stride",this._roundUp(c,h)),i&&(h=i),new Kc(Math.max(r,c),Math.max(i,h))}if(e instanceof di){let l=0,c=0,h=0,d=0,g=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),h=this._roundUp(y.align,h+d),d=y.size,g=h)}return c=this._roundUp(l,g+d),new Kc(Math.max(r,l),Math.max(i,c))}return null}_isUniformVar(e){return e instanceof Rs&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Rs&&e.storage=="storage"}_isTextureVar(e){return e instanceof Rs&&e.type!==null&&ss._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Rs&&e.type!==null&&ss._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const s=e;if(!s||!s.attributes)return null;const i=s.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,s){if(e===null)return s;for(let i of e)if(i.name==t){let r=i!==null&&i.value!==null?i.value:s;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):s}return s}_roundUp(e,t){return Math.ceil(t/e)*e}}ss._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ss._textureTypes=E.any_texture_type.map(n=>n.name),ss._samplerTypes=E.sampler_type.map(n=>n.name);class m_{constructor(e,t,s){this.name=e,this.value=t,this.node=s}clone(){return new m_(this.name,this.value,this.node)}}class y_{constructor(e){this.name=e.name,this.node=e}clone(){return new y_(this.node)}}class b_{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,s){this.variables.set(e,new m_(e,t,s??null))}setVariable(e,t,s){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,s)}getVariableValue(e){var t;const s=this.getVariable(e);return(t=s==null?void 0:s.value)!==null&&t!==void 0?t:null}clone(){return new b_(this)}}class PM{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class IM{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const s=this.exec.evalExpression(e.args[0],t);let i=!0;if(s instanceof O)return s.data.forEach(r=>{r||(i=!1)}),new F(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O){const i=s.data.some(r=>r);return new F(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const s=this.exec.evalExpression(e.args[2],t);if(!(s instanceof F))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return s.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.evalExpression(s,t);if(i instanceof ft&&i.typeInfo.size===0){const r=i.typeInfo,l=i.buffer.byteLength/r.stride;return new F(l,this.getTypeInfo("u32"))}return new F(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.abs(r)),s.typeInfo);const i=s;return new F(Math.abs(i.value),i.typeInfo)}Acos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.acos(r)),s.typeInfo);const i=s;return new F(Math.acos(i.value),s.typeInfo)}Acosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.acosh(r)),s.typeInfo);const i=s;return new F(Math.acosh(i.value),s.typeInfo)}Asin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.asin(r)),s.typeInfo);const i=s;return new F(Math.asin(i.value),s.typeInfo)}Asinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.asinh(r)),s.typeInfo);const i=s;return new F(Math.asinh(i.value),s.typeInfo)}Atan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.atan(r)),s.typeInfo);const i=s;return new F(Math.atan(i.value),s.typeInfo)}Atanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.atanh(r)),s.typeInfo);const i=s;return new F(Math.atanh(i.value),s.typeInfo)}Atan2(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((c,h)=>Math.atan2(c,i.data[h])),s.typeInfo);const r=s,l=i;return new F(Math.atan2(r.value,l.value),s.typeInfo)}Ceil(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.ceil(r)),s.typeInfo);const i=s;return new F(Math.ceil(i.value),s.typeInfo)}_clamp(e,t,s){return Math.min(Math.max(e,t),s)}Clamp(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s instanceof O&&i instanceof O&&r instanceof O)return new O(s.data.map((d,g)=>this._clamp(d,i.data[g],r.data[g])),s.typeInfo);const l=s,c=i,h=r;return new F(this._clamp(l.value,c.value,h.value),s.typeInfo)}Cos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.cos(r)),s.typeInfo);const i=s;return new F(Math.cos(i.value),s.typeInfo)}Cosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.cosh(r)),s.typeInfo);const i=s;return new F(Math.cos(i.value),s.typeInfo)}CountLeadingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.clz32(r)),s.typeInfo);const i=s;return new F(Math.clz32(i.value),s.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>this._countOneBits(r)),s.typeInfo);const i=s;return new F(this._countOneBits(i.value),s.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>this._countTrailingZeros(r)),s.typeInfo);const i=s;return new F(this._countTrailingZeros(i.value),s.typeInfo)}Cross(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O){if(s.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const r=s.data,l=i.data;return new O([r[1]*l[2]-l[1]*r[2],r[2]*l[0]-l[2]*r[0],r[0]*l[1]-l[0]*r[1]],s.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const s=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return s instanceof O?new O(s.data.map(r=>r*i),s.typeInfo):new F(s.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe){const i=s.data,r=s.typeInfo.getTypeName(),l=r.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h")return new F(i[0]*i[3]-i[1]*i[2],l);if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h")return new F(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),l);if(r==="mat2x4"||r==="mat2x4f"||r==="mat2x4h")console.error(`TODO: Determinant for ${r}`);else if(r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h")console.error(`TODO: Determinant for ${r}`);else{if(r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h")return new F(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),l);r==="mat3x4"||r==="mat3x4f"||r==="mat3x4h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h"?console.error(`TODO: Determinant for ${r}`):r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h"||console.error(`TODO: Determinant for ${r}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O){let c=0;for(let h=0;h<s.data.length;++h)c+=(s.data[h]-i.data[h])*(s.data[h]-i.data[h]);return new F(Math.sqrt(c),this.getTypeInfo("f32"))}const r=s,l=i;return new F(Math.abs(r.value-l.value),s.typeInfo)}_dot(e,t){let s=0;for(let i=0;i<e.length;++i)s+=t[i]*e[i];return s}Dot(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return s instanceof O&&i instanceof O?new F(this._dot(s.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.exp(r)),s.typeInfo);const i=s;return new F(Math.exp(i.value),s.typeInfo)}Exp2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.pow(2,r)),s.typeInfo);const i=s;return new F(Math.pow(2,i.value),s.typeInfo)}ExtractBits(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=i.value,c=r.value;if(s instanceof O)return new O(s.data.map(d=>d>>l&(1<<c)-1),s.typeInfo);if(s.typeInfo.name!=="i32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=s.value;return new F(h>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s instanceof O&&i instanceof O&&r instanceof O){const l=this._dot(i.data,r.data);return new O(l<0?Array.from(s.data):s.data.map(c=>-c),s.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>this._firstLeadingBit(r)),s.typeInfo);const i=s;return new F(this._firstLeadingBit(i.value),s.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>this._firstTrailingBit(r)),s.typeInfo);const i=s;return new F(this._firstTrailingBit(i.value),s.typeInfo)}Floor(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.floor(r)),s.typeInfo);const i=s;return new F(Math.floor(i.value),s.typeInfo)}Fma(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s instanceof O&&i instanceof O&&r instanceof O)return s.data.length!==i.data.length||s.data.length!==r.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new O(s.data.map((d,g)=>d*i.data[g]+r.data[g]),s.typeInfo);const l=s,c=i,h=r;return new F(l.value*c.value+h.value,l.typeInfo)}Fract(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>r-Math.floor(r)),s.typeInfo);const i=s;return new F(i.value-Math.floor(i.value),s.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const c=r.value,h=(1<<l.value)-1<<c,d=~h;if(s instanceof O&&i instanceof O)return new O(s.data.map((y,b)=>y&d|i.data[b]<<c&h),s.typeInfo);const g=s.value,_=i.value;return new F(g&d|_<<c&h,s.typeInfo)}InverseSqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>1/Math.sqrt(r)),s.typeInfo);const i=s;return new F(1/Math.sqrt(i.value),s.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O){let r=0;return s.data.forEach(l=>{r+=l*l}),new F(Math.sqrt(r),this.getTypeInfo("f32"))}const i=s;return new F(Math.abs(i.value),s.typeInfo)}Log(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.log(r)),s.typeInfo);const i=s;return new F(Math.log(i.value),s.typeInfo)}Log2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.log2(r)),s.typeInfo);const i=s;return new F(Math.log2(i.value),s.typeInfo)}Max(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((c,h)=>Math.max(c,i.data[h])),s.typeInfo);const r=s,l=i;return new F(Math.max(r.value,l.value),s.typeInfo)}Min(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((c,h)=>Math.min(c,i.data[h])),s.typeInfo);const r=s,l=i;return new F(Math.min(r.value,l.value),s.typeInfo)}Mix(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s instanceof O&&i instanceof O&&r instanceof O)return new O(s.data.map((h,d)=>s.data[d]*(1-r.data[d])+i.data[d]*r.data[d]),s.typeInfo);const l=i,c=r;return new F(s.value*(1-c.value)+l.value*c.value,s.typeInfo)}Modf(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((l,c)=>l%i.data[c]),s.typeInfo);const r=i;return new F(s.value%r.value,s.typeInfo)}Normalize(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O){const i=this.Length(e,t).value;return new O(s.data.map(r=>r/i),s.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O)return new O(s.data.map((c,h)=>Math.pow(c,i.data[h])),s.typeInfo);const r=s,l=i;return new F(Math.pow(r.value,l.value),s.typeInfo)}QuantizeToF16(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof O?new O(s.data.map(i=>i),s.typeInfo):new F(s.value,s.typeInfo)}Radians(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof O?new O(s.data.map(i=>i*Math.PI/180),s.typeInfo):new F(s.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(s instanceof O&&i instanceof O){const r=this._dot(s.data,i.data);return new O(s.data.map((l,c)=>l-2*r*i.data[c]),s.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s instanceof O&&i instanceof O&&r instanceof F){const l=this._dot(i.data,s.data);return new O(s.data.map((c,h)=>{const d=1-r.value*r.value*(1-l*l);if(d<0)return 0;const g=Math.sqrt(d);return r.value*c-(r.value*l+g)*i.data[h]}),s.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.round(r)),s.typeInfo);const i=s;return new F(Math.round(i.value),s.typeInfo)}Saturate(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.min(Math.max(r,0),1)),s.typeInfo);const i=s;return new F(Math.min(Math.max(i.value,0),1),s.typeInfo)}Sign(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.sign(r)),s.typeInfo);const i=s;return new F(Math.sign(i.value),s.typeInfo)}Sin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.sin(r)),s.typeInfo);const i=s;return new F(Math.sin(i.value),s.typeInfo)}Sinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.sinh(r)),s.typeInfo);const i=s;return new F(Math.sinh(i.value),s.typeInfo)}_smoothstep(e,t,s){const i=Math.min(Math.max((s-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof O&&s instanceof O&&i instanceof O)return new O(r.data.map((d,g)=>this._smoothstep(s.data[g],i.data[g],d)),r.typeInfo);const l=s,c=i,h=r;return new F(this._smoothstep(l.value,c.value,h.value),r.typeInfo)}Sqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.sqrt(r)),s.typeInfo);const i=s;return new F(Math.sqrt(i.value),s.typeInfo)}Step(e,t){const s=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof O&&s instanceof O)return new O(i.data.map((l,c)=>l<s.data[c]?0:1),i.typeInfo);const r=s;return new F(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.tan(r)),s.typeInfo);const i=s;return new F(Math.tan(i.value),s.typeInfo)}Tanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.tanh(r)),s.typeInfo);const i=s;return new F(Math.tanh(i.value),s.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const s=this.exec.evalExpression(e.args[0],t);if(!(s instanceof xe))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(s.typeInfo);if(s.typeInfo.name==="mat2x2"||s.typeInfo.name==="mat2x2f"||s.typeInfo.name==="mat2x2h"){const r=s.data;return new xe([r[0],r[2],r[1],r[3]],i)}if(s.typeInfo.name==="mat2x3"||s.typeInfo.name==="mat2x3f"||s.typeInfo.name==="mat2x3h"){const r=s.data;return new xe([r[0],r[3],r[6],r[1],r[4],r[7]],i)}if(s.typeInfo.name==="mat2x4"||s.typeInfo.name==="mat2x4f"||s.typeInfo.name==="mat2x4h"){const r=s.data;return new xe([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13]],i)}if(s.typeInfo.name==="mat3x2"||s.typeInfo.name==="mat3x2f"||s.typeInfo.name==="mat3x2h"){const r=s.data;return new xe([r[0],r[3],r[1],r[4],r[2],r[5]],i)}if(s.typeInfo.name==="mat3x3"||s.typeInfo.name==="mat3x3f"||s.typeInfo.name==="mat3x3h"){const r=s.data;return new xe([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]],i)}if(s.typeInfo.name==="mat3x4"||s.typeInfo.name==="mat3x4f"||s.typeInfo.name==="mat3x4h"){const r=s.data;return new xe([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14]],i)}if(s.typeInfo.name==="mat4x2"||s.typeInfo.name==="mat4x2f"||s.typeInfo.name==="mat4x2h"){const r=s.data;return new xe([r[0],r[4],r[1],r[5],r[2],r[6]],i)}if(s.typeInfo.name==="mat4x3"||s.typeInfo.name==="mat4x3f"||s.typeInfo.name==="mat4x3h"){const r=s.data;return new xe([r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]],i)}if(s.typeInfo.name==="mat4x4"||s.typeInfo.name==="mat4x4f"||s.typeInfo.name==="mat4x4h"){const r=s.data;return new xe([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]],i)}return console.error(`Invalid matrix type ${s.typeInfo.name}`),null}Trunc(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof O)return new O(s.data.map(r=>Math.trunc(r)),s.typeInfo);const i=s;return new F(Math.trunc(i.value),s.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const s=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(s instanceof fn){const r=s.name,l=t.getVariableValue(r);if(l instanceof Es){if(i<0||i>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const c=l.getMipLevelSize(i),h=l.dimension;return h==="1d"?new F(c[0],this.getTypeInfo("u32")):h==="3d"?new O(c,this.getTypeInfo("vec3u")):h==="2d"?new O(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${r} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const s=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof O)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(s instanceof fn){const l=s.name,c=t.getVariableValue(l);if(c instanceof Es){const h=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(h<0||h>=c.width||d<0||d>=c.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const g=c.getPixel(h,d,0,r);return g===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new O(g,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const s=e.args[0];if(s instanceof fn){const i=s.name,r=t.getVariableValue(i);return r instanceof Es?new F(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const s=e.args[0];if(s instanceof fn){const i=s.name,r=t.getVariableValue(i);return r instanceof Es?new F(r.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const s=e.args[0];if(s instanceof fn){const i=s.name,r=t.getVariableValue(i);return r instanceof Es?new F(r.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const s=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof O)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(s instanceof fn){const c=s.name,h=t.getVariableValue(c);if(h instanceof Es){const d=h.getMipLevelSize(0),g=Math.floor(i.data[0]),_=Math.floor(i.data[1]);return g<0||g>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(h.setPixel(g,_,0,r,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t);return t.getVariable(i).value.getSubData(this.exec,s.postfix,t)}AtomicStore(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t);return h instanceof F&&c instanceof F&&(h.value=c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),null}AtomicAdd(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value+=c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicSub(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value-=c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicMax(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=Math.max(h.value,c.value)),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicMin(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=Math.min(h.value,c.value)),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicAnd(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=h.value&c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicOr(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=h.value|c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicXor(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=h.value^c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicExchange(e,t){let s=e.args[0];s instanceof bt&&(s=s.right);const i=this.exec.getVariableName(s,t),r=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),h=r.value.getSubData(this.exec,s.postfix,t),d=new F(h.value,h.typeInfo);return h instanceof F&&c instanceof F&&(h.value=c.value),r.value instanceof ft&&r.value.setDataValue(this.exec,h,s.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const yg={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Kt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ht extends PM{constructor(e,t){var s;super(),this.ast=e??[],this.reflection=new ss,this.reflection.updateAST(this.ast),this.context=(s=t==null?void 0:t.clone())!==null&&s!==void 0?s:new b_,this.builtins=new IM(this),this.typeInfo={bool:this.getTypeInfo(ne.bool),i32:this.getTypeInfo(ne.i32),u32:this.getTypeInfo(ne.u32),f32:this.getTypeInfo(ne.f32),f16:this.getTypeInfo(ne.f16),vec2f:this.getTypeInfo(H.vec2f),vec2u:this.getTypeInfo(H.vec2u),vec2i:this.getTypeInfo(H.vec2i),vec2h:this.getTypeInfo(H.vec2h),vec3f:this.getTypeInfo(H.vec3f),vec3u:this.getTypeInfo(H.vec3u),vec3i:this.getTypeInfo(H.vec3i),vec3h:this.getTypeInfo(H.vec3h),vec4f:this.getTypeInfo(H.vec4f),vec4u:this.getTypeInfo(H.vec4u),vec4i:this.getTypeInfo(H.vec4i),vec4h:this.getTypeInfo(H.vec4h),mat2x2f:this.getTypeInfo(H.mat2x2f),mat2x3f:this.getTypeInfo(H.mat2x3f),mat2x4f:this.getTypeInfo(H.mat2x4f),mat3x2f:this.getTypeInfo(H.mat3x2f),mat3x3f:this.getTypeInfo(H.mat3x3f),mat3x4f:this.getTypeInfo(H.mat3x4f),mat4x2f:this.getTypeInfo(H.mat4x2f),mat4x3f:this.getTypeInfo(H.mat4x3f),mat4x4f:this.getTypeInfo(H.mat4x4f)}}getVariableValue(e){var t,s;const i=(s=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&s!==void 0?s:null;if(i===null)return null;if(i instanceof F)return i.value;if(i instanceof O||i instanceof xe)return Array.from(i.data);if(i instanceof ft&&i.typeInfo instanceof yi){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,s,i){const r=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,r),this._execStatements(this.ast,r);const l=r.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const c=t[0],h=t[1],d=t[2],g=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new O(t,g));for(const _ in s)for(const y in s[_]){const b=s[_][y];r.variables.forEach(T=>{var S;const R=T.node;if(R!=null&&R.attributes){let k=null,U=null;for(const P of R.attributes)P.name==="binding"?k=P.value:P.name==="group"&&(U=P.value);if(y==k&&_==U)if(b.texture!==void 0&&b.descriptor!==void 0){const P=new Es(b.texture,this.getTypeInfo(R.type),b.descriptor,(S=b.texture.view)!==null&&S!==void 0?S:null);T.value=P}else b.uniform!==void 0?T.value=new ft(b.uniform,this.getTypeInfo(R.type)):T.value=new ft(b,this.getTypeInfo(R.type))}})}for(let _=0;_<d;++_)for(let y=0;y<h;++y)for(let b=0;b<c;++b)r.setVariable("@workgroup_id",new O([b,y,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[b,y,_],r)}execStatement(e,t){if(e instanceof cx)return this.evalExpression(e.value,t);if(e instanceof hx){if(e.condition){const s=this.evalExpression(e.condition,t);if(!(s instanceof F))throw new Error("Invalid break-if condition");if(!s.value)return null}return Ht._breakObj}if(e instanceof fx)return Ht._continueObj;if(e instanceof rl)this._let(e,t);else if(e instanceof Rs)this._var(e,t);else if(e instanceof wu)this._const(e,t);else if(e instanceof _l)this._function(e,t);else{if(e instanceof lx)return this._if(e,t);if(e instanceof ox)return this._switch(e,t);if(e instanceof sx)return this._for(e,t);if(e instanceof nx)return this._while(e,t);if(e instanceof ax)return this._loop(e,t);if(e instanceof fp){const s=t.clone();return s.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,s)}if(e instanceof rx)this._assign(e,t);else if(e instanceof ix)this._increment(e,t);else{if(e instanceof As)return null;if(e instanceof d_){const s=e.name;t.getVariable(s)===null&&t.setVariable(s,new F(0,this.getTypeInfo("u32")))}else if(e instanceof g_)this._call(e,t);else{if(e instanceof ux||e instanceof p_)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Un?this._evalBinaryOp(e,t):e instanceof xt?this._evalLiteral(e,t):e instanceof fn?this._evalVariable(e,t):e instanceof __?this._evalCall(e,t):e instanceof ts?this._evalCreate(e,t):e instanceof dx?this._evalConst(e,t):e instanceof gx?this._evalBitcast(e,t):e instanceof bt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof ne){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let s=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return s!==null||(s=this.reflection.getTypeInfoByName(e)),s}_setOverrides(e,t){for(const s in e){const i=e[s],r=this.reflection.getOverrideInfo(s);r!==null?(r.type===null&&(r.type=this.getTypeInfo("u32")),r.type.name==="u32"||r.type.name==="i32"||r.type.name==="f32"||r.type.name==="f16"?t.setVariable(s,new F(i,r.type)):r.type.name==="bool"?t.setVariable(s,new F(i?1:0,r.type)):r.type.name==="vec2"||r.type.name==="vec3"||r.type.name==="vec4"||r.type.name==="vec2f"||r.type.name==="vec3f"||r.type.name==="vec4f"||r.type.name==="vec2i"||r.type.name==="vec3i"||r.type.name==="vec4i"||r.type.name==="vec2u"||r.type.name==="vec3u"||r.type.name==="vec4u"||r.type.name==="vec2h"||r.type.name==="vec3h"||r.type.name==="vec4h"?t.setVariable(s,new O(i,r.type)):console.error(`Invalid constant type for ${s}`)):console.error(`Override ${s} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,s){const i=[1,1,1];for(const g of e.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const _=s.getVariableValue(g.value[0]);i[0]=_ instanceof F?_.value:parseInt(g.value[0])}if(g.value.length>1){const _=s.getVariableValue(g.value[1]);i[1]=_ instanceof F?_.value:parseInt(g.value[1])}if(g.value.length>2){const _=s.getVariableValue(g.value[2]);i[2]=_ instanceof F?_.value:parseInt(g.value[2])}}const r=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");s.setVariable("@workgroup_size",new O(i,r));const c=i[0],h=i[1],d=i[2];for(let g=0,_=0;g<d;++g)for(let y=0;y<h;++y)for(let b=0;b<c;++b,++_){const T=[b,y,g],S=[b+t[0]*i[0],y+t[1]*i[1],g+t[2]*i[2]];s.setVariable("@local_invocation_id",new O(T,r)),s.setVariable("@global_invocation_id",new O(S,r)),s.setVariable("@local_invocation_index",new F(_,l)),this._dispatchExec(e,s)}}_dispatchExec(e,t){for(const s of e.node.args)for(const i of s.attributes)if(i.name==="builtin"){const r=`@${i.value}`,l=t.getVariable(r);l!==void 0&&t.variables.set(s.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof bt;)e=e.right;return e instanceof fn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const s of e){if(s instanceof Array){const r=t.clone(),l=this._execStatements(s,r);if(l)return l;continue}const i=this.execStatement(s,t);if(i)return i}return null}_call(e,t){const s=t.clone();s.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let r=0;r<i.node.args.length;++r){const l=i.node.args[r],c=this.evalExpression(e.args[r],s);s.setVariable(l.name,c,l)}this._execStatements(i.node.body,s)}else e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const s=this.getVariableName(e.variable,t),i=t.getVariable(s);i?e.operator==="++"?i.value instanceof F?i.value.value++:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof F?i.value.value--:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${s} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof fn){const s=this.getVariableName(e,t),i=t.getVariable(s);return i===null?(console.error(`Variable ${s} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof bt){if(e.operator==="*"){const s=this._getVariableData(e.right,t);return s instanceof ea?s.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const s=this._getVariableData(e.right,t);return new ea(s)}}return null}_assign(e,t){let s=null,i="<var>",r=null;if(e.variable instanceof bt){const h=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),g=e.operator;if(g==="="){if(h instanceof F||h instanceof O||h instanceof xe){if(d instanceof F||d instanceof O||d instanceof xe&&h.data.length===d.data.length)return void h.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof ft&&d instanceof ft&&h.buffer.byteLength-h.offset>=d.buffer.byteLength-d.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(g==="+=")return h instanceof F||h instanceof O||h instanceof xe?d instanceof F||d instanceof O||d instanceof xe?void h.data.set(d.data.map((_,y)=>h.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(g==="-=")return(h instanceof F||h instanceof O||h instanceof xe)&&(d instanceof F||d instanceof O||d instanceof xe)?void h.data.set(d.data.map((_,y)=>h.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof bt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const h=t.getVariable(i);if(!(h&&h.value instanceof ea))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);s=h.value.reference;let d=e.variable.postfix;if(!d){let g=e.variable.right;for(;g instanceof bt;){if(g.postfix){d=g.postfix;break}g=g.right}}d&&(s=s.getSubData(this,d,t))}}else{r=e.variable.postfix,i=this.getVariableName(e.variable,t);const h=t.getVariable(i);if(h===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);s=h.value}if(s instanceof ea&&(s=s.reference),s===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),c=e.operator;if(c==="=")if(s instanceof ft)s.setDataValue(this,l,r,t);else if(r){if(!(s instanceof O||s instanceof xe))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(r instanceof Ra){const h=this.evalExpression(r.index,t).value;if(s instanceof O){if(!(l instanceof F))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[h]=l.value}else{if(!(s instanceof xe))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(r.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(l instanceof O))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const g=s.typeInfo.getTypeName();if(g==="mat2x2"||g==="mat2x2f"||g==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[2*d]=l.data[0],s.data[2*d+1]=l.data[1]}else if(g==="mat2x3"||g==="mat2x3f"||g==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[3*d]=l.data[0],s.data[3*d+1]=l.data[1],s.data[3*d+2]=l.data[2]}else if(g==="mat2x4"||g==="mat2x4f"||g==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[4*d]=l.data[0],s.data[4*d+1]=l.data[1],s.data[4*d+2]=l.data[2],s.data[4*d+3]=l.data[3]}else if(g==="mat3x2"||g==="mat3x2f"||g==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[2*d]=l.data[0],s.data[2*d+1]=l.data[1]}else if(g==="mat3x3"||g==="mat3x3f"||g==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[3*d]=l.data[0],s.data[3*d+1]=l.data[1],s.data[3*d+2]=l.data[2]}else if(g==="mat3x4"||g==="mat3x4f"||g==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[4*d]=l.data[0],s.data[4*d+1]=l.data[1],s.data[4*d+2]=l.data[2],s.data[4*d+3]=l.data[3]}else if(g==="mat4x2"||g==="mat4x2f"||g==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[2*d]=l.data[0],s.data[2*d+1]=l.data[1]}else if(g==="mat4x3"||g==="mat4x3f"||g==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[3*d]=l.data[0],s.data[3*d+1]=l.data[1],s.data[3*d+2]=l.data[2]}else{if(g!=="mat4x4"&&g!=="mat4x4f"&&g!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);s.data[4*d]=l.data[0],s.data[4*d+1]=l.data[1],s.data[4*d+2]=l.data[2],s.data[4*d+3]=l.data[3]}}}}}else if(r instanceof ar){const h=r.value;if(!(s instanceof O))return void console.error(`Invalid assignment to ${h}. Variable ${i} is not a vector. Line ${e.line}`);if(l instanceof F){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(h==="x")s.data[0]=l.value;else if(h==="y"){if(s.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);s.data[1]=l.value}else if(h==="z"){if(s.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);s.data[2]=l.value}else if(h==="w"){if(s.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);s.data[3]=l.value}}else{if(!(l instanceof O))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(h.length!==l.data.length)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);for(let d=0;d<h.length;++d){const g=h[d];if(g==="x"||g==="r")s.data[0]=l.data[d];else if(g==="y"||g==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);s.data[1]=l.data[d]}else if(g==="z"||g==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);s.data[2]=l.data[d]}else{if(g!=="w"&&g!=="a")return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);s.data[3]=l.data[d]}}}}}else s instanceof F&&l instanceof F?s.value=l.value:s instanceof O&&l instanceof O||s instanceof xe&&l instanceof xe?s.data.set(l.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const h=s.getSubData(this,r,t);if(h instanceof O&&l instanceof F){const d=h.data,g=l.value;if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=g;else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=g;else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=g;else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=g;else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=g;else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=g;else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=g;else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=g;else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=g;else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=g;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(h instanceof O&&l instanceof O){const d=h.data,g=l.data;if(d.length!==g.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=g[_];else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=g[_];else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=g[_];else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=g[_];else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=g[_];else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=g[_];else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=g[_];else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=g[_];else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=g[_];else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=g[_];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(h instanceof F&&l instanceof F))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?h.value+=l.value:c==="-="?h.value-=l.value:c==="*="?h.value*=l.value:c==="/="?h.value/=l.value:c==="%="?h.value%=l.value:c==="&="?h.value&=l.value:c==="|="?h.value|=l.value:c==="^="?h.value^=l.value:c==="<<="?h.value<<=l.value:c===">>="?h.value>>=l.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}s instanceof ft&&s.setDataValue(this,h,r,t)}}_function(e,t){const s=new y_(e);t.functions.set(e.name,s)}_const(e,t){let s=null;e.value!==null&&(s=this.evalExpression(e.value,t)),t.createVariable(e.name,s,e)}_let(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof bt||(s=s.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const r=new ts(e.type,[]);s=this._evalCreate(r,t)}}t.createVariable(e.name,s,e)}_var(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof bt||(s=s.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof al||e.type instanceof As||e.type instanceof H){const r=new ts(e.type,[]);s=this._evalCreate(r,t)}}t.createVariable(e.name,s,e)}_switch(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const r of e.cases)if(r instanceof mx)for(const l of r.selectors){if(l instanceof xu){i=r;continue}const c=this.evalExpression(l,t);if(!(c instanceof F))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===s.value)return this._execStatements(r.body,t)}else r instanceof yx&&(i=r);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(e.body,t);for(const i of e.elseif){const r=this.evalExpression(i.condition,t);if(!(r instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof F?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===Ht._breakObj)break;if(s!==null&&s!==Ht._continueObj)return s;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const s=this._execStatements(e.body,t);if(s===Ht._breakObj)break;if(s===Ht._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Ht._breakObj)break}else if(s!==null)return s}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===Ht._breakObj)break;if(s!==Ht._continueObj&&s!==null)return s}return null}_evalBitcast(e,t){const s=this.evalExpression(e.value,t),i=e.type;if(s instanceof F){const r=Dv(s.value,s.typeInfo.name,i.name);return new F(r,this.getTypeInfo(i))}if(s instanceof O){const r=s.typeInfo.getTypeName();let l="";if(r.endsWith("f"))l="f32";else if(r.endsWith("i"))l="i32";else if(r.endsWith("u"))l="u32";else if(r.endsWith("b"))l="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${r}. Line ${e.line}`),null;l="f16"}const c=i.getTypeName();let h="";if(c.endsWith("f"))h="f32";else if(c.endsWith("i"))h="i32";else if(c.endsWith("u"))h="u32";else if(c.endsWith("b"))h="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const d=function(g,_,y){if(_===y)return g;const b=new Array(g.length);for(let T=0;T<g.length;T++)b[T]=Dv(g[T],_,y);return b}(Array.from(s.data),l,h);return new O(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${s.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var s;if(e instanceof ts){if(e.type===null)return dp.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof ts?e.type.name:e.name,r=e instanceof ts?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(r===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(r.size===0)return null;const l=new ft(new ArrayBuffer(r.size),r,0);if(r instanceof di){if(e.args)for(let c=0;c<e.args.length;++c){const h=r.members[c],d=e.args[c],g=this.evalExpression(d,t);l.setData(this,g,h.type,h.offset,t)}}else if(r instanceof yi){let c=0;if(e.args)for(let h=0;h<e.args.length;++h){const d=e.args[h],g=this.evalExpression(d,t);r.format===null&&(((s=g.typeInfo)===null||s===void 0?void 0:s.name)==="x32"?r.format=this.getTypeInfo("i32"):r.format=g.typeInfo),l.setData(this,g,r.format,c,t),c+=r.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof ts?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const s=this.getTypeInfo(e.type),i=s.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new F(e.scalarValue,s):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const s=t.getVariableValue(e.name);return s===null?s:s.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const i=Ht._priority.get(t.name);Ht._priority.get(e[s].name)<i&&(t=e[s])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const s=this.evalExpression(e.right,t);if(e.operator==="&")return new ea(s);if(e.operator==="*")return s instanceof ea?s.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=s instanceof F?s.value:s instanceof O?Array.from(s.data):null;switch(e.operator){case"+":{if(ce(i)){const c=i.map((h,d)=>+h);return new O(c,s.typeInfo)}const r=i,l=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(+r,l)}case"-":{if(ce(i)){const c=i.map((h,d)=>-h);return new O(c,s.typeInfo)}const r=i,l=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(-r,l)}case"!":{if(ce(i)){const c=i.map((h,d)=>h?0:1);return new O(c,s.typeInfo)}const r=i,l=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(r?0:1,l)}case"~":{if(ce(i)){const c=i.map((h,d)=>~h);return new O(c,s.typeInfo)}const r=i,l=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(~r,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const s=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),r=s instanceof F?s.value:s instanceof O||s instanceof xe?Array.from(s.data):null,l=i instanceof F?i.value:i instanceof O||i instanceof xe?Array.from(i.data):null;switch(e.operator){case"+":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b+_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y+g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g+y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c+h,d)}case"-":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b-_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y-g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g-y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c-h,d)}case"*":{if(ce(r)&&ce(l)){const g=r,_=l;if(s instanceof xe&&i instanceof xe){const y=function(R,k,U,P){if(Kt[k.name]===void 0||Kt[P.name]===void 0)return null;const D=Kt[k.name][0],$=Kt[k.name][1],Z=Kt[P.name][0];if(D!==Kt[P.name][1])return null;const fe=new Array(Z*$);for(let ue=0;ue<$;ue++)for(let J=0;J<Z;J++){let oe=0;for(let de=0;de<D;de++)oe+=R[de*$+ue]*U[J*D+de];fe[ue*Z+J]=oe}return fe}(g,s.typeInfo,_,i.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=Kt[i.typeInfo.name][0],T=Kt[s.typeInfo.name][1],S=this.getTypeInfo(`mat${b}x${T}f`);return new xe(y,S)}if(s instanceof xe&&i instanceof O){const y=function(b,T,S,R){if(Kt[T.name]===void 0||yg[R.name]===void 0)return null;const k=Kt[T.name][0],U=Kt[T.name][1];if(k!==S.length)return null;const P=new Array(U);for(let D=0;D<U;D++){let $=0;for(let Z=0;Z<k;Z++)$+=b[Z*U+D]*S[Z];P[D]=$}return P}(g,s.typeInfo,_,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,i.typeInfo)}if(s instanceof O&&i instanceof xe){const y=function(b,T,S,R){if(yg[T.name]===void 0||Kt[R.name]===void 0)return null;const k=Kt[R.name][0],U=Kt[R.name][1];if(U!==b.length)return null;const P=[];for(let D=0;D<k;D++){let $=0;for(let Z=0;Z<U;Z++)$+=b[Z]*S[Z*k+D];P[D]=$}return P}(g,s.typeInfo,_,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,s.typeInfo)}{if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b*_[T]);return new O(y,s.typeInfo)}}if(ce(r)){const g=l,_=r.map((y,b)=>y*g);return s instanceof xe?new xe(_,s.typeInfo):new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g*y);return i instanceof xe?new xe(_,i.typeInfo):new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c*h,d)}case"%":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b%_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y%g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g%y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c%h,d)}case"/":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b/_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y/g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g/y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c/h,d)}case"&":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b&_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y&g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g&y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c&h,d)}case"|":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b|_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y|g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g|y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c|h,d)}case"^":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b^_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y^g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g^y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c^h,d)}case"<<":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b<<_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y<<g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g<<y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c<<h,d)}case">>":{if(ce(r)&&ce(l)){const g=r,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,T)=>b>>_[T]);return new O(y,s.typeInfo)}if(ce(r)){const g=l,_=r.map((y,b)=>y>>g);return new O(_,s.typeInfo)}if(ce(l)){const g=r,_=l.map((y,b)=>g>>y);return new O(_,i.typeInfo)}const c=r,h=l,d=this._maxFormatTypeInfo([s.typeInfo,i.typeInfo]);return new F(c>>h,d)}case">":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g>h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d>c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c>d?1:0);return new O(h,i.typeInfo)}return new F(r>l?1:0,this.getTypeInfo("bool"));case"<":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g<h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d<c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c<d?1:0);return new O(h,i.typeInfo)}return new F(r<l?1:0,this.getTypeInfo("bool"));case"==":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g===h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d==c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c==d?1:0);return new O(h,i.typeInfo)}return new F(r===l?1:0,this.getTypeInfo("bool"));case"!=":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g!==h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d!==c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c!==d?1:0);return new O(h,i.typeInfo)}return new F(r!==l?1:0,this.getTypeInfo("bool"));case">=":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g>=h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d>=c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c>=d?1:0);return new O(h,i.typeInfo)}return new F(r>=l?1:0,this.getTypeInfo("bool"));case"<=":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g<=h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d<=c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c<=d?1:0);return new O(h,i.typeInfo)}return new F(r<=l?1:0,this.getTypeInfo("bool"));case"&&":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g&&h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d&&c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c&&d?1:0);return new O(h,i.typeInfo)}return new F(r&&l?1:0,this.getTypeInfo("bool"));case"||":if(ce(r)&&ce(l)){const c=r,h=l;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g||h[_]?1:0);return new O(d,s.typeInfo)}if(ce(r)){const c=l,h=r.map((d,g)=>d||c?1:0);return new O(h,s.typeInfo)}if(ce(l)){const c=r,h=l.map((d,g)=>c||d?1:0);return new O(h,i.typeInfo)}return new F(r||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const s=t.clone();s.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let r=0;r<i.node.args.length;++r){const l=i.node.args[r],c=this.evalExpression(e.args[r],s);s.createVariable(l.name,c,l)}return this._execStatements(i.node.body,s)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const s=t.getFunction(e.name);if(s){const i=t.clone();for(let r=0;r<s.node.args.length;++r){const l=s.node.args[r],c=this.evalExpression(e.args[r],i);i.setVariable(l.name,c,l)}return this._execStatements(s.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new F(0,this.getTypeInfo(e.type));const s=this.evalExpression(e.args[0],t);return s.typeInfo=this.getTypeInfo(e.type),s.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const s=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=yg[i];if(r===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const l=[];if(e instanceof xt)if(e.isVector){const c=e.vectorValue;for(const h of c)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const h=this.evalExpression(c,t);if(h instanceof O){const d=h.data;for(let g=0;g<d.length;++g){let _=d[g];l.push(_)}}else if(h instanceof F){let d=h.value;l.push(d)}}if(e.type instanceof H&&e.type.format===null&&(e.type.format=H.f32),l.length===0){const c=new Array(r).fill(0);return new O(c,s).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<r;)l.push(l[0]);return l.length<r?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new O(l.length>r?l.slice(0,r):l,s).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const s=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=Kt[i];if(r===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const l=[];if(e instanceof xt)if(e.isVector){const c=e.vectorValue;for(const h of c)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const h=this.evalExpression(c,t);h instanceof O?l.push(...h.data):h instanceof F?l.push(h.value):h instanceof xe&&l.push(...h.data)}if(s instanceof rr&&s.format===null&&(s.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(r[2]).fill(0);return new xe(c,s).getSubData(this,e.postfix,t)}return l.length!==r[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new xe(l,s).getSubData(this,e.postfix,t)}}Ht._breakObj=new Cn(new An("BREAK",null),null),Ht._continueObj=new Cn(new An("CONTINUE",null),null),Ht._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class kM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class NM{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new kM,this._exec=new Ht,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const s=this._global_decl_or_directive();if(!s)break;t.push(s)}if(this._deferArrayCountEval.length>0){for(const s of this._deferArrayCountEval){const i=s.arrayType,r=s.countNode;if(r instanceof fn){const l=r.name,c=this._context.constants.get(l);if(c)try{const h=c.constEvaluate(this._exec);i.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const s of t)s.search(i=>{i instanceof kv||i instanceof mg?i.type=this._forwardType(i.type):i instanceof al?i.format=this._forwardType(i.format):i instanceof Rs||i instanceof rl||i instanceof wu?i.type=this._forwardType(i.type):i instanceof _l?i.returnType=this._forwardType(i.returnType):i instanceof Iv&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof Pv){const t=this._getType(e.name);if(t)return t}else e instanceof mg?e.type=this._forwardType(e.type):e instanceof al&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new xM(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==E.eof}_match(e){if(e instanceof j)return!!this._check(e)&&(this._advance(),!0);for(let t=0,s=e.length;t<s;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const s=t.type;let i=!1;for(const r of e){if(s===r)return!0;r===E.tokens.name&&(i=!0)}if(i){const r=E.tokens.name.rule.exec(t.lexeme);if(r&&r.index==0&&r[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===E.tokens.name){const s=E.tokens.name.rule.exec(t.lexeme);return s&&s.index==0&&s[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._match(E.keywords.alias)){const t=this._type_alias();return this._consume(E.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(E.keywords.diagnostic)){const t=this._diagnostic();return this._consume(E.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(E.keywords.requires)){const t=this._requires_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(E.keywords.enable)){const t=this._enable_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(E.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(E.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(E.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(E.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(E.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(E.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(E.keywords.fn))return null;const e=this._currentLine,t=this._consume(E.tokens.ident,"Expected function name.").toString();this._consume(E.tokens.paren_left,"Expected '(' for function arguments.");const s=[];if(!this._check(E.tokens.paren_right))do{if(this._check(E.tokens.paren_right))break;const c=this._attribute(),h=this._consume(E.tokens.name,"Expected argument name.").toString();this._consume(E.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=d,s.push(this._updateNode(new Iv(h,g,c))))}while(this._match(E.tokens.comma));this._consume(E.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(E.tokens.arrow)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}const r=this._compound_statement(),l=this._currentLine;return this._updateNode(new _l(t,s,i,r,e,l),e)}_compound_statement(){const e=[];for(this._consume(E.tokens.brace_left,"Expected '{' for block.");!this._check(E.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(E.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._check(E.tokens.attr)&&this._attribute(),this._check(E.keywords.if))return this._if_statement();if(this._check(E.keywords.switch))return this._switch_statement();if(this._check(E.keywords.loop))return this._loop_statement();if(this._check(E.keywords.for))return this._for_statement();if(this._check(E.keywords.while))return this._while_statement();if(this._check(E.keywords.continuing))return this._continuing_statement();if(this._check(E.keywords.static_assert))return this._static_assert_statement();if(this._check(E.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(E.keywords.return))e=this._return_statement();else if(this._check([E.keywords.var,E.keywords.let,E.keywords.const]))e=this._variable_statement();else if(this._match(E.keywords.discard))e=this._updateNode(new vM);else if(this._match(E.keywords.break)){const t=this._updateNode(new hx);if(this._currentLoop.length>0){const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t,this._check(E.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(E.keywords.continue)){const t=this._updateNode(new fx);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(E.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(E.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new mM(t),e)}_while_statement(){if(!this._match(E.keywords.while))return null;const e=this._updateNode(new nx(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(E.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(E.keywords.continuing))return null;const t=this._currentLine,s=this._compound_statement();return this._updateNode(new fp(s,e),t)}_for_statement(){if(!this._match(E.keywords.for))return null;this._consume(E.tokens.paren_left,"Expected '('.");const e=this._updateNode(new sx(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(E.tokens.semicolon)?null:this._for_init(),this._consume(E.tokens.semicolon,"Expected ';'."),e.condition=this._check(E.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(E.tokens.semicolon,"Expected ';'."),e.increment=this._check(E.tokens.paren_right)?null:this._for_increment(),this._consume(E.tokens.paren_right,"Expected ')'."),this._check(E.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(E.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(E.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Rs(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(E.keywords.let)){const e=this._currentLine,t=this._consume(E.tokens.name,"Expected name for let.").toString();let s=null;if(this._match(E.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}this._consume(E.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new rl(t,s,null,null,i),e)}if(this._match(E.keywords.const)){const e=this._currentLine,t=this._consume(E.tokens.name,"Expected name for const.").toString();let s=null;if(this._match(E.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}this._consume(E.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return s===null&&i instanceof xt&&(s=i.type),this._updateNode(new wu(t,s,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(E.increment_operators))return this._current=e,null;const s=this._consume(E.increment_operators,"Expected increment operator");return this._updateNode(new ix(s.type===E.tokens.plus_plus?da.increment:da.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(E.tokens.brace_right))return null;let s=this._match(E.tokens.underscore);if(s||(e=this._unary_expression()),!s&&e==null)return null;const i=this._consume(E.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new rx(Ko.parse(i.lexeme),e,r),t)}_func_call_statement(){if(!this._check(E.tokens.ident))return null;const e=this._currentLine,t=this._current,s=this._consume(E.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new g_(s.lexeme,i),e)}_loop_statement(){if(!this._match(E.keywords.loop))return null;this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new ax([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let s of t)e.body.push(s);else e.body.push(t);if(t instanceof fp){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(E.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(E.keywords.switch))return null;const e=this._updateNode(new ox(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(E.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([E.keywords.default,E.keywords.case]);){if(this._match(E.keywords.case)){const s=this._case_selectors();for(const r of s)if(r instanceof xu){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new mx(s,i)))}if(this._match(E.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch default.");const s=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new yx(s)))}}return e}_case_selectors(){const e=[];for(this._match(E.keywords.default)?e.push(this._updateNode(new xu)):e.push(this._shift_expression());this._match(E.tokens.comma);)this._match(E.keywords.default)?e.push(this._updateNode(new xu)):e.push(this._shift_expression());return e}_case_body(){if(this._match(E.keywords.fallthrough))return this._consume(E.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(E.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute();const s=this._compound_statement();let i=[];this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(E.keywords.else)&&(this._check(E.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new lx(t,s,i,r),e)}_match_elseif(){return this._tokens[this._current].type===E.keywords.else&&this._tokens[this._current+1].type===E.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),s=this._compound_statement();return e.push(this._updateNode(new TM(t,s))),this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(E.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new cx(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(E.tokens.or_or);)e=this._updateNode(new Un(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(E.tokens.and_and);)e=this._updateNode(new Un(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(E.tokens.or);)e=this._updateNode(new Un(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(E.tokens.xor);)e=this._updateNode(new Un(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(E.tokens.and);)e=this._updateNode(new Un(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([E.tokens.equal_equal,E.tokens.not_equal])?this._updateNode(new Un(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([E.tokens.less_than,E.tokens.greater_than,E.tokens.less_than_equal,E.tokens.greater_than_equal]);)e=this._updateNode(new Un(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([E.tokens.shift_left,E.tokens.shift_right]);)e=this._updateNode(new Un(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([E.tokens.plus,E.tokens.minus]);)e=this._updateNode(new Un(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([E.tokens.star,E.tokens.forward_slash,E.tokens.modulo]);)e=this._updateNode(new Un(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([E.tokens.minus,E.tokens.bang,E.tokens.tilde,E.tokens.star,E.tokens.and])?this._updateNode(new bt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(E.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(E.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Ra(e)),s=this._postfix_expression();return s&&(t.postfix=s),t}if(this._match(E.tokens.period)){const e=this._consume(E.tokens.name,"Expected member name."),t=this._postfix_expression(),s=this._updateNode(new ar(e.lexeme));return t&&(s.postfix=t),s}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return ne.void;case"bool":return ne.bool;case"i32":return ne.i32;case"u32":return ne.u32;case"f32":return ne.f32;case"f16":return ne.f16;case"vec2f":return H.vec2f;case"vec3f":return H.vec3f;case"vec4f":return H.vec4f;case"vec2i":return H.vec2i;case"vec3i":return H.vec3i;case"vec4i":return H.vec4i;case"vec2u":return H.vec2u;case"vec3u":return H.vec3u;case"vec4u":return H.vec4u;case"vec2h":return H.vec2h;case"vec3h":return H.vec3h;case"vec4h":return H.vec4h;case"mat2x2f":return H.mat2x2f;case"mat2x3f":return H.mat2x3f;case"mat2x4f":return H.mat2x4f;case"mat3x2f":return H.mat3x2f;case"mat3x3f":return H.mat3x3f;case"mat3x4f":return H.mat3x4f;case"mat4x2f":return H.mat4x2f;case"mat4x3f":return H.mat4x3f;case"mat4x4f":return H.mat4x4f;case"mat2x2h":return H.mat2x2h;case"mat2x3h":return H.mat2x3h;case"mat2x4h":return H.mat2x4h;case"mat3x2h":return H.mat3x2h;case"mat3x3h":return H.mat3x3h;case"mat3x4h":return H.mat3x4h;case"mat4x2h":return H.mat4x2h;case"mat4x3h":return H.mat4x3h;case"mat4x4h":return H.mat4x4h;case"mat2x2i":return H.mat2x2i;case"mat2x3i":return H.mat2x3i;case"mat2x4i":return H.mat2x4i;case"mat3x2i":return H.mat3x2i;case"mat3x3i":return H.mat3x3i;case"mat3x4i":return H.mat3x4i;case"mat4x2i":return H.mat4x2i;case"mat4x3i":return H.mat4x3i;case"mat4x4i":return H.mat4x4i;case"mat2x2u":return H.mat2x2u;case"mat2x3u":return H.mat2x3u;case"mat2x4u":return H.mat2x4u;case"mat3x2u":return H.mat3x2u;case"mat3x3u":return H.mat3x3u;case"mat3x4u":return H.mat3x4u;case"mat4x2u":return H.mat4x2u;case"mat4x3u":return H.mat4x3u;case"mat4x4u":return H.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(E.tokens.ident)){const s=this._previous().toString();if(this._check(E.tokens.paren_left)){const i=this._argument_expression_list(),r=this._getType(s);return r!==null?this._updateNode(new ts(r,i)):this._updateNode(new __(s,i))}if(this._context.constants.has(s)){const i=this._context.constants.get(s);return this._updateNode(new dx(s,i.value))}return this._updateNode(new fn(s))}if(this._match(E.tokens.int_literal)){const s=this._previous().toString();let i=s.endsWith("i")||s.endsWith("i")?ne.i32:s.endsWith("u")||s.endsWith("U")?ne.u32:ne.x32;const r=parseInt(s);return this._validateTypeRange(r,i),this._updateNode(new xt(new F(r,this._exec.getTypeInfo(i)),i))}if(this._match(E.tokens.uint_literal)){const s=parseInt(this._previous().toString());return this._validateTypeRange(s,ne.u32),this._updateNode(new xt(new F(s,this._exec.getTypeInfo(ne.u32)),ne.u32))}if(this._match([E.tokens.decimal_float_literal,E.tokens.hex_float_literal])){let s=this._previous().toString(),i=s.endsWith("h");i&&(s=s.substring(0,s.length-1));const r=parseFloat(s);this._validateTypeRange(r,i?ne.f16:ne.f32);const l=i?ne.f16:ne.f32;return this._updateNode(new xt(new F(r,this._exec.getTypeInfo(l)),l))}if(this._match([E.keywords.true,E.keywords.false])){let s=this._previous().toString()===E.keywords.true.rule;return this._updateNode(new xt(new F(s?1:0,this._exec.getTypeInfo(ne.bool)),ne.bool))}if(this._check(E.tokens.paren_left))return this._paren_expression();if(this._match(E.keywords.bitcast)){this._consume(E.tokens.less_than,"Expected '<'.");const s=this._type_decl();this._consume(E.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new gx(s,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ts(e,t))}_argument_expression_list(){if(!this._match(E.tokens.paren_left))return null;const e=[];do{if(this._check(E.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(E.tokens.comma));return this._consume(E.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(E.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(E.tokens.paren_right),e}_paren_expression(){this._consume(E.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(E.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(E.keywords.struct))return null;const e=this._currentLine,t=this._consume(E.tokens.ident,"Expected name for struct.").toString();this._consume(E.tokens.brace_left,"Expected '{' for struct body.");const s=[];for(;!this._check(E.tokens.brace_right);){const l=this._attribute(),c=this._consume(E.tokens.name,"Expected variable name.").toString();this._consume(E.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h),this._check(E.tokens.brace_right)?this._match(E.tokens.comma):this._consume(E.tokens.comma,"Expected ',' for struct member."),s.push(this._updateNode(new kv(c,d,l)))}this._consume(E.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,r=this._updateNode(new As(t,s,e,i),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(E.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof xt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof xt&&(e.type=e.value.type.name==="x32"?ne.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(E.keywords.const))return null;const t=this._consume(E.tokens.name,"Expected variable name"),s=this._currentLine;let i=null;if(this._match(E.tokens.colon)){const h=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=h)}let r=null;this._consume(E.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let h=[ne.f32],d=l.constEvaluate(this._exec,h);d instanceof F&&this._validateTypeRange(d.value,h[0]),h[0]instanceof H&&h[0].format===null&&d.typeInfo instanceof rr&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?h[0].format=ne.f16:d.typeInfo.format.name==="f32"?h[0].format=ne.f32:d.typeInfo.format.name==="i32"?h[0].format=ne.i32:d.typeInfo.format.name==="u32"?h[0].format=ne.u32:d.typeInfo.format.name==="bool"?h[0].format=ne.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),r=this._updateNode(new xt(d,h[0])),this._exec.context.setVariable(t.toString(),d)}catch{r=l}if(i!==null&&r instanceof xt){if(r.type.name!=="x32"&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else i===null&&r instanceof xt&&(i=(e=r==null?void 0:r.type)!==null&&e!==void 0?e:ne.f32,i===ne.x32&&(i=ne.i32));const c=this._updateNode(new wu(t.toString(),i,"","",r),s);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(E.keywords.let))return null;const e=this._currentLine,t=this._consume(E.tokens.name,"Expected variable name");let s=null;if(this._match(E.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}let i=null;if(this._match(E.tokens.equal)&&(i=this._const_expression()),s!==null&&i instanceof xt){if(i.type.name!=="x32"&&s.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${s.name}. Line:${this._currentLine}`);i.type=s}else s===null&&i instanceof xt&&(s=i.type.name==="x32"?ne.i32:i.type);return i instanceof xt&&i.isScalar&&this._validateTypeRange(i.scalarValue,s),this._updateNode(new rl(t.toString(),s,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(E.keywords.var))return null;const e=this._currentLine;let t="",s="";this._match(E.tokens.less_than)&&(t=this._consume(E.storage_class,"Expected storage_class.").toString(),this._match(E.tokens.comma)&&(s=this._consume(E.access_mode,"Expected access_mode.").toString()),this._consume(E.tokens.greater_than,"Expected '>'."));const i=this._consume(E.tokens.name,"Expected variable name");let r=null;if(this._match(E.tokens.colon)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}return this._updateNode(new Rs(i.toString(),r,t,s,null),e)}_override_decl(){if(!this._match(E.keywords.override))return null;const e=this._consume(E.tokens.name,"Expected variable name");let t=null;if(this._match(E.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}return this._updateNode(new d_(e.toString(),t,null))}_diagnostic(){this._consume(E.tokens.paren_left,"Expected '('");const e=this._consume(E.tokens.ident,"Expected severity control name.");this._consume(E.tokens.comma,"Expected ','");let t=this._consume(E.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(E.tokens.period)&&(t+=`.${this._consume(E.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(E.tokens.paren_right,"Expected ')'"),this._updateNode(new ux(e.toString(),t))}_enable_directive(){const e=this._consume(E.tokens.ident,"identity expected.");return this._updateNode(new yM(e.toString()))}_requires_directive(){const e=[this._consume(E.tokens.ident,"identity expected.").toString()];for(;this._match(E.tokens.comma);){const t=this._consume(E.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new bM(e))}_type_alias(){const e=this._consume(E.tokens.ident,"identity expected.");this._consume(E.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const s=this._updateNode(new p_(e.toString(),t));return this._context.aliases.set(s.name,s),s}_type_decl(){if(this._check([E.tokens.ident,...E.texel_format,E.keywords.bool,E.keywords.f32,E.keywords.i32,E.keywords.u32])){const s=this._advance().toString();if(this._context.structs.has(s))return this._context.structs.get(s);if(this._context.aliases.has(s))return this._context.aliases.get(s).type;if(!this._getType(s)){const i=this._updateNode(new Pv(s));return this._forwardTypeCount++,i}return this._updateNode(new ne(s))}let e=this._texture_sampler_types();if(e)return e;if(this._check(E.template_types)){let s=this._advance().toString(),i=null,r=null;return this._match(E.tokens.less_than)&&(i=this._type_decl(),r=null,this._match(E.tokens.comma)&&(r=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new H(s,i,r))}if(this._match(E.keywords.ptr)){let s=this._previous().toString();this._consume(E.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(E.storage_class,"Expected storage_class for pointer");this._consume(E.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let l=null;return this._match(E.tokens.comma)&&(l=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new mg(s,i.toString(),r,l))}const t=this._attribute();if(this._match(E.keywords.array)){let s=null,i=-1;const r=this._previous();let l=null;if(this._match(E.tokens.less_than)){s=this._type_decl(),this._context.aliases.has(s.name)&&(s=this._context.aliases.get(s.name).type);let h="";if(this._match(E.tokens.comma)){l=this._shift_expression();try{h=l.constEvaluate(this._exec).toString(),l=null}catch{h="1"}}this._consume(E.tokens.greater_than,"Expected '>' for array."),i=h?parseInt(h):0}const c=this._updateNode(new al(r.toString(),t,s,i));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(E.sampler_type))return this._updateNode(new Zo(this._previous().toString(),null,null));if(this._match(E.depth_texture_type))return this._updateNode(new Zo(this._previous().toString(),null,null));if(this._match(E.sampled_texture_type)||this._match(E.multisampled_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zo(e.toString(),t,null))}if(this._match(E.storage_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(E.texel_format,"Invalid texel format.").toString();this._consume(E.tokens.comma,"Expected ',' after texel format.");const s=this._consume(E.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zo(e.toString(),t,s))}return null}_attribute(){let e=[];for(;this._match(E.tokens.attr);){const t=this._consume(E.attribute_name,"Expected attribute name"),s=this._updateNode(new bx(t.toString(),null));if(this._match(E.tokens.paren_left)){if(s.value=this._consume(E.literal_or_ident,"Expected attribute value").toString(),this._check(E.tokens.comma)){this._advance();do{const i=this._consume(E.literal_or_ident,"Expected attribute value").toString();s.value instanceof Array||(s.value=[s.value]),s.value.push(i)}while(this._match(E.tokens.comma))}this._consume(E.tokens.paren_right,"Expected ')'")}e.push(s)}return e.length==0?null:e}}class DM extends ss{constructor(e){super(),e&&this.update(e)}update(e){const t=new NM().parse(e);this.updateAST(t)}}function BM(n){var r;const e={attributes:[],bindings:[]};let t;try{t=UM(n)}catch(l){return ae.error(l.message)(),e}for(const l of t.uniforms){const c=[];for(const h of((r=l.type)==null?void 0:r.members)||[])c.push({name:h.name,type:Bv(h.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:c})}for(const l of t.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of t.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const s=t.entry.vertex[0],i=(s==null?void 0:s.inputs.length)||0;for(let l=0;l<i;l++){const c=s.inputs[l];if(c.locationType==="location"){const h=Bv(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:h})}}return e}function Bv(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function UM(n){try{return new DM(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const LM={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...LM}};const tn=globalThis.mathgl.config;function FM(n,{precision:e=tn.precision}={}){return n=zM(n),`${parseFloat(n.toPrecision(e))}`}function or(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function gi(n,e,t){return jM(n,s=>Math.max(e,Math.min(t,s)))}function tr(n,e,t){return or(n)?n.map((s,i)=>tr(s,e[i],t)):t*e+(1-t)*n}function Os(n,e,t){const s=tn.EPSILON;try{if(n===e)return!0;if(or(n)&&or(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!Os(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=tn.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{tn.EPSILON=s}}function zM(n){return Math.round(n/tn.EPSILON)*tn.EPSILON}function VM(n){return n.clone?n.clone():new Array(n.length)}function jM(n,e,t){if(or(n)){const s=n;t=t||VM(s);for(let i=0;i<t.length&&i<s.length;++i){const r=typeof n=="number"?n:n[i];t[i]=e(r,i,t)}return t}return e(n)}class v_ extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+t];return this.check()}toArray(e=[],t=0){for(let s=0;s<this.ELEMENTS;++s)e[t+s]=this[s];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:or(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(tn)}formatString(e){let t="";for(let s=0;s<this.ELEMENTS;++s)t+=(s>0?", ":"")+FM(this[s],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Os(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,s){if(s===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],l=typeof t=="number"?t:t[i];this[i]=r+s*(l-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),t[s]);return this.check()}add(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=t[s];return this.check()}subtract(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=t[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(tn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),t);return this.check()}get elements(){return this}}function $M(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Ge(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function ol(n,e,t=""){if(tn.debug&&!$M(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function ml(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class vx extends v_{get x(){return this[0]}set x(e){this[0]=Ge(e)}get y(){return this[1]}set y(e){this[1]=Ge(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let s=0;s<this.ELEMENTS;++s){const i=this[s]-e[s];t+=i*i}return Ge(t)}dot(e){let t=0;for(let s=0;s<this.ELEMENTS;++s)t+=this[s]*e[s];return Ge(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=t[s];return this.check()}divide(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=t[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ml(e>=0&&e<this.ELEMENTS,"index is out of range"),Ge(this[e])}setComponent(e,t){return ml(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const ll=1e-6;let Hn=typeof Float32Array<"u"?Float32Array:Array;function HM(){const n=new Hn(2);return Hn!=Float32Array&&(n[0]=0,n[1]=0),n}function Uv(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function WM(n,e){return n[0]=-e[0],n[1]=-e[1],n}function Tx(n,e,t,s){const i=e[0],r=e[1];return n[0]=i+s*(t[0]-i),n[1]=r+s*(t[1]-r),n}function XM(n,e,t){const s=e[0],i=e[1];return n[0]=t[0]*s+t[3]*i+t[6],n[1]=t[1]*s+t[4]*i+t[7],n}function qM(n,e,t){const s=e[0],i=e[1];return n[0]=t[0]*s+t[4]*i+t[12],n[1]=t[1]*s+t[5]*i+t[13],n}(function(){const n=HM();return function(e,t,s,i,r,l){let c,h;for(t||(t=2),s||(s=0),i?h=Math.min(i*t+s,e.length):h=e.length,c=s;c<h;c+=t)n[0]=e[c],n[1]=e[c+1],r(n,n,l),e[c]=n[0],e[c+1]=n[1];return e}})();function YM(n,e,t){const s=e[0],i=e[1],r=t[3]*s+t[7]*i||1;return n[0]=(t[0]*s+t[4]*i)/r,n[1]=(t[1]*s+t[5]*i)/r,n}function wx(n,e,t){const s=e[0],i=e[1],r=e[2],l=t[3]*s+t[7]*i+t[11]*r||1;return n[0]=(t[0]*s+t[4]*i+t[8]*r)/l,n[1]=(t[1]*s+t[5]*i+t[9]*r)/l,n[2]=(t[2]*s+t[6]*i+t[10]*r)/l,n}function KM(n,e,t){const s=e[0],i=e[1];return n[0]=t[0]*s+t[2]*i,n[1]=t[1]*s+t[3]*i,n[2]=e[2],n}function ZM(n,e,t){const s=e[0],i=e[1];return n[0]=t[0]*s+t[2]*i,n[1]=t[1]*s+t[3]*i,n[2]=e[2],n[3]=e[3],n}function xx(n,e,t){const s=e[0],i=e[1],r=e[2];return n[0]=t[0]*s+t[3]*i+t[6]*r,n[1]=t[1]*s+t[4]*i+t[7]*r,n[2]=t[2]*s+t[5]*i+t[8]*r,n[3]=e[3],n}function Sx(){const n=new Hn(3);return Hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function QM(n){const e=n[0],t=n[1],s=n[2];return Math.sqrt(e*e+t*t+s*s)}function Lv(n,e,t){const s=new Hn(3);return s[0]=n,s[1]=e,s[2]=t,s}function GM(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function JM(n){const e=n[0],t=n[1],s=n[2];return e*e+t*t+s*s}function eP(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function tP(n,e){const t=e[0],s=e[1],i=e[2];let r=t*t+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function Ax(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Su(n,e,t){const s=e[0],i=e[1],r=e[2],l=t[0],c=t[1],h=t[2];return n[0]=i*h-r*c,n[1]=r*l-s*h,n[2]=s*c-i*l,n}function nP(n,e,t,s){const i=e[0],r=e[1],l=e[2];return n[0]=i+s*(t[0]-i),n[1]=r+s*(t[1]-r),n[2]=l+s*(t[2]-l),n}function T_(n,e,t){const s=e[0],i=e[1],r=e[2];let l=t[3]*s+t[7]*i+t[11]*r+t[15];return l=l||1,n[0]=(t[0]*s+t[4]*i+t[8]*r+t[12])/l,n[1]=(t[1]*s+t[5]*i+t[9]*r+t[13])/l,n[2]=(t[2]*s+t[6]*i+t[10]*r+t[14])/l,n}function Ex(n,e,t){const s=e[0],i=e[1],r=e[2];return n[0]=s*t[0]+i*t[3]+r*t[6],n[1]=s*t[1]+i*t[4]+r*t[7],n[2]=s*t[2]+i*t[5]+r*t[8],n}function Rx(n,e,t){const s=t[0],i=t[1],r=t[2],l=t[3],c=e[0],h=e[1],d=e[2];let g=i*d-r*h,_=r*c-s*d,y=s*h-i*c,b=i*y-r*_,T=r*g-s*y,S=s*_-i*g;const R=l*2;return g*=R,_*=R,y*=R,b*=2,T*=2,S*=2,n[0]=c+g+b,n[1]=h+_+T,n[2]=d+y+S,n}function sP(n,e,t,s){const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],r[0]=i[0],r[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),r[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function iP(n,e,t,s){const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],r[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),r[1]=i[1],r[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function rP(n,e,t,s){const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],r[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),r[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),r[2]=i[2],n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function aP(n,e){const t=n[0],s=n[1],i=n[2],r=e[0],l=e[1],c=e[2],h=Math.sqrt((t*t+s*s+i*i)*(r*r+l*l+c*c)),d=h&&Ax(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}const Cx=GM,Ox=QM,bg=JM;(function(){const n=Sx();return function(e,t,s,i,r,l){let c,h;for(t||(t=3),s||(s=0),i?h=Math.min(i*t+s,e.length):h=e.length,c=s;c<h;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],r(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();const vg=[0,0,0];let Zc;class he extends vx{static get ZERO(){return Zc||(Zc=new he(0,0,0),Object.freeze(Zc)),Zc}constructor(e=0,t=0,s=0){super(-0,-0,-0),arguments.length===1&&or(e)?this.copy(e):(tn.debug&&(Ge(e),Ge(t),Ge(s)),this[0]=e,this[1]=t,this[2]=s)}set(e,t,s){return this[0]=e,this[1]=t,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return tn.debug&&(Ge(e.x),Ge(e.y),Ge(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ge(e)}angle(e){return aP(this,e)}cross(e){return Su(this,this,e),this.check()}rotateX({radians:e,origin:t=vg}){return sP(this,this,t,e),this.check()}rotateY({radians:e,origin:t=vg}){return iP(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=vg}){return rP(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return T_(this,this,e),this.check()}transformAsVector(e){return wx(this,this,e),this.check()}transformByMatrix3(e){return Ex(this,this,e),this.check()}transformByMatrix2(e){return KM(this,this,e),this.check()}transformByQuaternion(e){return Rx(this,this,e),this.check()}}let Qc;class w_ extends vx{static get ZERO(){return Qc||(Qc=new w_(0,0,0,0),Object.freeze(Qc)),Qc}constructor(e=0,t=0,s=0,i=0){super(-0,-0,-0,-0),or(e)&&arguments.length===1?this.copy(e):(tn.debug&&(Ge(e),Ge(t),Ge(s),Ge(i)),this[0]=e,this[1]=t,this[2]=s,this[3]=i)}set(e,t,s,i){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return tn.debug&&(Ge(e.x),Ge(e.y),Ge(e.z),Ge(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ge(e)}get w(){return this[3]}set w(e){this[3]=Ge(e)}transform(e){return T_(this,this,e),this.check()}transformByMatrix3(e){return xx(this,this,e),this.check()}transformByMatrix2(e){return ZM(this,this,e),this.check()}transformByQuaternion(e){return Rx(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Mx extends v_{toString(){let e="[";if(tn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let s=0;s<this.RANK;++s)e+=` ${this[s*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,s){return this[t*this.RANK+e]=Ge(s),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[s+i];return t}setColumn(e,t){const s=e*this.RANK;for(let i=0;i<this.RANK;++i)this[s+i]=t[i];return this}}function oP(){const n=new Hn(9);return Hn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function lP(n,e){if(n===e){const t=e[1],s=e[2],i=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=s,n[7]=i}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function cP(n,e){const t=e[0],s=e[1],i=e[2],r=e[3],l=e[4],c=e[5],h=e[6],d=e[7],g=e[8],_=g*l-c*d,y=-g*r+c*h,b=d*r-l*h;let T=t*_+s*y+i*b;return T?(T=1/T,n[0]=_*T,n[1]=(-g*s+i*d)*T,n[2]=(c*s-i*l)*T,n[3]=y*T,n[4]=(g*t-i*h)*T,n[5]=(-c*t+i*r)*T,n[6]=b*T,n[7]=(-d*t+s*h)*T,n[8]=(l*t-s*r)*T,n):null}function uP(n){const e=n[0],t=n[1],s=n[2],i=n[3],r=n[4],l=n[5],c=n[6],h=n[7],d=n[8];return e*(d*r-l*h)+t*(-d*i+l*c)+s*(h*i-r*c)}function Fv(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3],c=e[4],h=e[5],d=e[6],g=e[7],_=e[8],y=t[0],b=t[1],T=t[2],S=t[3],R=t[4],k=t[5],U=t[6],P=t[7],D=t[8];return n[0]=y*s+b*l+T*d,n[1]=y*i+b*c+T*g,n[2]=y*r+b*h+T*_,n[3]=S*s+R*l+k*d,n[4]=S*i+R*c+k*g,n[5]=S*r+R*h+k*_,n[6]=U*s+P*l+D*d,n[7]=U*i+P*c+D*g,n[8]=U*r+P*h+D*_,n}function hP(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3],c=e[4],h=e[5],d=e[6],g=e[7],_=e[8],y=t[0],b=t[1];return n[0]=s,n[1]=i,n[2]=r,n[3]=l,n[4]=c,n[5]=h,n[6]=y*s+b*l+d,n[7]=y*i+b*c+g,n[8]=y*r+b*h+_,n}function fP(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3],c=e[4],h=e[5],d=e[6],g=e[7],_=e[8],y=Math.sin(t),b=Math.cos(t);return n[0]=b*s+y*l,n[1]=b*i+y*c,n[2]=b*r+y*h,n[3]=b*l-y*s,n[4]=b*c-y*i,n[5]=b*h-y*r,n[6]=d,n[7]=g,n[8]=_,n}function zv(n,e,t){const s=t[0],i=t[1];return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function dP(n,e){const t=e[0],s=e[1],i=e[2],r=e[3],l=t+t,c=s+s,h=i+i,d=t*l,g=s*l,_=s*c,y=i*l,b=i*c,T=i*h,S=r*l,R=r*c,k=r*h;return n[0]=1-_-T,n[3]=g-k,n[6]=y+R,n[1]=g+k,n[4]=1-d-T,n[7]=b-S,n[2]=y-R,n[5]=b+S,n[8]=1-d-_,n}var gp;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(gp||(gp={}));const gP=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ut extends Mx{static get IDENTITY(){return _P()}static get ZERO(){return pP()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return gp}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(gP)}fromObject(e){return this.check()}fromQuaternion(e){return dP(this,e),this.check()}set(e,t,s,i,r,l,c,h,d){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this[4]=r,this[5]=l,this[6]=c,this[7]=h,this[8]=d,this.check()}setRowMajor(e,t,s,i,r,l,c,h,d){return this[0]=e,this[1]=i,this[2]=c,this[3]=t,this[4]=r,this[5]=h,this[6]=s,this[7]=l,this[8]=d,this.check()}determinant(){return uP(this)}transpose(){return lP(this,this),this.check()}invert(){return cP(this,this),this.check()}multiplyLeft(e){return Fv(this,e,this),this.check()}multiplyRight(e){return Fv(this,this,e),this.check()}rotate(e){return fP(this,this,e),this.check()}scale(e){return Array.isArray(e)?zv(this,this,e):zv(this,this,[e,e]),this.check()}translate(e){return hP(this,this,e),this.check()}transform(e,t){let s;switch(e.length){case 2:s=XM(t||[-0,-0],e,this);break;case 3:s=Ex(t||[-0,-0,-0],e,this);break;case 4:s=xx(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ol(s,e.length),s}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Gc,Jc=null;function pP(){return Gc||(Gc=new Ut([0,0,0,0,0,0,0,0,0]),Object.freeze(Gc)),Gc}function _P(){return Jc||(Jc=new Ut,Object.freeze(Jc)),Jc}function mP(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yP(n,e){if(n===e){const t=e[1],s=e[2],i=e[3],r=e[6],l=e[7],c=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=s,n[9]=r,n[11]=e[14],n[12]=i,n[13]=l,n[14]=c}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function pp(n,e){const t=e[0],s=e[1],i=e[2],r=e[3],l=e[4],c=e[5],h=e[6],d=e[7],g=e[8],_=e[9],y=e[10],b=e[11],T=e[12],S=e[13],R=e[14],k=e[15],U=t*c-s*l,P=t*h-i*l,D=t*d-r*l,$=s*h-i*c,Z=s*d-r*c,fe=i*d-r*h,ue=g*S-_*T,J=g*R-y*T,oe=g*k-b*T,de=_*R-y*S,ve=_*k-b*S,be=y*k-b*R;let Se=U*be-P*ve+D*de+$*oe-Z*J+fe*ue;return Se?(Se=1/Se,n[0]=(c*be-h*ve+d*de)*Se,n[1]=(i*ve-s*be-r*de)*Se,n[2]=(S*fe-R*Z+k*$)*Se,n[3]=(y*Z-_*fe-b*$)*Se,n[4]=(h*oe-l*be-d*J)*Se,n[5]=(t*be-i*oe+r*J)*Se,n[6]=(R*D-T*fe-k*P)*Se,n[7]=(g*fe-y*D+b*P)*Se,n[8]=(l*ve-c*oe+d*ue)*Se,n[9]=(s*oe-t*ve-r*ue)*Se,n[10]=(T*Z-S*D+k*U)*Se,n[11]=(_*D-g*Z-b*U)*Se,n[12]=(c*J-l*de-h*ue)*Se,n[13]=(t*de-s*J+i*ue)*Se,n[14]=(S*P-T*$-R*U)*Se,n[15]=(g*$-_*P+y*U)*Se,n):null}function bP(n){const e=n[0],t=n[1],s=n[2],i=n[3],r=n[4],l=n[5],c=n[6],h=n[7],d=n[8],g=n[9],_=n[10],y=n[11],b=n[12],T=n[13],S=n[14],R=n[15],k=e*l-t*r,U=e*c-s*r,P=t*c-s*l,D=d*T-g*b,$=d*S-_*b,Z=g*S-_*T,fe=e*Z-t*$+s*D,ue=r*Z-l*$+c*D,J=d*P-g*U+_*k,oe=b*P-T*U+S*k;return h*fe-i*ue+R*J-y*oe}function nr(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3],c=e[4],h=e[5],d=e[6],g=e[7],_=e[8],y=e[9],b=e[10],T=e[11],S=e[12],R=e[13],k=e[14],U=e[15];let P=t[0],D=t[1],$=t[2],Z=t[3];return n[0]=P*s+D*c+$*_+Z*S,n[1]=P*i+D*h+$*y+Z*R,n[2]=P*r+D*d+$*b+Z*k,n[3]=P*l+D*g+$*T+Z*U,P=t[4],D=t[5],$=t[6],Z=t[7],n[4]=P*s+D*c+$*_+Z*S,n[5]=P*i+D*h+$*y+Z*R,n[6]=P*r+D*d+$*b+Z*k,n[7]=P*l+D*g+$*T+Z*U,P=t[8],D=t[9],$=t[10],Z=t[11],n[8]=P*s+D*c+$*_+Z*S,n[9]=P*i+D*h+$*y+Z*R,n[10]=P*r+D*d+$*b+Z*k,n[11]=P*l+D*g+$*T+Z*U,P=t[12],D=t[13],$=t[14],Z=t[15],n[12]=P*s+D*c+$*_+Z*S,n[13]=P*i+D*h+$*y+Z*R,n[14]=P*r+D*d+$*b+Z*k,n[15]=P*l+D*g+$*T+Z*U,n}function Ju(n,e,t){const s=t[0],i=t[1],r=t[2];let l,c,h,d,g,_,y,b,T,S,R,k;return e===n?(n[12]=e[0]*s+e[4]*i+e[8]*r+e[12],n[13]=e[1]*s+e[5]*i+e[9]*r+e[13],n[14]=e[2]*s+e[6]*i+e[10]*r+e[14],n[15]=e[3]*s+e[7]*i+e[11]*r+e[15]):(l=e[0],c=e[1],h=e[2],d=e[3],g=e[4],_=e[5],y=e[6],b=e[7],T=e[8],S=e[9],R=e[10],k=e[11],n[0]=l,n[1]=c,n[2]=h,n[3]=d,n[4]=g,n[5]=_,n[6]=y,n[7]=b,n[8]=T,n[9]=S,n[10]=R,n[11]=k,n[12]=l*s+g*i+T*r+e[12],n[13]=c*s+_*i+S*r+e[13],n[14]=h*s+y*i+R*r+e[14],n[15]=d*s+b*i+k*r+e[15]),n}function x_(n,e,t){const s=t[0],i=t[1],r=t[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function vP(n,e,t,s){let i=s[0],r=s[1],l=s[2],c=Math.sqrt(i*i+r*r+l*l),h,d,g,_,y,b,T,S,R,k,U,P,D,$,Z,fe,ue,J,oe,de,ve,be,Se,We;return c<ll?null:(c=1/c,i*=c,r*=c,l*=c,d=Math.sin(t),h=Math.cos(t),g=1-h,_=e[0],y=e[1],b=e[2],T=e[3],S=e[4],R=e[5],k=e[6],U=e[7],P=e[8],D=e[9],$=e[10],Z=e[11],fe=i*i*g+h,ue=r*i*g+l*d,J=l*i*g-r*d,oe=i*r*g-l*d,de=r*r*g+h,ve=l*r*g+i*d,be=i*l*g+r*d,Se=r*l*g-i*d,We=l*l*g+h,n[0]=_*fe+S*ue+P*J,n[1]=y*fe+R*ue+D*J,n[2]=b*fe+k*ue+$*J,n[3]=T*fe+U*ue+Z*J,n[4]=_*oe+S*de+P*ve,n[5]=y*oe+R*de+D*ve,n[6]=b*oe+k*de+$*ve,n[7]=T*oe+U*de+Z*ve,n[8]=_*be+S*Se+P*We,n[9]=y*be+R*Se+D*We,n[10]=b*be+k*Se+$*We,n[11]=T*be+U*Se+Z*We,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function Px(n,e,t){const s=Math.sin(t),i=Math.cos(t),r=e[4],l=e[5],c=e[6],h=e[7],d=e[8],g=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=r*i+d*s,n[5]=l*i+g*s,n[6]=c*i+_*s,n[7]=h*i+y*s,n[8]=d*i-r*s,n[9]=g*i-l*s,n[10]=_*i-c*s,n[11]=y*i-h*s,n}function TP(n,e,t){const s=Math.sin(t),i=Math.cos(t),r=e[0],l=e[1],c=e[2],h=e[3],d=e[8],g=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*i-d*s,n[1]=l*i-g*s,n[2]=c*i-_*s,n[3]=h*i-y*s,n[8]=r*s+d*i,n[9]=l*s+g*i,n[10]=c*s+_*i,n[11]=h*s+y*i,n}function Ix(n,e,t){const s=Math.sin(t),i=Math.cos(t),r=e[0],l=e[1],c=e[2],h=e[3],d=e[4],g=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*i+d*s,n[1]=l*i+g*s,n[2]=c*i+_*s,n[3]=h*i+y*s,n[4]=d*i-r*s,n[5]=g*i-l*s,n[6]=_*i-c*s,n[7]=y*i-h*s,n}function wP(n,e){const t=e[0],s=e[1],i=e[2],r=e[4],l=e[5],c=e[6],h=e[8],d=e[9],g=e[10];return n[0]=Math.sqrt(t*t+s*s+i*i),n[1]=Math.sqrt(r*r+l*l+c*c),n[2]=Math.sqrt(h*h+d*d+g*g),n}function xP(n,e){const t=e[0],s=e[1],i=e[2],r=e[3],l=t+t,c=s+s,h=i+i,d=t*l,g=s*l,_=s*c,y=i*l,b=i*c,T=i*h,S=r*l,R=r*c,k=r*h;return n[0]=1-_-T,n[1]=g+k,n[2]=y-R,n[3]=0,n[4]=g-k,n[5]=1-d-T,n[6]=b+S,n[7]=0,n[8]=y+R,n[9]=b-S,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function SP(n,e,t,s,i,r,l){const c=1/(t-e),h=1/(i-s),d=1/(r-l);return n[0]=r*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*c,n[9]=(i+s)*h,n[10]=(l+r)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*r*2*d,n[15]=0,n}function AP(n,e,t,s,i){const r=1/Math.tan(e/2);if(n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const l=1/(s-i);n[10]=(i+s)*l,n[14]=2*i*s*l}else n[10]=-1,n[14]=-2*s;return n}const EP=AP;function RP(n,e,t,s,i,r,l){const c=1/(e-t),h=1/(s-i),d=1/(r-l);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*c,n[13]=(i+s)*h,n[14]=(l+r)*d,n[15]=1,n}const CP=RP;function OP(n,e,t,s){let i,r,l,c,h,d,g,_,y,b;const T=e[0],S=e[1],R=e[2],k=s[0],U=s[1],P=s[2],D=t[0],$=t[1],Z=t[2];return Math.abs(T-D)<ll&&Math.abs(S-$)<ll&&Math.abs(R-Z)<ll?mP(n):(_=T-D,y=S-$,b=R-Z,i=1/Math.sqrt(_*_+y*y+b*b),_*=i,y*=i,b*=i,r=U*b-P*y,l=P*_-k*b,c=k*y-U*_,i=Math.sqrt(r*r+l*l+c*c),i?(i=1/i,r*=i,l*=i,c*=i):(r=0,l=0,c=0),h=y*c-b*l,d=b*r-_*c,g=_*l-y*r,i=Math.sqrt(h*h+d*d+g*g),i?(i=1/i,h*=i,d*=i,g*=i):(h=0,d=0,g=0),n[0]=r,n[1]=h,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=c,n[9]=g,n[10]=b,n[11]=0,n[12]=-(r*T+l*S+c*R),n[13]=-(h*T+d*S+g*R),n[14]=-(_*T+y*S+b*R),n[15]=1,n)}function MP(){const n=new Hn(4);return Hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function PP(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function S_(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function IP(n){const e=n[0],t=n[1],s=n[2],i=n[3];return Math.sqrt(e*e+t*t+s*s+i*i)}function kP(n){const e=n[0],t=n[1],s=n[2],i=n[3];return e*e+t*t+s*s+i*i}function NP(n,e){const t=e[0],s=e[1],i=e[2],r=e[3];let l=t*t+s*s+i*i+r*r;return l>0&&(l=1/Math.sqrt(l)),n[0]=t*l,n[1]=s*l,n[2]=i*l,n[3]=r*l,n}function DP(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function BP(n,e,t,s){const i=e[0],r=e[1],l=e[2],c=e[3];return n[0]=i+s*(t[0]-i),n[1]=r+s*(t[1]-r),n[2]=l+s*(t[2]-l),n[3]=c+s*(t[3]-c),n}function Ba(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3];return n[0]=t[0]*s+t[4]*i+t[8]*r+t[12]*l,n[1]=t[1]*s+t[5]*i+t[9]*r+t[13]*l,n[2]=t[2]*s+t[6]*i+t[10]*r+t[14]*l,n[3]=t[3]*s+t[7]*i+t[11]*r+t[15]*l,n}function UP(n,e,t){const s=e[0],i=e[1],r=e[2],l=t[0],c=t[1],h=t[2],d=t[3],g=d*s+c*r-h*i,_=d*i+h*s-l*r,y=d*r+l*i-c*s,b=-l*s-c*i-h*r;return n[0]=g*d+b*-l+_*-h-y*-c,n[1]=_*d+b*-c+y*-l-g*-h,n[2]=y*d+b*-h+g*-c-_*-l,n[3]=e[3],n}(function(){const n=MP();return function(e,t,s,i,r,l){let c,h;for(t||(t=4),s||(s=0),i?h=Math.min(i*t+s,e.length):h=e.length,c=s;c<h;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],n[3]=e[c+3],r(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2],e[c+3]=n[3];return e}})();var _p;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(_p||(_p={}));const LP=45*Math.PI/180,FP=1,Tg=.1,wg=500,zP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Zt extends Mx{static get IDENTITY(){return jP()}static get ZERO(){return VP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return _p}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,s,i,r,l,c,h,d,g,_,y,b,T,S,R){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this[4]=r,this[5]=l,this[6]=c,this[7]=h,this[8]=d,this[9]=g,this[10]=_,this[11]=y,this[12]=b,this[13]=T,this[14]=S,this[15]=R,this.check()}setRowMajor(e,t,s,i,r,l,c,h,d,g,_,y,b,T,S,R){return this[0]=e,this[1]=r,this[2]=d,this[3]=b,this[4]=t,this[5]=l,this[6]=g,this[7]=T,this[8]=s,this[9]=c,this[10]=_,this[11]=S,this[12]=i,this[13]=h,this[14]=y,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(zP)}fromObject(e){return this.check()}fromQuaternion(e){return xP(this,e),this.check()}frustum(e){const{left:t,right:s,bottom:i,top:r,near:l=Tg,far:c=wg}=e;return c===1/0?$P(this,t,s,i,r,l):SP(this,t,s,i,r,l,c),this.check()}lookAt(e){const{eye:t,center:s=[0,0,0],up:i=[0,1,0]}=e;return OP(this,t,s,i),this.check()}ortho(e){const{left:t,right:s,bottom:i,top:r,near:l=Tg,far:c=wg}=e;return CP(this,t,s,i,r,l,c),this.check()}orthographic(e){const{fovy:t=LP,aspect:s=FP,focalDistance:i=1,near:r=Tg,far:l=wg}=e;Vv(t);const c=t/2,h=i*Math.tan(c),d=h*s;return this.ortho({left:-d,right:d,bottom:-h,top:h,near:r,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:s=1,near:i=.1,far:r=500}=e;return Vv(t),EP(this,t,s,i,r),this.check()}determinant(){return bP(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),i=1/s[0],r=1/s[1],l=1/s[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),i=1/s[0],r=1/s[1],l=1/s[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*l,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*l,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*l,e}transpose(){return yP(this,this),this.check()}invert(){return pp(this,this),this.check()}multiplyLeft(e){return nr(this,e,this),this.check()}multiplyRight(e){return nr(this,this,e),this.check()}rotateX(e){return Px(this,this,e),this.check()}rotateY(e){return TP(this,this,e),this.check()}rotateZ(e){return Ix(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return vP(this,this,e,t),this.check()}scale(e){return x_(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ju(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Ba(t||[-0,-0,-0,-0],e,this),ol(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:s}=e;let i;switch(s){case 2:i=qM(t||[-0,-0],e,this);break;case 3:i=T_(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ol(i,e.length),i}transformAsVector(e,t){let s;switch(e.length){case 2:s=YM(t||[-0,-0],e,this);break;case 3:s=wx(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ol(s,e.length),s}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,s){return this.identity().translate([e,t,s])}}let eu,tu;function VP(){return eu||(eu=new Zt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(eu)),eu}function jP(){return tu||(tu=new Zt,Object.freeze(tu)),tu}function Vv(n){if(n>Math.PI*2)throw Error("expected radians")}function $P(n,e,t,s,i,r){const l=2*r/(t-e),c=2*r/(i-s),h=(t+e)/(t-e),d=(i+s)/(i-s),g=-1,_=-1,y=-2*r;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=h,n[9]=d,n[10]=g,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function jv(){const n=new Hn(4);return Hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function HP(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function kx(n,e,t){t=t*.5;const s=Math.sin(t);return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=Math.cos(t),n}function $v(n,e,t){const s=e[0],i=e[1],r=e[2],l=e[3],c=t[0],h=t[1],d=t[2],g=t[3];return n[0]=s*g+l*c+i*d-r*h,n[1]=i*g+l*h+r*c-s*d,n[2]=r*g+l*d+s*h-i*c,n[3]=l*g-s*c-i*h-r*d,n}function WP(n,e,t){t*=.5;const s=e[0],i=e[1],r=e[2],l=e[3],c=Math.sin(t),h=Math.cos(t);return n[0]=s*h+l*c,n[1]=i*h+r*c,n[2]=r*h-i*c,n[3]=l*h-s*c,n}function XP(n,e,t){t*=.5;const s=e[0],i=e[1],r=e[2],l=e[3],c=Math.sin(t),h=Math.cos(t);return n[0]=s*h-r*c,n[1]=i*h+l*c,n[2]=r*h+s*c,n[3]=l*h-i*c,n}function qP(n,e,t){t*=.5;const s=e[0],i=e[1],r=e[2],l=e[3],c=Math.sin(t),h=Math.cos(t);return n[0]=s*h+i*c,n[1]=i*h-s*c,n[2]=r*h+l*c,n[3]=l*h-r*c,n}function YP(n,e){const t=e[0],s=e[1],i=e[2];return n[0]=t,n[1]=s,n[2]=i,n[3]=Math.sqrt(Math.abs(1-t*t-s*s-i*i)),n}function Au(n,e,t,s){const i=e[0],r=e[1],l=e[2],c=e[3];let h=t[0],d=t[1],g=t[2],_=t[3],y,b,T,S,R;return y=i*h+r*d+l*g+c*_,y<0&&(y=-y,h=-h,d=-d,g=-g,_=-_),1-y>ll?(b=Math.acos(y),R=Math.sin(b),T=Math.sin((1-s)*b)/R,S=Math.sin(s*b)/R):(T=1-s,S=s),n[0]=T*i+S*h,n[1]=T*r+S*d,n[2]=T*l+S*g,n[3]=T*c+S*_,n}function KP(n,e){const t=e[0],s=e[1],i=e[2],r=e[3],l=t*t+s*s+i*i+r*r,c=l?1/l:0;return n[0]=-t*c,n[1]=-s*c,n[2]=-i*c,n[3]=r*c,n}function ZP(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function Nx(n,e){const t=e[0]+e[4]+e[8];let s;if(t>0)s=Math.sqrt(t+1),n[3]=.5*s,s=.5/s,n[0]=(e[5]-e[7])*s,n[1]=(e[6]-e[2])*s,n[2]=(e[1]-e[3])*s;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const r=(i+1)%3,l=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[r*3+r]-e[l*3+l]+1),n[i]=.5*s,s=.5/s,n[3]=(e[r*3+l]-e[l*3+r])*s,n[r]=(e[r*3+i]+e[i*3+r])*s,n[l]=(e[l*3+i]+e[i*3+l])*s}return n}const QP=PP,GP=S_,JP=DP,eI=BP,tI=IP,nI=kP,Dx=NP,sI=function(){const n=Sx(),e=Lv(1,0,0),t=Lv(0,1,0);return function(s,i,r){const l=Ax(i,r);return l<-.999999?(Su(n,e,i),Ox(n)<1e-6&&Su(n,t,i),tP(n,n),kx(s,n,Math.PI),s):l>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Su(n,i,r),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+l,Dx(s,s))}}();(function(){const n=jv(),e=jv();return function(t,s,i,r,l,c){return Au(n,s,l,c),Au(e,i,r,c),Au(t,n,e,2*c*(1-c)),t}})();(function(){const n=oP();return function(e,t,s,i){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Dx(e,Nx(e,n))}})();const iI=[0,0,0,1];class Hv extends v_{constructor(e=0,t=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,s,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,s,i){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Nx(this,e),this.check()}fromAxisRotation(e,t){return kx(this,e,t),this.check()}identity(){return HP(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ge(e)}get y(){return this[1]}set y(e){this[1]=Ge(e)}get z(){return this[2]}set z(e){this[2]=Ge(e)}get w(){return this[3]}set w(e){this[3]=Ge(e)}len(){return tI(this)}lengthSquared(){return nI(this)}dot(e){return JP(this,e)}rotationTo(e,t){return sI(this,e,t),this.check()}add(e){return QP(this,this,e),this.check()}calculateW(){return YP(this,this),this.check()}conjugate(){return ZP(this,this),this.check()}invert(){return KP(this,this),this.check()}lerp(e,t,s){return s===void 0?this.lerp(this,e,t):(eI(this,e,t,s),this.check())}multiplyRight(e){return $v(this,this,e),this.check()}multiplyLeft(e){return $v(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return WP(this,this,e),this.check()}rotateY(e){return XP(this,this,e),this.check()}rotateZ(e){return qP(this,this,e),this.check()}scale(e){return GP(this,this,e),this.check()}slerp(e,t,s){let i,r,l;switch(arguments.length){case 1:({start:i=iI,target:r,ratio:l}=e);break;case 2:i=this,r=e,l=t;break;default:i=e,r=t,l=s}return Au(this,i,r,l),this.check()}transformVector4(e,t=new w_){return UP(t,e,this),ol(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const rI=1e-15,aI=1e-20;function Bx(n,e=[],t=0){const s=Math.fround(n),i=n-s;return e[t]=s,e[t+1]=i,e}function oI(n){return n-Math.fround(n)}function lI(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let s=0;s<4;++s){const i=t*4+s;Bx(n[s*4+t],e,i*2)}return e}const cI=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,uI={name:"fp32",vs:cI},hI=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,fI={ONE:1},dI={name:"fp64arithmetic",vs:hI,defaultUniforms:fI,uniformTypes:{ONE:"f32"},fp64ify:Bx,fp64LowPart:oI,fp64ifyMatrix4:lI},gI=[0,1,1,1],pI=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,_I=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Wv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:gI},vs:pI,fs:_I,getUniforms:mI};function mI(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const s=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=s}if(n.highlightColor){const s=Array.from(n.highlightColor,i=>i/255);Number.isFinite(s[3])||(s[3]=1),t.highlightColor=s}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Xv=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,yI=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,Ux=3,bI=255;var yl;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(yl||(yl={}));const Eu={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Ux},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:yl.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:yI,vs:Xv,fs:Xv,getUniforms:vI};function vI(n,e={}){if(n=n&&{...n},!n)return{...Eu.defaultUniforms};n.lights&&(n={...n,...wI(n.lights),lights:void 0});const{ambientLight:t,pointLights:s,directionalLights:i}=n||{};if(!(t||s&&s.length>0||i&&i.length>0))return{...Eu.defaultUniforms,enabled:0};const l={...Eu.defaultUniforms,...e,...TI({ambientLight:t,pointLights:s,directionalLights:i})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function TI({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const s={};s.ambientLightColor=xg(n);let i=0;for(const r of e){s.lightType=yl.POINT;const l=i;s[`lightColor${l}`]=xg(r),s[`lightPosition${l}`]=r.position,s[`lightAttenuation${l}`]=r.attenuation||[1,0,0],i++}for(const r of t){s.lightType=yl.DIRECTIONAL;const l=i;s[`lightColor${l}`]=xg(r),s[`lightDirection${l}`]=r.direction,i++}return i>Ux&&ae.warn("MAX_LIGHTS exceeded")(),s.directionalLightCount=t.length,s.pointLightCount=e.length,s}function wI(n){var t,s;const e={pointLights:[],directionalLights:[]};for(const i of n||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(t=e.directionalLights)==null||t.push(i);break;case"point":(s=e.pointLights)==null||s.push(i);break}return e}function xg(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(s=>s*t/bI)}const xI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,SI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Lx={props:{},name:"gouraudMaterial",vs:SI.replace("phongMaterial","gouraudMaterial"),fs:xI.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Eu],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Lx.defaultUniforms,...e}}},qv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,AI={name:"layer",vs:qv,fs:qv,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Fx="#define SMOOTH_EDGE_RADIUS 0.5",EI=`
${Fx}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,RI=`
${Fx}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,zx={name:"geometry",vs:EI,fs:RI},CI=25;var vt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(vt||(vt={}));var St;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(St||(St={}));var Ee;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ee||(Ee={}));const OI="compute",MI="auto",mp="manipulation",Ru="none",yp="pan-x",bp="pan-y";function PI(n){if(n.includes(Ru))return Ru;const e=n.includes(yp),t=n.includes(bp);return e&&t?Ru:e||t?e?yp:bp:n.includes(mp)?mp:MI}class II{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===OI&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return PI(e.join(" "))}}function eh(n){return n.trim().split(/\s+/g)}function Sg(n,e,t){if(n)for(const s of eh(e))n.addEventListener(s,t,!1)}function Ag(n,e,t){if(n)for(const s of eh(e))n.removeEventListener(s,t,!1)}function Yv(n){return(n.ownerDocument||n).defaultView}function kI(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Vx(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,s=0,i=0;for(;i<e;)t+=n[i].clientX,s+=n[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(s/e)}}function Kv(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:Vx(e),deltaX:n.deltaX,deltaY:n.deltaY}}function jx(n,e){const t=e.x-n.x,s=e.y-n.y;return Math.sqrt(t*t+s*s)}function Zv(n,e){const t=e.clientX-n.clientX,s=e.clientY-n.clientY;return Math.sqrt(t*t+s*s)}function NI(n,e){const t=e.x-n.x,s=e.y-n.y;return Math.atan2(s,t)*180/Math.PI}function Qv(n,e){const t=e.clientX-n.clientX,s=e.clientY-n.clientY;return Math.atan2(s,t)*180/Math.PI}function $x(n,e){return n===e?St.None:Math.abs(n)>=Math.abs(e)?n<0?St.Left:St.Right:e<0?St.Up:St.Down}function DI(n,e){const t=e.center;let s=n.offsetDelta,i=n.prevDelta;const r=n.prevInput;return(e.eventType===vt.Start||(r==null?void 0:r.eventType)===vt.End)&&(i=n.prevDelta={x:(r==null?void 0:r.deltaX)||0,y:(r==null?void 0:r.deltaY)||0},s=n.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-s.x),deltaY:i.y+(t.y-s.y)}}function Hx(n,e,t){return{x:e/n||0,y:t/n||0}}function BI(n,e){return Zv(e[0],e[1])/Zv(n[0],n[1])}function UI(n,e){return Qv(e[1],e[0])-Qv(n[1],n[0])}function LI(n,e){const t=n.lastInterval||e,s=e.timeStamp-t.timeStamp;let i,r,l,c;if(e.eventType!==vt.Cancel&&(s>CI||t.velocity===void 0)){const h=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,g=Hx(s,h,d);r=g.x,l=g.y,i=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,c=$x(h,d),n.lastInterval=e}else i=t.velocity,r=t.velocityX,l=t.velocityY,c=t.direction;e.velocity=i,e.velocityX=r,e.velocityY=l,e.direction=c}function FI(n,e){const{session:t}=n,{pointers:s}=e,{length:i}=s;t.firstInput||(t.firstInput=Kv(e)),i>1&&!t.firstMultiple?t.firstMultiple=Kv(e):i===1&&(t.firstMultiple=!1);const{firstInput:r,firstMultiple:l}=t,c=l?l.center:r.center,h=e.center=Vx(s);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=NI(c,h),e.distance=jx(c,h);const{deltaX:d,deltaY:g}=DI(t,e);e.deltaX=d,e.deltaY=g,e.offsetDirection=$x(e.deltaX,e.deltaY);const _=Hx(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?BI(l.pointers,s):1,e.rotation=l?UI(l.pointers,s):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return kI(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,LI(t,e),e}function zI(n,e,t){const s=t.pointers.length,i=t.changedPointers.length,r=e&vt.Start&&s-i===0,l=e&(vt.End|vt.Cancel)&&s-i===0;t.isFirst=!!r,t.isFinal=!!l,r&&(n.session={}),t.eventType=e;const c=FI(n,t);n.emit("hammer.input",c),n.recognize(c),n.session.prevInput=c}let VI=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){zI(this.manager,e,t)}init(){Sg(this.element,this.evEl,this.domHandler),Sg(this.target,this.evTarget,this.domHandler),Sg(Yv(this.element),this.evWin,this.domHandler)}destroy(){Ag(this.element,this.evEl,this.domHandler),Ag(this.target,this.evTarget,this.domHandler),Ag(Yv(this.element),this.evWin,this.domHandler)}};const jI={pointerdown:vt.Start,pointermove:vt.Move,pointerup:vt.End,pointercancel:vt.Cancel,pointerout:vt.Cancel},$I="pointerdown",HI="pointermove pointerup pointercancel";class WI extends VI{constructor(e){super(e),this.evEl=$I,this.evWin=HI,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let s=!1;const i=jI[e.type],r=e.pointerType,l=r==="touch";let c=t.findIndex(h=>h.pointerId===e.pointerId);i&vt.Start&&(e.buttons||l)?c<0&&(t.push(e),c=t.length-1):i&(vt.End|vt.Cancel)&&(s=!0),!(c<0)&&(t[c]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:r,srcEvent:e}),s&&t.splice(c,1))}}const XI=["","webkit","Moz","MS","ms","o"];function qI(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const s of XI){const i=s?s+t:e;if(i in n)return i}}const YI=1,Gv=2,Jv={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class KI{constructor(e,t){this.options={...Jv,...t,cssProps:{...Jv.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new WI(this),this.touchAction=new II(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Gv:YI}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let s;const{recognizers:i}=this;let{curRecognizer:r}=t;(!r||r&&r.state&Ee.Recognized)&&(r=t.curRecognizer=null);let l=0;for(;l<i.length;)s=i[l],t.stopped!==Gv&&(!r||s===r||s.canRecognizeWith(r))?s.recognize(e):s.reset(),!r&&s.state&(Ee.Began|Ee.Changed|Ee.Ended)&&(r=t.curRecognizer=s),l++}get(e){const{recognizers:t}=this;for(let s=0;s<t.length;s++)if(t[s].options.event===e)return t[s];return null}add(e){if(Array.isArray(e)){for(const s of e)this.add(s);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const s of e)this.remove(s);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:s}=this,i=s.indexOf(t);i!==-1&&(s.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:s}=this;for(const i of eh(e))s[i]=s[i]||[],s[i].push(t)}off(e,t){if(!e)return;const{handlers:s}=this;for(const i of eh(e))t?s[i]&&s[i].splice(s[i].indexOf(t),1):delete s[i]}emit(e,t){const s=this.handlers[e]&&this.handlers[e].slice();if(!s||!s.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<s.length;)s[r](i),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[s,i]of Object.entries(this.options.cssProps)){const r=qI(t.style,s);e?(this.oldCssProps[r]=t.style[r],t.style[r]=i):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let ZI=1;function QI(){return ZI++}function eT(n){return n&Ee.Cancelled?"cancel":n&Ee.Ended?"end":n&Ee.Changed?"move":n&Ee.Began?"start":""}class Wx{constructor(e){this.options=e,this.id=QI(),this.state=Ee.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:s}=this;return s[t.id]||(s[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const s of e)this.dropRecognizeWith(s);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:s}=this;return s.indexOf(t)===-1&&(s.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const s of e)this.dropRequireFailure(s);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const s=this.requireFail.indexOf(t);s>-1&&this.requireFail.splice(s,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ee.Ended&&this.manager.emit(this.options.event+eT(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ee.Ended&&this.manager.emit(this.options.event+eT(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ee.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ee.Failed|Ee.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ee.Failed;return}this.state&(Ee.Recognized|Ee.Cancelled|Ee.Failed)&&(this.state=Ee.Possible),this.state=this.process(t),this.state&(Ee.Began|Ee.Changed|Ee.Ended|Ee.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Xx extends Wx{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:s}=e,i=t&(Ee.Began|Ee.Changed),r=this.attrTest(e);return i&&(s&vt.Cancel||!r)?t|Ee.Cancelled:i||r?s&vt.End?t|Ee.Ended:t&Ee.Began?t|Ee.Changed:Ee.Began:Ee.Failed}}class tT extends Wx{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[mp]}process(e){const{options:t}=this,s=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&vt.Start&&this.count===0)return this.failTimeout();if(i&&r&&s){if(e.eventType!==vt.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||jx(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ee.Recognized,this.tryEmit(this._input)},t.interval),Ee.Began):Ee.Recognized}return Ee.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ee.Failed},this.options.interval),Ee.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ee.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const GI=["","start","move","end","cancel","up","down","left","right"];class nT extends Xx{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:St.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&St.Horizontal&&t.push(bp),e&St.Vertical&&t.push(yp),t}getEventNames(){return GI.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let s=!0,{distance:i}=e,{direction:r}=e;const l=e.deltaX,c=e.deltaY;return r&t.direction||(t.direction&St.Horizontal?(r=l===0?St.None:l<0?St.Left:St.Right,s=l!==this.pX,i=Math.abs(e.deltaX)):(r=c===0?St.None:c<0?St.Up:St.Down,s=c!==this.pY,i=Math.abs(e.deltaY))),e.direction=r,s&&i>t.threshold&&!!(r&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ee.Began)||!(this.state&Ee.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=St[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const JI=["","start","move","end","cancel","in","out"];class ek extends Xx{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Ru]}getEventNames(){return JI.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ee.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Rh{constructor(e,t,s){this.element=e,this.callback=t,this.options=s}}const tk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nk=tk.indexOf("firefox")!==-1,sT=4.000244140625,sk=40,ik=.25;class rk extends Rh{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=i=>{if(!this.options.enable)return;let r=i.deltaY;globalThis.WheelEvent&&(nk&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=sk)),r!==0&&r%sT===0&&(r=Math.floor(r/sT)),i.shiftKey&&r&&(r=r*ik),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-r,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const iT=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class ak extends Rh{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,iT.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){iT.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const rT=["keydown","keyup"];class ok extends Rh{constructor(e,t,s){super(e,t,{enable:!0,tabIndex:0,...s}),this.handleEvent=i=>{const r=i.target||i.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",rT.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){rT.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class lk extends Rh{constructor(e,t,s){super(e,t,s),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const aT=1,vp=2,oT=4,ck={pointerdown:aT,pointermove:vp,pointerup:oT,mousedown:aT,mousemove:vp,mouseup:oT},uk=0,hk=1,fk=2,dk=1,gk=2,pk=4;function _k(n){const e=ck[n.srcEvent.type];if(!e)return null;const{buttons:t,button:s}=n.srcEvent;let i=!1,r=!1,l=!1;return e===vp?(i=!!(t&dk),r=!!(t&pk),l=!!(t&gk)):(i=s===uk,r=s===hk,l=s===fk),{leftButton:i,middleButton:r,rightButton:l}}function mk(n,e){const t=n.center;if(!t)return null;const s=e.getBoundingClientRect(),i=s.width/e.offsetWidth||1,r=s.height/e.offsetHeight||1,l={x:(t.x-s.left-e.clientLeft)/i,y:(t.y-s.top-e.clientTop)/r};return{center:t,offsetCenter:l}}const yk={srcElement:"root",priority:0};class bk{constructor(e,t){this.handleEvent=s=>{if(this.isEmpty())return;const i=this._normalizeEvent(s);let r=s.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,s,i=!1,r=!1){const{handlers:l,handlersByElement:c}=this,h={...yk,...s};let d=c.get(h.srcElement);d||(d=[],c.set(h.srcElement,d));const g={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};i&&(g.once=!0),r&&(g.passive=!0),l.push(g),this._active=this._active||!g.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=g.priority);)_--;d.splice(_+1,0,g)}remove(e,t){const{handlers:s,handlersByElement:i}=this;for(let r=s.length-1;r>=0;r--){const l=s[r];if(l.type===e&&l.handler===t){s.splice(r,1);const c=i.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&i.delete(l.srcElement)}}this._active=s.some(r=>!r.passive)}_emit(e,t){const s=this.handlersByElement.get(t);if(s){let i=!1;const r=()=>{e.handled=!0},l=()=>{e.handled=!0,i=!0},c=[];for(let h=0;h<s.length;h++){const{type:d,handler:g,once:_}=s[h];if(g({...e,type:d,stopPropagation:r,stopImmediatePropagation:l}),_&&c.push(s[h]),i)break}for(let h=0;h<c.length;h++){const{type:d,handler:g}=c[h];this.remove(d,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,..._k(e),...mk(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function vk(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const s=t.shift(),i=t.shift()||{};e=new s(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class Tk{constructor(e=null,t={}){if(this._onBasicInput=s=>{this.manager.emit(s.srcEvent.type,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new KI(e,this.options);for(const s of this.options.recognizers){const{recognizer:i,recognizeWith:r,requireFailure:l}=vk(s);this.manager.add(i),r&&i.recognizeWith(r),l&&i.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new rk(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ak(e,this._onOtherEvent,{enable:!1}),this.keyInput=new ok(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new lk(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,s){this._addEventHandler(e,t,s,!1)}once(e,t,s){this._addEventHandler(e,t,s,!0)}watch(e,t,s){this._addEventHandler(e,t,s,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var r,l,c,h;const{manager:s}=this;if(!s)return;const i=s.get(e);i&&(i.set({enable:t}),s.touchAction.update()),(r=this.wheelInput)==null||r.enableEventType(e,t),(l=this.moveInput)==null||l.enableEventType(e,t),(c=this.keyInput)==null||c.enableEventType(e,t),(h=this.contextmenuInput)==null||h.enableEventType(e,t)}_addEventHandler(e,t,s,i,r){if(typeof e!="string"){s=t;for(const[d,g]of Object.entries(e))this._addEventHandler(d,g,s,i,r);return}const{manager:l,events:c}=this;if(!l)return;let h=c.get(e);if(!h){const d=this._getRecognizerName(e)||e;h=new bk(this,d),c.set(e,h),l&&l.on(e,h.handleEvent)}h.add(e,t,s,i,r),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[r,l]of Object.entries(e))this._removeEventHandler(r,l);return}const{events:s}=this,i=s.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:r}=i;let l=!1;for(const c of s.values())if(c.recognizerName===r&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(r,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(s=>s.getEventNames().includes(e)))==null?void 0:t.options.event}}const ze={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ze,"IDENTITY",{get:()=>(De.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const zn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},lr={common:0,meters:1,pixels:2},Tp={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},lT={multipan:[nT,{threshold:10,direction:St.Vertical,pointers:2}],pinch:[ek,{},null,["multipan"]],pan:[nT,{threshold:1},["pinch"],["multipan"]],dblclick:[tT,{event:"dblclick",taps:2}],click:[tT,{event:"click"},null,["dblclick"]]};function wk(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let s=0;s<t;s++)if(n[s]!==e[s])return!1;return!0}return!1}function Ol(n){let e={},t;return s=>{for(const i in s)if(!wk(s[i],e[i])){t=n(s),e=s;break}return t}}const cT=[0,0,0,0],xk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],qx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Sk=[0,0,0],Yx=[0,0,0],Ak=Ol(Ck);function Kx(n,e,t=Yx){t.length<3&&(t=[t[0],t[1],0]);let s=t,i,r=!0;switch(e===ze.LNGLAT_OFFSETS||e===ze.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case zn.WEB_MERCATOR:(e===ze.LNGLAT||e===ze.CARTESIAN)&&(i=[0,0,0],r=!1);break;case zn.WEB_MERCATOR_AUTO_OFFSET:e===ze.LNGLAT?s=i:e===ze.CARTESIAN&&(s=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(s),s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]);break;case zn.IDENTITY:s=n.position.map(Math.fround),s[2]=s[2]||0;break;case zn.GLOBE:r=!1,i=null;break;default:r=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:s,offsetMode:r}}function Ek(n,e,t){const{viewMatrixUncentered:s,projectionMatrix:i}=n;let{viewMatrix:r,viewProjectionMatrix:l}=n,c=cT,h=cT,d=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:y}=Kx(n,e,t);return y&&(h=n.projectPosition(g||_),d=[d[0]-h[0],d[1]-h[1],d[2]-h[2]],h[3]=1,c=Ba([],h,l),r=s||r,l=nr([],i,r),l=nr([],l,xk)),{viewMatrix:r,viewProjectionMatrix:l,projectionCenter:c,originCommon:h,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:g}}function Rk({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:s=ze.DEFAULT,coordinateOrigin:i=Yx,autoWrapLongitude:r=!1}){s===ze.DEFAULT&&(s=n.isGeospatial?ze.LNGLAT:ze.CARTESIAN);const l=Ak({viewport:n,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:i});return l.wrapLongitude=r,l.modelMatrix=t||qx,l}function Ck({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:s}){const{projectionCenter:i,viewProjectionMatrix:r,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:d}=Ek(n,t,s),g=n.getDistanceScales(),_=[n.width*e,n.height*e],y=Ba([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:l.slice(0,3),center:i,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:Sk,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:r,modelMatrix:qx,cameraPosition:c};if(d){const T=n.getDistanceScales(d);switch(t){case ze.METER_OFFSETS:b.commonUnitsPerWorldUnit=T.unitsPerMeter,b.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case ze.LNGLAT:case ze.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=T.unitsPerMeter),b.commonUnitsPerWorldUnit=T.unitsPerDegree,b.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case ze.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return b}const Ok=Object.keys(ze).map(n=>`const int COORDINATE_SYSTEM_${n} = ${ze[n]};`).join(""),Mk=Object.keys(zn).map(n=>`const int PROJECTION_MODE_${n} = ${zn[n]};`).join(""),Pk=Object.keys(lr).map(n=>`const int UNIT_${n.toUpperCase()} = ${lr[n]};`).join(""),Ik=`${Ok}
${Mk}
${Pk}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,kk={};function Nk(n=kk){return"viewport"in n?Rk(n):{}}const A_={name:"project",dependencies:[uI,zx],vs:Ik,getUniforms:Nk,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Dk=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ua={name:"project32",dependencies:[A_],vs:Dk};function Bk(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wa(n,e){const t=Ba([],e,n);return S_(t,t,1/t[3]),t}function uT(n,e){const t=n%e;return t<0?e+t:t}function wp(n,e,t){return n<e?e:n>t?t:n}function Uk(n){return Math.log(n)*Math.LOG2E}const E_=Math.log2||Uk;function Ms(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Vn=Math.PI,Zx=Vn/4,En=Vn/180,xp=180/Vn,Ca=512,th=4003e4,Sp=85.051129,Lk=1.5;function Fk(n){return E_(n)}function Ti(n){const[e,t]=n;Ms(Number.isFinite(e)),Ms(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const s=e*En,i=t*En,r=Ca*(s+Vn)/(2*Vn),l=Ca*(Vn+Math.log(Math.tan(Zx+i*.5)))/(2*Vn);return[r,l]}function Oa(n){const[e,t]=n,s=e/Ca*(2*Vn)-Vn,i=2*(Math.atan(Math.exp(t/Ca*(2*Vn)-Vn))-Zx);return[s*xp,i*xp]}function zk(n){const{latitude:e}=n;Ms(Number.isFinite(e));const t=Math.cos(e*En);return Fk(th*t)-9}function Eg(n){const e=Math.cos(n*En);return Ca/th/e}function Ap(n){const{latitude:e,longitude:t,highPrecision:s=!1}=n;Ms(Number.isFinite(e)&&Number.isFinite(t));const i=Ca,r=Math.cos(e*En),l=i/360,c=l/r,h=i/th/r,d={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[l,c,h],degreesPerUnit:[1/l,1/c,1/h]};if(s){const g=En*Math.tan(e*En)/r,_=l*g/2,y=i/th*g,b=y/c*h;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[b,0,b]}return d}function Qx(n,e){const[t,s,i]=n,[r,l,c]=e,{unitsPerMeter:h,unitsPerMeter2:d}=Ap({longitude:t,latitude:s,highPrecision:!0}),g=Ti(n);g[0]+=r*(h[0]+d[0]*l),g[1]+=l*(h[1]+d[1]*l);const _=Oa(g),y=(i||0)+(c||0);return Number.isFinite(i)||Number.isFinite(c)?[_[0],_[1],y]:_}function Vk(n){const{height:e,pitch:t,bearing:s,altitude:i,scale:r,center:l}=n,c=Bk();Ju(c,c,[0,0,-i]),Px(c,c,-t*En),Ix(c,c,s*En);const h=r/e;return x_(c,c,[h,h,h]),l&&Ju(c,c,eP([],l)),c}function jk(n){const{width:e,height:t,altitude:s,pitch:i=0,offset:r,center:l,scale:c,nearZMultiplier:h=1,farZMultiplier:d=1}=n;let{fovy:g=bl(Lk)}=n;s!==void 0&&(g=bl(s));const _=g*En,y=i*En,b=R_(g);let T=b;l&&(T+=l[2]*c/Math.cos(y)/t);const S=_*(.5+(r?r[1]:0)/t),R=Math.sin(S)*T/Math.sin(wp(Math.PI/2-y-S,.01,Math.PI-.01)),k=Math.sin(y)*R+T,U=T*10,P=Math.min(k*d,U);return{fov:_,aspect:e/t,focalDistance:b,near:h,far:P}}function bl(n){return 2*Math.atan(.5/n)*xp}function R_(n){return .5/Math.tan(.5*n*En)}function Gx(n,e){const[t,s,i=0]=n;return Ms(Number.isFinite(t)&&Number.isFinite(s)&&Number.isFinite(i)),wa(e,[t,s,i,1])}function C_(n,e,t=0){const[s,i,r]=n;if(Ms(Number.isFinite(s)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(r))return wa(e,[s,i,r,1]);const l=wa(e,[s,i,0,1]),c=wa(e,[s,i,1,1]),h=l[2],d=c[2],g=h===d?0:((t||0)-h)/(d-h);return Tx([],l,c,g)}function $k(n){const{width:e,height:t,bounds:s,minExtent:i=0,maxZoom:r=24,offset:l=[0,0]}=n,[[c,h],[d,g]]=s,_=Hk(n.padding),y=Ti([c,wp(g,-85.051129,Sp)]),b=Ti([d,wp(h,-85.051129,Sp)]),T=[Math.max(Math.abs(b[0]-y[0]),i),Math.max(Math.abs(b[1]-y[1]),i)],S=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];Ms(S[0]>0&&S[1]>0);const R=S[0]/T[0],k=S[1]/T[1],U=(_.right-_.left)/2/R,P=(_.top-_.bottom)/2/k,D=[(b[0]+y[0])/2+U,(b[1]+y[1])/2+P],$=Oa(D),Z=Math.min(r,E_(Math.abs(Math.min(R,k))));return Ms(Number.isFinite(Z)),{longitude:$[0],latitude:$[1],zoom:Z}}function Hk(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Ms(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const hT=Math.PI/180;function Wk(n,e=0){const{width:t,height:s,unproject:i}=n,r={targetZ:e},l=i([0,s],r),c=i([t,s],r);let h,d;const g=n.fovy?.5*n.fovy*hT:Math.atan(.5/n.altitude),_=(90-n.pitch)*hT;return g>_-.01?(h=fT(n,0,e),d=fT(n,t,e)):(h=i([0,0],r),d=i([t,0],r)),[l,c,d,h]}function fT(n,e,t){const{pixelUnprojectionMatrix:s}=n,i=wa(s,[e,0,1,1]),r=wa(s,[e,n.height,1,1]),c=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(r[2]-i[2]),h=Tx([],i,r,c),d=Oa(h);return d.push(t),d}const dT=512;function Xk(n){const{width:e,height:t,pitch:s=0}=n;let{longitude:i,latitude:r,zoom:l,bearing:c=0}=n;(i<-180||i>180)&&(i=uT(i+180,360)-180),(c<-180||c>180)&&(c=uT(c+180,360)-180);const h=E_(t/dT);if(l<=h)l=h,r=0;else{const d=t/2/Math.pow(2,l),g=Oa([0,d])[1];if(r<g)r=g;else{const _=Oa([0,dT-d])[1];r>_&&(r=_)}}return{width:e,height:t,longitude:i,latitude:r,zoom:l,pitch:s,bearing:c}}const Jx=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,qk=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Yk=`
${Jx}
${qk}
`,Kk=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Zk=`
${Jx}
${Kk}
`,Qk=Ol(n4),Gk=Ol(s4),Jk=[0,0,0,1],e4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function t4(n,e){const[t,s,i]=n,r=C_([t,s,i],e);return Number.isFinite(i)?r:[r[0],r[1],0]}function n4({viewport:n,center:e}){return new Zt(n.viewProjectionMatrix).invert().transform(e)}function s4({viewport:n,shadowMatrices:e}){const t=[],s=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,r=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>t4(l,s));for(const l of e){const c=l.clone().translate(new he(n.center).negate()),h=r.map(g=>c.transform(g)),d=new Zt().ortho({left:Math.min(...h.map(g=>g[0])),right:Math.max(...h.map(g=>g[0])),bottom:Math.min(...h.map(g=>g[1])),top:Math.max(...h.map(g=>g[1])),near:Math.min(...h.map(g=>-g[2])),far:Math.max(...h.map(g=>-g[2]))});t.push(d.multiplyRight(l))}return t}function i4(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const s=A_.getUniforms(t),i=Qk({viewport:t.viewport,center:s.center}),r=[],l=Gk({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const d=l[h],g=d.clone().translate(new he(t.viewport.center).negate());s.coordinateSystem===ze.LNGLAT&&s.projectionMode===zn.WEB_MERCATOR?(l[h]=g,r[h]=i):(l[h]=d.clone().multiplyRight(e4),r[h]=g.transform(i))}const c={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||Jk,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<l.length;h++)c[`viewProjectionMatrix${h}`]=l[h],c[`projectCenter${h}`]=r[h];for(let h=0;h<2;h++)c[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return c}const gT={name:"shadow",dependencies:[A_],vs:Yk,fs:Zk,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:i4,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},La={...Wv,defaultUniforms:{...Wv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},r4=[zx],a4=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],o4=[];function l4(n){const e=Vu.getDefaultShaderAssembler();for(const s of r4)e.addDefaultModule(s);const t=n==="glsl"?a4:o4;for(const s of t)e.addShaderHook(s);return e}const c4=[255,255,255],u4=1;let h4=0;class f4{constructor(e={}){this.type="ambient";const{color:t=c4}=e,{intensity:s=u4}=e;this.id=e.id||`ambient-${h4++}`,this.color=t,this.intensity=s}}const d4=[255,255,255],g4=1,p4=[0,0,-1];let _4=0;class pT{constructor(e={}){this.type="directional";const{color:t=d4}=e,{intensity:s=g4}=e,{direction:i=p4}=e,{_shadow:r=!1}=e;this.id=e.id||`directional-${_4++}`,this.color=t,this.intensity=s,this.type="directional",this.direction=new he(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class m4{constructor(e,t={id:"pass"}){const{id:s}=t;this.id=s,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class O_ extends m4{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,s]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,r=e.clearColor??(i?[0,0,0,0]:!1),l=i?1:!1,c=i?0:!1,h=e.colorMask??15,d={viewport:[0,0,t,s]};e.colorMask&&(d.colorMask=h),e.scissorRect&&(d.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:r,clearDepth:l,clearStencil:c});try{return this._drawLayers(g,e)}finally{g.end(),this.device.submit()}}_drawLayers(e,t){const{target:s,shaderModuleProps:i,viewports:r,views:l,onViewportActive:c,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const d=[];for(const g of r){const _=l&&l[g.id];c==null||c(g);const y=this._getDrawLayerParams(g,t),b=g.subViewports||[g];for(const T of b){const S=this._drawLayersInViewport(e,{target:s,shaderModuleProps:i,viewport:T,view:_,pass:t.pass,layers:t.layers},y);d.push(S)}}return d}_getDrawLayerParams(e,{layers:t,pass:s,isPicking:i=!1,layerFilter:r,cullRect:l,effects:c,shaderModuleProps:h},d=!1){var T;const g=[],_=eS(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:i,renderPass:s,cullRect:l},b={};for(let S=0;S<t.length;S++){const R=t[S],k=this._shouldDrawLayer(R,y,r,b),U={shouldDrawLayer:k};k&&!d&&(U.shouldDrawLayer=!0,U.layerRenderIndex=_(R,k),U.shaderModuleProps=this._getShaderModuleProps(R,c,s,h),U.layerParameters={...(T=R.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(R,S,e)}),g[S]=U}return g}_drawLayersInViewport(e,{layers:t,shaderModuleProps:s,pass:i,target:r,viewport:l,view:c},h){const d=y4(this.device,{shaderModuleProps:s,target:r,viewport:l});if(c&&c.props.clear){const _=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:r,parameters:{viewport:d,scissorRect:d},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<t.length;_++){const y=t[_],b=h[_],{shouldDrawLayer:T}=b;if(T&&y.props.pickable&&g.pickableCount++,y.isComposite&&g.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:R,layerParameters:k}=b;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),R.project&&(R.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:R,uniforms:{layerIndex:S},parameters:k})}catch(U){y.raiseError(U,`drawing ${y} to ${i}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,s){return null}getLayerParameters(e,t,s){return e.props.parameters}_shouldDrawLayer(e,t,s,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(s){const c=t.layer.id;if(c in i||(i[c]=s(t)),!i[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,s,i){var h,d;const r=this.device.canvasContext.cssToDeviceRatio(),l=((h=e.internalState)==null?void 0:h.propsInTransition)||e.props,c={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:r,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const g of t)_T(c,(d=g.getShaderModuleProps)==null?void 0:d.call(g,e,c));return _T(c,this.getShaderModuleProps(e,t,c),i)}}function eS(n=0,e={}){const t={},s=(i,r)=>{const l=i.props._offset,c=i.id,h=i.parent&&i.parent.id;let d;if(h&&!(h in e)&&s(i.parent,!1),h in t){const g=t[h]=t[h]||eS(e[h],e);d=g(i,r),t[c]=g}else Number.isFinite(l)?(d=l+(e[h]||0),t[c]=null):d=n;return r&&d>=n&&(n=d+1),e[c]=d,d};return s}function y4(n,{shaderModuleProps:e,target:t,viewport:s}){var h;const i=((h=e==null?void 0:e.project)==null?void 0:h.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,r]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:r,c=s;return[c.x*i,l-(c.y+c.height)*i,c.width*i,c.height*i,0,1]}function _T(n,...e){for(const t of e)if(t)for(const s in t)n[s]?Object.assign(n[s],t[s]):n[s]=t[s];return n}class b4 extends O_{constructor(e,t){super(e,t);const s=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[s],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,s=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*s,l=i.height*s,c=[1,1,1,1];(r!==t.width||l!==t.height)&&t.resize({width:r,height:l}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,s){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,s){return{shadow:{project:s.project,drawToShadowMap:!0}}}}const v4={color:[255,255,255],intensity:1},mT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],T4=[0,0,0,200/255];class tS{constructor(e={}){this.id="lighting-effect",this.shadowColor=T4,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:s}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),s._addDefaultShaderModule(gT),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const s=e[t];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:s,onViewportActive:i,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:s,onViewportActive:i,views:r,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const s=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:s,lighting:i,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(gT))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const s=new Zt().lookAt({eye:new he(t.direction).negate()});e.push(s)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const s=new b4(e);this.shadowPasses[t]=s}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:s}=this;!e&&t.length===0&&s.length===0&&(this.ambientLight=new f4(v4),this.directionalLights.push(new pT(mT[0]),new pT(mT[1])))}}class w4{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:s=1,type:i,padding:r=0,copy:l=!1,initialize:c=!1,maxCount:h}){const d=i||e&&e.constructor||Float32Array,g=t*s+r;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,g)}let _=1/0;h&&(_=h*s+r);const y=this._allocate(d,g,c,_);return e&&l?y.set(e):c||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,s,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const l=this._pool,c=e.BYTES_PER_ELEMENT*r,h=l.findIndex(d=>d.byteLength>=c);if(h>=0){const d=new e(l.splice(h,1)[0],0,r);return s&&d.fill(0),d}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:s}=e,{byteLength:i}=s,r=t.findIndex(l=>l.byteLength>=i);r<0?t.push(s):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,s),t.length>this.opts.poolSize&&t.shift()}}const Ma=new w4;function Qo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x4(n){return[n[12],n[13],n[14]]}function S4(n){return{left:ta(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:ta(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:ta(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:ta(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:ta(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:ta(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const yT=new he;function ta(n,e,t,s){yT.set(n,e,t);const i=yT.len();return{distance:s/i,normal:new he(-n/i,-e/i,-t/i)}}function A4(n){return n-Math.fround(n)}let jo;function Rg(n,e){const{size:t=1,startIndex:s=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,r=(i-s)/t;jo=Ma.allocate(jo,r,{type:Float32Array,size:t*2});let l=s,c=0;for(;l<i;){for(let h=0;h<t;h++){const d=n[l++];jo[c+h]=d,jo[c+h+t]=A4(d)}c+=t*2}return jo.subarray(0,r*t*2)}function E4(n){let e=null,t=!1;for(const s of n)s&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],s[0][0]),e[0][1]=Math.min(e[0][1],s[0][1]),e[1][0]=Math.max(e[1][0],s[1][0]),e[1][1]=Math.max(e[1][1],s[1][1])):e=s);return e}const R4=Math.PI/180,C4=Qo(),bT=[0,0,0],O4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function M4({width:n,height:e,orthographic:t,fovyRadians:s,focalDistance:i,padding:r,near:l,far:c}){const h=n/e,d=t?new Zt().orthographic({fovy:s,aspect:h,focalDistance:i,near:l,far:c}):new Zt().perspective({fovy:s,aspect:h,near:l,far:c});if(r){const{left:g=0,right:_=0,top:y=0,bottom:b=0}=r,T=gi((g+n-_)/2,0,n)-n/2,S=gi((y+e-b)/2,0,e)-e/2;d[8]-=T*2/n,d[9]+=S*2/e}return d}class Fa{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||O4,this.focalDistance=e.focalDistance||1,this.position=e.position||bT,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:s}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?zn.WEB_MERCATOR:zn.WEB_MERCATOR_AUTO_OFFSET:zn.IDENTITY}equals(e){return e instanceof Fa?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Os(e.projectionMatrix,this.projectionMatrix)&&Os(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const s=this.projectPosition(e),i=Gx(s,this.pixelProjectionMatrix),[r,l]=i,c=t?l:this.height-l;return e.length===2?[r,c]:[r,c,i[2]]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[i,r,l]=e,c=t?r:this.height-r,h=s&&s*this.distanceScales.unitsPerMeter[2],d=C_([i,c,l],this.pixelUnprojectionMatrix,h),[g,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[g,_,y]:Number.isFinite(s)?[g,_,s]:[g,_]}projectPosition(e){const[t,s]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,s,i]}unprojectPosition(e){const[t,s]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,s,i]}projectFlat(e){if(this.isGeospatial){const t=Ti(e);return t[1]=gi(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Oa(e):e}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(s[0],i[0],r[0],l[0]),Math.min(s[1],i[1],r[1],l[1]),Math.max(s[0],i[0],r[0],l[0]),Math.max(s[1],i[1],r[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?Ap({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:s=1,height:i=1}){return e<this.x+this.width&&this.x<e+s&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,S4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,s=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=zk({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Ap({latitude:s,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:l}=e;let c=bT;if(r&&(c=l?new Zt(l).transformAsVector(r,[]):r),this.isGeospatial){const h=this.projectPosition([t,s,0]);this.center=new he(c).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=C4,projectionMatrix:s=null,orthographic:i=!1,fovyRadians:r,fovy:l=75,near:c=.1,far:h=1e3,padding:d=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Zt().multiplyRight(t).translate(new he(this.center).negate()),this.projectionMatrix=s||M4({width:this.width,height:this.height,orthographic:i,fovyRadians:r||l*R4,focalDistance:g,padding:d,near:c,far:h});const _=Qo();nr(_,_,this.projectionMatrix),nr(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=pp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x4(this.viewMatrixInverse);const y=Qo(),b=Qo();x_(y,y,[this.width/2,-this.height/2,1]),Ju(y,y,[1,-1,0]),nr(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=pp(Qo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||De.warn("Pixel project matrix not invertible")()}}Fa.displayName="Viewport";class wi extends Fa{constructor(e={}){const{latitude:t=0,longitude:s=0,zoom:i=0,pitch:r=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:h=1.01,nearZ:d,farZ:g,orthographic:_=!1,projectionMatrix:y,repeat:b=!1,worldOffset:T=0,position:S,padding:R,legacyMeterSizes:k=!1}=e;let{width:U,height:P,altitude:D=1.5}=e;const $=Math.pow(2,i);U=U||1,P=P||1;let Z,fe=null;if(y)D=y[5]/2,Z=bl(D);else{e.fovy?(Z=e.fovy,D=R_(Z)):Z=bl(D);let J;if(R){const{top:oe=0,bottom:de=0}=R;J=[0,gi((oe+P-de)/2,0,P)-P/2]}fe=jk({width:U,height:P,scale:$,center:S&&[0,0,S[2]*Eg(t)],offset:J,pitch:r,fovy:Z,nearZMultiplier:c,farZMultiplier:h}),Number.isFinite(d)&&(fe.near=d),Number.isFinite(g)&&(fe.far=g)}let ue=Vk({height:P,pitch:r,bearing:l,scale:$,altitude:D});T&&(ue=new Zt().translate([512*T,0,0]).multiplyLeft(ue)),super({...e,width:U,height:P,viewMatrix:ue,longitude:s,latitude:t,zoom:i,...fe,fovy:Z,focalDistance:D}),this.latitude=t,this.longitude=s,this.zoom=i,this.pitch=r,this.bearing=l,this.altitude=D,this.fovy=Z,this.orthographic=_,this._subViewports=b?[]:null,this._pseudoMeters=k,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),s=Math.ceil((e[2]-180)/360);for(let i=t;i<=s;i++){const r=i?new wi({...this,worldOffset:i}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,s]=this.projectFlat(e),i=(e[2]||0)*Eg(e[1]);return[t,s,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,s]=this.unprojectFlat(e),i=(e[2]||0)/Eg(s);return[t,s,i]}addMetersToLngLat(e,t){return Qx(e,t)}panByPosition(e,t){const s=C_(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),r=Uv([],i,WM([],s)),l=Uv([],this.center,r),[c,h]=this.unprojectFlat(l);return{longitude:c,latitude:h}}getBounds(e={}){const t=Wk(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:s,height:i}=this,{longitude:r,latitude:l,zoom:c}=$k({width:s,height:i,bounds:e,...t});return new wi({width:s,height:i,longitude:r,latitude:l,zoom:c})}}wi.displayName="WebMercatorViewport";const vT=[0,0,0];function Cg(n,e,t=!1){const s=e.projectPosition(n);if(t&&e instanceof wi){const[i,r,l=0]=n,c=e.getDistanceScales([i,r]);s[2]=l*c.unitsPerMeter[2]}return s}function P4(n){const{viewport:e,modelMatrix:t,coordinateOrigin:s}=n;let{coordinateSystem:i,fromCoordinateSystem:r,fromCoordinateOrigin:l}=n;return i===ze.DEFAULT&&(i=e.isGeospatial?ze.LNGLAT:ze.CARTESIAN),r===void 0&&(r=i),l===void 0&&(l=s),{viewport:e,coordinateSystem:i,coordinateOrigin:s,modelMatrix:t,fromCoordinateSystem:r,fromCoordinateOrigin:l}}function nS(n,{viewport:e,modelMatrix:t,coordinateSystem:s,coordinateOrigin:i,offsetMode:r}){let[l,c,h=0]=n;switch(t&&([l,c,h]=Ba([],[l,c,h,1],t)),s){case ze.LNGLAT:return Cg([l,c,h],e,r);case ze.LNGLAT_OFFSETS:return Cg([l+i[0],c+i[1],h+(i[2]||0)],e,r);case ze.METER_OFFSETS:return Cg(Qx(i,[l,c,h]),e,r);case ze.CARTESIAN:default:return e.isGeospatial?[l+i[0],c+i[1],h+i[2]]:e.projectPosition([l,c,h])}}function I4(n,e){const{viewport:t,coordinateSystem:s,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:l,fromCoordinateOrigin:c}=P4(e),{autoOffset:h=!0}=e,{geospatialOrigin:d=vT,shaderCoordinateOrigin:g=vT,offsetMode:_=!1}=h?Kx(t,s,i):{},y=nS(n,{viewport:t,modelMatrix:r,coordinateSystem:l,coordinateOrigin:c,offsetMode:_});if(_){const b=t.projectPosition(d||g);Cx(y,y,b)}return y}let k4=1,N4=1;class sS{constructor(){w(this,"time",0);w(this,"channels",new Map);w(this,"animations",new Map);w(this,"playing",!1);w(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:s=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,l=k4++,c={time:0,delay:t,duration:s,rate:i,repeat:r};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(e){this.channels.delete(e);for(const[t,s]of this.animations)s.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const s=this.animations.values();for(const i of s){const{animation:r,channel:l}=i;r.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const s=N4++;return this.animations.set(s,{animation:e,channel:t}),e.setTime(this.getTime(t)),s}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const s=t-e.delay,i=e.duration*e.repeat;s>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,s)%e.duration,e.time*=e.rate)}}function D4(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function B4(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let U4=0;const L4={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:ip.stats.get(`animation-loop-${U4++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class F4{constructor(e){w(this,"device",null);w(this,"canvas",null);w(this,"props");w(this,"animationProps",null);w(this,"timeline",null);w(this,"stats");w(this,"cpuTime");w(this,"gpuTime");w(this,"frameRate");w(this,"display");w(this,"needsRedraw","initialized");w(this,"_initialized",!1);w(this,"_running",!1);w(this,"_animationFrameId",null);w(this,"_nextFramePromise",null);w(this,"_resolveNextFrame",null);w(this,"_cpuStartTime",0);w(this,"_error",null);if(this.props={...L4,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new El({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var s,i;if(this.props.onError(e),this._error=Error(),((i=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=D4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(B4(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,s;const e=(s=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:s.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:s}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),s!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=s,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const s=this.props.onAddHTML(t);s&&(t.innerHTML=s)}}_getSizeAndAspect(){var r,l,c,h;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((l=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:l.getPixelSize())||[1,1];let s=1;const i=(h=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:h.canvas;return i&&i.clientHeight?s=i.clientWidth/i.clientHeight:e>0&&t>0&&(s=e/t),{width:e,height:t,aspect:s}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Og={};function Ch(n="id"){Og[n]=Og[n]||1;const e=Og[n]++;return`${n}-${e}`}class TT{constructor(e){w(this,"id");w(this,"userData",{});w(this,"topology");w(this,"bufferLayout",[]);w(this,"vertexCount");w(this,"indices");w(this,"attributes");if(this.id=e.id||Ch("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&at.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function z4(n,e){if(e instanceof TT)return e;const t=V4(n,e),{attributes:s,bufferLayout:i}=j4(n,e);return new TT({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:s})}function V4(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:at.INDEX,data:t})}function j4(n,e){const t=[],s={};for(const[r,l]of Object.entries(e.attributes)){let c=r;switch(r){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){s[c]=n.createBuffer({data:l.value,id:`${r}-buffer`});const{value:h,size:d,normalized:g}=l;t.push({name:c,format:oM(h,d,g)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:s,bufferLayout:t,vertexCount:i}}const wh=class wh{constructor(e){w(this,"device");w(this,"destroyPolicy");w(this,"_hashCounter",0);w(this,"_hashes",{});w(this,"_renderPipelineCache",{});w(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new wh(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Ea.defaultProps,...e},s=this._hashRenderPipeline(t);if(!this._renderPipelineCache[s]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=s,this._renderPipelineCache[s]={pipeline:i,useCount:0}}return this._renderPipelineCache[s].useCount++,this._renderPipelineCache[s].pipeline}createComputePipeline(e){const t={...Xu.defaultProps,...e},s=this._hashComputePipeline(t);if(!this._computePipelineCache[s]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=s,this._computePipelineCache[s]={pipeline:i,useCount:0}}return this._computePipelineCache[s].useCount++,this._computePipelineCache[s].pipeline}release(e){const t=e.hash,s=e instanceof Xu?this._computePipelineCache:this._renderPipelineCache;s[t].useCount--,s[t].useCount===0&&this.destroyPolicy==="unused"&&(s[t].pipeline.destroy(),delete s[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,s=e.fs?this._getHash(e.fs.source):0,i="-",r=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${s}V${i}BL${r}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${t}/${s}V${i}T${e.topology}P${l}BL${r}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};w(wh,"defaultProps",{...Ea.defaultProps});let Ep=wh;const xh=class xh{constructor(e){w(this,"device");w(this,"destroyPolicy");w(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new xh(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let s=this._cache[t];if(!s){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=s={shader:i,useCount:0}}return s.useCount++,s.shader}release(e){const t=this._hashShader(e),s=this._cache[t];s&&(s.useCount--,s.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],s.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};w(xh,"defaultProps",{...$u.defaultProps});let Rp=xh;function $4(n,e){var i;const t={},s="Values";if(n.attributes.length===0&&!((i=n.varyings)!=null&&i.length))return{"No attributes or varyings":{[s]:"N/A"}};for(const r of n.attributes)if(r){const l=`${r.location} ${r.name}: ${r.type}`;t[`in ${l}`]={[s]:r.stepMode||"vertex"}}for(const r of n.varyings||[]){const l=`${r.location} ${r.name}`;t[`out ${l}`]={[s]:JSON.stringify(r)}}return t}let Ot=null,Xi=null;function H4(n,{id:e,minimap:t,opaque:s,top:i="0",left:r="0",rgbaScale:l=1}){Ot||(Ot=document.createElement("canvas"),Ot.id=e,Ot.title=e,Ot.style.zIndex="100",Ot.style.position="absolute",Ot.style.top=i,Ot.style.left=r,Ot.style.border="blue 5px solid",Ot.style.transform="scaleY(-1)",document.body.appendChild(Ot),Xi=Ot.getContext("2d")),(Ot.width!==n.width||Ot.height!==n.height)&&(Ot.width=n.width/2,Ot.height=n.height/2,Ot.style.width="400px",Ot.style.height="400px");const c=n.device.readPixelsToArrayWebGL(n),h=Xi==null?void 0:Xi.createImageData(n.width,n.height);if(h){for(let g=0;g<c.length;g+=4)h.data[0+g+0]=c[g+0]*l,h.data[0+g+1]=c[g+1]*l,h.data[0+g+2]=c[g+2]*l,h.data[0+g+3]=s?255:c[g+3]*l;Xi==null||Xi.putImageData(h,0,0)}}function Cp(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!Cp(n[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const s=Object.keys(n),i=Object.keys(e);if(s.length!==i.length)return!1;for(const r of s)if(!e.hasOwnProperty(r)||!Cp(n[r],e[r],t-1))return!1;return!0}return!1}function W4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function X4(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function iS(n){return W4(n)||X4(n)}function q4(n){return iS(n)||typeof n=="number"||typeof n=="boolean"}function rS(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const s=n[t];q4(s)?e.uniforms[t]=s:e.bindings[t]=s}),e}class Y4{constructor(e,t){w(this,"options",{disableWarnings:!1});w(this,"modules");w(this,"moduleUniforms");w(this,"moduleBindings");Object.assign(this.options,t);const s=u_(Object.values(e).filter(i=>i.dependencies));for(const i of s)e[i.name]=i;ae.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,r]of Object.entries(e))this._addModule(r),r.name&&i!==r.name&&!this.options.disableWarnings&&ae.warn(`Module name: ${i} vs ${r.name}`)()}destroy(){}setProps(e){var t;for(const s of Object.keys(e)){const i=s,r=e[i]||{},l=this.modules[i];if(!l){this.options.disableWarnings||ae.warn(`Module ${s} not found`)();continue}const c=this.moduleUniforms[i],h=this.moduleBindings[i],d=((t=l.getUniforms)==null?void 0:t.call(l,r,c))||r,{uniforms:g,bindings:_}=rS(d);this.moduleUniforms[i]={...c,...g},this.moduleBindings[i]={...h,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[s,i]of Object.entries(this.moduleUniforms))for(const[r,l]of Object.entries(i))e[`${s}.${r}`]={type:(t=this.modules[s].uniformTypes)==null?void 0:t[r],value:String(l)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let K4="";async function Z4(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:K4+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Mg{constructor(e,t){w(this,"device");w(this,"id");w(this,"texture");w(this,"sampler");w(this,"view");w(this,"ready");w(this,"isReady",!1);w(this,"destroyed",!1);w(this,"resolveReady",()=>{});w(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Ch("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:Z4(t.data)}),this.ready=new Promise((s,i)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,s;const i=e.data,r=await aS(i).then(t,s);if(this.destroyed)return;const l={...e,data:r};this.texture=this.device.createTexture(l),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function aS(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(aS));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),s=Object.keys(e),i={};for(let r=0;r<s.length;r++)i[s[r]]=t[r];return i}return n}const qi=2,Q4=1e4,Sh=class Sh{constructor(e,t){w(this,"device");w(this,"id");w(this,"source");w(this,"vs");w(this,"fs");w(this,"pipelineFactory");w(this,"shaderFactory");w(this,"userData",{});w(this,"parameters");w(this,"topology");w(this,"bufferLayout");w(this,"isInstanced");w(this,"instanceCount",0);w(this,"vertexCount");w(this,"indexBuffer",null);w(this,"bufferAttributes",{});w(this,"constantAttributes",{});w(this,"bindings",{});w(this,"uniforms",{});w(this,"vertexArray");w(this,"transformFeedback",null);w(this,"pipeline");w(this,"shaderInputs");w(this,"_uniformStore");w(this,"_attributeInfos",{});w(this,"_gpuGeometry",null);w(this,"_getModuleUniforms");w(this,"props");w(this,"_pipelineNeedsUpdate","newly created");w(this,"_needsRedraw","initializing");w(this,"_destroyed",!1);w(this,"_lastDrawTimestamp",-1);w(this,"_lastLogTime",0);w(this,"_logOpen",!1);w(this,"_drawCount",0);var h,d,g,_;this.props={...Sh.defaultProps,...t},t=this.props,this.id=t.id||Ch("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries(((h=this.props.modules)==null?void 0:h.map(y=>[y.name,y]))||[]),i=t.shaderInputs||new Y4(s,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const r=J4(e),l=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(g=this.shaderInputs)==null?void 0:g.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:y,getUniforms:b}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:l});this.source=y,this._getModuleUniforms=b,(_=this.props).shaderLayout||(_.shaderLayout=BM(this.source))}else{const{vs:y,fs:b,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:l});this.vs=y,this.fs=b,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Ep.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Rp.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ae.info(qi,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let s;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),Op(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,l=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;s=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),s?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",s}setGeometry(e){var s;(s=this._gpuGeometry)==null||s.destroy();const t=e&&z4(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new pg(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new pg(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Cp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new aM(this.shaderInputs.modules);for(const[t,s]of Object.entries(this.shaderInputs.modules))if(G4(s)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const s=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ae.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new pg(this.bufferLayout);for(const[r,l]of Object.entries(e)){const c=i.getBufferLayout(r);if(!c){s||ae.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const h=i.getAttributeNamesForBuffer(c);let d=!1;for(const g of h){const _=this._attributeInfos[g];_&&(this.vertexArray.setBuffer(_.location,l),d=!0)}!d&&!s&&ae.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[s,i]of Object.entries(e)){const r=this._attributeInfos[s];r?this.vertexArray.setConstantWebGL(r.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ae.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${s}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Op(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:s}=rS(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,s),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Mg&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,s]of Object.entries(this.bindings))s instanceof Mg?s.isReady&&(e[t]=s.texture):e[t]=s;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof ju?e=Math.max(e,t.texture.updateTimestamp):t instanceof at||t instanceof ht?e=Math.max(e,t.updateTimestamp):t instanceof Mg?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Hu||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[s]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===s)&&s!=="positions"&&delete t[s];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ae.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const s=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=s:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:s,fs:i}),this._attributeInfos=Kw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ae.level>3?0:Q4;ae.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ae.group(qi,`>>> DRAWING MODEL ${this.id}`,{collapsed:ae.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=$4(this.pipeline.shaderLayout,this.id);ae.table(qi,e)();const t=this.shaderInputs.getDebugTable();for(const[i,r]of Object.entries(this.uniforms))t[i]={value:r};ae.table(qi,t)();const s=this._getAttributeDebugTable();ae.table(qi,this._attributeInfos)(),ae.table(qi,s)(),ae.groupEnd(qi)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const s=e.props.framebuffer;s&&H4(s,{id:s.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,s]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[s.location];e[s.location]={name:t,type:s.shaderType,values:i?this._getBufferOrConstantValues(i,s.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,s=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:s.toString()}}return e}_getBufferOrConstantValues(e,t){const s=Gw(t);return(e instanceof at?new s(e.debugData):e).toString()}};w(Sh,"defaultProps",{...Ea.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Vu.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Rn=Sh;function G4(n){return!!(n.uniformTypes&&!Op(n.uniformTypes))}function J4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Op(n){for(const e in n)return!1;return!0}const pl=class pl{constructor(e,t=pl.defaultProps){w(this,"device");w(this,"model");w(this,"transformFeedback");if(!pl.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Rn(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||cO(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof at)return t.readAsync();const{buffer:s,byteOffset:i=0,byteLength:r=s.byteLength}=t;return s.readAsync(i,r)}};w(pl,"defaultProps",{...Rn.defaultProps,outputs:void 0,feedbackBuffers:void 0});let vl=pl;class Pa{constructor(e){w(this,"id");w(this,"topology");w(this,"vertexCount");w(this,"indices");w(this,"attributes");w(this,"userData",{});const{attributes:t={},indices:s=null,vertexCount:i=null}=e;this.id=e.id||Ch("geometry"),this.topology=e.topology,s&&(this.indices=ArrayBuffer.isView(s)?{value:s,size:1}:s),this.attributes={};for(const[r,l]of Object.entries(t)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(r)}: must be typed array or object with value as typed array`);if((r==="POSITION"||r==="positions")&&!c.size&&(c.size=3),r==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[r]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let s=1/0;for(const i of Object.values(e)){const{value:r,size:l,constant:c}=i;!c&&r&&l!==void 0&&l>=1&&(s=Math.min(s,r.length/l))}return s}}const eN={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class oS extends O_{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:s,viewports:i,onViewportActive:r,pickingFBO:l,deviceRect:{x:c,y:h,width:d,height:g},cullRect:_,effects:y,pass:b="picking",pickZ:T,shaderModuleProps:S}){this.pickZ=T;const R=this._resetColorEncoder(T),k=[c,h,d,g],U=super.render({target:l,layers:e,layerFilter:t,views:s,viewports:i,onViewportActive:r,cullRect:_,effects:y==null?void 0:y.filter(D=>D.useInPicking),pass:b,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:k});return this._colorEncoderState=null,{decodePickingColor:R&&nN.bind(null,R),stats:U}}shouldDrawLayer(e){const{pickable:t,operation:s}=e.props;return t&&s.includes("draw")||s.includes("terrain")||s.includes("mask")}getShaderModuleProps(e,t,s){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,s){const i={...e.props.parameters},{pickable:r,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?i.blend=!1:r&&l.includes("draw")&&(Object.assign(i,eN),i.blend=!0,i.blendColor=tN(this._colorEncoderState,e,s)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function tN(n,e,t){const{byLayer:s,byAlpha:i}=n;let r,l=s.get(e);return l?(l.viewports.push(t),r=l.a):(r=s.size+1,r<=255?(l={a:r,layer:e,viewports:[t]},s.set(e,l),i[r]=l):(De.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function nN(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const ha={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},nh=Symbol.for("component"),bi=Symbol.for("propTypes"),Pg=Symbol.for("deprecatedProps"),xa=Symbol.for("asyncPropDefaults"),cr=Symbol.for("asyncPropOriginal"),pi=Symbol.for("asyncPropResolved");function Oh(n,e=()=>!0){return Array.isArray(n)?lS(n,e,[]):e(n)?[n]:[]}function lS(n,e,t){let s=-1;for(;++s<n.length;){const i=n[s];Array.isArray(i)?lS(i,e,t):e(i)&&t.push(i)}return t}function sN({target:n,source:e,start:t=0,count:s=1}){const i=e.length,r=s*i;let l=0;for(let c=t;l<i;l++)n[c++]=e[l];for(;l<r;)l<r-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+r-l),l=r);return n}class iN{constructor(e,t,s){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=s,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const s=++this._loadCount;let i=e;typeof e=="string"&&(i=Lu(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(r=>{this._loadCount===s&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===s&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class rN{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:s=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,s):(r=new iN(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const s in t){const i=t[s],r=this._resources[i.resourceId];r&&r.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:s,requestId:i="default"}){const{_resources:r,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),r[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=r[e];if(this._track(s,i,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,s,i){const r=this._consumers,l=r[e]=r[e]||{};let c=l[t];const h=c&&c.resourceId&&this._resources[c.resourceId];h&&(h.unsubscribe(c),this.prune()),s&&(c?(c.onChange=i,c.resourceId=s.id):c={onChange:i,resourceId:s.id},l[t]=c,s.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const aN="layerManager.setLayers",oN="layerManager.activateViewport";class lN{constructor(e,t){var c;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=h=>{Wt(oN,this,h),h&&(this.context.viewport=h)};const{deck:s,stats:i,viewport:r,timeline:l}=t||{};this.layers=[],this.resourceManager=new rN({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:s,shaderAssembler:l4(((c=e==null?void 0:e.info)==null?void 0:c.shadingLanguage)||"glsl"),defaultShaderModules:[AI],renderPass:void 0,stats:i||new El({id:"deck.gl"}),viewport:r||new Fa({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new sS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const i=s.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(s=>t.id.indexOf(s)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Wt(aN,this,t,e),this._lastRenderedLayers=e;const s=Oh(e,Boolean);for(const i of s)i.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(s=>s.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,s=t.findIndex(i=>i.name===e.name);s>=0&&(t.splice(s,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,s){s.raiseError(t,`${e} of ${s}`)}_updateLayers(e,t){const s={};for(const l of e)s[l.id]?De.warn(`Multiple old layers with same id ${l.id}`)():s[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,s,i),this._finalizeOldLayers(s);let r=!1;for(const l of i)if(l.hasUniformTransition()){r=`Uniform transition in ${l}`;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,s){for(const i of e){i.context=this.context;const r=t[i.id];r===null&&De.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let l=null;try{this._debug&&r!==i&&i.validateProps(),r?(this._transferLayerState(r,i),this._updateLayer(i)):this._initializeLayer(i),s.push(i),l=i.isComposite?i.getSubLayers():null}catch(c){this._handleError("matching",c,i)}l&&this._updateSublayersRecursively(l,t,s)}}_finalizeOldLayers(e){for(const t in e){const s=e[t];s&&this._finalizeLayer(s)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ha.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ha.MATCHED,t!==e&&(e.lifecycle=ha.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ha.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ha.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function jn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!jn(n[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const s=Object.keys(n),i=Object.keys(e);if(s.length!==i.length)return!1;for(const r of s)if(!e.hasOwnProperty(r)||!jn(n[r],e[r],t-1))return!1;return!0}return!1}class cN{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,s=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(s):s}getViewport(e){return this._viewportMap[e]}unproject(e,t){const s=this.getViewports(),i={x:e[0],y:e[1]};for(let r=s.length-1;r>=0;--r){const l=s[r];if(l.containsPixel(i)){const c=e.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Oh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!jn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):De.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const s=t.type;return new s({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var l;return(l=this.getView(e.id))==null?void 0:l.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(e,t,s,i){const r=e.controller;if(r&&s){const l={...t,...r,id:e.id,x:s.x,y:s.y,width:s.width,height:s.height};return(!i||i.constructor!==r.type)&&(i=this._createController(e,l)),i&&i.setProps(l),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let i=e.length;i--;){const r=e[i],l=this.getViewState(r),c=r.makeViewport({viewState:l,width:this.width,height:this.height});let h=t[r.id];const d=!!r.controller;d&&!h&&(s=!0),(s||!d)&&h&&(h.finalize(),h=null),this.controllers[r.id]=this._updateController(r,l,c,h),c&&this._viewports.unshift(c)}for(const i in t){const r=t[i];r&&!this.controllers[i]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((s,i)=>!e[i].equals(t[i]))}}const uN=/([0-9]+\.?[0-9]*)(%|px)/;function ti(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=uN.exec(n);if(e&&e.length>=3){const t=e[2]==="%",s=parseFloat(e[1]);return{position:t?s/100:s,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function ni(n,e){return n.relative?Math.round(n.position*e):n.position}class Ia{constructor(e){const{id:t,x:s=0,y:i=0,width:r="100%",height:l="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ti(s),this._y=ti(i),this._width=ti(r),this._height=ti(l),this._padding=c&&{left:ti(c.left||0),right:ti(c.right||0),top:ti(c.top||0),bottom:ti(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&jn(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:s}){s=this.filterViewState(s);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const r=this.getViewportType(s);return new r({...s,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const s in this.props.viewState)s!=="id"&&(t[s]=this.props.viewState[s]);return t}return e}getDimensions({width:e,height:t}){const s={x:ni(this._x,e),y:ni(this._y,t),width:ni(this._width,e),height:ni(this._height,t)};return this._padding&&(s.padding={left:ni(this._padding.left,e),top:ni(this._padding.top,t),right:ni(this._padding.right,e),bottom:ni(this._padding.bottom,t)}),s}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Mh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,s;this.cancel(),this.settings=e,this._inProgress=!0,(s=(t=this.settings).onStart)==null||s.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:s,settings:i}=this;this._handle=s.addChannel({delay:s.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const wT=()=>{},Mp={BREAK:1,SNAP_TO_END:2,IGNORE:3},hN=n=>n,fN=Mp.BREAK;class dN{constructor(e){this._onTransitionUpdate=t=>{const{time:s,settings:{interpolator:i,startProps:r,endProps:l,duration:c,easing:h}}=t,d=h(s/c),g=i.interpolateProps(r,l,d);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Mh(e.timeline),this.onViewStateChange=e.onViewStateChange||wT,this.onStateChange=e.onStateChange||wT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const s=this.props;if(this.props=e,!s||this._shouldIgnoreViewportChange(s,e))return!1;if(this._isTransitionEnabled(e)){let i=s;if(this.transition.inProgress){const{interruption:r,endProps:l}=this.transition.settings;i={...s,...r===Mp.SNAP_TO_END?l:this.propsInTransition||s}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:s}=e;return(t>0||t==="auto")&&!!s}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Mp.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const s=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(s),r=t.transitionInterpolator,l=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(l===0)return;const c=r.initializeProps(e,i);this.propsInTransition={};const h={duration:l,easing:t.transitionEasing||hN,interpolator:r,interruption:t.transitionInterruption||fN,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Bt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class gN{constructor(e){const{compare:t,extract:s,required:i}=e;this._propsToCompare=t,this._propsToExtract=s||t,this._requiredProps=i}arePropsEqual(e,t){for(const s of this._propsToCompare)if(!(s in e)||!(s in t)||!Os(e[s],t[s]))return!1;return!0}initializeProps(e,t){const s={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(s[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(s),this._checkRequiredProps(i),{start:s,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const s=e[t];Bt(Number.isFinite(s)||Array.isArray(s),`${t} is required for transition`)})}}const pN=["longitude","latitude","zoom","bearing","pitch"],_N=["longitude","latitude","zoom"];class cS extends gN{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,s=Array.isArray(e)?{}:e;s.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:pN,required:_N},super(s.transitionProps),this.opts=s}initializeProps(e,t){const s=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const l=i(e),c=i(t),h=l.unproject(r);s.start.around=r,Object.assign(s.end,{around:c.project(h),aroundPosition:h,width:t.width,height:t.height})}return s}interpolateProps(e,t,s){const i={};for(const r of this._propsToExtract)i[r]=tr(e[r]||0,t[r]||0,s);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,tr(e.around,t.around,s)))}return i}}const si={transitionDuration:0},mN=300,nu=n=>1-(1-n)*(1-n),na={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Yi={};class yN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new dN({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:s}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-s]}isPointInBounds(e,t){const{width:s,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=s&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?mN:0;const{scrollZoom:s=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:h=!1,keyboard:d=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(na.WHEEL,g&&s),this.toggleEvents(na.PAN,g),this.toggleEvents(na.PINCH,g&&(c||h)),this.toggleEvents(na.MULTI_PAN,g&&h),this.toggleEvents(na.DOUBLE_CLICK,g&&l),this.toggleEvents(na.KEYBOARD,g&&d),this.scrollZoom=s,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=h,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(s=>{this._events[s]!==t&&(this._events[s]=t,t?this.eventManager.on(s,this.handleEvent):this.eventManager.off(s,this.handleEvent))})}updateViewport(e,t=null,s={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(s),r){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let s=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(s=!s);const i=this.controllerState[s?"panStart":"rotateStart"]({pos:t});return this._panMove=s,this.updateViewport(i,si,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),s=this.controllerState.pan({pos:t});return this.updateViewport(s,si,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const s=this.getCenter(e),i=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:nu},{isDragging:!1,isPanning:!0})}else{const s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),s=this.controllerState.rotate({pos:t});return this.updateViewport(s,si,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const s=this.getCenter(e),i=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:nu},{isDragging:!1,isRotating:!0})}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:s=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=e;let l=2/(1+Math.exp(-Math.abs(r*s)));r<0&&l!==0&&(l=1/l);const c=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.rotateStart({pos:t});return this.updateViewport(s,si,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const s=this.controllerState.rotate({pos:t});return this.updateViewport(s,si,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const s=this.getCenter(e),i=[s[0],s[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:nu},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Yi._startPinchRotation=e.rotation,Yi._lastPinchEvent=e,this.updateViewport(s,si,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:s}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:s})}if(this.touchRotate){const{rotation:s}=e;t=t.rotate({deltaAngleX:Yi._startPinchRotation-s})}return this.updateViewport(t,si,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Yi._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:s}=Yi;if(this.touchZoom&&t&&s&&e.scale!==s.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const l=Math.log2(e.scale),c=(l-Math.log2(s.scale))/(e.deltaTime-s.deltaTime),h=Math.pow(2,l+c*t/2);r=r.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:nu},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Yi._startPinchRotation=null,Yi._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:s?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:s,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let h;const d={};switch(e.srcEvent.code){case"Minus":h=t?c.zoomOut(s).zoomOut(s):c.zoomOut(s),d.isZooming=!0;break;case"Equal":h=t?c.zoomIn(s).zoomIn(s):c.zoomIn(s),d.isZooming=!0;break;case"ArrowLeft":t?(h=c.rotateLeft(r),d.isRotating=!0):(h=c.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":t?(h=c.rotateRight(r),d.isRotating=!0):(h=c.moveRight(i),d.isPanning=!0);break;case"ArrowUp":t?(h=c.rotateUp(l),d.isRotating=!0):(h=c.moveUp(i),d.isPanning=!0);break;case"ArrowDown":t?(h=c.rotateDown(l),d.isRotating=!0):(h=c.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?si:e?{...t,transitionInterpolator:new cS({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class bN{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const xT=5,vN=1.2;class TN extends bN{constructor(e){const{width:t,height:s,latitude:i,longitude:r,zoom:l,bearing:c=0,pitch:h=0,altitude:d=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:b=60,minPitch:T=0,startPanLngLat:S,startZoomLngLat:R,startRotatePos:k,startBearing:U,startPitch:P,startZoom:D,normalize:$=!0}=e;Bt(Number.isFinite(r)),Bt(Number.isFinite(i)),Bt(Number.isFinite(l)),super({width:t,height:s,latitude:i,longitude:r,zoom:l,bearing:c,pitch:h,altitude:d,maxZoom:_,minZoom:y,maxPitch:b,minPitch:T,normalize:$,position:g},{startPanLngLat:S,startZoomLngLat:R,startRotatePos:k,startBearing:U,startPitch:P,startZoom:D}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const s=this.getState().startPanLngLat||this._unproject(t);if(!s)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:s=0}){const{startRotatePos:i,startBearing:r,startPitch:l}=this.getState();if(!i||r===void 0||l===void 0)return this;let c;return e?c=this._getNewRotation(e,i,l,r):c={bearing:r+t,pitch:l+s},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:s}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let h=i+Math.log2(s);h=gi(h,c,l);const d=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...d.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),s={...this.getViewportProps()},{bearing:i,longitude:r}=s;return Math.abs(i-t.bearing)>180&&(s.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(s.longitude=r<0?r+360:r-360),s}applyConstraints(e){const{maxZoom:t,minZoom:s,zoom:i}=e;e.zoom=gi(i,s,t);const{maxPitch:r,minPitch:l,pitch:c}=e;e.pitch=gi(c,l,r);const{normalize:h=!0}=e;return h&&Object.assign(e,Xk(e)),e}_zoomFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.zoom({pos:[t/2,s/2],scale:e})}_panFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.pan({startPos:[t/2,s/2],pos:[t/2+e[0],s/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,s,i){const r=e[0]-t[0],l=e[1]-t[1],c=e[1],h=t[1],{width:d,height:g}=this.getViewportProps(),_=r/d;let y=0;l>0?Math.abs(g-h)>xT&&(y=l/(h-g)*vN):l<0&&h>xT&&(y=1-c/h),y=gi(y,-1,1);const{minPitch:b,maxPitch:T}=this.getViewportProps(),S=i+180*_;let R=s;return y>0?R=s+y*(T-s):y<0&&(R=s-y*(b-s)),{pitch:R,bearing:S}}}class wN extends yN{constructor(){super(...arguments),this.ControllerState=TN,this.transition={transitionDuration:300,transitionInterpolator:new cS({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class M_ extends Ia{constructor(e={}){super(e)}getViewportType(){return wi}get ControllerType(){return wN}}M_.displayName="MapView";const xN=new tS;function SN(n,e){const t=n.order??1/0,s=e.order??1/0;return t-s}class AN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(s=>s.id===e.id)){const s=t.findIndex(i=>SN(i,e)>0);s<0?t.push(e):t.splice(s,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(jn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const s=[];for(const i of e){const r=t[i.id];let l=i;r&&r!==i?r.setProps?(r.setProps(i.props),l=r):r.cleanup(this._context):r||i.setup(this._context),s.push(l),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(i=>i instanceof tS)||this._resolvedEffects.push(xN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class EN extends O_{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const RN="deckRenderer.renderLayers";class CN{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new EN(e),this.pickLayersPass=new oS(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};s.effects&&this._preRender(s.effects,s);const i=this.lastPostProcessEffect?this.renderBuffers[0]:s.target;this.lastPostProcessEffect&&(s.clearColor=[0,0,0,0],s.clearCanvas=!0);const r=t.render({...s,target:i});s.effects&&this._postRender(s.effects,s),this.renderCount++,Wt(RN,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const s of e)t.preRenderStats[s.id]=s.preRender(t),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(s=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${s}`,colorAttachments:[i]}))});for(const s of e)s.resize(t)}_postRender(e,t){const{renderBuffers:s}=this,i={...t,inputBuffer:s[0],swapBuffer:s[1]};for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const l=r.postRender(i);i.inputBuffer=l,i.swapBuffer=l===s[0]?s[1]:s[0]}}}const ON={pickedColor:null,pickedObjectIndex:-1};function MN({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:s,deviceRadius:i,deviceRect:r}){const{x:l,y:c,width:h,height:d}=r;let g=i*i,_=-1,y=0;for(let b=0;b<d;b++){const T=b+c-s,S=T*T;if(S>g)y+=4*h;else for(let R=0;R<h;R++){if(n[y+3]-1>=0){const U=R+l-t,P=U*U+S;P<=g&&(g=P,_=y)}y+=4}}if(_>=0){const b=n.slice(_,_+4),T=e(b);if(T){const S=Math.floor(_/4/h),R=_/4-S*h;return{...T,pickedColor:b,pickedX:l+R,pickedY:c+S}}De.error("Picked non-existent layer. Is picking buffer corrupt?")()}return ON}function PN({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let s=0;s<n.length;s+=4)if(n[s+3]-1>=0){const r=n.slice(s,s+4),l=r.join(",");if(!t.has(l)){const c=e(r);c?t.set(l,{...c,color:r}):De.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function uS({pickInfo:n,viewports:e,pixelRatio:t,x:s,y:i,z:r}){let l=e[0];e.length>1&&(l=kN((n==null?void 0:n.pickedViewports)||e,{x:s,y:i}));let c;if(l){const h=[s-l.x,i-l.y];r!==void 0&&(h[2]=r),c=l.unproject(h)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:s,y:i,pixel:[s,i],coordinate:c,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function IN(n){const{pickInfo:e,lastPickedInfo:t,mode:s,layers:i}=n,{pickedColor:r,pickedLayer:l,pickedObjectIndex:c}=e,h=l?[l]:[];if(s==="hover"){const _=t.index,y=t.layerId,b=l?l.props.id:null;if(b!==y||c!==_){if(b!==y){const T=i.find(S=>S.props.id===y);T&&h.unshift(T)}t.layerId=b,t.index=c,t.info=null}}const d=uS(n),g=new Map;return g.set(null,d),h.forEach(_=>{let y={...d};_===l&&(y.color=r,y.index=c,y.picked=!0),y=hS({layer:_,info:y,mode:s});const b=y.layer;_===l&&s==="hover"&&(t.info=y),g.set(b.id,y),s==="hover"&&b.updateAutoHighlight(y)}),g}function hS({layer:n,info:e,mode:t}){for(;n&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:s}),n=n.parent}return e}function kN(n,e){for(let t=n.length-1;t>=0;t--){const s=n[t];if(s.containsPixel(e))return s}return n[0]}class NN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new oS(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:s,viewports:i},r=this.lastPickedInfo.info){const l=r&&r.layer&&r.layer.id,c=r&&r.viewport&&r.viewport.id,h=l?s.find(y=>y.id===l):null,d=c&&i.find(y=>y.id===c)||i[0],g=d&&d.unproject([e-d.x,t-d.y]);return{...r,...{x:e,y:t,viewport:d,coordinate:g,layer:h}}}_resizeBuffer(){var t,s;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(s=this.depthFBO)==null||s.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(s=>this.pickLayersPass.shouldDrawLayer(s)&&!s.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:s,x:i,y:r,radius:l=0,depth:c=1,mode:h="query",unproject3D:d,onViewportActive:g,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||s.length===0)return{result:[],emptyInfo:uS({viewports:s,x:i,y:r,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,r],!0),S=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],R=Math.round(l*y),{width:k,height:U}=this.pickingFBO,P=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:R,deviceWidth:k,deviceHeight:U}),D={x:i-l,y:r-l,width:l*2+1,height:l*2+1};let $;const Z=[],fe=new Set;for(let ue=0;ue<c;ue++){let J;if(P){const de=this._drawAndSample({layers:b,views:t,viewports:s,onViewportActive:g,deviceRect:P,cullRect:D,effects:_,pass:`picking:${h}`});J=MN({...de,deviceX:S[0],deviceY:S[1],deviceRadius:R,deviceRect:P})}else J={pickedColor:null,pickedObjectIndex:-1};let oe;if(J.pickedLayer&&d&&this.depthFBO){const{pickedColors:de}=this._drawAndSample({layers:[J.pickedLayer],views:t,viewports:s,onViewportActive:g,deviceRect:{x:J.pickedX,y:J.pickedY,width:1,height:1},cullRect:D,effects:_,pass:`picking:${h}:z`},!0);de[3]&&(oe=de[0])}J.pickedLayer&&ue+1<c&&(fe.add(J.pickedLayer),J.pickedLayer.disablePickingIndex(J.pickedObjectIndex)),$=IN({pickInfo:J,lastPickedInfo:this.lastPickedInfo,mode:h,layers:b,viewports:s,x:i,y:r,z:oe,pixelRatio:y});for(const de of $.values())de.layer&&Z.push(de);if(!J.pickedColor)break}for(const ue of fe)ue.restorePickingColors();return{result:Z,emptyInfo:$.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:s,x:i,y:r,width:l=1,height:c=1,mode:h="query",maxObjects:d=null,onViewportActive:g,effects:_}){const y=this._getPickable(e);if(!y||s.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,r],!0),S=T.x,R=T.y+T.height,k=this.device.canvasContext.cssToDevicePixels([i+l,r+c],!0),U=k.x+k.width,P=k.y,D={x:S,y:P,width:U-S,height:R-P},$=this._drawAndSample({layers:y,views:t,viewports:s,onViewportActive:g,deviceRect:D,cullRect:{x:i,y:r,width:l,height:c},effects:_,pass:`picking:${h}`}),Z=PN($),fe=new Map,ue=[],J=Number.isFinite(d);for(let oe=0;oe<Z.length&&!(J&&ue.length>=d);oe++){const de=Z[oe];let ve={color:de.pickedColor,layer:null,index:de.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:b};ve=hS({layer:de.pickedLayer,info:ve,mode:h});const be=ve.layer.id;fe.has(be)||fe.set(be,new Set);const Se=fe.get(be),We=ve.object??ve.index;Se.has(We)||(Se.add(We),ue.push(ve))}return ue}_drawAndSample({layers:e,views:t,viewports:s,onViewportActive:i,deviceRect:r,cullRect:l,effects:c,pass:h},d=!1){const g=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:s,onViewportActive:i,pickingFBO:g,deviceRect:r,cullRect:l,effects:c,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const U of c)U.useInPicking&&(_.preRenderStats[U.id]=U.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:b,y:T,width:S,height:R}=r,k=new(d?Float32Array:Uint8Array)(S*R*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:b,sourceY:T,sourceWidth:S,sourceHeight:R,target:k}),{pickedColors:k,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:s,deviceWidth:i,deviceHeight:r}){const l=Math.max(0,e-s),c=Math.max(0,t-s),h=Math.min(i,e+s+1)-l,d=Math.min(r,t+s+1)-c;return h<=0||d<=0?null:{x:l,y:c,width:h,height:d}}}const DN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},BN="top-left",ST="__root";class UN{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!jn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const s of this.resolvedWidgets)t[s.id]=s;this.resolvedWidgets.length=0;for(const s of this.defaultWidgets)t[s.id]=null,this.resolvedWidgets.push(s);for(let s of e){const i=t[s.id];i?i.viewId!==s.viewId||i.placement!==s.placement?(this._remove(i),this._add(s)):s!==i&&(i.setProps(s.props),s=i):this._add(s),t[s.id]=null,this.resolvedWidgets.push(s)}for(const s in t){const i=t[s];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:s=BN}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,s).append(i),e._element=i}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var l;const s=e||ST;let i=this.containers[s];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(l=this.parentElement)==null||l.append(i),this.containers[s]=i);let r=i.querySelector(`.${t}`);return r||(r=document.createElement("div"),r.className=t,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,DN[t]),i.append(r)),r}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const s in this.containers){const i=this.lastViewports[s]||null,r=s===ST||i,l=this.containers[s];r?(l.style.display="block",l.style.left=`${i?i.x:0}px`,l.style.top=`${i?i.y:0}px`,l.style.width=`${i?i.width:e}px`,l.style.height=`${i?i.height:t}px`):l.style.display="none"}}onRedraw({viewports:e,layers:t}){var i,r;const s=e.reduce((l,c)=>(l[c.id]=c,l),{});for(const l of this.getWidgets()){const{viewId:c}=l;if(c){const h=s[c];h&&(l.onViewportChange&&l.onViewportChange(h),(i=l.onRedraw)==null||i.call(l,{viewports:[h],layers:t}))}else{if(l.onViewportChange)for(const h of e)l.onViewportChange(h);(r=l.onRedraw)==null||r.call(l,{viewports:e,layers:t})}}this.lastViewports=s,this._updateContainers()}onHover(e,t){var s,i;for(const r of this.getWidgets()){const{viewId:l}=r;(!l||l===((s=e.viewport)==null?void 0:s.id))&&((i=r.onHover)==null||i.call(r,e,t))}}onEvent(e,t){var i,r;const s=Tp[t.type];if(s)for(const l of this.getWidgets()){const{viewId:c}=l;(!c||c===((i=e.viewport)==null?void 0:i.id))&&((r=l[s])==null||r.call(l,e,t))}}}const LN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class FN{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,LN),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,s=t&&t.props.getTooltip;if(!s)return;const i=s(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,s){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${s}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var ga;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ga||(ga={}));const P_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},mt=(n,e,t)=>e?n.enable(t):n.disable(t),AT=(n,e,t)=>n.hint(t,e),un=(n,e,t)=>n.pixelStorei(t,e),ET=(n,e,t)=>{const s=t===36006?36009:36008;return n.bindFramebuffer(s,e)},$o=(n,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(i,e)};function Ig(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const zN={3042:mt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:mt,2885:(n,e)=>n.cullFace(e),2929:mt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:mt,35723:AT,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:ET,36010:ET,34964:$o,36662:$o,36663:$o,35053:$o,35055:$o,2886:(n,e)=>n.frontFace(e),33170:AT,2849:(n,e)=>n.lineWidth(e),32823:mt,32824:"polygonOffset",10752:"polygonOffset",35977:mt,32926:mt,32928:mt,32938:"sampleCoverage",32939:"sampleCoverage",3089:mt,3088:(n,e)=>n.scissor(...e),2960:mt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:mt,10754:mt,12288:mt,12289:mt,12290:mt,12291:mt,12292:mt,12293:mt,12294:mt,12295:mt,3333:un,3317:un,37440:un,37441:un,37443:un,3330:un,3332:un,3331:un,3314:un,32878:un,3316:un,3315:un,32877:un,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Ig(e)?e:[e,e];const[t,s]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,s)},stencilFunc:(n,e)=>{e=Ig(e)&&e.length===3?[...e,...e]:e;const[t,s,i,r,l,c]=e;n.stencilFuncSeparate(1028,t,s,i),n.stencilFuncSeparate(1029,r,l,c)},stencilOp:(n,e)=>{e=Ig(e)&&e.length===3?[...e,...e]:e;const[t,s,i,r,l,c]=e;n.stencilOpSeparate(1028,t,s,i),n.stencilOpSeparate(1029,r,l,c)},viewport:(n,e)=>n.viewport(...e)};function ut(n,e,t){return e[n]!==void 0?e[n]:t[n]}const VN={blendEquation:(n,e,t)=>n.blendEquationSeparate(ut(32777,e,t),ut(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ut(32969,e,t),ut(32968,e,t),ut(32971,e,t),ut(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ut(32824,e,t),ut(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ut(32938,e,t),ut(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ut(2962,e,t),ut(2967,e,t),ut(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ut(34816,e,t),ut(36003,e,t),ut(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ut(2964,e,t),ut(2965,e,t),ut(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ut(34817,e,t),ut(34818,e,t),ut(34819,e,t))},RT={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return s?n({[s]:t}):{valueChanged:!0}},blendColor:(n,e,t,s,i)=>n({32773:new Float32Array([e,t,s,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,s,i)=>n({32969:e,32968:t,32971:s,32970:i}),clearColor:(n,e,t,s,i)=>n({3106:new Float32Array([e,t,s,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,s,i)=>n({3107:[e,t,s,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,s,i)=>n({3088:new Int32Array([e,t,s,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,s)=>n({2962:e,2967:t,2963:s,34816:e,36003:t,36004:s}),stencilFuncSeparate:(n,e,t,s,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:s,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,s)=>n({2964:e,2965:t,2966:s,34817:e,34818:t,34819:s}),stencilOpSeparate:(n,e,t,s,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:s,[e===1028?2966:34819]:i}),viewport:(n,e,t,s,i)=>n({2978:[e,t,s,i]})},Gn=(n,e)=>n.isEnabled(e),CT={3042:Gn,2884:Gn,2929:Gn,3024:Gn,32823:Gn,32926:Gn,32928:Gn,3089:Gn,2960:Gn,35977:Gn},jN=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function za(n,e){if(HN(e))return;const t={};for(const i in e){const r=Number(i),l=zN[i];l&&(typeof l=="string"?t[l]=!0:l(n,e[i],r))}const s=n.state&&n.state.cache;if(s)for(const i in t){const r=VN[i];r(n,e,s)}}function fS(n,e=P_){if(typeof e=="number"){const i=e,r=CT[i];return r?r(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),s={};for(const i of t){const r=CT[i];s[i]=r?r(n,Number(i)):n.getParameter(Number(i))}return s}function $N(n){za(n,P_)}function HN(n){for(const e in n)return!1;return!0}function WN(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),s=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&s&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}class sr{constructor(e,t){w(this,"gl");w(this,"program",null);w(this,"stateStack",[]);w(this,"enable",!0);w(this,"cache",null);w(this,"log");w(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];za(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?fS(e):Object.assign({},P_),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,qN(e);for(const s in RT){const i=RT[s];XN(e,s,i)}OT(e,"getParameter"),OT(e,"isEnabled")}_updateCache(e){let t=!1,s;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const l=e[r],c=this.cache[r];WN(l,c)||(t=!0,s=c,i&&!(r in i)&&(i[r]=c),this.cache[r]=l)}return{valueChanged:t,oldValue:s}}}function OT(n,e){const t=n[e].bind(n);n[e]=function(i){if(i===void 0||jN.has(i))return t(i);const r=sr.get(n);return i in r.cache||(r.cache[i]=t(i)),r.enable?r.cache[i]:t(i)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function XN(n,e,t){if(!n[e])return;const s=n[e].bind(n);n[e]=function(...r){const l=sr.get(n),{valueChanged:c,oldValue:h}=t(l._updateCache,...r);return c&&s(...r),h},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function qN(n){const e=n.useProgram.bind(n);n.useProgram=function(s){const i=sr.get(n);i.program!==s&&(e(s),i.program=s)}}function YN(n,e,t){let s="";const i={preserveDrawingBuffer:!0,...t};let r=null;if(r||(r=n.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(s||(s="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!r&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,r=n.getContext("webgl2",i),r.luma||(r.luma={}),r.luma.softwareRenderer=!0),r||(r=n.getContext("webgl",{}),r&&(r=null,s||(s="Your browser only supports WebGL1"))),!r)throw s||(s="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${s}`);const{onContextLost:l,onContextRestored:c}=e;return n.addEventListener("webglcontextlost",h=>l(h),!1),n.addEventListener("webglcontextrestored",h=>c(h),!1),r.luma||(r.luma={}),r}function ka(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function KN(n,e){const t=n.getParameter(7936),s=n.getParameter(7937);ka(n,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,r=n.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),c=r||t,h=l||s,d=n.getParameter(7938),g=dS(c,h),_=ZN(c,h),y=QN(c,h);return{type:"webgl",gpu:g,gpuType:y,gpuBackend:_,vendor:c,renderer:h,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function dS(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function ZN(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function QN(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(dS(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function gS(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Go="WEBGL_compressed_texture_s3tc",Jo="WEBGL_compressed_texture_s3tc_srgb",pa="EXT_texture_compression_rgtc",_a="EXT_texture_compression_bptc",GN="WEBGL_compressed_texture_etc",JN="WEBGL_compressed_texture_astc",eD="WEBGL_compressed_texture_etc1",tD="WEBGL_compressed_texture_pvrtc",nD="WEBGL_compressed_texture_atc",MT="EXT_texture_norm16",PT="EXT_render_snorm",sD="EXT_color_buffer_float",I_={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[PT],"norm16-renderable-webgl":[MT],"snorm16-renderable-webgl":[MT,PT],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Go,Jo,pa,_a],"texture-compression-bc5-webgl":[pa],"texture-compression-bc7-webgl":[_a],"texture-compression-etc2":[GN],"texture-compression-astc":[JN],"texture-compression-etc1-webgl":[eD],"texture-compression-pvrtc-webgl":[tD],"texture-compression-atc-webgl":[nD]};function iD(n){return n in I_}function rD(n,e,t){return(I_[e]||[]).every(i=>ka(n,i,t))}const k_={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:sD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Go},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Jo},"bc1-rgba-unorm":{gl:33777,x:Go},"bc1-rgba-unorm-srgb":{gl:35916,x:Jo},"bc2-rgba-unorm":{gl:33778,x:Go},"bc2-rgba-unorm-srgb":{gl:35918,x:Jo},"bc3-rgba-unorm":{gl:33779,x:Go},"bc3-rgba-unorm-srgb":{gl:35919,x:Jo},"bc4-r-unorm":{gl:36283,x:pa},"bc4-r-snorm":{gl:36284,x:pa},"bc5-rg-unorm":{gl:36285,x:pa},"bc5-rg-snorm":{gl:36286,x:pa},"bc6h-rgb-ufloat":{gl:36495,x:_a},"bc6h-rgb-float":{gl:36494,x:_a},"bc7-rgba-unorm":{gl:36492,x:_a},"bc7-rgba-unorm-srgb":{gl:36493,x:_a},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function aD(n,e,t){let s=e.create;const i=k_[e.format];return(i==null?void 0:i.gl)===void 0&&(s=!1),i!=null&&i.x&&(s=s&&!!ka(n,i.x,t)),{format:e.format,create:s&&e.create,render:s&&e.render,filter:s&&e.filter,blend:s&&e.blend,store:s&&e.store}}function pS(n){var i;const e=k_[n],t=cD(n),s=h_(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||lD(s.channels,s.integer,s.normalized,t),type:s.dataType?gS(s.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:s.compressed||!1}}function oD(n){switch(h_(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function lD(n,e,t,s){if(s===6408||s===6407)return s;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cD(n){const e=k_[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const IT={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class uD extends AO{constructor(t,s,i){super([],i);w(this,"gl");w(this,"extensions");w(this,"testedFeatures",new Set);this.gl=t,this.extensions=s,ka(t,"EXT_color_buffer_float",s)}*[Symbol.iterator](){const t=this.getFeatures();for(const s of t)this.has(s)&&(yield s);return[]}has(t){var s;return(s=this.disabledFeatures)!=null&&s[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),iD(t)&&rD(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(s=>s!=="polygon-mode-webgl");for(const s of t)this.has(s)}getFeatures(){return[...Object.keys(IT),...Object.keys(I_)]}getWebGLFeature(t){const s=IT[t];return typeof s=="string"?!!ka(this.gl,s,this.extensions):!!s}}class hD extends SO{constructor(t){super();w(this,"gl");w(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class cl extends Wu{constructor(t,s){super(t,s);w(this,"device");w(this,"gl");w(this,"handle");w(this,"colorAttachments",[]);w(this,"depthStencilAttachment",null);const i=s.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let s=0;s<this.colorAttachments.length;++s){const i=this.colorAttachments[s];if(i){const r=36064+s;this._attachTextureView(r,i)}}if(this.depthStencilAttachment){const s=oD(this.depthStencilAttachment.props.format);this._attachTextureView(s,this.depthStencilAttachment)}if(this.device.props.debug){const s=this.gl.checkFramebufferStatus(36160);if(s!==36053)throw new Error(`Framebuffer ${dD(s)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,s){const{gl:i}=this.device,{texture:r}=s,l=s.props.baseMipLevel,c=s.props.baseArrayLayer;switch(i.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,r.handle,l,c);break;case 34067:const h=fD(c);i.framebufferTexture2D(36160,t,h,r.handle,l);break;case 3553:i.framebufferTexture2D(36160,t,3553,r.handle,l);break;default:throw new Error("Illegal texture type")}i.bindTexture(r.glTarget,null)}}function fD(n){return n<34069?n+34069:n}function dD(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class gD extends rp{constructor(t,s){super(s);w(this,"device");w(this,"format","rgba8unorm");w(this,"depthStencilFormat","depth24plus");w(this,"presentationSize");w(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new cl(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const s=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(s,t);return}}commit(){}}async function _S(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",n),new Promise((i,r)=>{s.onload=i,s.onerror=l=>r(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(s)})}const pD=1;let Qe=null,kT=!1;const N_={debugSpectorJS:ae.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function _D(n){if(!globalThis.SPECTOR)try{await _S(n.debugSpectorJSUrl||N_.debugSpectorJSUrl)}catch(e){ae.warn(String(e))}}function mD(n){var e;if(n={...N_,...n},!n.debugSpectorJS)return null;if(!Qe&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ae.probe(pD,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Qe=new t,globalThis.luma&&(globalThis.luma.spector=Qe)}if(!Qe)return null;if(kT||(kT=!0,Qe.spyCanvases(),Qe==null||Qe.onCaptureStarted.add(t=>ae.info("Spector capture started:",t)()),Qe==null||Qe.onCapture.add(t=>{ae.info("Spector capture complete:",t)(),Qe==null||Qe.getResultUI(),Qe==null||Qe.resultView.display(),Qe==null||Qe.resultView.addCapture(t)})),n.gl){const t=n.gl,s=t.device;Qe==null||Qe.startCapture(n.gl,500),t.device=s,new Promise(i=>setTimeout(i,2e3)).then(i=>{ae.info("Spector capture stopped after 2 seconds")(),Qe==null||Qe.stopCapture()})}return Qe}const yD="https://unpkg.com/webgl-debug@2.0.1/index.js";function mS(n){return n.luma=n.luma||{},n.luma}async function bD(){ur()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await _S(yD))}function vD(n,e={}){return e.debugWebGL||e.traceWebGL?wD(n,e):TD(n)}function TD(n){const e=mS(n);return e.realContext?e.realContext:n}function wD(n,e){if(!globalThis.WebGLDebugUtils)return ae.warn("webgl-debug not loaded")(),n;const t=mS(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...ga,...n});const s=globalThis.WebGLDebugUtils.makeDebugContext(n,xD.bind(null,e),SD.bind(null,e));for(const l in ga)!(l in s)&&typeof ga[l]=="number"&&(s[l]=ga[l]);class i{}Object.setPrototypeOf(s,Object.getPrototypeOf(n)),Object.setPrototypeOf(i,s);const r=Object.create(i);return t.realContext=n,t.debugContext=r,r.debug=!0,r}function NT(n,e){e=Array.from(e).map(s=>s===void 0?"undefined":s);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function xD(n,e,t,s){s=Array.from(s).map(c=>c===void 0?"undefined":c);const i=globalThis.WebGLDebugUtils.glEnumToString(e),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,s),l=`${i} in gl.${t}(${r})`;ae.error(l)();debugger}function SD(n,e,t){let s="";ae.level>=1&&(s=NT(e,t),n.traceWebGL&&ae.log(1,s)());for(const i of t)if(i===void 0){s=s||NT(e,t);debugger}}const kg={};function AD(n="id"){kg[n]=kg[n]||1;const e=kg[n]++;return`${n}-${e}`}class ul extends at{constructor(t,s={}){super(t,s);w(this,"device");w(this,"gl");w(this,"handle");w(this,"glTarget");w(this,"glUsage");w(this,"glIndexType",5123);w(this,"byteLength");w(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof s=="object"?s.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=ED(this.props.usage),this.glUsage=RD(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,s.data?this._initWithData(s.data,s.byteOffset,s.byteLength):this._initWithByteLength(s.byteLength||0)}_initWithData(t,s=0,i=t.byteLength+s){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bufferSubData(r,s,t),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,s,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let s=t;t===0&&(s=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,s,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,s=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,s,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,s,t.byteLength)}async readAsync(t=0,s){return this.readSyncWebGL(t,s)}readSyncWebGL(t=0,s){s=s??this.byteLength-t;const i=new Uint8Array(s),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,r,s),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,s),i}}function ED(n){return n&at.INDEX?34963:n&at.VERTEX?34962:n&at.UNIFORM?35345:34962}function RD(n){return n&at.INDEX||n&at.VERTEX?35044:n&at.UNIFORM?35048:35044}function CD(n){const e=n.split(/\r?\n/),t=[];for(const s of e){if(s.length<=1)continue;const i=s.split(":");if(i.length===2){const[_,y]=i;t.push({message:y.trim(),type:DT(_),lineNum:0,linePos:0});continue}const[r,l,c,...h]=i;let d=parseInt(c,10);isNaN(d)&&(d=0);let g=parseInt(l,10);isNaN(g)&&(g=0),t.push({message:h.join(":").trim(),type:DT(r),lineNum:d,linePos:g})}return t}function DT(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class OD extends $u{constructor(t,s){super(t,s);w(this,"device");w(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?CD(t):[]}getTranslatedSource(){const s=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(s==null?void 0:s.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:s}=this.device;if(s.shaderSource(this.handle,t),s.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ae.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ae.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async r=>await new Promise(l=>setTimeout(l,r));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function MD(n,e,t,s){if(ND(e))return s(n);const i=n;i.pushState();try{return PD(n,e),za(i.gl,t),s(n)}finally{i.popState()}}function PD(n,e){const t=n,{gl:s}=t;if(e.cullMode)switch(e.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029);break}if(e.frontFace&&s.frontFace(ir("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&s.enable(34383),e.depthBias!==void 0&&(s.enable(32823),s.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const r=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=ir("provokingVertex",e.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const r=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=ir("polygonMode",e.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,l),r==null||r.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&s.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&s.enable(12288),e.clipDistance1&&s.enable(12289),e.clipDistance2&&s.enable(12290),e.clipDistance3&&s.enable(12291),e.clipDistance4&&s.enable(12292),e.clipDistance5&&s.enable(12293),e.clipDistance6&&s.enable(12294),e.clipDistance7&&s.enable(12295)),e.depthWriteEnabled!==void 0&&s.depthMask(kD("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?s.enable(2929):s.disable(2929),s.depthFunc(Pp("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;s.stencilMaskSeparate(1028,i),s.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&ae.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,r=Pp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,r,0,i),s.stencilFuncSeparate(1029,r,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Ng("stencilPassOperation",e.stencilPassOperation),r=Ng("stencilFailOperation",e.stencilFailOperation),l=Ng("stencilDepthFailOperation",e.stencilDepthFailOperation);s.stencilOpSeparate(1028,r,l,i),s.stencilOpSeparate(1029,r,l,i)}switch(e.blend){case!0:s.enable(3042);break;case!1:s.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=BT("blendColorOperation",e.blendColorOperation||"add"),r=BT("blendAlphaOperation",e.blendAlphaOperation||"add");s.blendEquationSeparate(i,r);const l=su("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=su("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=su("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=su("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");s.blendFuncSeparate(l,c,h,d)}}function Pp(n,e){return ir(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Ng(n,e){return ir(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function BT(n,e){return ir(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function su(n,e){return ir(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function ID(n,e){return`Illegal parameter ${e} for ${n}`}function ir(n,e,t){if(!(e in t))throw new Error(ID(n,e));return t[e]}function kD(n,e){return e}function ND(n){let e=!0;for(const t in n){e=!1;break}return e}function yS(n){const e={};return n.addressModeU&&(e[10242]=Dg(n.addressModeU)),n.addressModeV&&(e[10243]=Dg(n.addressModeV)),n.addressModeW&&(e[32882]=Dg(n.addressModeW)),n.magFilter&&(e[10240]=Ip(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=DD(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=Pp("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Dg(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ip(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function DD(n,e="none"){if(!e)return Ip(n);switch(e){case"none":return Ip(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class kp extends Hu{constructor(t,s){super(t,s);w(this,"device");w(this,"handle");w(this,"parameters");this.device=t,this.parameters=yS(s),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[s,i]of Object.entries(t)){const r=Number(s);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,i);break;default:this.device.gl.samplerParameteri(this.handle,r,i);break}}}}class ma extends ju{constructor(t,s){super(t,{...ht.defaultProps,...s});w(this,"device");w(this,"gl");w(this,"handle");w(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=s.texture}}const BD="Failed to deduce GL constant from typed array";function UD(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(BD)}}function LD(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function bS(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function FD(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function sh(n,e,t){if(zD(e))return t(n);const{nocatch:s=!0}=e,i=sr.get(n);i.push(),za(n,e);let r;if(s)r=t(n),i.pop();else try{r=t(n)}finally{i.pop()}return r}function zD(n){for(const e in n)return!1;return!0}function VD(n,e,t){const{dimension:s,width:i,height:r,depth:l=0}=t,{glInternalFormat:c}=t,h=t.glTarget;switch(s){case"2d-array":case"3d":n.texStorage3D(h,e,c,i,r,l);break;default:n.texStorage2D(h,e,c,i,r)}}function UT(n,e,t,s){const{width:i,height:r}=s,{dimension:l,depth:c=0,mipLevel:h=0}=s,{x:d=0,y:g=0,z:_=0}=s,{glFormat:y,glType:b}=s,T=vS(s.glTarget,l,c),S=s.flipY?{37440:!0}:{};sh(n,S,()=>{switch(l){case"2d-array":case"3d":n.bindTexture(T,e),n.texSubImage3D(T,h,d,g,_,i,r,c,y,b,t),n.bindTexture(T,null);break;case"2d":case"cube":n.bindTexture(T,e),n.texSubImage2D(T,h,d,g,i,r,y,b,t),n.bindTexture(T,null);break;default:throw new Error(l)}})}function LT(n,e,t){const{dimension:s,width:i,height:r,depth:l=0,mipLevel:c=0,byteOffset:h=0}=t,{x:d=0,y:g=0,z:_=0}=t,{glFormat:y,glType:b,compressed:T}=t,S=vS(t.glTarget,s,l);switch(s){case"2d-array":case"3d":T?n.compressedTexSubImage3D(S,c,d,g,_,i,r,l,y,e,h):n.texSubImage3D(S,c,d,g,_,i,r,l,y,b,e,h);break;case"2d":case"cube":T?n.compressedTexSubImage2D(S,c,d,g,i,r,y,e,h):n.texSubImage2D(S,c,d,g,i,r,y,b,e,h);break;default:throw new Error(s)}}function jD(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function vS(n,e,t){return e==="cube"?34069+t:n}function $D(n,e){var k;const{sourceX:t=0,sourceY:s=0,sourceAttachment:i=0}=e||{};let{target:r=null,sourceWidth:l,sourceHeight:c,sourceDepth:h,sourceFormat:d,sourceType:g}=e||{};const{framebuffer:_,deleteFramebuffer:y}=TS(n),{gl:b,handle:T}=_;l||(l=_.width),c||(c=_.height);const S=(k=_.colorAttachments[i])==null?void 0:k.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${i}`);h=(S==null?void 0:S.depth)||1,d||(d=(S==null?void 0:S.glFormat)||6408),g||(g=(S==null?void 0:S.glType)||5121),r=XD(r,g,d,l,c),g=g||UD(r);const R=b.bindFramebuffer(36160,T);return b.readBuffer(36064+i),b.readPixels(t,s,l,c,d,g,r),b.readBuffer(36064),b.bindFramebuffer(36160,R||null),y&&_.destroy(),r}function HD(n,e){const{target:t,sourceX:s=0,sourceY:i=0,sourceFormat:r=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:c,sourceHeight:h,sourceType:d}=e||{};const{framebuffer:g,deleteFramebuffer:_}=TS(n);c=c||g.width,h=h||g.height;const y=g;d=d||5121;let b=t;if(!b){const S=bS(r),R=FD(d),k=l+c*h*S*R;b=y.device.createBuffer({byteLength:k})}const T=n.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:n,width:c,height:h,origin:[s,i],destinationBuffer:b,byteOffset:l}),T.destroy(),_&&g.destroy(),b}function TS(n){return n instanceof Wu?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:WD(n),deleteFramebuffer:!0}}function WD(n,e){const{device:t,width:s,height:i,id:r}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${r}`,width:s,height:i,colorAttachments:[n]})}function XD(n,e,t,s,i,r){if(n)return n;e||(e=5121);const l=LD(e,{clamped:!1}),c=bS(t);return new l(s*i*c)}class hl extends ht{constructor(t,s){super(t,s);w(this,"device");w(this,"gl");w(this,"handle");w(this,"sampler");w(this,"view");w(this,"mipmaps");w(this,"compressed");w(this,"glTarget");w(this,"glFormat");w(this,"glType");w(this,"glInternalFormat");w(this,"textureUnit",0);const i={...this.props};i.data=s.data,this.device=t,this.gl=this.device.gl,this.glTarget=jD(this.props.dimension);const r=pS(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:s,height:i}=t;if(!s||!i){const r=ht.getTextureDataSize(t.data);s=(r==null?void 0:r.width)||1,i=(r==null?void 0:r.height)||1}if(this.width=s,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new ma(this.device,{...this.props,texture:this}),this.bind(),VD(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new ma(this.device,{...t,texture:this})}setSampler(t={}){let s;t instanceof kp?(this.sampler=t,s=t.props):(this.sampler=new kp(this.device,t),s=t);const i=yS(s);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ae.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ae.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const s=ht.getExternalImageSize(t.image),i={...ht.defaultCopyExternalImageOptions,...s,...t},{image:r,depth:l,mipLevel:c,x:h,y:d,z:g,flipY:_}=i;let{width:y,height:b}=i;const{dimension:T,glTarget:S,glFormat:R,glInternalFormat:k,glType:U}=this;if(y=Math.min(y,this.width-h),b=Math.min(b,this.height-d),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return UT(this.device.gl,this.handle,r,{dimension:T,mipLevel:c,x:h,y:d,z:g,width:y,height:b,depth:l,glFormat:R,glType:U,glTarget:S,flipY:_}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,s=0){this.bind();const i=ht.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&ae.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<i.length;r++){const l=i[r];this._setMipLevel(s,r,l)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),LT(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,s=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of ht.CubeFaces)this.setTextureCubeFaceData(t[i],i)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,s,i=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ae.warn(`${this.id} has mipmap and multiple LODs.`)();const r=ht.CubeFaces.indexOf(s);this.setTexture2DData(t,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:s,width:i,height:r,pixels:l,data:c,format:h=6408,type:d=5121}=t,{gl:g}=this,_=l||c;this.bind(),_ instanceof Promise?_.then(y=>this.setImageDataForFace(Object.assign({},t,{face:s,data:y,pixels:y}))):this.width||this.height?g.texImage2D(s,0,h,i,r,0,h,d,_):g.texImage2D(s,0,h,h,d,_)}_getImageDataMap(t){for(let s=0;s<ht.CubeFaces.length;++s){const i=ht.CubeFaces[s];t[i]&&(t[34069+s]=t[i],delete t[i])}return t}_setSamplerParameters(t){ae.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[s,i]of Object.entries(t)){const r=Number(s),l=i;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,l);break;case 10241:this.gl.texParameteri(this.glTarget,r,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,l);break;default:this.gl.texParameteri(this.glTarget,r,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,s,i,r=this.glTarget){if(ht.isExternalImage(i)){UT(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:s,glTarget:r,flipY:this.props.flipY});return}if(ht.isTextureLevelData(i)){LT(this.device.gl,i.data,{...this,depth:t,mipLevel:s,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:s}=this;return t!==void 0&&(this.textureUnit=t,s.activeTexture(33984+t)),s.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:s}=this;return t!==void 0&&(this.textureUnit=t,s.activeTexture(33984+t)),s.bindTexture(this.glTarget,null),t}}const qD=[1,2,4,8];class YD extends ap{constructor(t,s){var l;super(t,s);w(this,"device");w(this,"glParameters");this.device=t;let i;if(!((l=s==null?void 0:s.parameters)!=null&&l.viewport))if(s!=null&&s.framebuffer){const{width:c,height:h}=s.framebuffer;i=[0,0,c,h]}else{const[c,h]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,c,h]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const r=this.props.framebuffer;if(r!=null&&r.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((h,d)=>36064+d);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const s={...this.glParameters};s.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(s.depthMask=!this.props.depthReadOnly),s.stencilMask=this.props.stencilReadOnly?0:1,s[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(s.viewport=t.viewport.slice(0,4),s.depthRange=[t.viewport[4],t.viewport[5]]):s.viewport=t.viewport),t.scissorRect&&(s.scissorTest=!0,s.scissor=t.scissorRect),t.blendConstant&&(s.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(s.colorMask=qD.map(i=>!!(i&t.colorMask))),this.glParameters=s,za(this.device.gl,s)}beginOcclusionQuery(t){const s=this.props.occlusionQuerySet;s==null||s.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let s=0;this.props.clearColors&&this.props.clearColors.forEach((i,r)=>{i&&this.clearColorBuffer(r,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(s|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(s|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(s|=1024,t.clearStencil=this.props.clearStencil),s!==0&&sh(this.device.gl,t,()=>{this.device.gl.clear(s)})}clearColorBuffer(t=0,s=[0,0,0,0]){sh(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(s.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,s);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,s);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,s);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function KD(n){return ZD.includes(n)}const ZD=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],wS={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function xS(n){const e=wS[n];if(!e)throw new Error("uniform");const[t,s,,i]=e;return{format:i,components:s,glType:t}}function QD(n){const e=wS[n];if(!e)throw new Error("attribute");const[,t,,s,i]=e;return{attributeType:s,vertexFormat:i,components:t}}function GD(n,e){const t={attributes:[],bindings:[]};t.attributes=JD(n,e);const s=n6(n,e);for(const c of s){const h=c.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:h})}const i=t6(n,e);let r=0;for(const c of i)if(KD(c.type)){const{viewDimension:h,sampleType:d}=i6(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:r,viewDimension:h,sampleType:d}),c.textureUnit=r,r+=1}i.length&&(t.uniforms=i);const l=e6(n,e);return l!=null&&l.length&&(t.varyings=l),t}function JD(n,e){const t=[],s=n.getProgramParameter(e,35721);for(let i=0;i<s;i++){const r=n.getActiveAttrib(e,i);if(!r)throw new Error("activeInfo");const{name:l,type:c}=r,h=n.getAttribLocation(e,l);if(h>=0){const{attributeType:d}=QD(c),g=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:h,stepMode:g,type:d})}}return t.sort((i,r)=>i.location-r.location),t}function e6(n,e){const t=[],s=n.getProgramParameter(e,35971);for(let i=0;i<s;i++){const r=n.getTransformFeedbackVarying(e,i);if(!r)throw new Error("activeInfo");const{name:l,type:c,size:h}=r,{glType:d,components:g}=xS(c),_={location:i,name:l,type:d,size:h*g};t.push(_)}return t.sort((i,r)=>i.location-r.location),t}function t6(n,e){const t=[],s=n.getProgramParameter(e,35718);for(let i=0;i<s;i++){const r=n.getActiveUniform(e,i);if(!r)throw new Error("activeInfo");const{name:l,size:c,type:h}=r,{name:d,isArray:g}=r6(l);let _=n.getUniformLocation(e,d);const y={location:_,name:d,size:c,type:h,isArray:g};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const T=`${d}[${b}]`;_=n.getUniformLocation(e,T);const S={...y,name:T,location:_};t.push(S)}}return t}function n6(n,e){const t=(r,l)=>n.getActiveUniformBlockParameter(e,r,l),s=[],i=n.getProgramParameter(e,35382);for(let r=0;r<i;r++){const l={name:n.getActiveUniformBlockName(e,r)||"",location:t(r,35391),byteLength:t(r,35392),vertex:t(r,35396),fragment:t(r,35398),uniformCount:t(r,35394),uniforms:[]},c=t(r,35395)||[],h=n.getActiveUniforms(e,c,35383),d=n.getActiveUniforms(e,c,35384),g=n.getActiveUniforms(e,c,35387),_=n.getActiveUniforms(e,c,35388);for(let y=0;y<l.uniformCount;++y){const b=n.getActiveUniform(e,c[y]);if(!b)throw new Error("activeInfo");l.uniforms.push({name:b.name,format:xS(h[y]).format,type:h[y],arrayLength:d[y],byteOffset:g[y],byteStride:_[y]})}s.push(l)}return s.sort((r,l)=>r.location-l.location),s}const s6={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function i6(n){const e=s6[n];if(!e)throw new Error("sampler");const[t,s]=e;return{viewDimension:t,sampleType:s}}function r6(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function a6(n,e,t,s){const i=n;let r=s;r===!0&&(r=1),r===!1&&(r=0);const l=typeof r=="number"?[r]:r;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof s!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,s);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return i.uniform1uiv(e,l,1);case 36294:return i.uniform2uiv(e,l,2);case 36295:return i.uniform3uiv(e,l,3);case 36296:return i.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return i.uniformMatrix2x3fv(e,!1,l);case 35686:return i.uniformMatrix2x4fv(e,!1,l);case 35687:return i.uniformMatrix3x2fv(e,!1,l);case 35688:return i.uniformMatrix3x4fv(e,!1,l);case 35689:return i.uniformMatrix4x2fv(e,!1,l);case 35690:return i.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function o6(n){return iS(n)!==null||typeof n=="number"||typeof n=="boolean"}function l6(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const s=n[t];o6(s)?e.uniforms[t]=s:e.bindings[t]=s}),e}function c6(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function u6(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const FT=4;class h6 extends Ea{constructor(t,s){super(t,s);w(this,"device");w(this,"handle");w(this,"vs");w(this,"fs");w(this,"introspectedLayout");w(this,"uniforms",{});w(this,"bindings",{});w(this,"varyings",null);w(this,"_uniformCount",0);w(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=s.vs,this.fs=s.fs;const{varyings:i,bufferMode:r=35981}=s;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,r)),this._linkShaders(),ae.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=GD(this.device.gl,this.handle),ae.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=f6(this.introspectedLayout,s.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,s){for(const[i,r]of Object.entries(t)){const l=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(h=>`"${h.name}"`).join(", ");s!=null&&s.disableWarnings||ae.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${c}`,r)();continue}switch(r||ae.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(r instanceof ul)&&!(r.buffer instanceof ul))throw new Error("buffer value");break;case"texture":if(!(r instanceof ma||r instanceof hl||r instanceof cl))throw new Error("texture value");break;case"sampler":ae.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(l.type)}this.bindings[i]=r}}draw(t){var R;const{renderPass:s,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:h,isInstanced:d=!1,firstVertex:g=0,transformFeedback:_}=t,y=c6(r),b=!!l.indexBuffer,T=(R=l.indexBuffer)==null?void 0:R.glIndexType;if(this.linkStatus!=="success")return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(s),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=s;return MD(this.device,i,S.glParameters,()=>{b&&d?this.device.gl.drawElementsInstanced(y,c||0,T,g,h||0):b?this.device.gl.drawElements(y,c||0,T,g):d?this.device.gl.drawArraysInstanced(y,g,c||0,h||0):this.device.gl.drawArrays(y,g,c||0),_&&_.end()}),l.unbindAfterRender(s),!0}setUniformsWebGL(t){const{bindings:s}=l6(t);Object.keys(s).forEach(i=>{ae.warn(`Unsupported value "${JSON.stringify(s[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ae.time(FT,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ae.timeEnd(FT,`linkProgram for ${this.id}`)(),ae.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}ae.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ae.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const s=this._getLinkStatus();this._reportLinkStatus(s)}async _reportLinkStatus(t){var s;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((s=this.fs)==null?void 0:s.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async r=>await new Promise(l=>setTimeout(l,r));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const s of this.shaderLayout.bindings)!this.bindings[s.name]&&!this.bindings[s.name.replace(/Uniforms$/,"")]&&(ae.warn(`Binding ${s.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let s=0,i=0;for(const r of this.shaderLayout.bindings){const l=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:c}=r,h=t.getUniformBlockIndex(this.handle,c);if(h===4294967295)throw new Error(`Invalid uniform block name ${c}`);t.uniformBlockBinding(this.handle,i,h),l instanceof ul?t.bindBufferBase(35345,i,l.handle):t.bindBufferRange(35345,i,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),i+=1;break;case"texture":if(!(l instanceof ma||l instanceof hl||l instanceof cl))throw new Error("texture");let d;if(l instanceof ma)d=l.texture;else if(l instanceof hl)d=l;else if(l instanceof cl&&l.colorAttachments[0]instanceof ma)ae.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=l.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+s),t.bindTexture(d.glTarget,d.handle),s+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:s,location:i,type:r,textureUnit:l}=t,c=this.uniforms[s]??l;c!==void 0&&a6(this.device.gl,i,r,c)}}}function f6(n,e){const t={...n,attributes:n.attributes.map(s=>({...s}))};for(const s of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(r=>r.name===s.name);i?(i.type=s.type||i.type,i.stepMode=s.stepMode||i.stepMode):ae.warn(`shader layout attribute ${s.name} not present in shader`)}return t}class d6 extends lp{constructor(t){super(t,{});w(this,"device");w(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const s of t)switch(s.name){case"copy-buffer-to-buffer":g6(this.device,s.options);break;case"copy-buffer-to-texture":p6(this.device,s.options);break;case"copy-texture-to-buffer":_6(this.device,s.options);break;case"copy-texture-to-texture":m6(this.device,s.options);break;default:throw new Error(s.name)}}}function g6(n,e){const t=e.sourceBuffer,s=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,s.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function p6(n,e){throw new Error("Not implemented")}function _6(n,e){const{sourceTexture:t,mipLevel:s=0,aspect:i="all",width:r=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:h=[0,0],destinationBuffer:d,byteOffset:g=0,bytesPerRow:_,rowsPerImage:y}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(s!==0||c!==0||_||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:T}=SS(t);let S;try{const R=d,k=r||b.width,U=l||b.height,P=pS(b.colorAttachments[0].texture.props.format),D=P.format,$=P.type;n.gl.bindBuffer(35051,R.handle),S=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(h[0],h[1],k,U,D,$,g)}finally{n.gl.bindBuffer(35051,null),S!==void 0&&n.gl.bindFramebuffer(36160,S),T&&b.destroy()}}function m6(n,e){const{sourceTexture:t,destinationMipLevel:s=0,origin:i=[0,0],destinationOrigin:r=[0,0],destinationTexture:l}=e;let{width:c=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:g}=SS(t),[_,y]=i,[b,T,S]=r,R=n.gl.bindFramebuffer(36160,d.handle);let k=null,U;if(l instanceof hl)k=l,c=Number.isFinite(c)?c:k.width,h=Number.isFinite(h)?h:k.height,k.bind(0),U=k.glTarget;else throw new Error("invalid destination");switch(U){case 3553:case 34067:n.gl.copyTexSubImage2D(U,s,b,T,_,y,c,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D(U,s,b,T,S,_,y,c,h);break}k&&k.unbind(),n.gl.bindFramebuffer(36160,R),g&&d.destroy()}function SS(n){if(n instanceof ht){const{width:e,height:t,id:s}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${s}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class y6 extends op{constructor(t,s){super(t,s);w(this,"device");w(this,"commandBuffer");this.device=t,this.commandBuffer=new d6(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,s,i){}}function b6(n){const{target:e,source:t,start:s=0,count:i=1}=n,r=t.length,l=i*r;let c=0;for(let h=s;c<r;c++)e[h++]=t[c];for(;c<l;)c<l-c?(e.copyWithin(s+c,s,s+c),c*=2):(e.copyWithin(s+c,s,s+l-c),c=l);return n.target}class D_ extends cp{constructor(t,s){super(t,s);w(this,"device");w(this,"handle");w(this,"buffer",null);w(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return oE()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const s=t;if(s&&s.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,s?s.handle:null),this.indexBuffer=s,this.device.gl.bindVertexArray(null)}setBuffer(t,s){const i=s;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:l,stride:c,offset:h,normalized:d,integer:g,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),g?this.device.gl.vertexAttribIPointer(t,r,l,c,h):this.device.gl.vertexAttribPointer(t,r,l,d,c,h),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,s){this._enable(t,!1),this.attributes[t]=s}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const s=this.attributes[t];ArrayBuffer.isView(s)&&this.device.setConstantAttributeWebGL(t,s)}}_getAccessor(t){const s=this.attributeInfos[t];if(!s)throw new Error(`Unknown attribute location ${t}`);const i=gS(s.bufferDataType);return{size:s.bufferComponents,type:i,stride:s.byteStride,offset:s.byteOffset,normalized:s.normalized,integer:s.integer,divisor:s.stepMode==="instance"?1:0}}_enable(t,s=!0){const r=D_.isConstantAttributeZeroSupported(this.device)||t!==0;(s||r)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),s?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,s){const i=v6(s),r=i.byteLength*t,l=i.length*t;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),c=c||!T6(i,this.bufferValue),c){const h=eM(s.constructor,l);b6({target:h,source:i,start:0,count:l}),this.buffer.write(h),this.bufferValue=s}return this.buffer}}function v6(n){return Array.isArray(n)?new Float32Array(n):n}function T6(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class w6 extends up{constructor(t,s){super(t,s);w(this,"device");w(this,"gl");w(this,"handle");w(this,"layout");w(this,"buffers",{});w(this,"unusedBuffers",{});w(this,"bindOnUse",!0);w(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,s.buffers&&this.setBuffers(s.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(u6(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const s in t)this.setBuffer(s,t[s])})}setBuffer(t,s){const i=this._getVaryingIndex(t),{buffer:r,byteLength:l,byteOffset:c}=this._getBufferRange(s);if(i<0){this.unusedBuffers[t]=r,ae.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:r,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(i,r,c,l)}getBuffer(t){if(zT(t))return this.buffers[t]||null;const s=this._getVaryingIndex(t);return s>=0?this.buffers[s]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let s;return this._bound?s=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,s=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),s}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof ul)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:s,byteOffset:i=0,byteLength:r=t.buffer.byteLength}=t;return{buffer:s,byteOffset:i,byteLength:r}}_getVaryingIndex(t){if(zT(t))return Number(t);for(const s of this.layout.varyings)if(t===s.name)return s.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:s,byteLength:i,byteOffset:r}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),s,r,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,s,i=0,r){const l=s&&s.handle;!l||r===void 0?this.gl.bindBufferBase(35982,t,l):this.gl.bindBufferRange(35982,t,l,i,r)}}function zT(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class x6 extends hp{constructor(t,s){super(t,s);w(this,"device");w(this,"handle");w(this,"target",null);w(this,"_queryPending",!1);w(this,"_pollingPromise",null);if(this.device=t,s.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let s=0;return this._pollingPromise=new Promise((i,r)=>{const l=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):s++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class ya extends mi{constructor(t){var _,y;super({...t,id:t.id||AD("webgl-device")});w(this,"type","webgl");w(this,"handle");w(this,"features");w(this,"limits");w(this,"info");w(this,"canvasContext");w(this,"lost");w(this,"_resolveContextLost");w(this,"gl");w(this,"debug",!1);w(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});w(this,"_extensions",{});w(this,"_polyfilled",!1);w(this,"spectorJS");w(this,"renderPass",null);w(this,"_constants");const s=mi._getCanvasContextProps(t);if(!s)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(y=(_=s.canvas)==null?void 0:_.gl)==null?void 0:y.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new gD(this,s),this.lost=new Promise(b=>{this._resolveContextLost=b});const r={...t.webgl};s.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),t.powerPreference!==void 0&&(r.powerPreference=t.powerPreference);const c=this.props._handle||YN(this.canvasContext.canvas,{onContextLost:b=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:b=>console.log("WebGL context restored")},r);if(!c)throw new Error("WebGL context creation failed");if(i=c.device,i){if(t._reuseDevices)return ae.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=c,this.gl=c,this.spectorJS=mD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=KN(this.gl,this._extensions),this.limits=new hD(this.gl),this.features=new uD(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),s.autoResize!==!1&&this.canvasContext.resize(),new sr(this.gl,{log:(...b)=>ae.log(1,...b)()}).trackState(this.gl,{copyState:!1});const d=t.debugWebGL||t.debug,g=t.debugWebGL;d&&(this.gl=vD(this.gl,{debugWebGL:d,traceWebGL:g}),ae.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ae.level=Math.max(ae.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const s=this._normalizeBufferProps(t);return new ul(this,s)}createTexture(t){return new hl(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new kp(this,t)}createShader(t){return new OD(this,t)}createFramebuffer(t){return new cl(this,t)}createVertexArray(t){return new D_(this,t)}createTransformFeedback(t){return new w6(this,t)}createQuerySet(t){return new x6(this,t)}createRenderPipeline(t){return new h6(this,t)}beginRenderPass(t){return new YD(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new y6(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,s){return $D(t,s)}readPixelsToBufferWebGL(t,s){return HD(t,s)}setParametersWebGL(t){za(this.gl,t)}getParametersWebGL(t){return fS(this.gl,t)}withParametersWebGL(t,s){return sh(this.gl,t,s)}resetWebGL(){ae.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),$N(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return aD(this.gl,t,this._extensions)}loseDevice(){var r;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(r=this._resolveContextLost)==null||r.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){sr.get(this.gl).push()}popState(){sr.get(this.gl).pop()}setSpectorMetadata(t,s){t.__SPECTOR_Metadata=s}getGLKey(t,s){const i=Number(t);for(const r in this.gl)if(this.gl[r]===i)return`GL.${r}`;return s!=null&&s.emptyIfUnknown?"":String(t)}getGLKeys(t){const s={emptyIfUnknown:!0};return Object.entries(t).reduce((i,[r,l])=>(i[`${r}:${this.getGLKey(r,s)}`]=`${l}:${this.getGLKey(l,s)}`,i),{})}setConstantAttributeWebGL(t,s){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const r=this._constants[t];switch(r&&R6(r,s)&&ae.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=s,s.constructor){case Float32Array:S6(this,t,s);break;case Int32Array:A6(this,t,s);break;case Uint32Array:E6(this,t,s);break;default:throw new Error("constant")}}getExtension(t){return ka(this.gl,t,this._extensions),this._extensions}}function S6(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function A6(n,e,t){n.gl.vertexAttribI4iv(e,t)}function E6(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function R6(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const C6={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},O6=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),M6=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),P6=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function I6(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,s){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",s);return i instanceof HTMLElement&&k6(i),i}return this.originalGetContext(t,s)}}function k6(n){n.getExtension("EXT_color_buffer_float");const e={...C6,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:O6(n),OES_vertex_array_object:M6(n),ANGLE_instanced_arrays:P6(n)},t=n.getExtension;n.getExtension=function(i){const r=t.call(n,i);return r||(i in e?e[i]:null)};const s=n.getSupportedExtensions;n.getSupportedExtensions=function(){const i=s.apply(n)||[];return i==null?void 0:i.concat(Object.keys(e))}}const iu=1;class N6 extends MO{constructor(){super();w(this,"type","webgl");mi.defaultProps={...mi.defaultProps,...N_},ya.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){I6(t)}async attach(t){if(t instanceof ya)return t;if((t==null?void 0:t.device)instanceof mi)return t.device;if(!D6(t))throw new Error("Invalid WebGL2RenderingContext");return new ya({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ae.groupCollapsed(iu,"WebGLDevice created")();const s=[];(t.debugWebGL||t.debug)&&s.push(bD()),t.debugSpectorJS&&s.push(_D(t));const i=await Promise.allSettled(s);for(const c of i)c.status==="rejected"&&ae.error(`Failed to initialize debug libraries ${c.reason}`)();const r=new ya(t),l=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return ae.probe(iu,l)(),ae.table(iu,r.info)(),ae.groupEnd(iu)(),r}}function D6(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const VT=new N6;function ii(){}const B6=({isDragging:n})=>n?"grabbing":"grab",AS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ii,onWebGLInitialized:ii,onResize:ii,onViewStateChange:ii,onInteractionStateChange:ii,onBeforeRender:ii,onAfterRender:ii,onLoad:ii,onError:n=>De.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:B6,getTooltip:null,debug:!1,drawPickingColors:!1};class B_{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new El({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=s=>{const{_pickRequest:i}=this;if(s.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(s.leftButton||s.rightButton)return;{const r=s.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=s},this._onEvent=s=>{const i=Tp[s.type],r=s.offsetCenter;if(!i||!r||!this.layerManager)return;const l=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:l,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:h}=c,d=h&&(h[i]||h.props[i]),g=this.props[i];let _=!1;d&&(_=d.call(h,c,s)),_||(g==null||g(c,s),this.widgetManager.onEvent(c,s))},this._onPointerDown=s=>{var l;if(((l=this.device)==null?void 0:l.type)==="webgpu")return;const i=s.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...AS,...e},e=this.props,e.viewState&&e.initialViewState&&De.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&De.error("WebGL1 context not supported.")(),t=VT.attach(e.gl)),t||(t=ip.createDevice({type:"best-available",_reuseDevices:!0,adapters:[VT],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Ma.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,s,i,r,l,c,h,d,g;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(s=this.layerManager)==null||s.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(r=this.effectManager)==null||r.finalize(),this.effectManager=null,(l=this.deckRenderer)==null||l.finalize(),this.deckRenderer=null,(c=this.deckPicker)==null||c.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((g=this.canvas.parentElement)==null||g.removeChild(this.canvas),this.canvas=null)}setProps(e){var s;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&De.removed("onLayerHover","onHover")(),"onLayerClick"in e&&De.removed("onLayerClick","onClick")(),e.initialViewState&&!jn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(s=this.animationLoop)==null||s.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||s||i||r||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Bt(this.viewManager),this.viewManager.views}getViewports(e){return Bt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const s in e)this.layerManager.resourceManager.add({resourceId:s,data:e[s],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,s){Bt(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Bt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:s}=e;if(t||t===0){const r=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=r}if(s||s===0){const r=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){var i,r;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,s=e.clientHeight??e.height;(t!==this.width||s!==this.height)&&(this.width=t,this.height=s,(i=this.viewManager)==null||i.setProps({width:t,height:s}),(r=this.layerManager)==null||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:s}))}_createAnimationLoop(e,t){const{gl:s,onError:i,useDevicePixels:r}=t;return new F4({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new M_({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,s,i,r;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:c}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let h=c,d=!1;for(const g of l)h=g,d=((s=g.layer)==null?void 0:s.onHover(g,e.event))||d;d||((r=(i=this.props).onHover)==null||r.call(i,h,e.event),this.widgetManager.onHover(h,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,r;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new sS;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new Tk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(lT).map(l=>{var b;const[c,h,d,g]=lT[l],_=(b=this.props.eventRecognizerOptions)==null?void 0:b[l],y={...h,..._,event:l};return{recognizer:new c(y),recognizeWith:d,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in Tp)this.eventManager.on(l,this._onEvent);this.viewManager=new cN({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new lN(this.device,{deck:this,stats:this.stats,viewport:s,timeline:t}),this.effectManager=new AN({deck:this,device:this.device}),this.deckRenderer=new CN(this.device),this.deckPicker=new NN(this.device),this.widgetManager=new UN({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new FN),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var l;const{device:s,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:i});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(l=this.deckRenderer)==null||l.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:s,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),De.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const s=ip.stats.get("Memory Usage");e.bufferMemory=s.get("Buffer Memory").count,e.textureMemory=s.get("Texture Memory").count,e.renderbufferMemory=s.get("Renderbuffer Memory").count,e.gpuMemory=s.get("GPU Memory").count}}B_.defaultProps=AS;B_.VERSION=DC;function U6(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Gw(n)}}const L6=Qw;function ru(n,e){return{attribute:n,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ji(n){return n.stride||n.size*n.bytesPerElement}function F6(n,e){return n.type===e.type&&n.size===e.size&&Ji(n)===Ji(e)&&(n.offset||0)===(e.offset||0)}function Np(n,e){e.offset&&De.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Ji(n),s=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,r=s*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:r,stride:t}}function z6(n,e){const t=Np(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class V6{constructor(e,t,s){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r=i==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;r?c="float32":!i&&t.isIndexed?c="uint32":c=i||"float32";let h=U6(i||c);this.doublePrecision=r,r&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:l,logicalType:i,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ji(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ma.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const s={};if(this.state.constant){const i=this.value;if(t){const r=Np(this.getAccessor(),t),l=r.offset/i.BYTES_PER_ELEMENT,c=r.size||this.size;s[e]=i.subarray(l,l+c)}else s[e]=i}else s[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?s[`${e}64Low`]=s[e]:s[`${e}64Low`]=new Float32Array(this.size)),s}_getBufferLayout(e=this.id,t=null){const s=this.getAccessor(),i=[],r={name:this.id,byteStride:Ji(s),attributes:i};if(this.doublePrecision){const l=z6(s,t||{});i.push(ru(e,{...s,...l.high}),ru(`${e}64Low`,{...s,...l.low}))}else if(t){const l=Np(s,t);i.push(ru(e,{...s,...l}))}else i.push(ru(e,s));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:s,size:i}=this,r=s*i;if(t&&r&&t.length>=r){const l=new Array(i).fill(1/0),c=new Array(i).fill(-1/0);for(let h=0;h<r;)for(let d=0;d<i;d++){const g=t[h++];g<l[d]&&(l[d]=g),g>c[d]&&(c[d]=g)}e=[l,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let s;ArrayBuffer.isView(e)?s={value:e}:e instanceof at?s={buffer:e}:s=e;const i={...this.settings,...s};if(ArrayBuffer.isView(s.value)){if(!s.type)if(this.doublePrecision&&s.value instanceof Float64Array)i.type="float32";else{const l=L6(s.value);i.type=i.normalized?l.replace("int","norm"):l}i.bytesPerElement=s.value.BYTES_PER_ELEMENT,i.stride=Ji(i)}if(t.bounds=null,s.constant){let r=s.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!t.constant||!this._areValuesEqual(r,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(s.buffer){const r=s.buffer;t.externalBuffer=r,t.constant=!1,this.value=s.value||null}else if(s.value){this._checkExternalBuffer(s);let r=s.value;t.externalBuffer=null,t.constant=!1,this.value=r;let{buffer:l}=this;const c=Ji(i),h=(i.vertexOffset||0)*c;if(this.doublePrecision&&r instanceof Float64Array&&(r=Rg(r,i)),this.settings.isIndexed){const g=this.settings.defaultType;r.constructor!==g&&(r=new g(r))}const d=r.byteLength+h+c*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(r,h)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:s=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Rg(t,{size:this.size,startIndex:s,endIndex:i}):t.subarray(s,i),s*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:s}=this,i=s.allocatedValue,r=Ma.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<r.byteLength+l)&&(c=this._createBuffer(r.byteLength+l),t&&i&&c.write(i instanceof Float64Array?Rg(i,this):i,l)),s.allocatedValue=r,s.constant=!1,s.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const s=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof s)&&this.settings.normalized&&!("normalized"in e)&&De.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,s){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[s]=e,t;if(!e){let l=r;for(;--l>=0;)t[s+l]=i[l];return t}switch(r){case 4:t[s+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[s+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[s+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[s+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let l=r;for(;--l>=0;)t[s+l]=Number.isFinite(e[l])?e[l]:i[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:s}=this;for(let i=0;i<s;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:s}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(t?at.INDEX:at.VERTEX)|at.COPY_DST,indexType:t?s:void 0,byteLength:e}),this._buffer}}const jT=[],$T=[];function Ph(n,e=0,t=1/0){let s=jT;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?s=n:n.length>0&&($T.length=n.length,s=$T):s=jT,(e>0||Number.isFinite(t))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(e,t),i.index=e-1),{iterable:s,objectInfo:i}}function ES(n){return n&&n[Symbol.asyncIterator]}function RS(n,e){const{size:t,stride:s,offset:i,startIndices:r,nested:l}=e,c=n.BYTES_PER_ELEMENT,h=s?s/c:t,d=i?i/c:0,g=Math.floor((n.length-d)/h);return(_,{index:y,target:b})=>{if(!r){const k=y*h+d;for(let U=0;U<t;U++)b[U]=n[k+U];return b}const T=r[y],S=r[y+1]||g;let R;if(l){R=new Array(S-T);for(let k=T;k<S;k++){const U=k*h+d;b=new Array(t);for(let P=0;P<t;P++)b[P]=n[U+P];R[k-T]=b}}else if(h===t)R=n.subarray(T*t+d,S*t+d);else{R=new n.constructor((S-T)*t);let k=0;for(let U=T;U<S;U++){const P=U*h+d;for(let D=0;D<t;D++)R[k++]=n[P+D]}}return R}}const j6=[],Cu=[[0,1/0]];function $6(n,e){if(n===Cu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],s=n.length;let i=0;for(let r=0;r<s;r++){const l=n[r];l[1]<e[0]?(t.push(l),i=r+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(i,0,e),t}const H6={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function CS(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...H6[t],...e,...n,type:t}}class OS extends V6{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Cu}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!F6(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,s=this.settings.transition,i=Array.isArray(t)?e[t.find(r=>e[r])]:e[t];return CS(i,s)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:s=0,endRow:i=1/0}=t;this.state.updateRanges=$6(this.state.updateRanges,[s,i])}else this.state.updateRanges=Cu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=j6}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:s}=this;return s.noAlloc?!1:s.update?(super.allocate(e,t.updateRanges!==Cu),!0):!1}updateBuffer({numInstances:e,data:t,props:s,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:l,noAlloc:c}}=this;let h=!0;if(l){for(const[d,g]of r)l.call(i,this,{data:t,startRow:d,endRow:g,props:s,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,g]of r){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(g)?this.getVertexOffset(g):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:s,settings:i}=this;if(!e)return s.binaryValue=null,s.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(s.binaryValue===e)return this.clearNeedsUpdate(),!0;if(s.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Bt(ArrayBuffer.isView(l.value),`invalid ${i.accessor}`);const c=!!l.size&&l.size!==this.size;return s.binaryAccessor=RS(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const s in e)Object.assign(t,super.getValue(s,e[s]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,s=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?s.stepMode=e?e.isInstanced?"instance":"vertex":"instance":s.stepMode=i??"vertex",!t)return s;for(const r in t){const l=super._getBufferLayout(r,t[r]);s.attributes.push(...l.attributes)}return s}_autoUpdater(e,{data:t,startRow:s,endRow:i,props:r,numInstances:l}){if(e.constant)return;const{settings:c,state:h,value:d,size:g,startIndices:_}=e,{accessor:y,transform:b}=c,T=h.binaryAccessor||(typeof y=="function"?y:r[y]);Bt(typeof T=="function",`accessor "${y}" is not a function`);let S=e.getVertexOffset(s);const{iterable:R,objectInfo:k}=Ph(t,s,i);for(const U of R){k.index++;let P=T(U,k);if(b&&(P=b.call(this,P)),_){const D=(k.index<_.length-1?_[k.index+1]:l)-_[k.index];if(P&&Array.isArray(P[0])){let $=S;for(const Z of P)e._normalizeValue(Z,d,$),$+=g}else P&&P.length>g?d.set(P,S):(e._normalizeValue(P,k.target,0),sN({target:d,source:k.target,start:S,count:D}));S+=D*g}else e._normalizeValue(P,d,S),S+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let s=!0;switch(t){case 4:s=s&&Number.isFinite(e[3]);case 3:s=s&&Number.isFinite(e[2]);case 2:s=s&&Number.isFinite(e[1]);case 1:s=s&&Number.isFinite(e[0]);break;default:s=!1}if(!s)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Bg(n){const{source:e,target:t,start:s=0,size:i,getData:r}=n,l=n.end||t.length,c=e.length,h=l-s;if(c>h){t.set(e.subarray(0,h),s);return}if(t.set(e,s),!r)return;let d=c;for(;d<h;){const g=r(d,e);for(let _=0;_<i;_++)t[s+d]=g[_]||0,d++}}function W6({source:n,target:e,size:t,getData:s,sourceStartIndices:i,targetStartIndices:r}){if(!i||!r)return Bg({source:n,target:e,size:t,getData:s}),e;let l=0,c=0;const h=s&&((g,_)=>s(g+c,_)),d=Math.min(i.length,r.length);for(let g=1;g<d;g++){const _=i[g]*t,y=r[g]*t;Bg({source:n.subarray(l,_),target:e,start:c,end:y,size:t,getData:h}),l=_,c=y}return c<e.length&&Bg({source:[],target:e,start:c,size:t,getData:h}),e}function X6(n){const{device:e,settings:t,value:s}=n,i=new OS(e,t);return i.setData({value:s instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function MS(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function PS(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function IS(n){n.push(n.shift())}function q6(n,e){const{doublePrecision:t,settings:s,value:i,size:r}=n,l=t&&i instanceof Float64Array?2:1;let c=0;const{shaderAttributes:h}=n.settings;if(h)for(const d of Object.values(h))c=Math.max(c,d.vertexOffset??0);return(s.noAlloc?i.length:(e+c)*r)*l}function kS({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function NS({device:n,buffer:e,attribute:t,fromLength:s,toLength:i,fromStartIndices:r,getData:l=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,h=t.size*c,d=t.byteOffset,g=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,_=t.startIndices,y=r&&_,b=t.isConstant;if(!y&&e&&s>=i)return e;const T=t.value instanceof Float64Array?Float32Array:t.value.constructor,S=b?t.value:new T(t.getBuffer().readSyncWebGL(d,i*T.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const P=l;l=(D,$)=>t.normalizeConstant(P(D,$))}const R=b?(P,D)=>l(S,D):(P,D)=>l(S.subarray(P+d,P+d+h),D),k=e?new Float32Array(e.readSyncWebGL(g,s*4).buffer):new Float32Array(0),U=new Float32Array(i);return W6({source:k,target:U,sourceStartIndices:r,targetStartIndices:_,size:h,getData:R}),(!e||e.byteLength<U.byteLength+g)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:U.byteLength+g,usage:35050})),e.write(U,g),e}class DS{constructor({device:e,attribute:t,timeline:s}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Mh(s),this.attribute=t,this.attributeInTransition=X6(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,s=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=q6(this.attribute,t),this.transition.start({...e,duration:s})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Y6 extends DS{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="interpolation",this.transform=G6(e,t)}start(e,t){const s=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:l}=this;IS(r),r[0]=NS({device:this.device,buffer:r[0],attribute:l,fromLength:s,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=kS({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:c}=this,h=c.model;let d=Math.floor(this.currentLength/l.size);BS(l)&&(d/=2),h.setVertexCount(d),l.isConstant?(h.setAttributes({aFrom:r[0]}),h.setConstantAttributes({aTo:l.value})):h.setAttributes({aFrom:r[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:s}=this.transition;let i=s/e;t&&(i=t(i));const{model:r}=this.transform,l={time:i};r.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const K6=`uniform interpolationUniforms {
  float time;
} interpolation;
`,HT={name:"interpolation",vs:K6,uniformTypes:{time:"f32"}},Z6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Q6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function BS(n){return n.doublePrecision&&n.value instanceof Float64Array}function G6(n,e){const t=e.size,s=MS(t),i=PS(t),r=e.getBufferLayout();return BS(e)?new vl(n,{vs:Q6,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[dI,HT],defines:{ATTRIBUTE_TYPE:s,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new vl(n,{vs:Z6,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:r.attributes[0].format}],modules:[HT],defines:{ATTRIBUTE_TYPE:s},varyings:["vCurrent"],disableWarnings:!0})}class J6 extends DS{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="spring",this.texture=rB(e),this.framebuffer=aB(e,this.texture),this.transform=iB(e,t)}start(e,t){const s=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:l}=this;for(let h=0;h<2;h++)r[h]=NS({device:this.device,buffer:r[h],attribute:l,fromLength:s,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=kS({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:s,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:s,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),IS(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(s)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const eB=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,tB={name:"spring",vs:eB,uniformTypes:{damping:"f32",stiffness:"f32"}},nB=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,sB=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function iB(n,e){const t=MS(e.size),s=PS(e.size);return new vl(n,{vs:nB,fs:sB,bufferLayout:[{name:"aPrev",format:s},{name:"aCur",format:s},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[tB],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function rB(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function aB(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const oB={interpolation:Y6,spring:J6};class lB{constructor(e,{id:t,timeline:s}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:s}){this.numInstances=s||1;for(const i in e){const r=e[i],l=r.getTransitionSetting(t);l&&this._updateAttribute(i,r,l)}for(const i in this.transitions){const r=e[i];(!r||!r.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const s=this.transitions[t];s.inProgress&&(e[t]=s.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,s){const i=this.transitions[e];let r=!i||i.type!==s.type;if(r){i&&this._removeTransition(e);const l=oB[s.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(De.error(`unsupported transition type '${s.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(s,this.numInstances))}}const WT="attributeManager.invalidate",cB="attributeManager.updateStart",uB="attributeManager.updateEnd",hB="attribute.updateStart",fB="attribute.allocate",dB="attribute.updateEnd";class gB{constructor(e,{id:t="attribute-manager",stats:s,timeline:i}={}){this.mergeBoundsMemoized=Ol(E4),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new lB(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const s=this._invalidateTrigger(e,t);Wt(WT,this,e,s)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Wt(WT,this,"all")}update({data:e,numInstances:t,startIndices:s=null,transitions:i,props:r={},buffers:l={},context:c={}}){let h=!1;Wt(cB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const g=this.attributes[d],_=g.settings.accessor;g.startIndices=s,g.numInstances=t,r[d]&&De.removed(`props.${d}`,`data.attributes.${d}`)(),g.setExternalBuffer(l[d])||g.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&g.setConstantValue(r[_])||g.needsUpdate()&&(h=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:r,context:c})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}h&&Wt(uB,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(s=>{var i;return(i=this.attributes[s])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:s}=this,i={...s.getAttributes()};for(const r in t){const l=t[r];l.needsRedraw(e)&&!s.hasAttribute(r)&&(i[r]=l)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const s in e){const i=e[s],r={...i,id:s,size:i.isIndexed&&1||i.size||1,...t};this.attributes[s]=new OS(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:s,updateTriggers:i}=this,r=i[e];return r&&r.forEach(l=>{const c=s[l];c&&c.setNeedsUpdate(c.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:s}=e;if(Wt(hB,t),t.constant){t.setConstantValue(t.value);return}t.allocate(s)&&Wt(fB,t,s),t.updateBuffer(e)&&(this.needsRedraw=!0,Wt(dB,t,s))}}class pB extends Mh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:s,duration:i,easing:r}}=this,l=r(e/i);this._value=tr(t,s,l)}}const XT=1e-5;function qT(n,e,t,s,i){const r=e-n,c=(t-e)*i,h=-r*s;return c+h+r+e}function _B(n,e,t,s,i){if(Array.isArray(t)){const r=[];for(let l=0;l<t.length;l++)r[l]=qT(n[l],e[l],t[l],s,i);return r}return qT(n,e,t,s,i)}function YT(n,e){if(Array.isArray(n)){let t=0;for(let s=0;s<n.length;s++){const i=n[s]-e[s];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class mB extends Mh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:s,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:l=e}=this;let c=_B(r,l,t,s,i);const h=YT(c,t),d=YT(c,l);h<XT&&d<XT&&(c=t,this.end()),this._prevValue=l,this._currValue=c}}const yB={interpolation:pB,spring:mB};class bB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,s,i){const{transitions:r}=this;if(r.has(e)){const h=r.get(e),{value:d=h.settings.fromValue}=h;t=d,this.remove(e)}if(i=CS(i),!i)return;const l=yB[i.type];if(!l){De.error(`unsupported transition type '${i.type}'`)();return}const c=new l(this.timeline);c.start({...i,fromValue:t,toValue:s}),r.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,s]of this.transitions)s.update(),e[t]=s.value,s.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function vB(n){const e=n[bi];for(const t in e){const s=e[t],{validate:i}=s;if(i&&!i(n[t],s))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function TB(n,e){const t=US({newProps:n,oldProps:e,propTypes:n[bi],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=xB(n,e);let i=!1;return s||(i=SB(n,e)),{dataChanged:s,propsChanged:t,updateTriggersChanged:i,extensionsChanged:AB(n,e),transitionsChanged:wB(n,e)}}function wB(n,e){if(!n.transitions)return!1;const t={},s=n[bi];let i=!1;for(const r in n.transitions){const l=s[r],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&Dp(n[r],e[r],l)&&(t[r]=!0,i=!0)}return i?t:!1}function US({newProps:n,oldProps:e,ignoreProps:t={},propTypes:s={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const r of Object.keys(n))if(!(r in t)){if(!(r in e))return`${i}.${r} added`;const l=Dp(n[r],e[r],s[r]);if(l)return`${i}.${r} ${l}`}for(const r of Object.keys(e))if(!(r in t)){if(!(r in n))return`${i}.${r} dropped`;if(!Object.hasOwnProperty.call(n,r)){const l=Dp(n[r],e[r],s[r]);if(l)return`${i}.${r} ${l}`}}return!1}function Dp(n,e,t){let s=t&&t.equal;return s&&!s(n,e,t)||!s&&(s=n&&e&&n.equals,s&&!s.call(n,e))?"changed deeply":!s&&e!==n?"changed shallowly":null}function xB(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:s,_dataDiff:i}=n;return s?s(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function SB(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&KT(n,e,"all"))return{all:!0};const t={};let s=!1;for(const i in n.updateTriggers)i!=="all"&&KT(n,e,i)&&(t[i]=!0,s=!0);return s?t:!1}function AB(n,e){if(e===null)return!0;const t=e.extensions,{extensions:s}=n;if(s===t)return!1;if(!t||!s||s.length!==t.length)return!0;for(let i=0;i<s.length;i++)if(!s[i].equals(t[i]))return!0;return!1}function KT(n,e,t){let s=n.updateTriggers[t];s=s??{};let i=e.updateTriggers[t];return i=i??{},US({oldProps:i,newProps:s,triggerName:t})}const EB="count(): argument not an object",RB="count(): argument not a container";function CB(n){if(!MB(n))throw new Error(EB);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(OB(n))return Object.keys(n).length;throw new Error(RB)}function OB(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function MB(n){return n!==null&&typeof n=="object"}function ZT(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(s=>s.name==="project64"))){const s=t.modules.findIndex(i=>i.name==="project32");s>=0&&t.modules.splice(s,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const s={...n.inject};for(const i in e.inject)s[i]=(s[i]||"")+e.inject[i];t.inject=s}return t}const PB={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Bp={};function IB(n,e,t,s){if(t instanceof ht)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const r=e.createTexture({...t,sampler:{...PB,...i,...s},mipmaps:!0});return Bp[r.id]=n,r}function kB(n,e){!e||!(e instanceof ht)||Bp[e.id]===n&&(e.delete(),delete Bp[e.id])}const NB={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Up(n)&&(n.length===3||n.length===4)},equal(n,e,t){return jn(n,e,1)}},accessor:{validate(n,e){const t=ih(n);return t==="function"||t===ih(e.value)},equal(n,e,t){return typeof e=="function"?!0:jn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Up(n)},equal(n,e,t){const{compare:s}=t,i=Number.isInteger(s)?s:s?1:0;return s?jn(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:s}=t,i=Number.isInteger(s)?s:s?1:0;return s?jn(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:s}=t.props;return s?s(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const s=t.context;return!s||!s.device?null:IB(t.id,s.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{kB(t.id,n)}}};function DB(n){const e={},t={},s={};for(const[i,r]of Object.entries(n)){const l=r==null?void 0:r.deprecatedFor;if(l)s[i]=Array.isArray(l)?l:[l];else{const c=BB(i,r);e[i]=c,t[i]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:s}}function BB(n,e){switch(ih(e)){case"object":return Ho(n,e);case"array":return Ho(n,{type:"array",value:e,compare:!1});case"boolean":return Ho(n,{type:"boolean",value:e});case"number":return Ho(n,{type:"number",value:e});case"function":return Ho(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Ho(n,e){return"type"in e?{name:n,...NB[e.type],...e}:"value"in e?{name:n,type:ih(e.value),...e}:{name:n,type:"object",value:e}}function Up(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function ih(n){return Up(n)?"array":n===null?"null":typeof n}function UB(n,e){let t;for(let r=e.length-1;r>=0;r--){const l=e[r];"extensions"in l&&(t=l.extensions)}const s=Lp(n.constructor,t),i=Object.create(s);i[nh]=n,i[cr]={},i[pi]={};for(let r=0;r<e.length;++r){const l=e[r];for(const c in l)i[c]=l[c]}return Object.freeze(i),i}const LB="_mergedDefaultProps";function Lp(n,e){if(!(n instanceof Ih.constructor))return{};let t=LB;if(e)for(const i of e){const r=i.constructor;r&&(t+=`:${r.extensionName||r.name}`)}const s=LS(n,t);return s||(n[t]=FB(n,e||[]))}function FB(n,e){if(!n.prototype)return null;const s=Object.getPrototypeOf(n),i=Lp(s),r=LS(n,"defaultProps")||{},l=DB(r),c=Object.assign(Object.create(null),i,l.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[bi],l.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[Pg],l.deprecatedProps);for(const g of e){const _=Lp(g.constructor);_&&(Object.assign(c,_),Object.assign(h,_[bi]),Object.assign(d,_[Pg]))}return zB(c,n),jB(c,h),VB(c,d),c[bi]=h,c[Pg]=d,e.length===0&&!U_(n,"_propTypes")&&(n._propTypes=h),c}function zB(n,e){const t=HB(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function VB(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(s){const i=`${this.id}: ${t}`;for(const r of e[t])U_(this,r)||(this[r]=s);De.deprecated(i,e[t].join("/"))()}})}function jB(n,e){const t={},s={};for(const i in e){const r=e[i],{name:l,value:c}=r;r.async&&(t[l]=c,s[l]=$B(l))}n[xa]=t,n[cr]={},Object.defineProperties(n,s)}function $B(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||ES(e)?this[cr][n]=e:this[pi][n]=e},get(){if(this[pi]){if(n in this[pi])return this[pi][n]||this[xa][n];if(n in this[cr]){const e=this[nh]&&this[nh].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[xa][n]}}return this[xa][n]}}}function U_(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function LS(n,e){return U_(n,e)&&n[e]}function HB(n){const e=n.componentName;return e||De.warn(`${n.name}.componentName not specified`)(),e||n.name}let WB=0;class Ih{constructor(...e){this.props=UB(this,e),this.id=this.props.id,this.count=WB++}clone(e){const{props:t}=this,s={};for(const i in t[xa])i in t[pi]?s[i]=t[pi][i]:i in t[cr]&&(s[i]=t[cr][i]);return new this.constructor({...t,...s,...e})}}Ih.componentName="Component";Ih.defaultProps={};const XB=Object.freeze({});class qB{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||XB}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[nh]||this.component;const t=e[pi]||{},s=e[cr]||e,i=e[xa]||{};for(const r in t){const l=t[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,l),t[r]=this.getAsyncProp(r)}for(const r in s){const l=s[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(ES(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const s=this.asyncProps[e];return t===s.resolvedValue||t===s.lastValue?!1:(s.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const s=this.asyncProps[e];s&&(t=this._postProcessValue(s,t),s.resolvedValue=t,s.pendingLoadCount++,s.resolvedLoadCount=s.pendingLoadCount)}_setAsyncPropValue(e,t,s){const i=this.asyncProps[e];i&&s>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=s,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const s=this.asyncProps[e];if(s){s.pendingLoadCount++;const i=s.pendingLoadCount;t.then(r=>{this.component&&(r=this._postProcessValue(s,r),this._setAsyncPropValue(e,r,i),this._onResolve(e,r))}).catch(r=>{this._onError(e,r)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const s=this.asyncProps[e];if(!s)return;s.pendingLoadCount++;const i=s.pendingLoadCount;let r=[],l=0;for await(const c of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?r=h(c,r):r=r.concat(c),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:l,endRow:r.length}]}),l=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const s=e.type;return s&&this.component&&(s.release&&s.release(e.resolvedValue,s,this.component),s.transform)?s.transform(t,s,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[bi];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class YB extends qB{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const s=this.layer,i=s==null?void 0:s.props.fetch;return i?i(t,{propName:e,layer:s}):super._fetch(e,t)}_onResolve(e,t){const s=this.layer;if(s){const i=s.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:s})}}_onError(e,t){const s=this.layer;s&&s.raiseError(t,`loading ${e} of ${this.layer}`)}}const KB="layer.changeFlag",ZB="layer.initialize",QB="layer.update",GB="layer.finalize",JB="layer.matched",QT=2**24-1,eU=Object.freeze([]),tU=Ol(({oldViewport:n,viewport:e})=>n.equals(e));let Bn=new Uint8ClampedArray(0);const nU={data:{type:"data",value:eU,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:s,loadOptions:i,signal:r})=>{const{resourceManager:l}=t.context;i=i||t.getLoadOptions(),s=s||t.props.loaders,r&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:r}});let c=l.contains(n);return!c&&!i&&(l.add({resourceId:n,data:Lu(n,s),persistent:!1}),c=!0),c?l.subscribe({resourceId:n,onChange:h=>{var d;return(d=t.internalState)==null?void 0:d.reloadAsyncProp(e,h)},consumerId:t.id,requestId:e}):Lu(n,s,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ze.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class rs extends Ih{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ha.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Bt(this.internalState);const t=this.internalState.viewport||this.context.viewport,s=nS(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,l]=Gx(s,t.pixelProjectionMatrix);return e.length===2?[i,r]:[i,r,l]}unproject(e){return Bt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Bt(this.internalState);const s=this.internalState.viewport||this.context.viewport;return I4(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ze.DEFAULT||e===ze.LNGLAT||e===ze.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Bt(e instanceof Uint8Array);const[t,s,i]=e;return t+s*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:CB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=ZT(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=ZT(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:s}=e.changeFlags;if(s&&t)if(Array.isArray(s))for(const i of s)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,r=this.internalState.hasPickingBuffer,l=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(r!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:h}=t.attributes,d=c||h;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const s of this.getModels())s.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:s}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var s,i,r,l;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(s=this.props).onError)!=null&&i.call(s,e)||(l=(r=this.context)==null?void 0:r.onError)==null||l.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!tU({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const s in e)e[s].layoutChanged()&&(t=!0);for(const s of this.getModels())this._setModelAttributes(s,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,s=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:s,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),s=Object.create(this.props);for(const i in t)Object.defineProperty(s,i,{value:t[i]});return s}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const s=Math.floor(Bn.length/4);if(this.internalState.usesPickingColorCache=!0,s<t){t>QT&&De.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Bn=Ma.allocate(Bn,t,{size:4,copy:!0,maxCount:Math.max(t,QT)});const i=Math.floor(Bn.length/4),r=[0,0,0];for(let l=s;l<i;l++)this.encodePickingColor(l,r),Bn[l*4+0]=r[0],Bn[l*4+1]=r[1],Bn[l*4+2]=r[2],Bn[l*4+3]=0}e.value=Bn.subarray(0,t*4)}_setModelAttributes(e,t,s=!1){var c;if(!Object.keys(t).length)return;if(s){const h=this.getAttributeManager();e.setBufferLayout(h.getBufferLayouts(e)),t=h.getAttributes()}const i=((c=e.userData)==null?void 0:c.excludeAttributes)||{},r={},l={};for(const h in t){if(i[h])continue;const d=t[h].getValue();for(const g in d){const _=d[g];_ instanceof at?t[h].settings.isIndexed?e.setIndexBuffer(_):r[g]=_:_&&(l[g]=_)}}e.setAttributes(r),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:s,instancePickingColors:i}=this.getAttributeManager().attributes,r=s||i,l=r&&t.attributes&&t.attributes[r.id];if(l&&l.value){const c=l.value,h=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const g=r.getVertexOffset(d);c[g]===h[0]&&c[g+1]===h[1]&&c[g+2]===h[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:s}=this.getAttributeManager().attributes,i=t||s;if(!i)return;const r=i.getVertexOffset(e),l=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(l-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,s=e||t;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==Bn.buffer&&(s.value=Bn.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){Bt(!this.internalState),Bt(Number.isFinite(this.props.coordinateSystem)),Wt(ZB,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new YB({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(De.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new bB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Wt(JB,this,this===e);const{state:t,internalState:s}=e;this!==e&&(this.internalState=s,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Wt(QB,this,e),!e)return;const t=this.props,s=this.context,i=this.internalState,r=s.viewport,l=this._updateUniformTransition();i.propsInTransition=l,s.viewport=i.viewport||r,this.props=l;try{const c=this._getUpdateParams(),h=this.getModels();if(s.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const g of this.props.extensions)g.updateState.call(this,c,g);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==h[0];this._postUpdate(c,d)}finally{s.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Wt(GB,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:s={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,l=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:c}=this.props,h=c&&c(s)||[0,0];l.device instanceof ya&&l.device.setParametersWebGL({polygonOffset:h});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(l.device instanceof ya)l.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:i,context:l};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:i,context:l};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)}}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let r=!1;switch(i){case"dataChanged":const l=e[i],c=t[i];l&&Array.isArray(c)&&(t.dataChanged=Array.isArray(l)?c.concat(l):l,r=!0);default:t[i]||(t[i]=e[i],r=!0)}r&&Wt(KB,this,i,e)}const s=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=s,t.somethingChanged=s||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const s=TB(e,t);if(s.updateTriggersChanged)for(const r in s.updateTriggersChanged)s.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(s.transitionsChanged)for(const r in s.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],(i=e.transitions)==null?void 0:i[r]);return this.setChangeFlags(s)}validateProps(){vB(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:s}=this.props;e.picked&&typeof s=="function"&&(t.highlightColor=s(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new gB(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:s,oldProps:i}=e,r=this.state.model;r!=null&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:h}=s;if(t||i.autoHighlight!==l||i.highlightedObjectIndex!==c||i.highlightColor!==h){const d={};Array.isArray(h)&&(d.highlightColor=h),(t||i.autoHighlight!==l||c!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),i=s?s.getNeedsRedraw(e):!1;if(t=t||i,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}rs.defaultProps=nU;rs.layerName="Layer";const sU="compositeLayer.renderLayers";class kh extends rs{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||t}getSubLayerRow(e,t,s){return e.__source={parent:this,object:t,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(s,i)=>s&&s.__source?(t.index=s.__source.index,e(s.__source.object,t)):e(s,i)}return e}getSubLayerProps(e={}){var fe;const{opacity:t,pickable:s,visible:i,parameters:r,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:h,highlightColor:d,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:y,positionFormat:b,modelMatrix:T,extensions:S,fetch:R,operation:k,_subLayerProps:U}=this.props,P={id:"",updateTriggers:{},opacity:t,pickable:s,visible:i,parameters:r,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:h,highlightColor:d,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:y,positionFormat:b,modelMatrix:T,extensions:S,fetch:R,operation:k},D=U&&e.id&&U[e.id],$=D&&D.updateTriggers,Z=e.id||"sublayer";if(D){const ue=this.props[bi],J=e.type?e.type._propTypes:{};for(const oe in D){const de=J[oe]||ue[oe];de&&de.type==="accessor"&&(D[oe]=this.getSubLayerAccessor(D[oe]))}}Object.assign(P,e,D),P.id=`${this.props.id}-${Z}`,P.updateTriggers={all:(fe=this.props.updateTriggers)==null?void 0:fe.all,...e.updateTriggers,...$};for(const ue of S){const J=ue.getSubLayerProps.call(this,ue);J&&Object.assign(P,J,{updateTriggers:Object.assign(P.updateTriggers,J.updateTriggers)})}return P}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let s=this.internalState.subLayers;const i=!s||this.needsUpdate();if(i){const r=this.renderLayers();s=Oh(r,Boolean),this.internalState.subLayers=s}Wt(sU,this,i,s);for(const r of s)r.parent=this}}kh.layerName="CompositeLayer";const au=Math.PI/180,GT=180/Math.PI,Ou=6370972,ba=256;function iU(){const n=ba/Ou,e=Math.PI/180*ba;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class rU extends Fa{constructor(e={}){const{longitude:t=0,zoom:s=0,nearZMultiplier:i=.5,farZMultiplier:r=1,resolution:l=10}=e;let{latitude:c=0,height:h,altitude:d=1.5,fovy:g}=e;c=Math.max(Math.min(c,Sp),-85.051129),h=h||1,g?d=R_(g):g=bl(d);const _=1/Math.PI/Math.cos(c*Math.PI/180),y=Math.pow(2,s)*_,b=e.nearZ??i,T=e.farZ??(d+ba*2*y/h)*r,S=new Zt().lookAt({eye:[0,-d,0],up:[0,0,1]});S.rotateX(c*au),S.rotateZ(-t*au),S.scale(y/h),super({...e,height:h,viewMatrix:S,longitude:t,latitude:c,zoom:s,distanceScales:iU(),fovy:g,focalDistance:d,near:b,far:T}),this.scale=y,this.latitude=c,this.longitude=t,this.resolution=l}get projectionMode(){return zn.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],r[0],i[0],l[0]),Math.min(s[1],r[1],i[1],l[1]),Math.max(s[0],r[0],i[0],l[0]),Math.max(s[1],r[1],i[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[i,r,l]=e,c=t?r:this.height-r,{pixelUnprojectionMatrix:h}=this;let d;if(Number.isFinite(l))d=Ug(h,[i,c,l,1]);else{const b=Ug(h,[i,c,-1,1]),T=Ug(h,[i,c,1,1]),S=((s||0)/Ou+1)*ba,R=bg(Cx([],b,T)),k=bg(b),U=bg(T),D=4*((4*k*U-(R-k-U)**2)/16)/R,$=Math.sqrt(k-D),Z=Math.sqrt(Math.max(0,S*S-D)),fe=($-Z)/Math.sqrt(R);d=nP([],b,T,fe)}const[g,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[g,_,y]:Number.isFinite(s)?[g,_,s]:[g,_]}projectPosition(e){const[t,s,i=0]=e,r=t*au,l=s*au,c=Math.cos(l),h=(i/Ou+1)*ba;return[Math.sin(r)*c*h,-Math.cos(r)*c*h,Math.sin(l)*h]}unprojectPosition(e){const[t,s,i]=e,r=Ox(e),l=Math.asin(i/r),h=Math.atan2(t,-s)*GT,d=l*GT,g=(r/ba-1)*Ou;return[h,d,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const s=this.unproject(t);return{longitude:e[0]-s[0]+this.longitude,latitude:e[1]-s[1]+this.latitude}}}function Ug(n,e){const t=Ba([],e,n);return S_(t,t,1/t[3]),t}class FS{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Ma,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:s={},getGeometry:i,geometryBuffer:r,positionFormat:l,dataChanged:c,normalize:h=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||(l==="XY"?2:3),this.buffers=s,this.normalize=h,r&&(Bt(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),h||(s.vertexPositions=r)),this.geometryBuffer=s.vertexPositions,Array.isArray(c))for(const d of c)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?RS(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:s,buffers:i,_attributeDefs:r,typedArrayManager:l}=this;for(const c in r)if(c in i)l.release(s[c]),s[c]=null;else{const h=r[c];h.copy=t,s[c]=l.allocate(s[c],e,h)}}_forEachGeometry(e,t,s){const{data:i,getGeometry:r}=this,{iterable:l,objectInfo:c}=Ph(i,t,s);for(const h of l){c.index++;const d=r?r(h,c):null;e(d,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:s,instanceCount:i}=this;const{data:r,geometryBuffer:l}=this,{startRow:c=0,endRow:h=1/0}=e||{},d={};if(e||(t=[0],s=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const b=_&&this.normalizeGeometry(_);d[y]=b,s[y+1]=s[y]+(b?this.getGeometrySize(b):0)},c,h),i=s[s.length-1];else if(s=r.startIndices,i=s[r.length]||0,ArrayBuffer.isView(l))i=i||l.length/this.positionSize;else if(l instanceof at){const _=this.positionSize*4;i=i||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;i=i||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;i=i||_.length/y}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=s,this.instanceCount=i;const g={};this._forEachGeometry((_,y)=>{const b=d[y]||_;g.vertexStart=s[y],g.indexStart=t[y];const T=y<s.length-1?s[y+1]:i;g.geometrySize=T-s[y],g.geometryIndex=y,this.updateGeometryAttributes(b,g)},c,h),this.vertexCount=t[t.length-1]}}const aU=typeof window<"u"?rt.useLayoutEffect:rt.useEffect;function rh(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const oU={position:"absolute",zIndex:-1};function zS(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>zS(t,e));if(Nh(n)){if(lU(n))return e.style=oU,rt.cloneElement(n,e);if(cU(n))return rt.cloneElement(n,e)}return n}function Nh(n){return n&&typeof n=="object"&&"type"in n||!1}function lU(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function cU(n){const e=n.type;return e&&e.deckGLViewProps}function Fp(n){if(typeof n=="function")return rt.createElement(Ia,{},n);if(Array.isArray(n))return n.map(Fp);if(Nh(n)){if(n.type===rt.Fragment)return Fp(n.props.children);if(rh(n.type,Ia))return n}return n}function uU({children:n,layers:e=[],views:t=null}){const s=[],i=[],r={};return rt.Children.forEach(Fp(n),l=>{if(Nh(l)){const c=l.type;if(rh(c,rs)){const h=hU(c,l.props);i.push(h)}else s.push(l);if(rh(c,Ia)&&c!==Ia&&l.props.id){const h=new c(l.props);r[h.id]=h}}else l&&s.push(l)}),Object.keys(r).length>0&&(Array.isArray(t)?t.forEach(l=>{r[l.id]=l}):t&&(r[t.id]=t),t=Object.values(r)),e=i.length>0?[...i,...e]:e,{layers:e,children:s,views:t}}function hU(n,e){const t={},s=n.defaultProps||{};for(const i in e)s[i]!==e[i]&&(t[i]=e[i]);return new n(t)}const fU=rt.createContext();function dU({children:n,deck:e,ContextProvider:t=fU.Provider}){const{viewManager:s}=e||{};if(!s||!s.views.length)return[];const i={},r=s.views[0].id;for(const l of n){let c=r,h=l;Nh(l)&&rh(l.type,Ia)&&(c=l.props.id||r,h=l.props.children);const d=s.getViewport(c),g=s.getViewState(c);if(d){g.padding=d.padding;const{x:_,y,width:b,height:T}=d;h=zS(h,{x:_,y,width:b,height:T,viewport:d,viewState:g}),i[c]||(i[c]={viewport:d,children:[]}),i[c].children.push(h)}}return Object.keys(i).map(l=>{const{viewport:c,children:h}=i[l],{x:d,y:g,width:_,height:y}=c,b={position:"absolute",left:d,top:g,width:_,height:y},T=`view-${l}`,S=rt.createElement("div",{key:T,id:T,style:b},...h),R={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:U=>{U.viewId=l,e._onViewStateChange(U)},widgets:[]},k=`view-${l}-context`;return rt.createElement(t,{key:k,value:R},S)})}const gU={mixBlendMode:null};function pU({width:n,height:e,style:t}){const s={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},i={left:0,top:0};if(t)for(const r in t)r in gU?i[r]=t[r]:s[r]=t[r];return{containerStyle:s,canvasStyle:i}}function _U(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function VS(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function mU(n,e,t){var i,r,l;const s=new e({...t,_customRender:((l=(r=(i=t.deviceProps)==null?void 0:i.adapters)==null?void 0:r[0])==null?void 0:l.type)==="webgpu"?void 0:c=>{n.redrawReason=c;const h=s.getViewports();n.lastRenderedViewports!==h?n.forceUpdate():VS(n)}});return s}function yU(n,e){const[t,s]=rt.useState(0),r=rt.useRef({control:null,version:t,forceUpdate:()=>s($=>$+1)}).current,l=rt.useRef(null),c=rt.useRef(null),h=rt.useMemo(()=>uU(n),[n.layers,n.views,n.children]);let d=!0;const g=$=>{var Z;return d&&n.viewState?(r.viewStateUpdateRequested=$,null):(r.viewStateUpdateRequested=null,(Z=n.onViewStateChange)==null?void 0:Z.call(n,$))},_=$=>{var Z;d?r.interactionStateUpdateRequested=$:(r.interactionStateUpdateRequested=null,(Z=n.onInteractionStateChange)==null||Z.call(n,$))},y=rt.useMemo(()=>{const $={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:h.layers,views:h.views,onViewStateChange:g,onInteractionStateChange:_};return delete $._customRender,r.deck&&r.deck.setProps($),$},[n]);rt.useEffect(()=>{const $=n.Deck||B_;return r.deck=mU(r,$,{...y,parent:l.current,canvas:c.current}),()=>{var Z;return(Z=r.deck)==null?void 0:Z.finalize()}},[]),aU(()=>{VS(r);const{viewStateUpdateRequested:$,interactionStateUpdateRequested:Z}=r;$&&g($),Z&&_(Z)}),rt.useImperativeHandle(e,()=>_U(r),[]);const b=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:T,width:S="100%",height:R="100%",id:k,style:U}=n,{containerStyle:P,canvasStyle:D}=rt.useMemo(()=>pU({width:S,height:R,style:U}),[S,R,U]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===b||r.version!==t){r.lastRenderedViewports=b,r.version=t;const $=dU({children:h.children,deck:r.deck,ContextProvider:T}),Z=rt.createElement("canvas",{key:"canvas",id:k||"deckgl-overlay",ref:c,style:D});r.control=rt.createElement("div",{id:`${k||"deckgl"}-wrapper`,ref:l,style:P},[Z,$])}return d=!1,r.control}const bU=rt.forwardRef(yU),vU=new Uint32Array([0,2,1,0,3,2]),TU=new Float32Array([0,1,0,0,1,0,1,1]);function wU(n,e){if(!e)return xU(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),s=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),i=Math.ceil(t/e)+1,r=Math.ceil(s/e)+1,l=(i-1)*(r-1)*6,c=new Uint32Array(l),h=new Float32Array(i*r*2),d=new Float64Array(i*r*3);let g=0,_=0;for(let y=0;y<i;y++){const b=y/(i-1);for(let T=0;T<r;T++){const S=T/(r-1),R=SU(n,b,S);d[g*3+0]=R[0],d[g*3+1]=R[1],d[g*3+2]=R[2]||0,h[g*2+0]=b,h[g*2+1]=1-S,y>0&&T>0&&(c[_++]=g-r,c[_++]=g-r-1,c[_++]=g-1,c[_++]=g-r,c[_++]=g-1,c[_++]=g),g++}}return{vertexCount:l,positions:d,indices:c,texCoords:h}}function xU(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:vU,texCoords:TU}}function SU(n,e,t){return tr(tr(n[0],n[1],t),tr(n[3],n[2],t),e)}const JT=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,AU={name:"bitmap",vs:JT,fs:JT,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},EU=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,RU=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,CU=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${RU}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,OU={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ze.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class L_ extends rs{getShaders(){return super.getShaders({vs:EU,fs:CU,modules:[Ua,La,AU]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:s=>s.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:s=>s.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:s=>s.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:s}){var r;const i=this.getAttributeManager();if(s.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const l=this.state.mesh,c=this._createMesh();this.state.model.setVertexCount(c.vertexCount);for(const h in c)l&&l[h]!==c[h]&&i.invalidate(h);this.setState({mesh:c,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,s=e.info;if(!s.color||!t)return s.bitmap=null,s;const{width:i,height:r}=t;s.index=0;const l=MU(s.color);return s.bitmap={size:{width:i,height:r},uv:l,pixel:[Math.floor(l[0]*i),Math.floor(l[1]*r)]},s}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return e1(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),wU(t,this.context.viewport.resolution)}_getModel(){return new Rn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:s,coordinateConversion:i,bounds:r,disablePicking:l}=this.state,{image:c,desaturate:h,transparentColor:d,tintColor:g}=this.props;if(!(t.picking.isActive&&l)&&c&&s){const _={bitmapTexture:c,bounds:r,coordinateConversion:i,desaturate:h,tintColor:g.slice(0,3).map(y=>y/255),transparentColor:d.map(y=>y/255)};s.shaderInputs.setProps({bitmap:_}),s.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:s}=ze;let{_imageCoordinateSystem:i}=this.props;if(i!==s){const{bounds:r}=this.props;if(!e1(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const l=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&l===t)return{coordinateConversion:-1,bounds:r};if(i===t&&l===e){const c=Ti([r[0],r[1]]),h=Ti([r[2],r[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}L_.layerName="BitmapLayer";L_.defaultProps=OU;function MU(n){const[e,t,s]=n,i=(s&240)/256,r=(s&15)/16;return[(e+r)/256,(t+i)/256]}function e1(n){return Number.isFinite(n[0])}const t1=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,PU={name:"icon",vs:t1,fs:t1,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},IU=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,kU=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NU=1024,DU=4,n1=()=>{},s1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},BU={x:0,y:0,width:0,height:0};function UU(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function LU(n,e,t,s){const i=Math.min(t/e.width,s/e.height),r=Math.floor(e.width*i),l=Math.floor(e.height*i);return i===1?{image:e,width:r,height:l}:(n.canvas.height=l,n.canvas.width=r,n.clearRect(0,0,r,l),n.drawImage(e,0,0,e.width,e.height,0,0,r,l),{image:n.canvas,width:r,height:l})}function Tl(n){return n&&(n.id||n.url)}function FU(n,e,t,s){const{width:i,height:r,device:l}=n,c=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:s,mipmaps:!0}),h=l.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:n,destinationTexture:c,width:i,height:r}),h.finish(),n.destroy(),c}function i1(n,e,t){for(let s=0;s<e.length;s++){const{icon:i,xOffset:r}=e[s],l=Tl(i);n[l]={...i,x:r,y:t}}}function zU({icons:n,buffer:e,mapping:t={},xOffset:s=0,yOffset:i=0,rowHeight:r=0,canvasWidth:l}){let c=[];for(let h=0;h<n.length;h++){const d=n[h],g=Tl(d);if(!t[g]){const{height:_,width:y}=d;s+y+e>l&&(i1(t,c,i),s=0,i=r+i+e,r=0,c=[]),c.push({icon:d,xOffset:s}),s=s+y+e,r=Math.max(r,_)}}return c.length>0&&i1(t,c,i),{mapping:t,rowHeight:r,xOffset:s,yOffset:i,canvasWidth:l,canvasHeight:UU(r+i+e)}}function VU(n,e,t){if(!n||!e)return null;t=t||{};const s={},{iterable:i,objectInfo:r}=Ph(n);for(const l of i){r.index++;const c=e(l,r),h=Tl(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!s[h]&&(!t[h]||c.url!==t[h].url)&&(s[h]={...c,source:l,sourceIndex:r.index})}return s}class jU{constructor(e,{onUpdate:t=n1,onError:s=n1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=DU,this._canvasWidth=NU,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=s}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Tl(e):e;return this._mapping[t]||BU}setProps({loadOptions:e,autoPacking:t,iconAtlas:s,iconMapping:i,textureParameters:r}){var l;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),s&&((l=this._texture)==null||l.delete(),this._texture=null,this._externalTexture=s),r&&(this._samplerParameters=r)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const s=Object.values(VU(e,t,this._mapping)||{});if(s.length>0){const{mapping:i,xOffset:r,yOffset:l,rowHeight:c,canvasHeight:h}=zU({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=i,this._xOffset=r,this._yOffset=l,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||s1,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=FU(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||s1)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(s)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const s of e)this._pendingCount++,Lu(s.url,this._loadOptions).then(i=>{var T;const r=Tl(s),l=this._mapping[r],{x:c,y:h,width:d,height:g}=l,{image:_,width:y,height:b}=LU(t,i,d,g);(T=this._texture)==null||T.copyExternalImage({image:_,x:c+(d-y)/2,y:h+(g-b)/2,width:y,height:b}),l.width=y,l.height=b,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:s.url,source:s.source,sourceIndex:s.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const jS=[0,0,0,255],$U={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:jS},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Dh extends rs{getShaders(){return super.getShaders({vs:IU,fs:kU,modules:[Ua,La,PU]})}initializeState(){this.state={iconManager:new jU(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:jS},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var b;super.updateState(e);const{props:t,oldProps:s,changeFlags:i}=e,r=this.getAttributeManager(),{iconAtlas:l,iconMapping:c,data:h,getIcon:d,textureParameters:g}=t,{iconManager:_}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?c:null,textureParameters:g}),y?s.iconMapping!==t.iconMapping&&r.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&_.packIcons(h,d),i.extensionsChanged&&((b=this.state.model)==null||b.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:s,sizeMaxPixels:i,sizeUnits:r,billboard:l,alphaCutoff:c}=this.props,{iconManager:h}=this.state,d=h.getTexture();if(d){const g=this.state.model,_={iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:lr[r],sizeScale:t,sizeMinPixels:s,sizeMaxPixels:i,billboard:l,alphaCutoff:c};g.shaderInputs.setProps({icon:_}),g.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Rn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Pa({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var s;const t=(s=this.getCurrentLayer())==null?void 0:s.props.onIconError;t?t(e):De.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:s,anchorX:i=t/2,anchorY:r=s/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,s/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:s,width:i,height:r}=this.state.iconManager.getIconMapping(e);return[t,s,i,r]}}Dh.defaultProps=$U;Dh.layerName="IconLayer";const r1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,HU={name:"scatterplot",vs:r1,fs:r1,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},WU=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,XU=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,a1=[0,0,0,255],qU={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:a1},getLineColor:{type:"accessor",value:a1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class F_ extends rs{getShaders(){return super.getShaders({vs:WU,fs:XU,modules:[Ua,La,HU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:s,radiusMinPixels:i,radiusMaxPixels:r,stroked:l,filled:c,billboard:h,antialiasing:d,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,T={stroked:l,filled:c,billboard:h,antialiasing:d,radiusUnits:lr[t],radiusScale:s,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:lr[g],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b},S=this.state.model;S.shaderInputs.setProps({scatterplot:T}),S.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Rn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Pa({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}F_.defaultProps=qU;F_.layerName="ScatterplotLayer";const $S={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function HS(n,e,t={}){return YU(n,t)!==e?(ZU(n,t),!0):!1}function YU(n,e={}){return Math.sign(KU(n,e))}const o1={x:0,y:1,z:2};function KU(n,e={}){const{start:t=0,end:s=n.length,plane:i="xy"}=e,r=e.size||2;let l=0;const c=o1[i[0]],h=o1[i[1]];for(let d=t,g=s-r;d<s;d+=r)l+=(n[d+c]-n[g+c])*(n[d+h]+n[g+h]),g=d;return l/2}function ZU(n,e){const{start:t=0,end:s=n.length,size:i=2}=e,r=(s-t)/i,l=Math.floor(r/2);for(let c=0;c<l;++c){const h=t+c*i,d=t+(r-1-c)*i;for(let g=0;g<i;++g){const _=n[h+g];n[h+g]=n[d+g],n[d+g]=_}}}function $n(n,e){const t=e.length,s=n.length;if(s>0){let i=!0;for(let r=0;r<t;r++)if(n[s-t+r]!==e[r]){i=!1;break}if(i)return!1}for(let i=0;i<t;i++)n[s+i]=e[i];return!0}function zp(n,e){const t=e.length;for(let s=0;s<t;s++)n[s]=e[s]}function wl(n,e,t,s,i=[]){const r=s+e*t;for(let l=0;l<t;l++)i[l]=n[r+l];return i}function Vp(n,e,t,s,i=[]){let r,l;if(t&8)r=(s[3]-n[1])/(e[1]-n[1]),l=3;else if(t&4)r=(s[1]-n[1])/(e[1]-n[1]),l=1;else if(t&2)r=(s[2]-n[0])/(e[0]-n[0]),l=2;else if(t&1)r=(s[0]-n[0])/(e[0]-n[0]),l=0;else return null;for(let c=0;c<n.length;c++)i[c]=(l&1)===c?s[l]:r*(e[c]-n[c])+n[c];return i}function Mu(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function WS(n,e){const{size:t=2,broken:s=!1,gridResolution:i=10,gridOffset:r=[0,0],startIndex:l=0,endIndex:c=n.length}=e||{},h=(c-l)/t;let d=[];const g=[d],_=wl(n,0,t,l);let y,b;const T=qS(_,i,r,[]),S=[];$n(d,_);for(let R=1;R<h;R++){for(y=wl(n,R,t,l,y),b=Mu(y,T);b;){Vp(_,y,b,T,S);const k=Mu(S,T);k&&(Vp(_,S,k,T,S),b=k),$n(d,S),zp(_,S),GU(T,i,b),s&&d.length>t&&(d=[],g.push(d),$n(d,_)),b=Mu(y,T)}$n(d,y),zp(_,y)}return s?g:g[0]}const l1=0,QU=1;function XS(n,e=null,t){if(!n.length)return[];const{size:s=2,gridResolution:i=10,gridOffset:r=[0,0],edgeTypes:l=!1}=t||{},c=[],h=[{pos:n,types:l?new Array(n.length/s).fill(QU):null,holes:e||[]}],d=[[],[]];let g=[];for(;h.length;){const{pos:_,types:y,holes:b}=h.shift();JU(_,s,b[0]||_.length,d),g=qS(d[0],i,r,g);const T=Mu(d[1],g);if(T){let S=c1(_,y,s,0,b[0]||_.length,g,T);const R={pos:S[0].pos,types:S[0].types,holes:[]},k={pos:S[1].pos,types:S[1].types,holes:[]};h.push(R,k);for(let U=0;U<b.length;U++)S=c1(_,y,s,b[U],b[U+1]||_.length,g,T),S[0]&&(R.holes.push(R.pos.length),R.pos=ou(R.pos,S[0].pos),l&&(R.types=ou(R.types,S[0].types))),S[1]&&(k.holes.push(k.pos.length),k.pos=ou(k.pos,S[1].pos),l&&(k.types=ou(k.types,S[1].types)))}else{const S={positions:_};l&&(S.edgeTypes=y),b.length&&(S.holeIndices=b),c.push(S)}}return c}function c1(n,e,t,s,i,r,l){const c=(i-s)/t,h=[],d=[],g=[],_=[],y=[];let b,T,S;const R=wl(n,c-1,t,s);let k=Math.sign(l&8?R[1]-r[3]:R[0]-r[2]),U=e&&e[c-1],P=0,D=0;for(let $=0;$<c;$++)b=wl(n,$,t,s,b),T=Math.sign(l&8?b[1]-r[3]:b[0]-r[2]),S=e&&e[s/t+$],T&&k&&k!==T&&(Vp(R,b,l,r,y),$n(h,y)&&g.push(U),$n(d,y)&&_.push(U)),T<=0?($n(h,b)&&g.push(S),P-=T):g.length&&(g[g.length-1]=l1),T>=0?($n(d,b)&&_.push(S),D+=T):_.length&&(_[_.length-1]=l1),zp(R,b),k=T,U=S;return[P?{pos:h,types:e&&g}:null,D?{pos:d,types:e&&_}:null]}function qS(n,e,t,s){const i=Math.floor((n[0]-t[0])/e)*e+t[0],r=Math.floor((n[1]-t[1])/e)*e+t[1];return s[0]=i,s[1]=r,s[2]=i+e,s[3]=r+e,s}function GU(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function JU(n,e,t,s){let i=1/0,r=-1/0,l=1/0,c=-1/0;for(let h=0;h<t;h+=e){const d=n[h],g=n[h+1];i=d<i?d:i,r=d>r?d:r,l=g<l?g:l,c=g>c?g:c}return s[0][0]=i,s[0][1]=l,s[1][0]=r,s[1][1]=c,s}function ou(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const eL=85.051129;function tL(n,e){const{size:t=2,startIndex:s=0,endIndex:i=n.length,normalize:r=!0}=e||{},l=n.slice(s,i);YS(l,t,0,i-s);const c=WS(l,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const h of c)KS(h,t);return c}function nL(n,e=null,t){const{size:s=2,normalize:i=!0,edgeTypes:r=!1}=t||{};e=e||[];const l=[],c=[];let h=0,d=0;for(let _=0;_<=e.length;_++){const y=e[_]||n.length,b=d,T=sL(n,s,h,y);for(let S=T;S<y;S++)l[d++]=n[S];for(let S=h;S<T;S++)l[d++]=n[S];YS(l,s,b,d),iL(l,s,b,d,t==null?void 0:t.maxLatitude),h=y,c[_]=d}c.pop();const g=XS(l,c,{size:s,gridResolution:360,gridOffset:[-180,-180],edgeTypes:r});if(i)for(const _ of g)KS(_.positions,s);return g}function sL(n,e,t,s){let i=-1,r=-1;for(let l=t+1;l<s;l+=e){const c=Math.abs(n[l]);c>i&&(i=c,r=l-1)}return r}function iL(n,e,t,s,i=eL){const r=n[t],l=n[s-e];if(Math.abs(r-l)>180){const c=wl(n,0,e,t);c[0]+=Math.round((l-r)/360)*360,$n(n,c),c[1]=Math.sign(c[1])*i,$n(n,c),c[0]=r,$n(n,c)}}function YS(n,e,t,s){let i=n[0],r;for(let l=t;l<s;l+=e){r=n[l];const c=r-i;(c>180||c<-180)&&(r-=Math.round(c/360)*360),n[l]=i=r}}function KS(n,e){let t;const s=n.length/e;for(let r=0;r<s&&(t=n[r*e],(t+180)%360===0);r++);const i=-Math.round(t/360)*360;if(i!==0)for(let r=0;r<s;r++)n[r*e]+=i}function rL(n,e,t,s){let i;if(Array.isArray(n[0])){const r=n.length*e;i=new Array(r);for(let l=0;l<n.length;l++)for(let c=0;c<e;c++)i[l*e+c]=n[l][c]||0}else i=n;return t?WS(i,{size:e,gridResolution:t}):s?tL(i,{size:e}):i}const aL=1,oL=2,Lg=4;class lL extends FS{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?rL(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(u1(e)){let s=0;for(const i of e)s+=this.getGeometrySize(i);return s}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&u1(e))for(const s of e){const i=this.getGeometrySize(s);t.geometrySize=i,this.updateGeometryAttributes(s,t),t.vertexStart+=i}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const s=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:r,geometrySize:l}=t;s.fill(0,r,r+l),i?(s[r]=Lg,s[r+l-2]=Lg):(s[r]+=aL,s[r+l-2]+=oL),s[r+l-1]=Lg}_updatePositions(e,t){const{positions:s}=this.attributes;if(!s||!e)return;const{vertexStart:i,geometrySize:r}=t,l=new Array(3);for(let c=i,h=0;h<r;c++,h++)this.getPointOnPath(e,h,l),s[c*3]=l[0],s[c*3+1]=l[1],s[c*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,s=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return s[0]=e[r],s[1]=e[r+1],s[2]=i===3&&e[r+2]||0,s}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,s=e.length-t;return e[0]===e[s]&&e[1]===e[s+1]&&(t===2||e[2]===e[s+2])}}function u1(n){return Array.isArray(n[0])}const h1=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,cL={name:"path",vs:h1,fs:h1,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},uL=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hL=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ZS=[0,0,0,255],fL={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:ZS},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Fg={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Bh extends rs{getShaders(){return super.getShaders({vs:uL,fs:hL,modules:[Ua,La,cL]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Fg,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Fg,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Fg,defaultValue:ZS},instancePickingColors:{size:4,type:"uint8",accessor:(s,{index:i,target:r})=>this.encodePickingColor(s&&s.__source?s.__source.index:i,r)}}),this.setState({pathTesselator:new lL({fp64:this.use64bitPositions()})})}updateState(e){var l;super.updateState(e);const{props:t,changeFlags:s}=e,i=this.getAttributeManager();if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,h=t.data.attributes||{};c.updateGeometry({data:t.data,geometryBuffer:h.getPath,buffers:h,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:s.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),s.dataChanged||i.invalidateAll()}s.extensionsChanged&&((l=this.state.model)==null||l.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(r=>r.__source.index===s)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let s=0;s<t.length;s++)t[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:s,billboard:i,miterLimit:r,widthUnits:l,widthScale:c,widthMinPixels:h,widthMaxPixels:d}=this.props,g=this.state.model,_={jointType:Number(t),capType:Number(s),billboard:i,widthUnits:lr[l],widthScale:c,miterLimit:r,widthMinPixels:h,widthMaxPixels:d};g.shaderInputs.setProps({path:_}),g.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Rn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Pa({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Bh.defaultProps=fL;Bh.layerName="PathLayer";var lu={exports:{}},f1;function dL(){if(f1)return lu.exports;f1=1,lu.exports=n,lu.exports.default=n;function n(C,N,I){I=I||2;var Q=N&&N.length,A=Q?N[0]*I:C.length,L=e(C,0,A,I,!0),K=[];if(!L||L.next===L.prev)return K;var ee,se,le,pe,Re,_e,Ie;if(Q&&(L=h(C,N,L,I)),C.length>80*I){ee=le=C[0],se=pe=C[1];for(var Te=I;Te<A;Te+=I)Re=C[Te],_e=C[Te+1],Re<ee&&(ee=Re),_e<se&&(se=_e),Re>le&&(le=Re),_e>pe&&(pe=_e);Ie=Math.max(le-ee,pe-se),Ie=Ie!==0?32767/Ie:0}return s(L,K,I,ee,se,Ie,0),K}function e(C,N,I,Q,A){var L,K;if(A===We(C,N,I,Q)>0)for(L=N;L<I;L+=Q)K=ve(L,C[L],C[L+1],K);else for(L=I-Q;L>=N;L-=Q)K=ve(L,C[L],C[L+1],K);return K&&D(K,K.next)&&(be(K),K=K.next),K}function t(C,N){if(!C)return C;N||(N=C);var I=C,Q;do if(Q=!1,!I.steiner&&(D(I,I.next)||P(I.prev,I,I.next)===0)){if(be(I),I=N=I.prev,I===I.next)break;Q=!0}else I=I.next;while(Q||I!==N);return N}function s(C,N,I,Q,A,L,K){if(C){!K&&L&&b(C,Q,A,L);for(var ee=C,se,le;C.prev!==C.next;){if(se=C.prev,le=C.next,L?r(C,Q,A,L):i(C)){N.push(se.i/I|0),N.push(C.i/I|0),N.push(le.i/I|0),be(C),C=le.next,ee=le.next;continue}if(C=le,C===ee){K?K===1?(C=l(t(C),N,I),s(C,N,I,Q,A,L,2)):K===2&&c(C,N,I,Q,A,L):s(t(C),N,I,Q,A,L,1);break}}}}function i(C){var N=C.prev,I=C,Q=C.next;if(P(N,I,Q)>=0)return!1;for(var A=N.x,L=I.x,K=Q.x,ee=N.y,se=I.y,le=Q.y,pe=A<L?A<K?A:K:L<K?L:K,Re=ee<se?ee<le?ee:le:se<le?se:le,_e=A>L?A>K?A:K:L>K?L:K,Ie=ee>se?ee>le?ee:le:se>le?se:le,Te=Q.next;Te!==N;){if(Te.x>=pe&&Te.x<=_e&&Te.y>=Re&&Te.y<=Ie&&k(A,ee,L,se,K,le,Te.x,Te.y)&&P(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function r(C,N,I,Q){var A=C.prev,L=C,K=C.next;if(P(A,L,K)>=0)return!1;for(var ee=A.x,se=L.x,le=K.x,pe=A.y,Re=L.y,_e=K.y,Ie=ee<se?ee<le?ee:le:se<le?se:le,Te=pe<Re?pe<_e?pe:_e:Re<_e?Re:_e,Lt=ee>se?ee>le?ee:le:se>le?se:le,Mn=pe>Re?pe>_e?pe:_e:Re>_e?Re:_e,Pn=S(Ie,Te,N,I,Q),xi=S(Lt,Mn,N,I,Q),Be=C.prevZ,ke=C.nextZ;Be&&Be.z>=Pn&&ke&&ke.z<=xi;){if(Be.x>=Ie&&Be.x<=Lt&&Be.y>=Te&&Be.y<=Mn&&Be!==A&&Be!==K&&k(ee,pe,se,Re,le,_e,Be.x,Be.y)&&P(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,ke.x>=Ie&&ke.x<=Lt&&ke.y>=Te&&ke.y<=Mn&&ke!==A&&ke!==K&&k(ee,pe,se,Re,le,_e,ke.x,ke.y)&&P(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;Be&&Be.z>=Pn;){if(Be.x>=Ie&&Be.x<=Lt&&Be.y>=Te&&Be.y<=Mn&&Be!==A&&Be!==K&&k(ee,pe,se,Re,le,_e,Be.x,Be.y)&&P(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;ke&&ke.z<=xi;){if(ke.x>=Ie&&ke.x<=Lt&&ke.y>=Te&&ke.y<=Mn&&ke!==A&&ke!==K&&k(ee,pe,se,Re,le,_e,ke.x,ke.y)&&P(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function l(C,N,I){var Q=C;do{var A=Q.prev,L=Q.next.next;!D(A,L)&&$(A,Q,Q.next,L)&&J(A,L)&&J(L,A)&&(N.push(A.i/I|0),N.push(Q.i/I|0),N.push(L.i/I|0),be(Q),be(Q.next),Q=C=L),Q=Q.next}while(Q!==C);return t(Q)}function c(C,N,I,Q,A,L){var K=C;do{for(var ee=K.next.next;ee!==K.prev;){if(K.i!==ee.i&&U(K,ee)){var se=de(K,ee);K=t(K,K.next),se=t(se,se.next),s(K,N,I,Q,A,L,0),s(se,N,I,Q,A,L,0);return}ee=ee.next}K=K.next}while(K!==C)}function h(C,N,I,Q){var A=[],L,K,ee,se,le;for(L=0,K=N.length;L<K;L++)ee=N[L]*Q,se=L<K-1?N[L+1]*Q:C.length,le=e(C,ee,se,Q,!1),le===le.next&&(le.steiner=!0),A.push(R(le));for(A.sort(d),L=0;L<A.length;L++)I=g(A[L],I);return I}function d(C,N){return C.x-N.x}function g(C,N){var I=_(C,N);if(!I)return N;var Q=de(I,C);return t(Q,Q.next),t(I,I.next)}function _(C,N){var I=N,Q=C.x,A=C.y,L=-1/0,K;do{if(A<=I.y&&A>=I.next.y&&I.next.y!==I.y){var ee=I.x+(A-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(ee<=Q&&ee>L&&(L=ee,K=I.x<I.next.x?I:I.next,ee===Q))return K}I=I.next}while(I!==N);if(!K)return null;var se=K,le=K.x,pe=K.y,Re=1/0,_e;I=K;do Q>=I.x&&I.x>=le&&Q!==I.x&&k(A<pe?Q:L,A,le,pe,A<pe?L:Q,A,I.x,I.y)&&(_e=Math.abs(A-I.y)/(Q-I.x),J(I,C)&&(_e<Re||_e===Re&&(I.x>K.x||I.x===K.x&&y(K,I)))&&(K=I,Re=_e)),I=I.next;while(I!==se);return K}function y(C,N){return P(C.prev,C,N.prev)<0&&P(N.next,C,C.next)<0}function b(C,N,I,Q){var A=C;do A.z===0&&(A.z=S(A.x,A.y,N,I,Q)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==C);A.prevZ.nextZ=null,A.prevZ=null,T(A)}function T(C){var N,I,Q,A,L,K,ee,se,le=1;do{for(I=C,C=null,L=null,K=0;I;){for(K++,Q=I,ee=0,N=0;N<le&&(ee++,Q=Q.nextZ,!!Q);N++);for(se=le;ee>0||se>0&&Q;)ee!==0&&(se===0||!Q||I.z<=Q.z)?(A=I,I=I.nextZ,ee--):(A=Q,Q=Q.nextZ,se--),L?L.nextZ=A:C=A,A.prevZ=L,L=A;I=Q}L.nextZ=null,le*=2}while(K>1);return C}function S(C,N,I,Q,A){return C=(C-I)*A|0,N=(N-Q)*A|0,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,N=(N|N<<8)&16711935,N=(N|N<<4)&252645135,N=(N|N<<2)&858993459,N=(N|N<<1)&1431655765,C|N<<1}function R(C){var N=C,I=C;do(N.x<I.x||N.x===I.x&&N.y<I.y)&&(I=N),N=N.next;while(N!==C);return I}function k(C,N,I,Q,A,L,K,ee){return(A-K)*(N-ee)>=(C-K)*(L-ee)&&(C-K)*(Q-ee)>=(I-K)*(N-ee)&&(I-K)*(L-ee)>=(A-K)*(Q-ee)}function U(C,N){return C.next.i!==N.i&&C.prev.i!==N.i&&!ue(C,N)&&(J(C,N)&&J(N,C)&&oe(C,N)&&(P(C.prev,C,N.prev)||P(C,N.prev,N))||D(C,N)&&P(C.prev,C,C.next)>0&&P(N.prev,N,N.next)>0)}function P(C,N,I){return(N.y-C.y)*(I.x-N.x)-(N.x-C.x)*(I.y-N.y)}function D(C,N){return C.x===N.x&&C.y===N.y}function $(C,N,I,Q){var A=fe(P(C,N,I)),L=fe(P(C,N,Q)),K=fe(P(I,Q,C)),ee=fe(P(I,Q,N));return!!(A!==L&&K!==ee||A===0&&Z(C,I,N)||L===0&&Z(C,Q,N)||K===0&&Z(I,C,Q)||ee===0&&Z(I,N,Q))}function Z(C,N,I){return N.x<=Math.max(C.x,I.x)&&N.x>=Math.min(C.x,I.x)&&N.y<=Math.max(C.y,I.y)&&N.y>=Math.min(C.y,I.y)}function fe(C){return C>0?1:C<0?-1:0}function ue(C,N){var I=C;do{if(I.i!==C.i&&I.next.i!==C.i&&I.i!==N.i&&I.next.i!==N.i&&$(I,I.next,C,N))return!0;I=I.next}while(I!==C);return!1}function J(C,N){return P(C.prev,C,C.next)<0?P(C,N,C.next)>=0&&P(C,C.prev,N)>=0:P(C,N,C.prev)<0||P(C,C.next,N)<0}function oe(C,N){var I=C,Q=!1,A=(C.x+N.x)/2,L=(C.y+N.y)/2;do I.y>L!=I.next.y>L&&I.next.y!==I.y&&A<(I.next.x-I.x)*(L-I.y)/(I.next.y-I.y)+I.x&&(Q=!Q),I=I.next;while(I!==C);return Q}function de(C,N){var I=new Se(C.i,C.x,C.y),Q=new Se(N.i,N.x,N.y),A=C.next,L=N.prev;return C.next=N,N.prev=C,I.next=A,A.prev=I,Q.next=I,I.prev=Q,L.next=Q,Q.prev=L,Q}function ve(C,N,I,Q){var A=new Se(C,N,I);return Q?(A.next=Q.next,A.prev=Q,Q.next.prev=A,Q.next=A):(A.prev=A,A.next=A),A}function be(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Se(C,N,I){this.i=C,this.x=N,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(C,N,I,Q){var A=N&&N.length,L=A?N[0]*I:C.length,K=Math.abs(We(C,0,L,I));if(A)for(var ee=0,se=N.length;ee<se;ee++){var le=N[ee]*I,pe=ee<se-1?N[ee+1]*I:C.length;K-=Math.abs(We(C,le,pe,I))}var Re=0;for(ee=0;ee<Q.length;ee+=3){var _e=Q[ee]*I,Ie=Q[ee+1]*I,Te=Q[ee+2]*I;Re+=Math.abs((C[_e]-C[Te])*(C[Ie+1]-C[_e+1])-(C[_e]-C[Ie])*(C[Te+1]-C[_e+1]))}return K===0&&Re===0?0:Math.abs((Re-K)/K)};function We(C,N,I,Q){for(var A=0,L=N,K=I-Q;L<I;L+=Q)A+=(C[K]-C[L])*(C[L+1]+C[K+1]),K=L;return A}return n.flatten=function(C){for(var N=C[0][0].length,I={vertices:[],holes:[],dimensions:N},Q=0,A=0;A<C.length;A++){for(var L=0;L<C[A].length;L++)for(var K=0;K<N;K++)I.vertices.push(C[A][L][K]);A>0&&(Q+=C[A-1].length,I.holes.push(Q))}return I},lu.exports}var gL=dL();const pL=uw(gL),cu=$S.CLOCKWISE,d1=$S.COUNTER_CLOCKWISE,_i={};function _L(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function el(n){return"positions"in n?n.positions:n}function Pu(n){return"holeIndices"in n?n.holeIndices:null}function mL(n){return Array.isArray(n[0])}function yL(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function bL(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function vL(n,e,t,s){for(let i=0;i<e;i++)if(n[t+i]!==n[s-e+i])return!1;return!0}function g1(n,e,t,s,i){let r=e;const l=t.length;for(let c=0;c<l;c++)for(let h=0;h<s;h++)n[r++]=t[c][h]||0;if(!bL(t))for(let c=0;c<s;c++)n[r++]=t[0][c]||0;return _i.start=e,_i.end=r,_i.size=s,HS(n,i,_i),r}function p1(n,e,t,s,i=0,r,l){r=r||t.length;const c=r-i;if(c<=0)return e;let h=e;for(let d=0;d<c;d++)n[h++]=t[i+d];if(!vL(t,s,i,r))for(let d=0;d<s;d++)n[h++]=t[i+d];return _i.start=e,_i.end=h,_i.size=s,HS(n,l,_i),h}function TL(n,e){_L(n);const t=[],s=[];if("positions"in n){const{positions:i,holeIndices:r}=n;if(r){let l=0;for(let c=0;c<=r.length;c++)l=p1(t,l,i,e,r[c-1],r[c],c===0?cu:d1),s.push(l);return s.pop(),{positions:t,holeIndices:s}}n=i}if(!mL(n))return p1(t,0,n,e,0,t.length,cu),t;if(!yL(n)){let i=0;for(const[r,l]of n.entries())i=g1(t,i,l,e,r===0?cu:d1),s.push(i);return s.pop(),{positions:t,holeIndices:s}}return g1(t,0,n,e,cu),t}function zg(n,e,t){const s=n.length/3;let i=0;for(let r=0;r<s;r++){const l=(r+1)%s;i+=n[r*3+e]*n[l*3+t],i-=n[l*3+e]*n[r*3+t]}return Math.abs(i/2)}function _1(n,e,t,s){const i=n.length/3;for(let r=0;r<i;r++){const l=r*3,c=n[l+0],h=n[l+1],d=n[l+2];n[l+e]=c,n[l+t]=h,n[l+s]=d}}function wL(n,e,t,s){let i=Pu(n);i&&(i=i.map(c=>c/e));let r=el(n);const l=s&&e===3;if(t){const c=r.length;r=r.slice();const h=[];for(let d=0;d<c;d+=e){h[0]=r[d],h[1]=r[d+1],l&&(h[2]=r[d+2]);const g=t(h);r[d]=g[0],r[d+1]=g[1],l&&(r[d+2]=g[2])}}if(l){const c=zg(r,0,1),h=zg(r,0,2),d=zg(r,1,2);if(!c&&!h&&!d)return[];c>h&&c>d||(h>d?(t||(r=r.slice()),_1(r,0,2,1)):(t||(r=r.slice()),_1(r,2,0,1)))}return pL(r,i,e)}class xL extends FS{constructor(e){const{fp64:t,IndexType:s=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:s,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=TL(e,this.positionSize);return this.opts.resolution?XS(el(t),Pu(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?nL(el(t),Pu(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(m1(e)){let t=0;for(const s of e)t+=this.getGeometrySize(s);return t}return el(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&m1(e))for(const s of e){const i=this.getGeometrySize(s);t.geometrySize=i,this.updateGeometryAttributes(s,t),t.vertexStart+=i,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const s=e;this._updateIndices(s,t),this._updatePositions(s,t),this._updateVertexValid(s,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:s,indexStart:i}){const{attributes:r,indexStarts:l,typedArrayManager:c}=this;let h=r.indices;if(!h||!e)return;let d=i;const g=wL(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=c.allocate(h,i+g.length,{copy:!0});for(let _=0;_<g.length;_++)h[d++]=g[_]+s;l[t+1]=i+g.length,r.indices=h}_updatePositions(e,{vertexStart:t,geometrySize:s}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!e)return;const l=el(e);for(let c=t,h=0;h<s;c++,h++){const d=l[h*r],g=l[h*r+1],_=r>2?l[h*r+2]:0;i[c*3]=d,i[c*3+1]=g,i[c*3+2]=_}}_updateVertexValid(e,{vertexStart:t,geometrySize:s}){const{positionSize:i}=this,r=this.attributes.vertexValid,l=e&&Pu(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+s),l)for(let c=0;c<l.length;c++)r[t+l[c]/i-1]=0;r[t+s-1]=0}}function m1(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const y1=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,SL={name:"solidPolygon",vs:y1,fs:y1,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},QS=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,AL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${QS}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,EL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${QS}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,RL=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ah=[0,0,0,255],CL={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ah},getLineColor:{type:"accessor",value:ah},material:!0},uu={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class z_ extends rs{getShaders(e){return super.getShaders({vs:e==="top"?AL:EL,fs:RL,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ua,Lx,La,SL]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:s}=this.props;e.isGeospatial&&t===ze.DEFAULT&&(t=ze.LNGLAT);let i;t===ze.LNGLAT&&(s?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new xL({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),l=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:uu,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:uu,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:uu,accessor:"getFillColor",defaultValue:ah},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:uu,accessor:"getLineColor",defaultValue:ah},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:h,target:d})=>this.encodePickingColor(c&&c.__source?c.__source.index:h,d)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(r=>r.__source.index===s)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let s=0;s<t.length;s++)t[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:s,wireframe:i,elevationScale:r}=this.props,{topModel:l,sideModel:c,wireframeModel:h,polygonTesselator:d}=this.state,g={extruded:!!t,elevationScale:r,isWireframe:!1};h&&i&&(h.setInstanceCount(d.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...g,isWireframe:!0}}),h.draw(this.context.renderPass)),c&&s&&(c.setInstanceCount(d.instanceCount-1),c.shaderInputs.setProps({solidPolygon:g}),c.draw(this.context.renderPass)),l&&s&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:g}),l.draw(this.context.renderPass))}updateState(e){var c;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:s,changeFlags:i}=e,r=this.getAttributeManager();(i.extensionsChanged||t.filled!==s.filled||t.extruded!==s.extruded)&&((c=this.state.models)==null||c.forEach(h=>h.destroy()),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:s}){if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,l=e.data.attributes||{};r.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:e._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:s}=this.props;let i,r,l;if(t){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Rn(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(s){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new Rn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Pa({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new Rn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Pa({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,l,i].filter(Boolean),topModel:i,sideModel:r,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}z_.defaultProps=CL;z_.layerName="SolidPolygonLayer";function OL({data:n,getIndex:e,dataRange:t,replace:s}){const{startRow:i=0,endRow:r=1/0}=t,l=n.length;let c=l,h=l;for(let y=0;y<l;y++){const b=e(n[y]);if(c>y&&b>=i&&(c=y),b>=r){h=y;break}}let d=c;const _=h-c!==s.length?n.slice(h):void 0;for(let y=0;y<s.length;y++)n[d++]=s[y];if(_){for(let y=0;y<_.length;y++)n[d++]=_[y];n.length=d}return{startRow:c,endRow:c+s.length}}function ML(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,s=n.featureIds.value[t];return t!==-1?PL(n,s,t):null}function PL(n,e,t){const s={properties:{...n.properties[e]}};for(const i in n.numericProps)s.properties[i]=n.numericProps[i].value[t];return s}function IL(n,e){const t={points:null,lines:null,polygons:null};for(const s in t){const i=n[s].globalFeatureIds.value;t[s]=new Uint8ClampedArray(i.length*4);const r=[];for(let l=0;l<i.length;l++)e(i[l],r),t[s][l*4+0]=r[0],t[s][l*4+1]=r[1],t[s][l*4+2]=r[2],t[s][l*4+3]=255}return t}const b1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,kL={name:"sdf",vs:b1,fs:b1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},NL=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vg=192/256,v1=[],DL={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class V_ extends Dh{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,kL],fs:NL}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:s,target:i})=>this.encodePickingColor(s,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e;let{outlineColor:i}=t;i!==s.outlineColor&&(i=i.map(r=>r/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&De.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:s,outlineWidth:i}=this.props,{outlineColor:r}=this.state,l=i?Math.max(s,Vg*(1-i)):-1,c=this.state.model,h={buffer:Vg,outlineBuffer:l,gamma:s,enabled:!!t,outlineColor:r};if(c.shaderInputs.setProps({sdf:h}),super.draw(e),t&&i){const{iconManager:d}=this.state;d.getTexture()&&(c.shaderInputs.setProps({sdf:{...h,outlineBuffer:Vg}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):v1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):v1}}V_.defaultProps=DL;V_.layerName="MultiIconLayer";const oh=1e20;class BL{constructor({fontSize:e=24,buffer:t=3,radius:s=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:l="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=s;const h=this.size=e+t*4,d=this._createCanvas(h),g=this.ctx=d.getContext("2d",{willReadFrequently:!0});g.font=`${c} ${l} ${e}px ${r}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:l}=this.ctx.measureText(e),c=Math.ceil(s),h=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-r))),g=Math.min(this.size-this.buffer,c+Math.ceil(i)),_=d+2*this.buffer,y=g+2*this.buffer,b=Math.max(_*y,0),T=new Uint8ClampedArray(b),S={data:T,width:_,height:y,glyphWidth:d,glyphHeight:g,glyphTop:c,glyphLeft:h,glyphAdvance:t};if(d===0||g===0)return S;const{ctx:R,buffer:k,gridInner:U,gridOuter:P}=this;R.clearRect(k,k,d,g),R.fillText(e,k,k+c);const D=R.getImageData(k,k,d,g);P.fill(oh,0,b),U.fill(0,0,b);for(let $=0;$<g;$++)for(let Z=0;Z<d;Z++){const fe=D.data[4*($*d+Z)+3]/255;if(fe===0)continue;const ue=($+k)*_+Z+k;if(fe===1)P[ue]=0,U[ue]=oh;else{const J=.5-fe;P[ue]=J>0?J*J:0,U[ue]=J<0?J*J:0}}T1(P,0,0,_,y,_,this.f,this.v,this.z),T1(U,k,k,d,g,_,this.f,this.v,this.z);for(let $=0;$<b;$++){const Z=Math.sqrt(P[$])-Math.sqrt(U[$]);T[$]=Math.round(255-255*(Z/this.radius+this.cutoff))}return S}}function T1(n,e,t,s,i,r,l,c,h){for(let d=e;d<e+s;d++)w1(n,t*r+d,r,i,l,c,h);for(let d=t;d<t+i;d++)w1(n,d*r+e,1,s,l,c,h)}function w1(n,e,t,s,i,r,l){r[0]=0,l[0]=-1e20,l[1]=oh,i[0]=n[e];for(let c=1,h=0,d=0;c<s;c++){i[c]=n[e+c*t];const g=c*c;do{const _=r[h];d=(i[c]-i[_]+g-_*_)/(c-_)/2}while(d<=l[h]&&--h>-1);h++,r[h]=c,l[h]=d,l[h+1]=oh}for(let c=0,h=0;c<s;c++){for(;l[h+1]<c;)h++;const d=r[h],g=c-d;n[e+c*t]=i[d]+g*g}}const UL=32,LL=[];function FL(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function zL({characterSet:n,getFontWidth:e,fontHeight:t,buffer:s,maxCanvasWidth:i,mapping:r={},xOffset:l=0,yOffset:c=0}){let h=0,d=l;const g=t+s*2;for(const _ of n)if(!r[_]){const y=e(_);d+y+s*2>i&&(d=0,h++),r[_]={x:d+s,y:c+h*g+s,width:y,height:g,layoutWidth:y,layoutHeight:t},d+=y+s*2}return{mapping:r,xOffset:d,yOffset:c+h*g,canvasHeight:FL(c+(h+1)*g)}}function GS(n,e,t,s){var r;let i=0;for(let l=e;l<t;l++){const c=n[l];i+=((r=s[c])==null?void 0:r.layoutWidth)||0}return i}function JS(n,e,t,s,i,r){let l=e,c=0;for(let h=e;h<t;h++){const d=GS(n,h,h+1,i);c+d>s&&(l<h&&r.push(h),l=h,c=0),c+=d}return c}function VL(n,e,t,s,i,r){let l=e,c=e,h=e,d=0;for(let g=e;g<t;g++)if((n[g]===" "||n[g+1]===" "||g+1===t)&&(h=g+1),h>c){let _=GS(n,c,h,i);d+_>s&&(l<c&&(r.push(c),l=c,d=0),_>s&&(_=JS(n,c,h,s,i,r),l=r[r.length-1])),c=h,d+=_}return d}function jL(n,e,t,s,i=0,r){r===void 0&&(r=n.length);const l=[];return e==="break-all"?JS(n,i,r,t,s,l):VL(n,i,r,t,s,l),l}function $L(n,e,t,s,i,r){let l=0,c=0;for(let h=e;h<t;h++){const d=n[h],g=s[d];g?(c||(c=g.layoutHeight),i[h]=l+g.layoutWidth/2,l+=g.layoutWidth):(De.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),i[h]=l,l+=UL)}r[0]=l,r[1]=c}function HL(n,e,t,s,i){var R;const r=Array.from(n),l=r.length,c=new Array(l),h=new Array(l),d=new Array(l),g=(t==="break-word"||t==="break-all")&&isFinite(s)&&s>0,_=[0,0],y=[0,0];let b=0,T=0,S=0;for(let k=0;k<=l;k++){const U=r[k];if((U===`
`||k===l)&&(S=k),S>T){const P=g?jL(r,t,s,i,T,S):LL;for(let D=0;D<=P.length;D++){const $=D===0?T:P[D-1],Z=D<P.length?P[D]:S;$L(r,$,Z,i,c,y);for(let fe=$;fe<Z;fe++){const ue=r[fe],J=((R=i[ue])==null?void 0:R.layoutOffsetY)||0;h[fe]=b+y[1]/2+J,d[fe]=y[0]}b=b+y[1]*e,_[0]=Math.max(_[0],y[0])}T=S}U===`
`&&(c[T]=0,h[T]=0,d[T]=0,T++)}return _[1]=b,{x:c,y:h,rowWidth:d,size:_}}function WL({value:n,length:e,stride:t,offset:s,startIndices:i,characterSet:r}){const l=n.BYTES_PER_ELEMENT,c=t?t/l:1,h=s?s/l:0,d=i[e]||Math.ceil((n.length-h)/c),g=r&&new Set,_=new Array(e);let y=n;if(c>1||h>0){const b=n.constructor;y=new b(d);for(let T=0;T<d;T++)y[T]=n[T*c+h]}for(let b=0;b<e;b++){const T=i[b],S=i[b+1]||d,R=y.subarray(T,S);_[b]=String.fromCodePoint.apply(null,R),g&&R.forEach(g.add,g)}if(g)for(const b of g)r.add(String.fromCodePoint(b));return{texts:_,characterCount:d}}class eA{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function XL(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Sa={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:XL(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},x1=1024,S1=.9,A1=1.2,tA=3;let lh=new eA(tA);function qL(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const s=lh.get(n);if(!s)return t;for(const i in s.mapping)t.has(i)&&t.delete(i);return t}function YL(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function E1(n,e,t,s){n.font=`${s} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function KL(n){De.assert(Number.isFinite(n)&&n>=tA,"Invalid cache limit"),lh=new eA(n)}class ZL{constructor(){this.props={...Sa}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*A1+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=qL(this._key,this.props.characterSet),s=lh.get(this._key);if(s&&t.size===0){this._atlas!==s&&(this._atlas=s);return}const i=this._generateFontAtlas(t,s);this._atlas=i,lh.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:s,fontWeight:i,fontSize:r,buffer:l,sdf:c,radius:h,cutoff:d}=this.props;let g=t&&t.data;g||(g=document.createElement("canvas"),g.width=x1);const _=g.getContext("2d",{willReadFrequently:!0});E1(_,s,r,i);const{mapping:y,canvasHeight:b,xOffset:T,yOffset:S}=zL({getFontWidth:R=>_.measureText(R).width,fontHeight:r*A1,buffer:l,characterSet:e,maxCanvasWidth:x1,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(g.height!==b){const R=_.getImageData(0,0,g.width,g.height);g.height=b,_.putImageData(R,0,0)}if(E1(_,s,r,i),c){const R=new BL({fontSize:r,buffer:l,radius:h,cutoff:d,fontFamily:s,fontWeight:`${i}`});for(const k of e){const{data:U,width:P,height:D,glyphTop:$}=R.draw(k);y[k].width=P,y[k].layoutOffsetY=r*S1-$;const Z=_.createImageData(P,D);YL(U,Z),_.putImageData(Z,y[k].x,y[k].y)}}else for(const R of e)_.fillText(R,y[R].x,y[R].y+l+r*S1);return{xOffset:T,yOffset:S,mapping:y,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:s,buffer:i,sdf:r,radius:l,cutoff:c}=this.props;return r?`${e} ${t} ${s} ${i} ${l} ${c}`:`${e} ${t} ${s} ${i}`}}const R1=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,QL={name:"textBackground",vs:R1,fs:R1,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},GL=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,JL=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,eF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class j_ extends rs{getShaders(){return super.getShaders({vs:GL,fs:JL,modules:[Ua,La,QL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var s;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:s,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:l,getLineWidth:c}=this.props;let{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]);const d=this.state.model,g={billboard:t,stroked:!!c,padding:h,sizeUnits:lr[i],sizeScale:s,sizeMinPixels:r,sizeMaxPixels:l};d.shaderInputs.setProps({textBackground:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Rn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Pa({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}j_.defaultProps=eF;j_.layerName="TextBackgroundLayer";const C1={start:1,middle:0,end:-1},O1={top:1,center:0,bottom:-1},jg=[0,0,0,255],tF=1,nF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:jg},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Sa.characterSet},fontFamily:Sa.fontFamily,fontWeight:Sa.fontWeight,lineHeight:tF,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:jg},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:jg},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class $_ extends kh{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[s,i]}=this.transformParagraph(e,t);const{fontSize:r}=this.state.fontAtlasManager.props;s/=r,i/=r;const{getTextAnchor:l,getAlignmentBaseline:c}=this.props,h=C1[typeof l=="function"?l(e,t):l],d=O1[typeof c=="function"?c(e,t):c];return[(h-1)*s/2,(d-1)*i/2,s,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:s,getAlignmentBaseline:i}=this.props,{x:r,y:l,rowWidth:c,size:[h,d]}=this.transformParagraph(e,t),g=C1[typeof s=="function"?s(e,t):s],_=O1[typeof i=="function"?i(e,t):i],y=r.length,b=new Array(y*2);let T=0;for(let S=0;S<y;S++){const R=(1-g)*(h-c[S])/2;b[T++]=(g-1)*h/2+R+r[S],b[T++]=(_-1)*d/2+l[S]}return b}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new ZL},this.props.maxWidth>0&&De.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:s,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==s.lineHeight||t.wordBreak!==s.wordBreak||t.maxWidth!==s.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:s}=this.props,{fontAtlasManager:i,characterSet:r}=this.state,l={...e,characterSet:r,fontFamily:t,fontWeight:s};if(!i.mapping)return i.setProps(l),!0;for(const c in l)if(l[c]!==i.props[c])return i.setProps(l),!0;return!1}_updateText(){var h;const{data:e,characterSet:t}=this.props,s=(h=e.attributes)==null?void 0:h.getText;let{getText:i}=this.props,r=e.startIndices,l;const c=t==="auto"&&new Set;if(s&&r){const{texts:d,characterCount:g}=WL({...ArrayBuffer.isView(s)?{value:s}:s,length:e.length,startIndices:r,characterSet:c});l=g,i=(_,{index:y})=>d[y]}else{const{iterable:d,objectInfo:g}=Ph(e);r=[0],l=0;for(const _ of d){g.index++;const y=Array.from(i(_,g)||"");c&&y.forEach(c.add,c),l+=y.length,r.push(l)}}this.setState({getText:i,startIndices:r,numInstances:l,characterSet:c||t})}transformParagraph(e,t){const{fontAtlasManager:s}=this.state,i=s.mapping,r=this.state.getText,{wordBreak:l,lineHeight:c,maxWidth:h}=this.props,d=r(e,t)||"";return HL(d,c,l,h*s.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:s,fontAtlasManager:{scale:i,atlas:r,mapping:l},styleVersion:c}=this.state,{data:h,_dataDiff:d,getPosition:g,getColor:_,getSize:y,getAngle:b,getPixelOffset:T,getBackgroundColor:S,getBorderColor:R,getBorderWidth:k,backgroundPadding:U,background:P,billboard:D,fontSettings:$,outlineWidth:Z,outlineColor:fe,sizeScale:ue,sizeUnits:J,sizeMinPixels:oe,sizeMaxPixels:de,transitions:ve,updateTriggers:be}=this.props,Se=this.getSubLayerClass("characters",V_),We=this.getSubLayerClass("background",j_);return[P&&new We({getFillColor:S,getLineColor:R,getLineWidth:k,padding:U,getPosition:g,getSize:y,getAngle:b,getPixelOffset:T,billboard:D,sizeScale:ue,sizeUnits:J,sizeMinPixels:oe,sizeMaxPixels:de,transitions:ve&&{getPosition:ve.getPosition,getAngle:ve.getAngle,getSize:ve.getSize,getFillColor:ve.getBackgroundColor,getLineColor:ve.getBorderColor,getLineWidth:ve.getBorderWidth,getPixelOffset:ve.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:be.getPosition,getAngle:be.getAngle,getSize:be.getSize,getFillColor:be.getBackgroundColor,getLineColor:be.getBorderColor,getLineWidth:be.getBorderWidth,getPixelOffset:be.getPixelOffset,getBoundingRect:{getText:be.getText,getTextAnchor:be.getTextAnchor,getAlignmentBaseline:be.getAlignmentBaseline,styleVersion:c}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Se({sdf:$.sdf,smoothing:Number.isFinite($.smoothing)?$.smoothing:Sa.smoothing,outlineWidth:Z/($.radius||Sa.radius),outlineColor:fe,iconAtlas:r,iconMapping:l,getPosition:g,getColor:_,getSize:y,getAngle:b,getPixelOffset:T,billboard:D,sizeScale:ue*i,sizeUnits:J,sizeMinPixels:oe*i,sizeMaxPixels:de*i,transitions:ve&&{getPosition:ve.getPosition,getAngle:ve.getAngle,getColor:ve.getColor,getSize:ve.getSize,getPixelOffset:ve.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:be.getText,getPosition:be.getPosition,getAngle:be.getAngle,getColor:be.getColor,getSize:be.getSize,getPixelOffset:be.getPixelOffset,getIconOffsets:{getTextAnchor:be.getTextAnchor,getAlignmentBaseline:be.getAlignmentBaseline,styleVersion:c}}}),{data:h,_dataDiff:d,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:s})]}static set fontAtlasCacheLimit(e){KL(e)}}$_.defaultProps=nF;$_.layerName="TextLayer";const Iu={circle:{type:F_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Dh,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:$_,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},ku={type:Bh,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},jp={type:z_,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Wo({type:n,props:e}){const t={};for(const s in e)t[s]=n.defaultProps[e[s]];return t}function $g(n,e){const{transitions:t,updateTriggers:s}=n.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const r in e){const l=e[r];let c=n.props[r];r.startsWith("get")&&(c=n.getSubLayerAccessor(c),i.updateTriggers[l]=s[r],t&&(i.transitions[l]=t[r])),i[l]=c}return i}function sF(n){if(Array.isArray(n))return n;switch(De.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return De.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function M1(n,e,t={}){const s={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:r=n.length}=t;for(let l=i;l<r;l++){const c=n[l],{geometry:h}=c;if(h)if(h.type==="GeometryCollection"){De.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:d}=h;for(let g=0;g<d.length;g++){const _=d[g];P1(_,s,e,c,l)}}else P1(h,s,e,c,l)}return s}function P1(n,e,t,s,i){const{type:r,coordinates:l}=n,{pointFeatures:c,lineFeatures:h,polygonFeatures:d,polygonOutlineFeatures:g}=e;if(!rF(r,l)){De.warn(`${r} coordinates are malformed`)();return}switch(r){case"Point":c.push(t({geometry:n},s,i));break;case"MultiPoint":l.forEach(_=>{c.push(t({geometry:{type:"Point",coordinates:_}},s,i))});break;case"LineString":h.push(t({geometry:n},s,i));break;case"MultiLineString":l.forEach(_=>{h.push(t({geometry:{type:"LineString",coordinates:_}},s,i))});break;case"Polygon":d.push(t({geometry:n},s,i)),l.forEach(_=>{g.push(t({geometry:{type:"LineString",coordinates:_}},s,i))});break;case"MultiPolygon":l.forEach(_=>{d.push(t({geometry:{type:"Polygon",coordinates:_}},s,i)),_.forEach(y=>{g.push(t({geometry:{type:"LineString",coordinates:y}},s,i))})});break}}const iF={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function rF(n,e){let t=iF[n];for(De.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function nA(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function hu(n){return n.geometry.coordinates}function aF(n,e){const t=nA(),{pointFeatures:s,lineFeatures:i,polygonFeatures:r,polygonOutlineFeatures:l}=n;return t.points.data=s,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=hu,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=hu,t.polygons.data=r,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=hu,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=hu,t}function oF(n,e){const t=nA(),{points:s,lines:i,polygons:r}=n,l=IL(n,e);return t.points.data={length:s.positions.value.length/s.positions.size,attributes:{...s.attributes,getPosition:s.positions,instancePickingColors:{size:4,value:l.points}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:l.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:r.polygonIndices.value.length-1,startIndices:r.polygonIndices.value,attributes:{...r.attributes,getPolygon:r.positions,pickingColors:{size:4,value:l.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.polygons._normalize=!1,r.triangles&&(t.polygons.data.attributes.indices=r.triangles.value),t.polygonsOutline.data={length:r.primitivePolygonIndices.value.length-1,startIndices:r.primitivePolygonIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:l.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.polygonsOutline._pathType="open",t}const lF=["points","linestrings","polygons"],cF={...Wo(Iu.circle),...Wo(Iu.icon),...Wo(Iu.text),...Wo(ku),...Wo(jp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Uh extends kh{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:s}=this.props,i=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const s=oF(e.data,this.encodePickingColor);this.setState({layerProps:s})}_updateStateJSON({props:e,changeFlags:t}){const s=sF(e.data),i=this.getSubLayerRow.bind(this);let r={};const l={};if(Array.isArray(t.dataChanged)){const h=this.state.features;for(const d in h)r[d]=h[d].slice(),l[d]=[];for(const d of t.dataChanged){const g=M1(s,i,d);for(const _ in h)l[_].push(OL({data:r[_],getIndex:y=>y.__source.index,dataRange:d,replace:g[_]}))}}else r=M1(s,i);const c=aF(r,l);this.setState({features:r,featuresDiff:l,layerProps:c})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s,sourceLayer:i}=t;return t.featureType=lF.find(r=>i.id.startsWith(`${this.id}-${r}-`)),s>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[s]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,s=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===s&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var l;const{extruded:e,wireframe:t}=this.props,{layerProps:s}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,(l=s.polygons)==null?void 0:l.data)&&this.getSubLayerClass(i,jp.type);if(r){const c=$g(this,jp.props),h=e&&t;return h||delete c.getLineColor,c.updateTriggers.lineColors=h,new r(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),s.polygons)}return null}_renderLineLayers(){var h,d;const{extruded:e,stroked:t}=this.props,{layerProps:s}=this.state,i="polygons-stroke",r="linestrings",l=!e&&t&&this.shouldRenderSubLayer(i,(h=s.polygonsOutline)==null?void 0:h.data)&&this.getSubLayerClass(i,ku.type),c=this.shouldRenderSubLayer(r,(d=s.lines)==null?void 0:d.data)&&this.getSubLayerClass(r,ku.type);if(l||c){const g=$g(this,ku.props);return[l&&new l(g,this.getSubLayerProps({id:i,updateTriggers:g.updateTriggers}),s.polygonsOutline),c&&new c(g,this.getSubLayerProps({id:r,updateTriggers:g.updateTriggers}),s.lines)]}return null}_renderPointLayers(){var c;const{pointType:e}=this.props,{layerProps:t,binary:s}=this.state;let{highlightedObjectIndex:i}=this.props;!s&&Number.isFinite(i)&&(i=t.points.data.findIndex(h=>h.__source.index===i));const r=new Set(e.split("+")),l=[];for(const h of r){const d=`points-${h}`,g=Iu[h],_=g&&this.shouldRenderSubLayer(d,(c=t.points)==null?void 0:c.data)&&this.getSubLayerClass(d,g.type);if(_){const y=$g(this,g.props);let b=t.points;if(h==="text"&&s){const{instancePickingColors:T,...S}=b.data.attributes;b={...b,data:{...b.data,attributes:S}}}l.push(new _(y,this.getSubLayerProps({id:d,updateTriggers:y.updateTriggers,highlightedObjectIndex:i}),b))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),s=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,s,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(s,i)=>{const{data:r,index:l}=i,c=ML(r,l);return e(c,i)}}}Uh.layerName="GeoJsonLayer";Uh.defaultProps=cF;class uF{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:s,onError:i}){const{index:r,id:l,bbox:c,userData:h,zoom:d}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,y=await t.scheduleRequest(this,S=>S.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let b=null,T;try{b=await e({index:r,id:l,bbox:c,userData:h,zoom:d,signal:_})}catch(S){T=S||!0}finally{y.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=b,this._isCancelled&&!b){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,T?i(T,this):s(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Xt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},I1=new he,hF=new he;class H_{constructor(e=[0,0,0],t=[0,0,0],s){s=s||I1.copy(e).add(t).scale(.5),this.center=new he(s),this.halfDiagonal=new he(t).subtract(this.center),this.minimum=new he(e),this.maximum=new he(t)}clone(){return new H_(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,s=hF.from(e.normal),i=t.x*Math.abs(s.x)+t.y*Math.abs(s.y)+t.z*Math.abs(s.z),r=this.center.dot(s)+e.distance;return r-i>0?Xt.INSIDE:r+i<0?Xt.OUTSIDE:Xt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=I1.from(e).subtract(this.center),{halfDiagonal:s}=this;let i=0,r;return r=Math.abs(t.x)-s.x,r>0&&(i+=r*r),r=Math.abs(t.y)-s.y,r>0&&(i+=r*r),r=Math.abs(t.z)-s.z,r>0&&(i+=r*r),i}}const Xo=new he,k1=new he;class W_{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new he,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Xo.from(t),this.center=new he().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new W_(this.center,this.radius)}union(e){const t=this.center,s=this.radius,i=e.center,r=e.radius,l=Xo.copy(i).subtract(t),c=l.magnitude();if(s>=c+r)return this.clone();if(r>=c+s)return e.clone();const h=(s+c+r)*.5;return k1.copy(l).scale((-s+h)/c).add(t),this.center.copy(k1),this.radius=h,this}expand(e){const s=Xo.from(e).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(e){this.center.transform(e);const t=wP(Xo,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const s=Xo.from(e).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(e){const t=this.center,s=this.radius,r=e.normal.dot(t)+e.distance;return r<-s?Xt.OUTSIDE:r<s?Xt.INTERSECTING:Xt.INSIDE}}const fF=new he,dF=new he,fu=new he,du=new he,gu=new he,gF=new he,pF=new he,xs={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class X_{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new he().from(e),this.halfAxes=new Ut(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new he(e).len(),new he(t).len(),new he(s).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new he(e).normalize(),r=new he(t).normalize(),l=new he(s).normalize();return new Hv().fromMatrix3(new Ut([...i,...r,...l]))}fromCenterHalfSizeQuaternion(e,t,s){const i=new Hv(s),r=new Ut().fromQuaternion(i);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=new he().from(e),this.halfAxes=r,this}clone(){return new X_(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new W_){const t=this.halfAxes,s=t.getColumn(0,fu),i=t.getColumn(1,du),r=t.getColumn(2,gu),l=fF.copy(s).add(i).add(r);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,s=e.normal,i=this.halfAxes,r=s.x,l=s.y,c=s.z,h=Math.abs(r*i[xs.COLUMN0ROW0]+l*i[xs.COLUMN0ROW1]+c*i[xs.COLUMN0ROW2])+Math.abs(r*i[xs.COLUMN1ROW0]+l*i[xs.COLUMN1ROW1]+c*i[xs.COLUMN1ROW2])+Math.abs(r*i[xs.COLUMN2ROW0]+l*i[xs.COLUMN2ROW1]+c*i[xs.COLUMN2ROW2]),d=s.dot(t)+e.distance;return d<=-h?Xt.OUTSIDE:d>=h?Xt.INSIDE:Xt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=dF.from(e).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,fu),r=s.getColumn(1,du),l=s.getColumn(2,gu),c=i.magnitude(),h=r.magnitude(),d=l.magnitude();i.normalize(),r.normalize(),l.normalize();let g=0,_;return _=Math.abs(t.dot(i))-c,_>0&&(g+=_*_),_=Math.abs(t.dot(r))-h,_>0&&(g+=_*_),_=Math.abs(t.dot(l))-d,_>0&&(g+=_*_),g}computePlaneDistances(e,t,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const l=this.center,c=this.halfAxes,h=c.getColumn(0,fu),d=c.getColumn(1,du),g=c.getColumn(2,gu),_=gF.copy(h).add(d).add(g).add(l),y=pF.copy(_).subtract(e);let b=t.dot(y);return i=Math.min(b,i),r=Math.max(b,r),_.copy(l).add(h).add(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),_.copy(l).add(h).subtract(d).add(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),_.copy(l).add(h).subtract(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),l.copy(_).subtract(h).add(d).add(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),l.copy(_).subtract(h).add(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),l.copy(_).subtract(h).subtract(d).add(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),l.copy(_).subtract(h).subtract(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),i=Math.min(b,i),r=Math.max(b,r),s[0]=i,s[1]=r,s}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,fu);t.transformAsPoint(e);const s=this.halfAxes.getColumn(1,du);s.transformAsPoint(e);const i=this.halfAxes.getColumn(2,gu);return i.transformAsPoint(e),this.halfAxes=new Ut([...t,...s,...i]),this}getTransform(){throw new Error("not implemented")}}const N1=new he,D1=new he;class xl{constructor(e=[0,0,1],t=0){this.normal=new he,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return ml(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=N1.from(e),this.normal.from(t).normalize();const s=-this.normal.dot(e);return this.distance=s,this}fromCoefficients(e,t,s,i){return this.normal.set(e,t,s),ml(Os(this.normal.len(),1)),this.distance=i,this}clone(){return new xl(this.normal,this.distance)}equals(e){return Os(this.distance,e.distance)&&Os(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=D1.copy(this.normal).transformAsVector(e).normalize(),s=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(s,t)}projectPointOntoPlane(e,t=[0,0,0]){const s=N1.from(e),i=this.getPointDistance(s),r=D1.copy(this.normal).scale(i);return s.subtract(r).to(t)}}const B1=[new he([1,0,0]),new he([0,1,0]),new he([0,0,1])],U1=new he,_F=new he;class Cs{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*B1.length;const t=e.center,s=e.radius;let i=0;for(const r of B1){let l=this.planes[i],c=this.planes[i+1];l||(l=this.planes[i]=new xl),c||(c=this.planes[i+1]=new xl);const h=U1.copy(r).scale(-s).add(t);l.fromPointNormal(h,r);const d=U1.copy(r).scale(s).add(t),g=_F.copy(r).negate();c.fromPointNormal(d,g),i+=2}return this}computeVisibility(e){let t=Xt.INSIDE;for(const s of this.planes)switch(e.intersectPlane(s)){case Xt.OUTSIDE:return Xt.OUTSIDE;case Xt.INTERSECTING:t=Xt.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(ml(Number.isFinite(t),"parentPlaneMask is required."),t===Cs.MASK_OUTSIDE||t===Cs.MASK_INSIDE)return t;let s=Cs.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const l=r<31?1<<r:0;if(r<31&&(t&l)===0)continue;const c=i[r],h=e.intersectPlane(c);if(h===Xt.OUTSIDE)return Cs.MASK_OUTSIDE;h===Xt.INTERSECTING&&(s|=l)}return s}}Cs.MASK_OUTSIDE=4294967295;Cs.MASK_INSIDE=0;Cs.MASK_INDETERMINATE=2147483647;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;new he;const Jn=new Ut,mF=new Ut,yF=new Ut,pu=new Ut,L1=new Ut;function bF(n,e={}){const t=aI,s=10;let i=0,r=0;const l=mF,c=yF;l.identity(),c.copy(n);const h=t*vF(c);for(;r<s&&TF(c)>h;)wF(c,pu),L1.copy(pu).transpose(),c.multiplyRight(pu),c.multiplyLeft(L1),l.multiplyRight(pu),++i>2&&(++r,i=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function vF(n){let e=0;for(let t=0;t<9;++t){const s=n[t];e+=s*s}return Math.sqrt(e)}const $p=[1,0,0],Hp=[2,2,1];function TF(n){let e=0;for(let t=0;t<3;++t){const s=n[Jn.getElementIndex(Hp[t],$p[t])];e+=2*s*s}return Math.sqrt(e)}function wF(n,e){const t=rI;let s=0,i=1;for(let d=0;d<3;++d){const g=Math.abs(n[Jn.getElementIndex(Hp[d],$p[d])]);g>s&&(i=d,s=g)}const r=$p[i],l=Hp[i];let c=1,h=0;if(Math.abs(n[Jn.getElementIndex(l,r)])>t){const d=n[Jn.getElementIndex(l,l)],g=n[Jn.getElementIndex(r,r)],_=n[Jn.getElementIndex(l,r)],y=(d-g)/2/_;let b;y<0?b=-1/(-y+Math.sqrt(1+y*y)):b=1/(y+Math.sqrt(1+y*y)),c=1/Math.sqrt(1+b*b),h=b*c}return Ut.IDENTITY.to(e),e[Jn.getElementIndex(r,r)]=e[Jn.getElementIndex(l,l)]=c,e[Jn.getElementIndex(l,r)]=h,e[Jn.getElementIndex(r,l)]=-h,e}const ri=new he,xF=new he,SF=new he,AF=new he,EF=new he,RF=new Ut,CF={diagonal:new Ut,unitary:new Ut};function OF(n,e=new X_){if(!n||n.length===0)return e.halfAxes=new Ut([0,0,0,0,0,0,0,0,0]),e.center=new he,e;const t=n.length,s=new he(0,0,0);for(const J of n)s.add(J);const i=1/t;s.multiplyByScalar(i);let r=0,l=0,c=0,h=0,d=0,g=0;for(const J of n){const oe=ri.copy(J).subtract(s);r+=oe.x*oe.x,l+=oe.x*oe.y,c+=oe.x*oe.z,h+=oe.y*oe.y,d+=oe.y*oe.z,g+=oe.z*oe.z}r*=i,l*=i,c*=i,h*=i,d*=i,g*=i;const _=RF;_[0]=r,_[1]=l,_[2]=c,_[3]=l,_[4]=h,_[5]=d,_[6]=c,_[7]=d,_[8]=g;const{unitary:y}=bF(_,CF),b=e.halfAxes.copy(y);let T=b.getColumn(0,SF),S=b.getColumn(1,AF),R=b.getColumn(2,EF),k=-Number.MAX_VALUE,U=-Number.MAX_VALUE,P=-Number.MAX_VALUE,D=Number.MAX_VALUE,$=Number.MAX_VALUE,Z=Number.MAX_VALUE;for(const J of n)ri.copy(J),k=Math.max(ri.dot(T),k),U=Math.max(ri.dot(S),U),P=Math.max(ri.dot(R),P),D=Math.min(ri.dot(T),D),$=Math.min(ri.dot(S),$),Z=Math.min(ri.dot(R),Z);T=T.multiplyByScalar(.5*(D+k)),S=S.multiplyByScalar(.5*($+U)),R=R.multiplyByScalar(.5*(Z+P)),e.center.copy(T).add(S).add(R);const fe=xF.set(k-D,U-$,P-Z).multiplyByScalar(.5),ue=new Ut([fe[0],0,0,0,fe[1],0,0,0,fe[2]]);return e.halfAxes.multiplyRight(ue),e}const va=512,MF=3,sA=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],iA=sA.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),PF=iA.concat([[.25,.5],[.75,.5]]);class Ta{constructor(e,t,s){this.x=e,this.y=t,this.z=s}get children(){if(!this._children){const e=this.x*2,t=this.y*2,s=this.z+1;this._children=[new Ta(e,t,s),new Ta(e,t+1,s),new Ta(e+1,t,s),new Ta(e+1,t+1,s)]}return this._children}update(e){const{viewport:t,cullingVolume:s,elevationBounds:i,minZ:r,maxZ:l,bounds:c,offset:h,project:d}=e,g=this.getBoundingVolume(i,h,d);if(c&&!this.insideBounds(c)||s.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<l&&y>=r){const b=g.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(b))}if(y>=l)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,s,i]){const r=Math.pow(2,this.z),l=va/r;return this.x*l<s&&this.y*l<i&&(this.x+1)*l>e&&(this.y+1)*l>t}getBoundingVolume(e,t,s){if(s){const h=this.z<1?PF:this.z<2?iA:sA,d=[];for(const g of h){const _=Xp(this.x+g[0],this.y+g[1],this.z);_[2]=e[0],d.push(s(_)),e[0]!==e[1]&&(_[2]=e[1],d.push(s(_)))}return OF(d)}const i=Math.pow(2,this.z),r=va/i,l=this.x*r+t*va,c=va-(this.y+1)*r;return new H_([l,c,e[0]],[l+r,c+r,e[1]])}}function IF(n,e,t,s){const i=n instanceof rU&&n.resolution?n.projectPosition:null,r=Object.values(n.getFrustumPlanes()).map(({normal:b,distance:T})=>new xl(b.clone().negate(),T)),l=new Cs(r),c=n.distanceScales.unitsPerMeter[2],h=t&&t[0]*c||0,d=t&&t[1]*c||0,g=n instanceof wi&&n.pitch<=60?e:0;if(s){const[b,T,S,R]=s,k=Ti([b,R]),U=Ti([S,T]);s=[k[0],va-k[1],U[0],va-U[1]]}const _=new Ta(0,0,0),y={viewport:n,project:i,cullingVolume:l,elevationBounds:[h,d],minZ:g,maxZ:e,bounds:s,offset:0};if(_.update(y),n instanceof wi&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;_.update(y)&&!(--y.offset<-3););for(y.offset=1;_.update(y)&&!(++y.offset>MF););}return _.getSelected()}const Ps=512,kF=[-1/0,-1/0,1/0,1/0],NF={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let s=0;s<t;s++)if(n[s]!==e[s])return!1;return!0}};function rA(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function DF(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function BF(n,e){if(!n||!n.length)return null;const{index:t,id:s}=e;if(Array.isArray(n)){const r=DF(s)%n.length;n=n[r]}let i=n;for(const r of Object.keys(t)){const l=new RegExp(`{${r}}`,"g");i=i.replace(l,String(t[r]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function UF(n,e,t){let s;return s=n.getBounds(),n.isGeospatial?[Math.max(s[0],t[0]),Math.max(s[1],t[1]),Math.min(s[2],t[2]),Math.min(s[3],t[3])]:[Math.max(Math.min(s[0],t[2]),t[0]),Math.max(Math.min(s[1],t[3]),t[1]),Math.min(Math.max(s[2],t[0]),t[2]),Math.min(Math.max(s[3],t[1]),t[3])]}function LF({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(i=>Wp(i,e||0,t))}function Wp(n,e,t){if(!Array.isArray(e)){const r=t.x-n.x,l=t.y-n.y,{width:c,height:h}=t,d={targetZ:e},g=n.unproject([r,l],d),_=n.unproject([r+c,l],d),y=n.unproject([r,l+h],d),b=n.unproject([r+c,l+h],d);return[Math.min(g[0],_[0],y[0],b[0]),Math.min(g[1],_[1],y[1],b[1]),Math.max(g[0],_[0],y[0],b[0]),Math.max(g[1],_[1],y[1],b[1])]}const s=Wp(n,e[0],t),i=Wp(n,e[1],t);return[Math.min(s[0],i[0]),Math.min(s[1],i[1]),Math.max(s[2],i[2]),Math.max(s[3],i[3])]}function FF(n,e,t){return t?rA(n,t).map(i=>i*e/Ps):n.map(s=>s*e/Ps)}function q_(n,e){return Math.pow(2,n)*Ps/e}function Xp(n,e,t){const s=q_(t,Ps),i=n/s*360-180,r=Math.PI-2*Math.PI*e/s,l=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,l]}function F1(n,e,t,s){const i=q_(t,s);return[n/i*Ps,e/i*Ps]}function zF(n,e,t,s,i=Ps){if(n.isGeospatial){const[d,g]=Xp(e,t,s),[_,y]=Xp(e+1,t+1,s);return{west:d,north:g,east:_,south:y}}const[r,l]=F1(e,t,s,i),[c,h]=F1(e+1,t+1,s,i);return{left:r,top:l,right:c,bottom:h}}function VF(n,e,t,s,i){const r=UF(n,null,s),l=q_(e,t),[c,h,d,g]=FF(r,l,i),_=[];for(let y=Math.floor(c);y<d;y++)for(let b=Math.floor(h);b<g;b++)_.push({x:y,y:b,z:e});return _}function jF({viewport:n,maxZoom:e,minZoom:t,zRange:s,extent:i,tileSize:r=Ps,modelMatrix:l,modelMatrixInverse:c,zoomOffset:h=0}){let d=n.isGeospatial?Math.round(n.zoom+Math.log2(Ps/r))+h:Math.ceil(n.zoom)+h;if(typeof t=="number"&&Number.isFinite(t)&&d<t){if(!i)return[];d=t}typeof e=="number"&&Number.isFinite(e)&&d>e&&(d=e);let g=i;return l&&c&&i&&!n.isGeospatial&&(g=rA(i,l)),n.isGeospatial?IF(n,d,s,i):VF(n,d,r,g||kF,c)}function $F(n){let e={},t;return s=>{for(const i in s)if(!HF(s[i],e[i])){t=n(s),e=s;break}return t}}function HF(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let s=0;s<t;s++)if(n[s]!==e[s])return!1;return!0}return!1}const z1=1,Lh=2,WF="never",XF="no-overlap",Y_="best-available",qF=5,YF={[Y_]:QF,[XF]:GF,[WF]:()=>{}},KF={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class ZF{constructor(e){this._getCullBounds=$F(LF),this.opts={...KF,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var s,i;(i=(s=this.opts).onTileLoad)==null||i.call(s,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new qE({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Zt,this._modelMatrixInverse=new Zt}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:s}={zRange:null,modelMatrix:null}){const i=s?new Zt(s):new Zt,r=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Os(this._zRange,t)||r){r&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[r,l,c,h]of s){let d;if("west"in i)d=i.west<c&&i.east>r&&i.south<h&&i.north>l;else{const g=Math.min(i.top,i.bottom),_=Math.max(i.top,i.bottom);d=i.left<c&&i.right>r&&g<h&&_>l}if(d)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:s,zRange:i,modelMatrix:r,modelMatrixInverse:l}){const{tileSize:c,extent:h,zoomOffset:d}=this.opts;return jF({viewport:e,maxZoom:t,minZoom:s,zRange:i,tileSize:c,extent:h,modelMatrix:r,modelMatrixInverse:l,zoomOffset:d})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:zF(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),s=Math.floor(e.y/2),i=e.z-1;return{x:t,y:s,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||Y_,t=new Array(this._cache.size);let s=0;for(const i of this._cache.values())t[s++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:YF[e])(Array.from(this._cache.values())),s=0;for(const i of this._cache.values())if(t[s++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let s=0;for(const i of this._cache.values())i.isLoading&&(s++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&s>e&&t.length>0;)t.shift().abort(),s--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const s=this._getNearestAncestor(t);t.parent=s,s!=null&&s.children&&s.children.push(t)}}_resizeCache(){var l,c;const{_cache:e,opts:t}=this,s=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:qF*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>s||this._cacheByteSize>i){for(const[h,d]of e)if(!d.isVisible&&!d.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?d.byteLength:0,e.delete(h),(c=(l=this.opts).onTileUnload)==null||c.call(l,d)),e.size<=s&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((h,d)=>h.zoom-d.zoom),this._dirty=!1)}_getTile(e,t){const s=this.getTileId(e);let i=this._cache.get(s),r=!1;return!i&&t?(i=new uF(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:s,zoom:this.getTileZoom(i.index)}),r=!0,this._cache.set(s,i),this._dirty=!0):i&&i.needsReload&&(r=!0),i&&r&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let s=e.index;for(;this.getTileZoom(s)>t;){s=this.getParentIndex(s);const i=this._getTile(s);if(i)return i}return null}}function QF(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!aA(e)&&K_(e);for(const e of n)e.isVisible=!!(e.state&Lh)}function GF(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&aA(t);const e=Array.from(n).sort((t,s)=>t.zoom-s.zoom);for(const t of e)if(t.isVisible=!!(t.state&Lh),t.children&&(t.isVisible||t.state&z1))for(const s of t.children)s.state=z1;else t.isSelected&&K_(t)}function aA(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=Lh,!0;e=e.parent}return!1}function K_(n){for(const e of n.children)e.isLoaded||e.content?e.state|=Lh:K_(e)}const JF={TilesetClass:ZF,data:{type:"data",value:[]},dataComparator:NF.equal,renderSubLayers:{type:"function",value:n=>new Uh(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Y_,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Z_ extends kh{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,s;return!!((s=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&s.every(i=>i.isLoaded&&i.layers&&i.layers.every(r=>r.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const s=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?s&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(r=>{r.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:s,refinementStrategy:i,extent:r,maxZoom:l,minZoom:c,maxRequests:h,debounceTime:d,zoomOffset:g}=this.props;return{maxCacheSize:t,maxCacheByteSize:s,maxZoom:l,minZoom:c,tileSize:e,refinementStrategy:i,extent:r,maxRequests:h,debounceTime:d,zoomOffset:g,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:s}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:s}),{isLoaded:r}=e,l=this.state.isLoaded!==r,c=this.state.frameNumber!==i;r&&(l||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:s,fetch:i}=this.props,{signal:r}=e;return e.url=typeof t=="string"||Array.isArray(t)?BF(t,e):null,s?s(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,s=t.props.tile,i=e.info;return i.picked&&(i.tile=s),i.sourceTile=s,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(s=>e.layers[0].props[s]!==t[s])&&(e.layers=e.layers.map(s=>s.clone(t)));else{const s=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Oh(s,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:s}=e.props;return this.state.tileset.isTileVisible(s,t)}}Z_.defaultProps=JF;Z_.layerName="TileLayer";const e8="modulepreload",t8=function(n){return"/"+n},V1={},Na=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=Promise.allSettled(t.map(h=>{if(h=t8(h),h in V1)return;V1[h]=!0;const d=h.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":e8,d||(_.as="script"),_.crossOrigin="",_.href=h,c&&_.setAttribute("nonce",c),document.head.appendChild(_),d)return new Promise((y,b)=>{_.addEventListener("load",y),_.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return i.then(l=>{for(const c of l||[])c.status==="rejected"&&r(c.reason);return e().catch(r)})},n8=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Na(async()=>{const{default:s}=await Promise.resolve().then(()=>Va);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Q_ extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class s8 extends Q_{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class i8 extends Q_{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class r8 extends Q_{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var qp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(qp||(qp={}));var a8=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};class o8{constructor(e,{headers:t={},customFetch:s,region:i=qp.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=n8(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return a8(this,void 0,void 0,function*(){try{const{headers:i,method:r,body:l}=t;let c={},{region:h}=t;h||(h=this.region),h&&h!=="any"&&(c["x-region"]=h);let d;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",d=l):typeof l=="string"?(c["Content-Type"]="text/plain",d=l):typeof FormData<"u"&&l instanceof FormData?d=l:(c["Content-Type"]="application/json",d=JSON.stringify(l)));const g=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:d}).catch(T=>{throw new s8(T)}),_=g.headers.get("x-relay-error");if(_&&_==="true")throw new i8(g);if(!g.ok)throw new r8(g);let y=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),b;return y==="application/json"?b=yield g.json():y==="application/octet-stream"?b=yield g.blob():y==="text/event-stream"?b=g:y==="multipart/form-data"?b=yield g.formData():b=yield g.text(),{data:b,error:null}}catch(i){return{data:null,error:i}}})}}var Mt={},sa={},ia={},ra={},aa={},oa={},l8=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Da=l8();const c8=Da.fetch,oA=Da.fetch.bind(Da),lA=Da.Headers,u8=Da.Request,h8=Da.Response,Va=Object.freeze(Object.defineProperty({__proto__:null,Headers:lA,Request:u8,Response:h8,default:oA,fetch:c8},Symbol.toStringTag,{value:"Module"})),f8=K3(Va);var _u={},j1;function cA(){if(j1)return _u;j1=1,Object.defineProperty(_u,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return _u.default=n,_u}var $1;function uA(){if($1)return oa;$1=1;var n=oa&&oa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(oa,"__esModule",{value:!0});const e=n(f8),t=n(cA());class s{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,r.fetch?this.fetch=r.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,l){return this.headers=Object.assign({},this.headers),this.headers[r]=l,this}then(r,l){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const c=this.fetch;let h=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var g,_,y;let b=null,T=null,S=null,R=d.status,k=d.statusText;if(d.ok){if(this.method!=="HEAD"){const $=await d.text();$===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?T=$:T=JSON.parse($))}const P=(g=this.headers.Prefer)===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),D=(_=d.headers.get("content-range"))===null||_===void 0?void 0:_.split("/");P&&D&&D.length>1&&(S=parseInt(D[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(b={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,S=null,R=406,k="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const P=await d.text();try{b=JSON.parse(P),Array.isArray(b)&&d.status===404&&(T=[],b=null,R=200,k="OK")}catch{d.status===404&&P===""?(R=204,k="No Content"):b={message:P}}if(b&&this.isMaybeSingle&&(!((y=b==null?void 0:b.details)===null||y===void 0)&&y.includes("0 rows"))&&(b=null,R=200,k="OK"),b&&this.shouldThrowOnError)throw new t.default(b)}return{error:b,data:T,count:S,status:R,statusText:k}});return this.shouldThrowOnError||(h=h.catch(d=>{var g,_,y;return{error:{message:`${(g=d==null?void 0:d.name)!==null&&g!==void 0?g:"FetchError"}: ${d==null?void 0:d.message}`,details:`${(_=d==null?void 0:d.stack)!==null&&_!==void 0?_:""}`,hint:"",code:`${(y=d==null?void 0:d.code)!==null&&y!==void 0?y:""}`},data:null,count:null,status:0,statusText:""}})),h.then(r,l)}returns(){return this}overrideTypes(){return this}}return oa.default=s,oa}var H1;function hA(){if(H1)return aa;H1=1;var n=aa&&aa.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(aa,"__esModule",{value:!0});const e=n(uA());class t extends e.default{select(i){let r=!1;const l=(i??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join("");return this.url.searchParams.set("select",l),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(i,{ascending:r=!0,nullsFirst:l,foreignTable:c,referencedTable:h=c}={}){const d=h?`${h}.order`:"order",g=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${g?`${g},`:""}${i}.${r?"asc":"desc"}${l===void 0?"":l?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:r,referencedTable:l=r}={}){const c=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${i}`),this}range(i,r,{foreignTable:l,referencedTable:c=l}={}){const h=typeof c>"u"?"offset":`${c}.offset`,d=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(h,`${i}`),this.url.searchParams.set(d,`${r-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:i=!1,verbose:r=!1,settings:l=!1,buffers:c=!1,wal:h=!1,format:d="text"}={}){var g;const _=[i?"analyze":null,r?"verbose":null,l?"settings":null,c?"buffers":null,h?"wal":null].filter(Boolean).join("|"),y=(g=this.headers.Accept)!==null&&g!==void 0?g:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${d}; for="${y}"; options=${_};`,d==="json"?this:this}rollback(){var i;return((i=this.headers.Prefer)!==null&&i!==void 0?i:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return aa.default=t,aa}var W1;function G_(){if(W1)return ra;W1=1;var n=ra&&ra.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ra,"__esModule",{value:!0});const e=n(hA());class t extends e.default{eq(i,r){return this.url.searchParams.append(i,`eq.${r}`),this}neq(i,r){return this.url.searchParams.append(i,`neq.${r}`),this}gt(i,r){return this.url.searchParams.append(i,`gt.${r}`),this}gte(i,r){return this.url.searchParams.append(i,`gte.${r}`),this}lt(i,r){return this.url.searchParams.append(i,`lt.${r}`),this}lte(i,r){return this.url.searchParams.append(i,`lte.${r}`),this}like(i,r){return this.url.searchParams.append(i,`like.${r}`),this}likeAllOf(i,r){return this.url.searchParams.append(i,`like(all).{${r.join(",")}}`),this}likeAnyOf(i,r){return this.url.searchParams.append(i,`like(any).{${r.join(",")}}`),this}ilike(i,r){return this.url.searchParams.append(i,`ilike.${r}`),this}ilikeAllOf(i,r){return this.url.searchParams.append(i,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(i,r){return this.url.searchParams.append(i,`ilike(any).{${r.join(",")}}`),this}is(i,r){return this.url.searchParams.append(i,`is.${r}`),this}in(i,r){const l=Array.from(new Set(r)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${l})`),this}contains(i,r){return typeof r=="string"?this.url.searchParams.append(i,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(i,`cs.{${r.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(r)}`),this}containedBy(i,r){return typeof r=="string"?this.url.searchParams.append(i,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(i,`cd.{${r.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(r)}`),this}rangeGt(i,r){return this.url.searchParams.append(i,`sr.${r}`),this}rangeGte(i,r){return this.url.searchParams.append(i,`nxl.${r}`),this}rangeLt(i,r){return this.url.searchParams.append(i,`sl.${r}`),this}rangeLte(i,r){return this.url.searchParams.append(i,`nxr.${r}`),this}rangeAdjacent(i,r){return this.url.searchParams.append(i,`adj.${r}`),this}overlaps(i,r){return typeof r=="string"?this.url.searchParams.append(i,`ov.${r}`):this.url.searchParams.append(i,`ov.{${r.join(",")}}`),this}textSearch(i,r,{config:l,type:c}={}){let h="";c==="plain"?h="pl":c==="phrase"?h="ph":c==="websearch"&&(h="w");const d=l===void 0?"":`(${l})`;return this.url.searchParams.append(i,`${h}fts${d}.${r}`),this}match(i){return Object.entries(i).forEach(([r,l])=>{this.url.searchParams.append(r,`eq.${l}`)}),this}not(i,r,l){return this.url.searchParams.append(i,`not.${r}.${l}`),this}or(i,{foreignTable:r,referencedTable:l=r}={}){const c=l?`${l}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,r,l){return this.url.searchParams.append(i,`${r}.${l}`),this}}return ra.default=t,ra}var X1;function fA(){if(X1)return ia;X1=1;var n=ia&&ia.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ia,"__esModule",{value:!0});const e=n(G_());class t{constructor(i,{headers:r={},schema:l,fetch:c}){this.url=i,this.headers=r,this.schema=l,this.fetch=c}select(i,{head:r=!1,count:l}={}){const c=r?"HEAD":"GET";let h=!1;const d=(i??"*").split("").map(g=>/\s/.test(g)&&!h?"":(g==='"'&&(h=!h),g)).join("");return this.url.searchParams.set("select",d),l&&(this.headers.Prefer=`count=${l}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(i,{count:r,defaultToNull:l=!0}={}){const c="POST",h=[];if(this.headers.Prefer&&h.push(this.headers.Prefer),r&&h.push(`count=${r}`),l||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(i)){const d=i.reduce((g,_)=>g.concat(Object.keys(_)),[]);if(d.length>0){const g=[...new Set(d)].map(_=>`"${_}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}upsert(i,{onConflict:r,ignoreDuplicates:l=!1,count:c,defaultToNull:h=!0}={}){const d="POST",g=[`resolution=${l?"ignore":"merge"}-duplicates`];if(r!==void 0&&this.url.searchParams.set("on_conflict",r),this.headers.Prefer&&g.push(this.headers.Prefer),c&&g.push(`count=${c}`),h||g.push("missing=default"),this.headers.Prefer=g.join(","),Array.isArray(i)){const _=i.reduce((y,b)=>y.concat(Object.keys(b)),[]);if(_.length>0){const y=[...new Set(_)].map(b=>`"${b}"`);this.url.searchParams.set("columns",y.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}update(i,{count:r}={}){const l="PATCH",c=[];return this.headers.Prefer&&c.push(this.headers.Prefer),r&&c.push(`count=${r}`),this.headers.Prefer=c.join(","),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}delete({count:i}={}){const r="DELETE",l=[];return i&&l.push(`count=${i}`),this.headers.Prefer&&l.unshift(this.headers.Prefer),this.headers.Prefer=l.join(","),new e.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return ia.default=t,ia}var qo={},Yo={},q1;function d8(){return q1||(q1=1,Object.defineProperty(Yo,"__esModule",{value:!0}),Yo.version=void 0,Yo.version="0.0.0-automated"),Yo}var Y1;function g8(){if(Y1)return qo;Y1=1,Object.defineProperty(qo,"__esModule",{value:!0}),qo.DEFAULT_HEADERS=void 0;const n=d8();return qo.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},qo}var K1;function p8(){if(K1)return sa;K1=1;var n=sa&&sa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(sa,"__esModule",{value:!0});const e=n(fA()),t=n(G_()),s=g8();class i{constructor(l,{headers:c={},schema:h,fetch:d}={}){this.url=l,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),c),this.schemaName=h,this.fetch=d}from(l){const c=new URL(`${this.url}/${l}`);return new e.default(c,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new i(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:h=!1,get:d=!1,count:g}={}){let _;const y=new URL(`${this.url}/rpc/${l}`);let b;h||d?(_=h?"HEAD":"GET",Object.entries(c).filter(([S,R])=>R!==void 0).map(([S,R])=>[S,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([S,R])=>{y.searchParams.append(S,R)})):(_="POST",b=c);const T=Object.assign({},this.headers);return g&&(T.Prefer=`count=${g}`),new t.default({method:_,url:y,headers:T,schema:this.schemaName,body:b,fetch:this.fetch,allowEmpty:!1})}}return sa.default=i,sa}var Z1;function _8(){if(Z1)return Mt;Z1=1;var n=Mt&&Mt.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.PostgrestError=Mt.PostgrestBuilder=Mt.PostgrestTransformBuilder=Mt.PostgrestFilterBuilder=Mt.PostgrestQueryBuilder=Mt.PostgrestClient=void 0;const e=n(p8());Mt.PostgrestClient=e.default;const t=n(fA());Mt.PostgrestQueryBuilder=t.default;const s=n(G_());Mt.PostgrestFilterBuilder=s.default;const i=n(hA());Mt.PostgrestTransformBuilder=i.default;const r=n(uA());Mt.PostgrestBuilder=r.default;const l=n(cA());return Mt.PostgrestError=l.default,Mt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:r.default,PostgrestError:l.default},Mt}var m8=_8();const y8=uw(m8),{PostgrestClient:b8,PostgrestQueryBuilder:lz,PostgrestFilterBuilder:cz,PostgrestTransformBuilder:uz,PostgrestBuilder:hz,PostgrestError:fz}=y8,v8="2.11.2",T8={"X-Client-Info":`realtime-js/${v8}`},w8="1.0.0",dA=1e4,x8=1e3;var Aa;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Aa||(Aa={}));var hn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(hn||(hn={}));var Fn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Fn||(Fn={}));var Yp;(function(n){n.websocket="websocket"})(Yp||(Yp={}));var Qi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Qi||(Qi={}));class S8{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let l=this.HEADER_LENGTH+2;const c=s.decode(e.slice(l,l+i));l=l+i;const h=s.decode(e.slice(l,l+r));l=l+r;const d=JSON.parse(s.decode(e.slice(l,e.byteLength)));return{ref:null,topic:c,event:h,payload:d}}}class gA{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var tt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(tt||(tt={}));const Q1=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((r,l)=>(r[l]=A8(l,n,e,i),r),{})},A8=(n,e,t,s)=>{const i=e.find(c=>c.name===n),r=i==null?void 0:i.type,l=t[n];return r&&!s.includes(r)?pA(r,l):Kp(l)},pA=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return O8(e,t)}switch(n){case tt.bool:return E8(e);case tt.float4:case tt.float8:case tt.int2:case tt.int4:case tt.int8:case tt.numeric:case tt.oid:return R8(e);case tt.json:case tt.jsonb:return C8(e);case tt.timestamp:return M8(e);case tt.abstime:case tt.date:case tt.daterange:case tt.int4range:case tt.int8range:case tt.money:case tt.reltime:case tt.text:case tt.time:case tt.timestamptz:case tt.timetz:case tt.tsrange:case tt.tstzrange:return Kp(e);default:return Kp(e)}},Kp=n=>n,E8=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},R8=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},C8=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},O8=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let r;const l=n.slice(1,t);try{r=JSON.parse("["+l+"]")}catch{r=l?l.split(","):[]}return r.map(c=>pA(e,c))}return n},M8=n=>typeof n=="string"?n.replace(" ","T"):n,_A=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Hg{constructor(e,t,s={},i=dA){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var G1;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(G1||(G1={}));class fl{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:r,onLeave:l,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fl.syncState(this.state,i,r,l),this.pendingDiffs.forEach(h=>{this.state=fl.syncDiff(this.state,h,r,l)}),this.pendingDiffs=[],c()}),this.channel._on(s.diff,{},i=>{const{onJoin:r,onLeave:l,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=fl.syncDiff(this.state,i,r,l),c())}),this.onJoin((i,r,l)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:l})}),this.onLeave((i,r,l)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const r=this.cloneDeep(e),l=this.transformState(t),c={},h={};return this.map(r,(d,g)=>{l[d]||(h[d]=g)}),this.map(l,(d,g)=>{const _=r[d];if(_){const y=g.map(R=>R.presence_ref),b=_.map(R=>R.presence_ref),T=g.filter(R=>b.indexOf(R.presence_ref)<0),S=_.filter(R=>y.indexOf(R.presence_ref)<0);T.length>0&&(c[d]=T),S.length>0&&(h[d]=S)}else c[d]=g}),this.syncDiff(r,{joins:c,leaves:h},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:l}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,(c,h)=>{var d;const g=(d=e[c])!==null&&d!==void 0?d:[];if(e[c]=this.cloneDeep(h),g.length>0){const _=e[c].map(b=>b.presence_ref),y=g.filter(b=>_.indexOf(b.presence_ref)<0);e[c].unshift(...y)}s(c,g,h)}),this.map(l,(c,h)=>{let d=e[c];if(!d)return;const g=h.map(_=>_.presence_ref);d=d.filter(_=>g.indexOf(_.presence_ref)<0),e[c]=d,i(c,d,h),d.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var J1;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(J1||(J1={}));var ew;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(ew||(ew={}));var Ss;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ss||(Ss={}));class J_{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=hn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Hg(this,Fn.join,this.params,this.timeout),this.rejoinTimer=new gA(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=hn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=hn.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=hn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=hn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fn.reply,{},(i,r)=>{this._trigger(this._replyEventName(r),i)}),this.presence=new fl(this),this.broadcastEndpointURL=_A(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:l,private:c}}=this.params;this._onError(g=>e==null?void 0:e(Ss.CHANNEL_ERROR,g)),this._onClose(()=>e==null?void 0:e(Ss.CLOSED));const h={},d={broadcast:r,presence:l,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(g=>g.filter))!==null&&i!==void 0?i:[],private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var _;if(this.socket.setAuth(),g===void 0){e==null||e(Ss.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,b=(_=y==null?void 0:y.length)!==null&&_!==void 0?_:0,T=[];for(let S=0;S<b;S++){const R=y[S],{filter:{event:k,schema:U,table:P,filter:D}}=R,$=g&&g[S];if($&&$.event===k&&$.schema===U&&$.table===P&&$.filter===D)T.push(Object.assign(Object.assign({},R),{id:$.id}));else{this.unsubscribe(),e==null||e(Ss.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=T,e&&e(Ss.SUBSCRIBED);return}}).receive("error",g=>{e==null||e(Ss.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ss.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:l}=e,h={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=d.body)===null||i===void 0?void 0:i.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var l,c,h;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(c=(l=this.params)===null||l===void 0?void 0:l.config)===null||c===void 0?void 0:c.broadcast)===null||h===void 0)&&h.ack)&&r("ok"),d.receive("ok",()=>r("ok")),d.receive("error",()=>r("error")),d.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=hn.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fn.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new Hg(this,Fn.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout(()=>i.abort(),s),l=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),l}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Hg(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const l=e.toLocaleLowerCase(),{close:c,error:h,leave:d,join:g}=Fn;if(s&&[c,h,d,g].indexOf(l)>=0&&s!==this._joinRef())return;let y=this._onMessage(l,t,s);if(t&&!y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(b=>{var T,S,R;return((T=b.filter)===null||T===void 0?void 0:T.event)==="*"||((R=(S=b.filter)===null||S===void 0?void 0:S.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===l}).map(b=>b.callback(y,s)):(r=this.bindings[l])===null||r===void 0||r.filter(b=>{var T,S,R,k,U,P;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in b){const D=b.id,$=(T=b.filter)===null||T===void 0?void 0:T.event;return D&&((S=t.ids)===null||S===void 0?void 0:S.includes(D))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((R=t.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const D=(U=(k=b==null?void 0:b.filter)===null||k===void 0?void 0:k.event)===null||U===void 0?void 0:U.toLocaleLowerCase();return D==="*"||D===((P=t==null?void 0:t.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===l}).map(b=>{if(typeof y=="object"&&"ids"in y){const T=y.data,{schema:S,table:R,commit_timestamp:k,type:U,errors:P}=T;y=Object.assign(Object.assign({},{schema:S,table:R,commit_timestamp:k,eventType:U,new:{},old:{},errors:P}),this._getPayloadRecords(T))}b.callback(y,s)})}_isClosed(){return this.state===hn.closed}_isJoined(){return this.state===hn.joined}_isJoining(){return this.state===hn.joining}_isLeaving(){return this.state===hn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===s&&J_.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Fn.close,{},e)}_onError(e){this._on(Fn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=hn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Q1(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Q1(e.columns,e.old_record)),t}}const P8=()=>{},I8=typeof WebSocket<"u",k8=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class N8{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=T8,this.params={},this.timeout=dA,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=P8,this.conn=null,this.sendBuffer=[],this.serializer=new S8,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=r=>{let l;return r?l=r:typeof fetch>"u"?l=(...c)=>Na(async()=>{const{default:h}=await Promise.resolve().then(()=>Va);return{default:h}},void 0).then(({default:h})=>h(...c)):l=fetch,(...c)=>l(...c)},this.endPoint=`${e}/${Yp.websocket}`,this.httpEndpoint=_A(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(r,l)=>l(JSON.stringify(r)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new gA(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(I8){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new D8(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Na(async()=>{const{default:e}=await import("./browser-CB_bFFJP.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:w8}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Aa.connecting:return Qi.Connecting;case Aa.open:return Qi.Open;case Aa.closing:return Qi.Closing;default:return Qi.Closed}}isConnected(){return this.connectionState()===Qi.Open}channel(e,t={config:{}}){const s=new J_(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:r}=e,l=()=>{this.encode(e,c=>{var h;(h=this.conn)===null||h===void 0||h.send(c)})};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(Fn.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(x8,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:r,ref:l}=t;l&&l===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${s} ${i} ${l&&"("+l+")"||""}`,r),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,r,l)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Fn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([k8],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class D8{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Aa.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class em extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Pt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class B8 extends em{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Zp extends em{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var U8=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};const mA=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Na(async()=>{const{default:s}=await Promise.resolve().then(()=>Va);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},L8=()=>U8(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Na(()=>Promise.resolve().then(()=>Va),void 0)).Response:Response}),Qp=n=>{if(Array.isArray(n))return n.map(t=>Qp(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[i]=Qp(s)}),e};var dr=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};const Wg=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),F8=(n,e,t)=>dr(void 0,void 0,void 0,function*(){const s=yield L8();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{e(new B8(Wg(i),n.status||500))}).catch(i=>{e(new Zp(Wg(i),i))}):e(new Zp(Wg(n),n))}),z8=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function Ml(n,e,t,s,i,r){return dr(this,void 0,void 0,function*(){return new Promise((l,c)=>{n(t,z8(e,s,i,r)).then(h=>{if(!h.ok)throw h;return s!=null&&s.noResolveJson?h:h.json()}).then(h=>l(h)).catch(h=>F8(h,c,s))})})}function ch(n,e,t,s){return dr(this,void 0,void 0,function*(){return Ml(n,"GET",e,t,s)})}function ci(n,e,t,s,i){return dr(this,void 0,void 0,function*(){return Ml(n,"POST",e,s,i,t)})}function V8(n,e,t,s,i){return dr(this,void 0,void 0,function*(){return Ml(n,"PUT",e,s,i,t)})}function j8(n,e,t,s){return dr(this,void 0,void 0,function*(){return Ml(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function yA(n,e,t,s,i){return dr(this,void 0,void 0,function*(){return Ml(n,"DELETE",e,s,i,t)})}var en=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};const $8={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class H8{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=mA(i)}uploadOrUpdate(e,t,s,i){return en(this,void 0,void 0,function*(){try{let r;const l=Object.assign(Object.assign({},tw),i);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(l.upsert)});const h=l.metadata;typeof Blob<"u"&&s instanceof Blob?(r=new FormData,r.append("cacheControl",l.cacheControl),h&&r.append("metadata",this.encodeMetadata(h)),r.append("",s)):typeof FormData<"u"&&s instanceof FormData?(r=s,r.append("cacheControl",l.cacheControl),h&&r.append("metadata",this.encodeMetadata(h))):(r=s,c["cache-control"]=`max-age=${l.cacheControl}`,c["content-type"]=l.contentType,h&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(h)))),i!=null&&i.headers&&(c=Object.assign(Object.assign({},c),i.headers));const d=this._removeEmptyFolders(t),g=this._getFinalPath(d),_=yield this.fetch(`${this.url}/object/${g}`,Object.assign({method:e,body:r,headers:c},l!=null&&l.duplex?{duplex:l.duplex}:{})),y=yield _.json();return _.ok?{data:{path:d,id:y.Id,fullPath:y.Key},error:null}:{data:null,error:y}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}upload(e,t,s){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return en(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),l=this._getFinalPath(r),c=new URL(this.url+`/object/upload/sign/${l}`);c.searchParams.set("token",t);try{let h;const d=Object.assign({upsert:tw.upsert},i),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(h=new FormData,h.append("cacheControl",d.cacheControl),h.append("",s)):typeof FormData<"u"&&s instanceof FormData?(h=s,h.append("cacheControl",d.cacheControl)):(h=s,g["cache-control"]=`max-age=${d.cacheControl}`,g["content-type"]=d.contentType);const _=yield this.fetch(c.toString(),{method:"PUT",body:h,headers:g}),y=yield _.json();return _.ok?{data:{path:r,fullPath:y.Key},error:null}:{data:null,error:y}}catch(h){if(Pt(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e,t){return en(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=yield ci(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),l=new URL(this.url+r.url),c=l.searchParams.get("token");if(!c)throw new em("No token returned by API");return{data:{signedUrl:l.toString(),path:e,token:c},error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}update(e,t,s){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return en(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Pt(i))return{data:null,error:i};throw i}})}copy(e,t,s){return en(this,void 0,void 0,function*(){try{return{data:{path:(yield ci(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Pt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return en(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),r=yield ci(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const l=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${l}`)},{data:r,error:null}}catch(i){if(Pt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return en(this,void 0,void 0,function*(){try{const i=yield ci(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(l=>Object.assign(Object.assign({},l),{signedUrl:l.signedURL?encodeURI(`${this.url}${l.signedURL}${r}`):null})),error:null}}catch(i){if(Pt(i))return{data:null,error:i};throw i}})}download(e,t){return en(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),l=r?`?${r}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield ch(this.fetch,`${this.url}/${i}/${c}${l}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(Pt(c))return{data:null,error:c};throw c}})}info(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield ch(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Qp(s),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}exists(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield j8(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Pt(s)&&s instanceof Zp){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&i.push(r);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",h=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});h!==""&&i.push(h);let d=i.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${s}${d}`)}}}remove(e){return en(this,void 0,void 0,function*(){try{return{data:yield yA(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}list(e,t,s){return en(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},$8),t),{prefix:e||""});return{data:yield ci(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(Pt(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const W8="2.7.1",X8={"X-Client-Info":`storage-js/${W8}`};var la=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};class q8{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},X8),t),this.fetch=mA(s)}listBuckets(){return la(this,void 0,void 0,function*(){try{return{data:yield ch(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Pt(e))return{data:null,error:e};throw e}})}getBucket(e){return la(this,void 0,void 0,function*(){try{return{data:yield ch(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return la(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return la(this,void 0,void 0,function*(){try{return{data:yield V8(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}emptyBucket(e){return la(this,void 0,void 0,function*(){try{return{data:yield ci(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return la(this,void 0,void 0,function*(){try{return{data:yield yA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}}class Y8 extends q8{constructor(e,t={},s){super(e,t,s)}from(e){return new H8(this.url,this.headers,e,this.fetch)}}const K8="2.49.1";let tl="";typeof Deno<"u"?tl="deno":typeof document<"u"?tl="web":typeof navigator<"u"&&navigator.product==="ReactNative"?tl="react-native":tl="node";const Z8={"X-Client-Info":`supabase-js-${tl}/${K8}`},Q8={headers:Z8},G8={schema:"public"},J8={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},e5={};var t5=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};const n5=n=>{let e;return n?e=n:typeof fetch>"u"?e=oA:e=fetch,(...t)=>e(...t)},s5=()=>typeof Headers>"u"?lA:Headers,i5=(n,e,t)=>{const s=n5(t),i=s5();return(r,l)=>t5(void 0,void 0,void 0,function*(){var c;const h=(c=yield e())!==null&&c!==void 0?c:n;let d=new i(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${h}`),s(r,Object.assign(Object.assign({},l),{headers:d}))})};var r5=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};function a5(n){return n.replace(/\/$/,"")}function o5(n,e){const{db:t,auth:s,realtime:i,global:r}=n,{db:l,auth:c,realtime:h,global:d}=e,g={db:Object.assign(Object.assign({},l),t),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},h),i),global:Object.assign(Object.assign({},d),r),accessToken:()=>r5(this,void 0,void 0,function*(){return""})};return n.accessToken?g.accessToken=n.accessToken:delete g.accessToken,g}const bA="2.68.0",fa=30*1e3,Gp=3,Xg=Gp*fa,l5="http://localhost:9999",c5="supabase.auth.token",u5={"X-Client-Info":`gotrue-js/${bA}`},Jp="X-Supabase-Api-Version",vA={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function h5(n){return Math.round(Date.now()/1e3)+n}function f5(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const es=()=>typeof window<"u"&&typeof document<"u",Ki={tested:!1,writable:!1},dl=()=>{if(!es())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ki.tested)return Ki.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ki.tested=!0,Ki.writable=!0}catch{Ki.tested=!0,Ki.writable=!1}return Ki.writable};function d5(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,r)=>{e[r]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const TA=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Na(async()=>{const{default:s}=await Promise.resolve().then(()=>Va);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},g5=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",wA=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},mu=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},yu=async(n,e)=>{await n.removeItem(e)};function p5(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,r,l,c,h,d,g=0;for(n=n.replace("-","+").replace("_","/");g<n.length;)l=e.indexOf(n.charAt(g++)),c=e.indexOf(n.charAt(g++)),h=e.indexOf(n.charAt(g++)),d=e.indexOf(n.charAt(g++)),s=l<<2|c>>4,i=(c&15)<<4|h>>2,r=(h&3)<<6|d,t=t+String.fromCharCode(s),h!=64&&i!=0&&(t=t+String.fromCharCode(i)),d!=64&&r!=0&&(t=t+String.fromCharCode(r));return t}class Fh{constructor(){this.promise=new Fh.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Fh.promiseConstructor=Promise;function nw(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(p5(s))}async function _5(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function m5(n,e){return new Promise((s,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const l=await n(r);if(!e(r,null,l)){s(l);return}}catch(l){if(!e(r,l)){i(l);return}}})()})}function y5(n){return("0"+n.toString(16)).substr(-2)}function b5(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let r=0;r<56;r++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,y5).join("")}async function v5(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}function T5(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function w5(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await v5(n);return T5(t)}async function ca(n,e,t=!1){const s=b5();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await wA(n,`${e}-code-verifier`,i);const r=await w5(s);return[r,s===r?"plain":"s256"]}const x5=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function S5(n){const e=n.headers.get(Jp);if(!e||!e.match(x5))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class tm extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Oe(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class A5 extends tm{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function E5(n){return Oe(n)&&n.name==="AuthApiError"}class xA extends tm{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class gr extends tm{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class ai extends gr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function R5(n){return Oe(n)&&n.name==="AuthSessionMissingError"}class qg extends gr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class bu extends gr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vu extends gr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function C5(n){return Oe(n)&&n.name==="AuthImplicitGrantRedirectError"}class sw extends gr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class e_ extends gr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Yg(n){return Oe(n)&&n.name==="AuthRetryableFetchError"}class iw extends gr{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var O5=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const Zi=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),M5=[502,503,504];async function rw(n){var e;if(!g5(n))throw new e_(Zi(n),0);if(M5.includes(n.status))throw new e_(Zi(n),n.status);let t;try{t=await n.json()}catch(r){throw new xA(Zi(r),r)}let s;const i=S5(n);if(i&&i.getTime()>=vA["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new iw(Zi(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ai}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,l)=>r&&typeof l=="string",!0))throw new iw(Zi(t),n.status,t.weak_password.reasons);throw new A5(Zi(t),n.status||500,s)}const P5=(n,e,t,s)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function Le(n,e,t,s){var i;const r=Object.assign({},s==null?void 0:s.headers);r[Jp]||(r[Jp]=vA["2024-01-01"].name),s!=null&&s.jwt&&(r.Authorization=`Bearer ${s.jwt}`);const l=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(l.redirect_to=s.redirectTo);const c=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",h=await I5(n,e,t+c,{headers:r,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(h):{data:Object.assign({},h),error:null}}async function I5(n,e,t,s,i,r){const l=P5(e,s,i,r);let c;try{c=await n(t,Object.assign({},l))}catch(h){throw console.error(h),new e_(Zi(h),0)}if(c.ok||await rw(c),s!=null&&s.noResolveJson)return c;try{return await c.json()}catch(h){await rw(h)}}function oi(n){var e;let t=null;B5(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=h5(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function aw(n){const e=oi(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function fi(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function k5(n){return{data:n,error:null}}function N5(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r}=n,l=O5(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:r},h=Object.assign({},l);return{data:{properties:c,user:h},error:null}}function D5(n){return n}function B5(n){return n.access_token&&n.refresh_token&&n.expires_in}var U5=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class L5{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=TA(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Le(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Oe(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Le(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:fi})}catch(s){if(Oe(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=U5(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await Le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:N5,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Oe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Le(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:fi})}catch(t){if(Oe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,l,c,h;try{const d={nextPage:null,lastPage:0,total:0},g=await Le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:D5});if(g.error)throw g.error;const _=await g.json(),y=(l=g.headers.get("x-total-count"))!==null&&l!==void 0?l:0,b=(h=(c=g.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&h!==void 0?h:[];return b.length>0&&(b.forEach(T=>{const S=parseInt(T.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(T.split(";")[1].split("=")[1]);d[`${R}Page`]=S}),d.total=parseInt(y)),{data:Object.assign(Object.assign({},_),d),error:null}}catch(d){if(Oe(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){try{return await Le(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:fi})}catch(t){if(Oe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Le(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:fi})}catch(s){if(Oe(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await Le(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:fi})}catch(s){if(Oe(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await Le(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(Oe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Le(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Oe(t))return{data:null,error:t};throw t}}}const F5={getItem:n=>dl()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{dl()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{dl()&&globalThis.localStorage.removeItem(n)}};function ow(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function z5(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ua={debug:!!(globalThis&&dl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class SA extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class V5 extends SA{}async function j5(n,e,t){ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ua.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new V5(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ua.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}z5();const $5={url:l5,storageKey:c5,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:u5,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lw(n,e,t){return await t()}class Sl{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Sl.nextInstanceID,Sl.nextInstanceID+=1,this.instanceID>0&&es()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},$5),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new L5({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=TA(i.fetch),this.lock=i.lock||lw,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:es()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=j5:this.lock=lw,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:dl()?this.storage=F5:(this.memoryStorage={},this.storage=ow(this.memoryStorage)):(this.memoryStorage={},this.storage=ow(this.memoryStorage)),es()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${bA}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=d5(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),es()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),C5(r)){const h=(e=r.details)===null||e===void 0?void 0:e.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:l,redirectType:c}=i;return this._debug("#_initialize()","detected session in URL",l,"redirect type",c),await this._saveSession(l),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Oe(t)?{error:t}:{error:new xA("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:oi}),{data:l,error:c}=r;if(c||!l)return{data:{user:null,session:null},error:c};const h=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:d,session:h},error:null}}catch(r){if(Oe(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:g,password:_,options:y}=e;let b=null,T=null;this.flowType==="pkce"&&([b,T]=await ca(this.storage,this.storageKey)),r=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:y==null?void 0:y.emailRedirectTo,body:{email:g,password:_,data:(t=y==null?void 0:y.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},code_challenge:b,code_challenge_method:T},xform:oi})}else if("phone"in e){const{phone:g,password:_,options:y}=e;r=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:_,data:(s=y==null?void 0:y.data)!==null&&s!==void 0?s:{},channel:(i=y==null?void 0:y.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken}},xform:oi})}else throw new bu("You must provide either an email or phone number and a password");const{data:l,error:c}=r;if(c||!l)return{data:{user:null,session:null},error:c};const h=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:d,session:h},error:null}}catch(r){if(Oe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:l,options:c}=e;t=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:l,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:aw})}else if("phone"in e){const{phone:r,password:l,options:c}=e;t=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:l,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:aw})}else throw new bu("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new qg}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(Oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await mu(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:r,error:l}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:oi});if(await yu(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new qg}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:l})}catch(r){if(Oe(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:l}=e,c=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:l,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:oi}),{data:h,error:d}=c;return d?{data:{user:null,session:null},error:d}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new qg}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:h,error:d})}catch(t){if(Oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,l;try{if("email"in e){const{email:c,options:h}=e;let d=null,g=null;this.flowType==="pkce"&&([d,g]=await ca(this.storage,this.storageKey));const{error:_}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},create_user:(s=h==null?void 0:h.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:d,code_challenge_method:g},redirectTo:h==null?void 0:h.emailRedirectTo});return{data:{user:null,session:null},error:_}}if("phone"in e){const{phone:c,options:h}=e,{data:d,error:g}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(i=h==null?void 0:h.data)!==null&&i!==void 0?i:{},create_user:(r=h==null?void 0:h.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(l=h==null?void 0:h.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:g}}throw new bu("You must provide either an email or phone number.")}catch(c){if(Oe(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:l,error:c}=await Le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:oi});if(c)throw c;if(!l)throw new Error("An error occurred on token verification.");const h=l.session,d=l.user;return h!=null&&h.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),{data:{user:d,session:h},error:null}}catch(i){if(Oe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,l=null;return this.flowType==="pkce"&&([r,l]=await ca(this.storage,this.storageKey)),await Le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:l}),headers:this.headers,xform:k5})}catch(r){if(Oe(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ai;const{error:i}=await Le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Oe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:l}=await Le(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in e){const{phone:s,type:i,options:r}=e,{data:l,error:c}=await Le(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:c}}throw new bu("You must provide either an email or phone number and a type")}catch(t){if(Oe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await mu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Xg:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let l=this.suppressGetSessionWarning;e=new Proxy(e,{get:(h,d,g)=>(!l&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(h,d,g))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:fi}):await this._useSession(async t=>{var s,i,r;const{data:l,error:c}=t;if(c)throw c;return!(!((s=l.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ai}:await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=l.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:fi})})}catch(t){if(Oe(t))return R5(t)&&(await this._removeSession(),await yu(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new ai;const l=i.session;let c=null,h=null;this.flowType==="pkce"&&e.email!=null&&([c,h]=await ca(this.storage,this.storageKey));const{data:d,error:g}=await Le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:h}),jwt:l.access_token,xform:fi});if(g)throw g;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}})}catch(s){if(Oe(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return nw(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ai;const t=Date.now()/1e3;let s=t,i=!0,r=null;const l=nw(e.access_token);if(l.exp&&(s=l.exp,i=s<=t),i){const{session:c,error:h}=await this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!c)return{data:{user:null,session:null},error:null};r=c}else{const{data:c,error:h}=await this._getUser(e.access_token);if(h)throw h;r={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Oe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:l,error:c}=t;if(c)throw c;e=(s=l.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new ai;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Oe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!es())throw new vu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new sw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vu("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new sw("No code detected.");const{data:U,error:P}=await this._exchangeCodeForSession(e.code);if(P)throw P;const D=new URL(window.location.href);return D.searchParams.delete("code"),window.history.replaceState(window.history.state,"",D.toString()),{data:{session:U.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:l,expires_in:c,expires_at:h,token_type:d}=e;if(!r||!c||!l||!d)throw new vu("No session defined in URL");const g=Math.round(Date.now()/1e3),_=parseInt(c);let y=g+_;h&&(y=parseInt(h));const b=y-g;b*1e3<=fa&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${_}s`);const T=y-_;g-T>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",T,y,g):g-T<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",T,y,g);const{data:S,error:R}=await this._getUser(r);if(R)throw R;const k={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:_,expires_at:y,refresh_token:l,token_type:d,user:S.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:k,redirectType:e.type},error:null}}catch(s){if(Oe(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mu(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const l=(s=i.session)===null||s===void 0?void 0:s.access_token;if(l){const{error:c}=await this.admin.signOut(l,e);if(c&&!(E5(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await yu(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=f5(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:r},error:l}=t;if(l)throw l;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await ca(this.storage,this.storageKey,!0));try{return await Le(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Oe(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Oe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async r=>{var l,c,h,d,g;const{data:_,error:y}=r;if(y)throw y;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(l=e.options)===null||l===void 0?void 0:l.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(h=e.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Le(this.fetch,"GET",b,{headers:this.headers,jwt:(g=(d=_.session)===null||d===void 0?void 0:d.access_token)!==null&&g!==void 0?g:void 0})});if(i)throw i;return es()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(Oe(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:l}=t;if(l)throw l;return await Le(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(Oe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await m5(async i=>(i>0&&await _5(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await Le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:oi})),(i,r)=>{const l=200*Math.pow(2,i);return r&&Yg(r)&&Date.now()+l-s<fa})}catch(s){if(this._debug(t,"error",s),Oe(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),es()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await mu(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Xg;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Xg}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:r}=await this._callRefreshToken(s.refresh_token);r&&(console.error(r),Yg(r)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ai;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Fh;const{data:r,error:l}=await this._refreshAccessToken(e);if(l)throw l;if(!r.session)throw new ai;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const c={session:r.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(r){if(this._debug(i,"error",r),Oe(r)){const l={session:null,error:r};return Yg(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(l),l}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],l=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(h){r.push(h)}});if(await Promise.all(l),r.length>0){for(let c=0;c<r.length;c+=1)console.error(r[c]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await wA(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await yu(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&es()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),fa);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/fa);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${fa}ms, refresh threshold is ${Gp} ticks`),i<=Gp&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof SA)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!es()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[r,l]=await ca(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(l)}`});i.push(c.toString())}if(s!=null&&s.queryParams){const r=new URLSearchParams(s.queryParams);i.push(r.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Le(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Oe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:r,error:l}=t;if(l)return{data:null,error:l};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:h,error:d}=await Le(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((i=h==null?void 0:h.totp)===null||i===void 0)&&i.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),{data:h,error:null})})}catch(t){if(Oe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:l,error:c}=await Le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(t){if(Oe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Oe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(l=>l.factor_type==="totp"&&l.status==="verified"),r=s.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const l=this._decodeJWT(i.access_token);let c=null;l.aal&&(c=l.aal);let h=c;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(_=>_.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(h="aal2");const g=l.amr||[];return{data:{currentLevel:c,nextLevel:h,currentAuthenticationMethods:g},error:null}}))}}Sl.nextInstanceID=0;const H5=Sl;class W5 extends H5{constructor(e){super(e)}}var X5=function(n,e,t,s){function i(r){return r instanceof t?r:new t(function(l){l(r)})}return new(t||(t=Promise))(function(r,l){function c(g){try{d(s.next(g))}catch(_){l(_)}}function h(g){try{d(s.throw(g))}catch(_){l(_)}}function d(g){g.done?r(g.value):i(g.value).then(c,h)}d((s=s.apply(n,e||[])).next())})};class q5{constructor(e,t,s){var i,r,l;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=a5(e);this.realtimeUrl=`${c}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${c}/auth/v1`,this.storageUrl=`${c}/storage/v1`,this.functionsUrl=`${c}/functions/v1`;const h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,d={db:G8,realtime:e5,auth:Object.assign(Object.assign({},J8),{storageKey:h}),global:Q8},g=o5(s??{},d);this.storageKey=(i=g.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(r=g.global.headers)!==null&&r!==void 0?r:{},g.accessToken?(this.accessToken=g.accessToken,this.auth=new Proxy({},{get:(_,y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((l=g.auth)!==null&&l!==void 0?l:{},this.headers,g.global.fetch),this.fetch=i5(t,this._getAccessToken.bind(this),g.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},g.realtime)),this.rest=new b8(`${c}/rest/v1`,{headers:this.headers,schema:g.db.schema,fetch:this.fetch}),g.accessToken||this._listenForAuthEvents()}get functions(){return new o8(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Y8(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return X5(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:l,lock:c,debug:h},d,g){const _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new W5({url:this.authUrl,headers:Object.assign(Object.assign({},_),d),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:l,lock:c,debug:h,fetch:g,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new N8(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Y5=(n,e,t)=>new q5(n,e,t),K5="https://gnslobtligrwjszpgzww.supabase.co",Z5="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imduc2xvYnRsaWdyd2pzenBnend3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1MDc0MDcsImV4cCI6MjA1ODA4MzQwN30.Y02AGcFKV9ElvmdnkY_SqR6xYTnp3Y10HLylxbBL3Sk",Q5=Y5(K5,Z5),G5={latitude:44.9346984280946,longitude:-93.26225984401101,zoom:18,maxZoom:20,maxPitch:89,bearing:0},J5={position:"absolute",right:0,bottom:0,backgroundColor:"hsla(0,0%,100%,.5)",padding:"0 5px",font:"12px/20px Helvetica Neue,Arial,Helvetica,sans-serif"},ez={textDecoration:"none",color:"rgba(0,0,0,.75)",cursor:"grab"},tz=typeof Yb<"u"&&Yb.devicePixelRatio||1;function nz(n){return n.object?{html:`            <div><b>${n.object.properties.name}</b></div>
            `}:null}const sz=async()=>{const{data:n}=await Q5.rpc("get_all");return{type:"FeatureCollection",features:(n==null?void 0:n.map(e=>({geometry:{type:"Point",coordinates:[e.lng,e.lat]},type:"Feature",properties:{name:e.name}})))??[]}};function iz({showBorder:n=!1,onTilesLoad:e}){const t=new Uh({id:"solar",data:sz(),pointType:"circle",filled:!0,getFillColor:[0,255,0],getPointRadius:4,pointRadiusMinPixels:10,pickable:!0}),s=new Z_({data:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],maxRequests:20,pickable:!1,onViewportLoad:e,autoHighlight:n,highlightColor:[60,60,60,40],minZoom:0,maxZoom:19,tileSize:256,zoomOffset:tz===1?-1:0,renderSubLayers:i=>{const[[r,l],[c,h]]=i.tile.boundingBox,{data:d,...g}=i;return[new L_(g,{image:d,bounds:[r,l,c,h]}),n&&new Bh({id:`${i.id}-border`,data:[[[r,h],[r,l],[c,l],[c,h],[r,h]]],getPath:_=>_,getColor:[255,0,0],widthMinPixels:4})]}});return nl.jsx(bU,{layers:[s,t],views:new M_({repeat:!0}),initialViewState:G5,controller:!0,getTooltip:nz,children:nl.jsxs("div",{style:J5,children:[" ",nl.jsx("a",{style:ez,href:"https://www.openstreetmap.org/copyright",target:"blank",children:"OpenStreetMap contributors"})]})})}rE.createRoot(document.getElementById("root")).render(nl.jsx(rt.StrictMode,{children:nl.jsx(iz,{})}));export{uw as g};
