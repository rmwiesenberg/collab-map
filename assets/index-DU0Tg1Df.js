var qA=Object.defineProperty;var KA=(n,e,t)=>e in n?qA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var T=(n,e,t)=>KA(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function ZA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var id={exports:{}},ao={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R0;function QA(){if(R0)return ao;R0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var l=null;if(a!==void 0&&(l=""+a),s.key!==void 0&&(l=""+s.key),"key"in s){a={};for(var c in s)c!=="key"&&(a[c]=s[c])}else a=s;return s=a.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:a}}return ao.Fragment=e,ao.jsx=t,ao.jsxs=t,ao}var C0;function GA(){return C0||(C0=1,id.exports=QA()),id.exports}var To=GA(),sd={exports:{}},Ce={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0;function JA(){if(M0)return Ce;M0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function y(S){return S===null||typeof S!="object"?null:(S=_&&S[_]||S["@@iterator"],typeof S=="function"?S:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,E={};function M(S,B,K){this.props=S,this.context=B,this.refs=E,this.updater=K||b}M.prototype.isReactComponent={},M.prototype.setState=function(S,B){if(typeof S!="object"&&typeof S!="function"&&S!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,S,B,"setState")},M.prototype.forceUpdate=function(S){this.updater.enqueueForceUpdate(this,S,"forceUpdate")};function N(){}N.prototype=M.prototype;function V(S,B,K){this.props=S,this.context=B,this.refs=E,this.updater=K||b}var P=V.prototype=new N;P.constructor=V,x(P,M.prototype),P.isPureReactComponent=!0;var H=Array.isArray,X={H:null,A:null,T:null,S:null},Z=Object.prototype.hasOwnProperty;function he(S,B,K,ee,ie,le){return K=le.ref,{$$typeof:n,type:S,key:B,ref:K!==void 0?K:null,props:le}}function ue(S,B){return he(S.type,B,void 0,void 0,void 0,S.props)}function J(S){return typeof S=="object"&&S!==null&&S.$$typeof===n}function oe(S){var B={"=":"=0",":":"=2"};return"$"+S.replace(/[=:]/g,function(K){return B[K]})}var de=/\/+/g;function ve(S,B){return typeof S=="object"&&S!==null&&S.key!=null?oe(""+S.key):B.toString(36)}function be(){}function Se(S){switch(S.status){case"fulfilled":return S.value;case"rejected":throw S.reason;default:switch(typeof S.status=="string"?S.then(be,be):(S.status="pending",S.then(function(B){S.status==="pending"&&(S.status="fulfilled",S.value=B)},function(B){S.status==="pending"&&(S.status="rejected",S.reason=B)})),S.status){case"fulfilled":return S.value;case"rejected":throw S.reason}}throw S}function We(S,B,K,ee,ie){var le=typeof S;(le==="undefined"||le==="boolean")&&(S=null);var pe=!1;if(S===null)pe=!0;else switch(le){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(S.$$typeof){case n:case e:pe=!0;break;case g:return pe=S._init,We(pe(S._payload),B,K,ee,ie)}}if(pe)return ie=ie(S),pe=ee===""?"."+ve(S,0):ee,H(ie)?(K="",pe!=null&&(K=pe.replace(de,"$&/")+"/"),We(ie,B,K,"",function(Ie){return Ie})):ie!=null&&(J(ie)&&(ie=ue(ie,K+(ie.key==null||S&&S.key===ie.key?"":(""+ie.key).replace(de,"$&/")+"/")+pe)),B.push(ie)),1;pe=0;var Re=ee===""?".":ee+":";if(H(S))for(var _e=0;_e<S.length;_e++)ee=S[_e],le=Re+ve(ee,_e),pe+=We(ee,B,K,le,ie);else if(_e=y(S),typeof _e=="function")for(S=_e.call(S),_e=0;!(ee=S.next()).done;)ee=ee.value,le=Re+ve(ee,_e++),pe+=We(ee,B,K,le,ie);else if(le==="object"){if(typeof S.then=="function")return We(Se(S),B,K,ee,ie);throw B=String(S),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return pe}function R(S,B,K){if(S==null)return S;var ee=[],ie=0;return We(S,ee,"","",function(le){return B.call(K,le,ie++)}),ee}function D(S){if(S._status===-1){var B=S._result;B=B(),B.then(function(K){(S._status===0||S._status===-1)&&(S._status=1,S._result=K)},function(K){(S._status===0||S._status===-1)&&(S._status=2,S._result=K)}),S._status===-1&&(S._status=0,S._result=B)}if(S._status===1)return S._result.default;throw S._result}var I=typeof reportError=="function"?reportError:function(S){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof S=="object"&&S!==null&&typeof S.message=="string"?String(S.message):String(S),error:S});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",S);return}console.error(S)};function Q(){}return Ce.Children={map:R,forEach:function(S,B,K){R(S,function(){B.apply(this,arguments)},K)},count:function(S){var B=0;return R(S,function(){B++}),B},toArray:function(S){return R(S,function(B){return B})||[]},only:function(S){if(!J(S))throw Error("React.Children.only expected to receive a single React element child.");return S}},Ce.Component=M,Ce.Fragment=t,Ce.Profiler=s,Ce.PureComponent=V,Ce.StrictMode=i,Ce.Suspense=f,Ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Ce.act=function(){throw Error("act(...) is not supported in production builds of React.")},Ce.cache=function(S){return function(){return S.apply(null,arguments)}},Ce.cloneElement=function(S,B,K){if(S==null)throw Error("The argument must be a React element, but you passed "+S+".");var ee=x({},S.props),ie=S.key,le=void 0;if(B!=null)for(pe in B.ref!==void 0&&(le=void 0),B.key!==void 0&&(ie=""+B.key),B)!Z.call(B,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&B.ref===void 0||(ee[pe]=B[pe]);var pe=arguments.length-2;if(pe===1)ee.children=K;else if(1<pe){for(var Re=Array(pe),_e=0;_e<pe;_e++)Re[_e]=arguments[_e+2];ee.children=Re}return he(S.type,ie,void 0,void 0,le,ee)},Ce.createContext=function(S){return S={$$typeof:l,_currentValue:S,_currentValue2:S,_threadCount:0,Provider:null,Consumer:null},S.Provider=S,S.Consumer={$$typeof:a,_context:S},S},Ce.createElement=function(S,B,K){var ee,ie={},le=null;if(B!=null)for(ee in B.key!==void 0&&(le=""+B.key),B)Z.call(B,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(ie[ee]=B[ee]);var pe=arguments.length-2;if(pe===1)ie.children=K;else if(1<pe){for(var Re=Array(pe),_e=0;_e<pe;_e++)Re[_e]=arguments[_e+2];ie.children=Re}if(S&&S.defaultProps)for(ee in pe=S.defaultProps,pe)ie[ee]===void 0&&(ie[ee]=pe[ee]);return he(S,le,void 0,void 0,null,ie)},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(S){return{$$typeof:c,render:S}},Ce.isValidElement=J,Ce.lazy=function(S){return{$$typeof:g,_payload:{_status:-1,_result:S},_init:D}},Ce.memo=function(S,B){return{$$typeof:d,type:S,compare:B===void 0?null:B}},Ce.startTransition=function(S){var B=X.T,K={};X.T=K;try{var ee=S(),ie=X.S;ie!==null&&ie(K,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(Q,I)}catch(le){I(le)}finally{X.T=B}},Ce.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Ce.use=function(S){return X.H.use(S)},Ce.useActionState=function(S,B,K){return X.H.useActionState(S,B,K)},Ce.useCallback=function(S,B){return X.H.useCallback(S,B)},Ce.useContext=function(S){return X.H.useContext(S)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(S,B){return X.H.useDeferredValue(S,B)},Ce.useEffect=function(S,B){return X.H.useEffect(S,B)},Ce.useId=function(){return X.H.useId()},Ce.useImperativeHandle=function(S,B,K){return X.H.useImperativeHandle(S,B,K)},Ce.useInsertionEffect=function(S,B){return X.H.useInsertionEffect(S,B)},Ce.useLayoutEffect=function(S,B){return X.H.useLayoutEffect(S,B)},Ce.useMemo=function(S,B){return X.H.useMemo(S,B)},Ce.useOptimistic=function(S,B){return X.H.useOptimistic(S,B)},Ce.useReducer=function(S,B,K){return X.H.useReducer(S,B,K)},Ce.useRef=function(S){return X.H.useRef(S)},Ce.useState=function(S){return X.H.useState(S)},Ce.useSyncExternalStore=function(S,B,K){return X.H.useSyncExternalStore(S,B,K)},Ce.useTransition=function(){return X.H.useTransition()},Ce.version="19.0.0",Ce}var O0;function qg(){return O0||(O0=1,sd.exports=JA()),sd.exports}var it=qg(),rd={exports:{}},oo={},ad={exports:{}},od={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I0;function eS(){return I0||(I0=1,function(n){function e(R,D){var I=R.length;R.push(D);e:for(;0<I;){var Q=I-1>>>1,S=R[Q];if(0<s(S,D))R[Q]=D,R[I]=S,I=Q;else break e}}function t(R){return R.length===0?null:R[0]}function i(R){if(R.length===0)return null;var D=R[0],I=R.pop();if(I!==D){R[0]=I;e:for(var Q=0,S=R.length,B=S>>>1;Q<B;){var K=2*(Q+1)-1,ee=R[K],ie=K+1,le=R[ie];if(0>s(ee,I))ie<S&&0>s(le,ee)?(R[Q]=le,R[ie]=I,Q=ie):(R[Q]=ee,R[K]=I,Q=K);else if(ie<S&&0>s(le,I))R[Q]=le,R[ie]=I,Q=ie;else break e}}return D}function s(R,D){var I=R.sortIndex-D.sortIndex;return I!==0?I:R.id-D.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var f=[],d=[],g=1,_=null,y=3,b=!1,x=!1,E=!1,M=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;function P(R){for(var D=t(d);D!==null;){if(D.callback===null)i(d);else if(D.startTime<=R)i(d),D.sortIndex=D.expirationTime,e(f,D);else break;D=t(d)}}function H(R){if(E=!1,P(R),!x)if(t(f)!==null)x=!0,Se();else{var D=t(d);D!==null&&We(H,D.startTime-R)}}var X=!1,Z=-1,he=5,ue=-1;function J(){return!(n.unstable_now()-ue<he)}function oe(){if(X){var R=n.unstable_now();ue=R;var D=!0;try{e:{x=!1,E&&(E=!1,N(Z),Z=-1),b=!0;var I=y;try{t:{for(P(R),_=t(f);_!==null&&!(_.expirationTime>R&&J());){var Q=_.callback;if(typeof Q=="function"){_.callback=null,y=_.priorityLevel;var S=Q(_.expirationTime<=R);if(R=n.unstable_now(),typeof S=="function"){_.callback=S,P(R),D=!0;break t}_===t(f)&&i(f),P(R)}else i(f);_=t(f)}if(_!==null)D=!0;else{var B=t(d);B!==null&&We(H,B.startTime-R),D=!1}}break e}finally{_=null,y=I,b=!1}D=void 0}}finally{D?de():X=!1}}}var de;if(typeof V=="function")de=function(){V(oe)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,be=ve.port2;ve.port1.onmessage=oe,de=function(){be.postMessage(null)}}else de=function(){M(oe,0)};function Se(){X||(X=!0,de())}function We(R,D){Z=M(function(){R(n.unstable_now())},D)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(R){R.callback=null},n.unstable_continueExecution=function(){x||b||(x=!0,Se())},n.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):he=0<R?Math.floor(1e3/R):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_getFirstCallbackNode=function(){return t(f)},n.unstable_next=function(R){switch(y){case 1:case 2:case 3:var D=3;break;default:D=y}var I=y;y=D;try{return R()}finally{y=I}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(R,D){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var I=y;y=R;try{return D()}finally{y=I}},n.unstable_scheduleCallback=function(R,D,I){var Q=n.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?Q+I:Q):I=Q,R){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=I+S,R={id:g++,callback:D,priorityLevel:R,startTime:I,expirationTime:S,sortIndex:-1},I>Q?(R.sortIndex=I,e(d,R),t(f)===null&&R===t(d)&&(E?(N(Z),Z=-1):E=!0,We(H,I-Q))):(R.sortIndex=S,e(f,R),x||b||(x=!0,Se())),R},n.unstable_shouldYield=J,n.unstable_wrapCallback=function(R){var D=y;return function(){var I=y;y=D;try{return R.apply(this,arguments)}finally{y=I}}}}(od)),od}var P0;function tS(){return P0||(P0=1,ad.exports=eS()),ad.exports}var ld={exports:{}},Bt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0;function nS(){if(N0)return Bt;N0=1;var n=qg();function e(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(f,d,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:f,containerInfo:d,implementation:g}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Bt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Bt.createPortal=function(f,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(f,d,null,g)},Bt.flushSync=function(f){var d=l.T,g=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=d,i.p=g,i.d.f()}},Bt.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(f,d))},Bt.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Bt.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var g=d.as,_=c(g,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,b=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?i.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):g==="script"&&i.d.X(f,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Bt.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=c(d.as,d.crossOrigin);i.d.M(f,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(f)},Bt.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,_=c(g,d.crossOrigin);i.d.L(f,g,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Bt.preloadModule=function(f,d){if(typeof f=="string")if(d){var g=c(d.as,d.crossOrigin);i.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(f)},Bt.requestFormReset=function(f){i.d.r(f)},Bt.unstable_batchedUpdates=function(f,d){return f(d)},Bt.useFormState=function(f,d,g){return l.H.useFormState(f,d,g)},Bt.useFormStatus=function(){return l.H.useHostTransitionStatus()},Bt.version="19.0.0",Bt}var D0;function iS(){if(D0)return ld.exports;D0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ld.exports=nS(),ld.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k0;function sS(){if(k0)return oo;k0=1;var n=tS(),e=qg(),t=iS();function i(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}var a=Symbol.for("react.element"),l=Symbol.for("react.transitional.element"),c=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),y=Symbol.for("react.consumer"),b=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),H=Symbol.for("react.memo_cache_sentinel"),X=Symbol.iterator;function Z(r){return r===null||typeof r!="object"?null:(r=X&&r[X]||r["@@iterator"],typeof r=="function"?r:null)}var he=Symbol.for("react.client.reference");function ue(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===he?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case f:return"Fragment";case c:return"Portal";case g:return"Profiler";case d:return"StrictMode";case E:return"Suspense";case M:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case b:return(r.displayName||"Context")+".Provider";case y:return(r._context.displayName||"Context")+".Consumer";case x:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case N:return o=r.displayName||null,o!==null?o:ue(r.type)||"Memo";case V:o=r._payload,r=r._init;try{return ue(r(o))}catch{}}return null}var J=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=Object.assign,de,ve;function be(r){if(de===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);de=o&&o[1]||"",ve=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+de+r+ve}var Se=!1;function We(r,o){if(!r||Se)return"";Se=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(G){var q=G}Reflect.construct(r,[],re)}else{try{re.call()}catch(G){q=G}r.call(re.prototype)}}else{try{throw Error()}catch(G){q=G}(re=r())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(G){if(G&&q&&typeof G.stack=="string")return[G.stack,q.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=h.DetermineComponentFrameRoot(),v=m[0],A=m[1];if(v&&A){var O=v.split(`
`),F=A.split(`
`);for(p=h=0;h<O.length&&!O[h].includes("DetermineComponentFrameRoot");)h++;for(;p<F.length&&!F[p].includes("DetermineComponentFrameRoot");)p++;if(h===O.length||p===F.length)for(h=O.length-1,p=F.length-1;1<=h&&0<=p&&O[h]!==F[p];)p--;for(;1<=h&&0<=p;h--,p--)if(O[h]!==F[p]){if(h!==1||p!==1)do if(h--,p--,0>p||O[h]!==F[p]){var te=`
`+O[h].replace(" at new "," at ");return r.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",r.displayName)),te}while(1<=h&&0<=p);break}}}finally{Se=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?be(u):""}function R(r){switch(r.tag){case 26:case 27:case 5:return be(r.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 15:return r=We(r.type,!1),r;case 11:return r=We(r.type.render,!1),r;case 1:return r=We(r.type,!0),r;default:return""}}function D(r){try{var o="";do o+=R(r),r=r.return;while(r);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function I(r){var o=r,u=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(u=o.return),r=o.return;while(r)}return o.tag===3?u:null}function Q(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function S(r){if(I(r)!==r)throw Error(i(188))}function B(r){var o=r.alternate;if(!o){if(o=I(r),o===null)throw Error(i(188));return o!==r?null:r}for(var u=r,h=o;;){var p=u.return;if(p===null)break;var m=p.alternate;if(m===null){if(h=p.return,h!==null){u=h;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===u)return S(p),r;if(m===h)return S(p),o;m=m.sibling}throw Error(i(188))}if(u.return!==h.return)u=p,h=m;else{for(var v=!1,A=p.child;A;){if(A===u){v=!0,u=p,h=m;break}if(A===h){v=!0,h=p,u=m;break}A=A.sibling}if(!v){for(A=m.child;A;){if(A===u){v=!0,u=m,h=p;break}if(A===h){v=!0,h=m,u=p;break}A=A.sibling}if(!v)throw Error(i(189))}}if(u.alternate!==h)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?r:o}function K(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=K(r),o!==null)return o;r=r.sibling}return null}var ee=Array.isArray,ie=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},pe=[],Re=-1;function _e(r){return{current:r}}function Ie(r){0>Re||(r.current=pe[Re],pe[Re]=null,Re--)}function Te(r,o){Re++,pe[Re]=r.current,r.current=o}var Nt=_e(null),An=_e(null),Sn=_e(null),cs=_e(null);function ke(r,o){switch(Te(Sn,o),Te(An,r),Te(Nt,null),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)&&(o=o.namespaceURI)?n0(o):0;break;default:if(r=r===8?o.parentNode:o,o=r.tagName,r=r.namespaceURI)r=n0(r),o=i0(r,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}Ie(Nt),Te(Nt,o)}function Pe(){Ie(Nt),Ie(An),Ie(Sn)}function Yu(r){r.memoizedState!==null&&Te(cs,r);var o=Nt.current,u=i0(o,r.type);o!==u&&(Te(An,r),Te(Nt,u))}function Xo(r){An.current===r&&(Ie(Nt),Ie(An)),cs.current===r&&(Ie(cs),to._currentValue=le)}var qu=Object.prototype.hasOwnProperty,Ku=n.unstable_scheduleCallback,Zu=n.unstable_cancelCallback,E2=n.unstable_shouldYield,R2=n.unstable_requestPaint,Un=n.unstable_now,C2=n.unstable_getCurrentPriorityLevel,$p=n.unstable_ImmediatePriority,Xp=n.unstable_UserBlockingPriority,Yo=n.unstable_NormalPriority,M2=n.unstable_LowPriority,Yp=n.unstable_IdlePriority,O2=n.log,I2=n.unstable_setDisableYieldValue,ua=null,Zt=null;function P2(r){if(Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(ua,r,void 0,(r.current.flags&128)===128)}catch{}}function xi(r){if(typeof O2=="function"&&I2(r),Zt&&typeof Zt.setStrictMode=="function")try{Zt.setStrictMode(ua,r)}catch{}}var Qt=Math.clz32?Math.clz32:k2,N2=Math.log,D2=Math.LN2;function k2(r){return r>>>=0,r===0?32:31-(N2(r)/D2|0)|0}var qo=128,Ko=4194304;function us(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Zo(r,o){var u=r.pendingLanes;if(u===0)return 0;var h=0,p=r.suspendedLanes,m=r.pingedLanes,v=r.warmLanes;r=r.finishedLanes!==0;var A=u&134217727;return A!==0?(u=A&~p,u!==0?h=us(u):(m&=A,m!==0?h=us(m):r||(v=A&~v,v!==0&&(h=us(v))))):(A=u&~p,A!==0?h=us(A):m!==0?h=us(m):r||(v=u&~v,v!==0&&(h=us(v)))),h===0?0:o!==0&&o!==h&&(o&p)===0&&(p=h&-h,v=o&-o,p>=v||p===32&&(v&4194176)!==0)?o:h}function fa(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function B2(r,o){switch(r){case 1:case 2:case 4:case 8:return o+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qp(){var r=qo;return qo<<=1,(qo&4194176)===0&&(qo=128),r}function Kp(){var r=Ko;return Ko<<=1,(Ko&62914560)===0&&(Ko=4194304),r}function Qu(r){for(var o=[],u=0;31>u;u++)o.push(r);return o}function ha(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function U2(r,o,u,h,p,m){var v=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var A=r.entanglements,O=r.expirationTimes,F=r.hiddenUpdates;for(u=v&~u;0<u;){var te=31-Qt(u),re=1<<te;A[te]=0,O[te]=-1;var q=F[te];if(q!==null)for(F[te]=null,te=0;te<q.length;te++){var G=q[te];G!==null&&(G.lane&=-536870913)}u&=~re}h!==0&&Zp(r,h,0),m!==0&&p===0&&r.tag!==0&&(r.suspendedLanes|=m&~(v&~o))}function Zp(r,o,u){r.pendingLanes|=o,r.suspendedLanes&=~o;var h=31-Qt(o);r.entangledLanes|=o,r.entanglements[h]=r.entanglements[h]|1073741824|u&4194218}function Qp(r,o){var u=r.entangledLanes|=o;for(r=r.entanglements;u;){var h=31-Qt(u),p=1<<h;p&o|r[h]&o&&(r[h]|=o),u&=~p}}function Gp(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Jp(){var r=ie.p;return r!==0?r:(r=window.event,r===void 0?32:T0(r.type))}function L2(r,o){var u=ie.p;try{return ie.p=r,o()}finally{ie.p=u}}var Ai=Math.random().toString(36).slice(2),Dt="__reactFiber$"+Ai,Xt="__reactProps$"+Ai,Zs="__reactContainer$"+Ai,Gu="__reactEvents$"+Ai,F2="__reactListeners$"+Ai,z2="__reactHandles$"+Ai,e_="__reactResources$"+Ai,da="__reactMarker$"+Ai;function Ju(r){delete r[Dt],delete r[Xt],delete r[Gu],delete r[F2],delete r[z2]}function fs(r){var o=r[Dt];if(o)return o;for(var u=r.parentNode;u;){if(o=u[Zs]||u[Dt]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(r=a0(r);r!==null;){if(u=r[Dt])return u;r=a0(r)}return o}r=u,u=r.parentNode}return null}function Qs(r){if(r=r[Dt]||r[Zs]){var o=r.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return r}return null}function ga(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(i(33))}function Gs(r){var o=r[e_];return o||(o=r[e_]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Tt(r){r[da]=!0}var t_=new Set,n_={};function hs(r,o){Js(r,o),Js(r+"Capture",o)}function Js(r,o){for(n_[r]=o,r=0;r<o.length;r++)t_.add(o[r])}var Qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),V2=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),i_={},s_={};function H2(r){return qu.call(s_,r)?!0:qu.call(i_,r)?!1:V2.test(r)?s_[r]=!0:(i_[r]=!0,!1)}function Qo(r,o,u){if(H2(o))if(u===null)r.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+u)}}function Go(r,o,u){if(u===null)r.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+u)}}function Gn(r,o,u,h){if(h===null)r.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(o,u,""+h)}}function an(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function r_(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function W2(r){var o=r_(r)?"checked":"value",u=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),h=""+r[o];if(!r.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,m=u.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return p.call(this)},set:function(v){h=""+v,m.call(this,v)}}),Object.defineProperty(r,o,{enumerable:u.enumerable}),{getValue:function(){return h},setValue:function(v){h=""+v},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Jo(r){r._valueTracker||(r._valueTracker=W2(r))}function a_(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var u=o.getValue(),h="";return r&&(h=r_(r)?r.checked?"true":"false":r.value),r=h,r!==u?(o.setValue(r),!0):!1}function el(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var j2=/[\n"\\]/g;function on(r){return r.replace(j2,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function ef(r,o,u,h,p,m,v,A){r.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?r.type=v:r.removeAttribute("type"),o!=null?v==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+an(o)):r.value!==""+an(o)&&(r.value=""+an(o)):v!=="submit"&&v!=="reset"||r.removeAttribute("value"),o!=null?tf(r,v,an(o)):u!=null?tf(r,v,an(u)):h!=null&&r.removeAttribute("value"),p==null&&m!=null&&(r.defaultChecked=!!m),p!=null&&(r.checked=p&&typeof p!="function"&&typeof p!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?r.name=""+an(A):r.removeAttribute("name")}function o_(r,o,u,h,p,m,v,A){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(r.type=m),o!=null||u!=null){if(!(m!=="submit"&&m!=="reset"||o!=null))return;u=u!=null?""+an(u):"",o=o!=null?""+an(o):u,A||o===r.value||(r.value=o),r.defaultValue=o}h=h??p,h=typeof h!="function"&&typeof h!="symbol"&&!!h,r.checked=A?r.checked:!!h,r.defaultChecked=!!h,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(r.name=v)}function tf(r,o,u){o==="number"&&el(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function er(r,o,u,h){if(r=r.options,o){o={};for(var p=0;p<u.length;p++)o["$"+u[p]]=!0;for(u=0;u<r.length;u++)p=o.hasOwnProperty("$"+r[u].value),r[u].selected!==p&&(r[u].selected=p),p&&h&&(r[u].defaultSelected=!0)}else{for(u=""+an(u),o=null,p=0;p<r.length;p++){if(r[p].value===u){r[p].selected=!0,h&&(r[p].defaultSelected=!0);return}o!==null||r[p].disabled||(o=r[p])}o!==null&&(o.selected=!0)}}function l_(r,o,u){if(o!=null&&(o=""+an(o),o!==r.value&&(r.value=o),u==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=u!=null?""+an(u):""}function c_(r,o,u,h){if(o==null){if(h!=null){if(u!=null)throw Error(i(92));if(ee(h)){if(1<h.length)throw Error(i(93));h=h[0]}u=h}u==null&&(u=""),o=u}u=an(o),r.defaultValue=u,h=r.textContent,h===u&&h!==""&&h!==null&&(r.value=h)}function tr(r,o){if(o){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=o;return}}r.textContent=o}var $2=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function u_(r,o,u){var h=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?h?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":h?r.setProperty(o,u):typeof u!="number"||u===0||$2.has(o)?o==="float"?r.cssFloat=u:r[o]=(""+u).trim():r[o]=u+"px"}function f_(r,o,u){if(o!=null&&typeof o!="object")throw Error(i(62));if(r=r.style,u!=null){for(var h in u)!u.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?r.setProperty(h,""):h==="float"?r.cssFloat="":r[h]="");for(var p in o)h=o[p],o.hasOwnProperty(p)&&u[p]!==h&&u_(r,p,h)}else for(var m in o)o.hasOwnProperty(m)&&u_(r,m,o[m])}function nf(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var X2=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Y2=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tl(r){return Y2.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var sf=null;function rf(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var nr=null,ir=null;function h_(r){var o=Qs(r);if(o&&(r=o.stateNode)){var u=r[Xt]||null;e:switch(r=o.stateNode,o.type){case"input":if(ef(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+on(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var h=u[o];if(h!==r&&h.form===r.form){var p=h[Xt]||null;if(!p)throw Error(i(90));ef(h,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(o=0;o<u.length;o++)h=u[o],h.form===r.form&&a_(h)}break e;case"textarea":l_(r,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&er(r,!!u.multiple,o,!1)}}}var af=!1;function d_(r,o,u){if(af)return r(o,u);af=!0;try{var h=r(o);return h}finally{if(af=!1,(nr!==null||ir!==null)&&(Ll(),nr&&(o=nr,r=ir,ir=nr=null,h_(o),r)))for(o=0;o<r.length;o++)h_(r[o])}}function pa(r,o){var u=r.stateNode;if(u===null)return null;var h=u[Xt]||null;if(h===null)return null;u=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(i(231,o,typeof u));return u}var of=!1;if(Qn)try{var _a={};Object.defineProperty(_a,"passive",{get:function(){of=!0}}),window.addEventListener("test",_a,_a),window.removeEventListener("test",_a,_a)}catch{of=!1}var Si=null,lf=null,nl=null;function g_(){if(nl)return nl;var r,o=lf,u=o.length,h,p="value"in Si?Si.value:Si.textContent,m=p.length;for(r=0;r<u&&o[r]===p[r];r++);var v=u-r;for(h=1;h<=v&&o[u-h]===p[m-h];h++);return nl=p.slice(r,1<h?1-h:void 0)}function il(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function sl(){return!0}function p_(){return!1}function Yt(r){function o(u,h,p,m,v){this._reactName=u,this._targetInst=p,this.type=h,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var A in r)r.hasOwnProperty(A)&&(u=r[A],this[A]=u?u(m):m[A]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?sl:p_,this.isPropagationStopped=p_,this}return oe(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),o}var ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rl=Yt(ds),ma=oe({},ds,{view:0,detail:0}),q2=Yt(ma),cf,uf,ya,al=oe({},ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hf,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ya&&(ya&&r.type==="mousemove"?(cf=r.screenX-ya.screenX,uf=r.screenY-ya.screenY):uf=cf=0,ya=r),cf)},movementY:function(r){return"movementY"in r?r.movementY:uf}}),__=Yt(al),K2=oe({},al,{dataTransfer:0}),Z2=Yt(K2),Q2=oe({},ma,{relatedTarget:0}),ff=Yt(Q2),G2=oe({},ds,{animationName:0,elapsedTime:0,pseudoElement:0}),J2=Yt(G2),ex=oe({},ds,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),tx=Yt(ex),nx=oe({},ds,{data:0}),m_=Yt(nx),ix={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ax(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=rx[r])?!!o[r]:!1}function hf(){return ax}var ox=oe({},ma,{key:function(r){if(r.key){var o=ix[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=il(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?sx[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hf,charCode:function(r){return r.type==="keypress"?il(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?il(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),lx=Yt(ox),cx=oe({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),y_=Yt(cx),ux=oe({},ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hf}),fx=Yt(ux),hx=oe({},ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),dx=Yt(hx),gx=oe({},al,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),px=Yt(gx),_x=oe({},ds,{newState:0,oldState:0}),mx=Yt(_x),yx=[9,13,27,32],df=Qn&&"CompositionEvent"in window,ba=null;Qn&&"documentMode"in document&&(ba=document.documentMode);var bx=Qn&&"TextEvent"in window&&!ba,b_=Qn&&(!df||ba&&8<ba&&11>=ba),v_=" ",T_=!1;function x_(r,o){switch(r){case"keyup":return yx.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function A_(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var sr=!1;function vx(r,o){switch(r){case"compositionend":return A_(o);case"keypress":return o.which!==32?null:(T_=!0,v_);case"textInput":return r=o.data,r===v_&&T_?null:r;default:return null}}function Tx(r,o){if(sr)return r==="compositionend"||!df&&x_(r,o)?(r=g_(),nl=lf=Si=null,sr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return b_&&o.locale!=="ko"?null:o.data;default:return null}}var xx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S_(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!xx[r.type]:o==="textarea"}function w_(r,o,u,h){nr?ir?ir.push(h):ir=[h]:nr=h,o=Wl(o,"onChange"),0<o.length&&(u=new rl("onChange","change",null,u,h),r.push({event:u,listeners:o}))}var va=null,Ta=null;function Ax(r){Qy(r,0)}function ol(r){var o=ga(r);if(a_(o))return r}function E_(r,o){if(r==="change")return o}var R_=!1;if(Qn){var gf;if(Qn){var pf="oninput"in document;if(!pf){var C_=document.createElement("div");C_.setAttribute("oninput","return;"),pf=typeof C_.oninput=="function"}gf=pf}else gf=!1;R_=gf&&(!document.documentMode||9<document.documentMode)}function M_(){va&&(va.detachEvent("onpropertychange",O_),Ta=va=null)}function O_(r){if(r.propertyName==="value"&&ol(Ta)){var o=[];w_(o,Ta,r,rf(r)),d_(Ax,o)}}function Sx(r,o,u){r==="focusin"?(M_(),va=o,Ta=u,va.attachEvent("onpropertychange",O_)):r==="focusout"&&M_()}function wx(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ol(Ta)}function Ex(r,o){if(r==="click")return ol(o)}function Rx(r,o){if(r==="input"||r==="change")return ol(o)}function Cx(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Gt=typeof Object.is=="function"?Object.is:Cx;function xa(r,o){if(Gt(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var u=Object.keys(r),h=Object.keys(o);if(u.length!==h.length)return!1;for(h=0;h<u.length;h++){var p=u[h];if(!qu.call(o,p)||!Gt(r[p],o[p]))return!1}return!0}function I_(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function P_(r,o){var u=I_(r);r=0;for(var h;u;){if(u.nodeType===3){if(h=r+u.textContent.length,r<=o&&h>=o)return{node:u,offset:o-r};r=h}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=I_(u)}}function N_(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?N_(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function D_(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=el(r.document);o instanceof r.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)r=o.contentWindow;else break;o=el(r.document)}return o}function _f(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function Mx(r,o){var u=D_(o);o=r.focusedElem;var h=r.selectionRange;if(u!==o&&o&&o.ownerDocument&&N_(o.ownerDocument.documentElement,o)){if(h!==null&&_f(o)){if(r=h.start,u=h.end,u===void 0&&(u=r),"selectionStart"in o)o.selectionStart=r,o.selectionEnd=Math.min(u,o.value.length);else if(u=(r=o.ownerDocument||document)&&r.defaultView||window,u.getSelection){u=u.getSelection();var p=o.textContent.length,m=Math.min(h.start,p);h=h.end===void 0?m:Math.min(h.end,p),!u.extend&&m>h&&(p=h,h=m,m=p),p=P_(o,m);var v=P_(o,h);p&&v&&(u.rangeCount!==1||u.anchorNode!==p.node||u.anchorOffset!==p.offset||u.focusNode!==v.node||u.focusOffset!==v.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),u.removeAllRanges(),m>h?(u.addRange(r),u.extend(v.node,v.offset)):(r.setEnd(v.node,v.offset),u.addRange(r)))}}for(r=[],u=o;u=u.parentNode;)u.nodeType===1&&r.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<r.length;o++)u=r[o],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var Ox=Qn&&"documentMode"in document&&11>=document.documentMode,rr=null,mf=null,Aa=null,yf=!1;function k_(r,o,u){var h=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;yf||rr==null||rr!==el(h)||(h=rr,"selectionStart"in h&&_f(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Aa&&xa(Aa,h)||(Aa=h,h=Wl(mf,"onSelect"),0<h.length&&(o=new rl("onSelect","select",null,o,u),r.push({event:o,listeners:h}),o.target=rr)))}function gs(r,o){var u={};return u[r.toLowerCase()]=o.toLowerCase(),u["Webkit"+r]="webkit"+o,u["Moz"+r]="moz"+o,u}var ar={animationend:gs("Animation","AnimationEnd"),animationiteration:gs("Animation","AnimationIteration"),animationstart:gs("Animation","AnimationStart"),transitionrun:gs("Transition","TransitionRun"),transitionstart:gs("Transition","TransitionStart"),transitioncancel:gs("Transition","TransitionCancel"),transitionend:gs("Transition","TransitionEnd")},bf={},B_={};Qn&&(B_=document.createElement("div").style,"AnimationEvent"in window||(delete ar.animationend.animation,delete ar.animationiteration.animation,delete ar.animationstart.animation),"TransitionEvent"in window||delete ar.transitionend.transition);function ps(r){if(bf[r])return bf[r];if(!ar[r])return r;var o=ar[r],u;for(u in o)if(o.hasOwnProperty(u)&&u in B_)return bf[r]=o[u];return r}var U_=ps("animationend"),L_=ps("animationiteration"),F_=ps("animationstart"),Ix=ps("transitionrun"),Px=ps("transitionstart"),Nx=ps("transitioncancel"),z_=ps("transitionend"),V_=new Map,H_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function wn(r,o){V_.set(r,o),hs(o,[r])}var ln=[],or=0,vf=0;function ll(){for(var r=or,o=vf=or=0;o<r;){var u=ln[o];ln[o++]=null;var h=ln[o];ln[o++]=null;var p=ln[o];ln[o++]=null;var m=ln[o];if(ln[o++]=null,h!==null&&p!==null){var v=h.pending;v===null?p.next=p:(p.next=v.next,v.next=p),h.pending=p}m!==0&&W_(u,p,m)}}function cl(r,o,u,h){ln[or++]=r,ln[or++]=o,ln[or++]=u,ln[or++]=h,vf|=h,r.lanes|=h,r=r.alternate,r!==null&&(r.lanes|=h)}function Tf(r,o,u,h){return cl(r,o,u,h),ul(r)}function wi(r,o){return cl(r,null,null,o),ul(r)}function W_(r,o,u){r.lanes|=u;var h=r.alternate;h!==null&&(h.lanes|=u);for(var p=!1,m=r.return;m!==null;)m.childLanes|=u,h=m.alternate,h!==null&&(h.childLanes|=u),m.tag===22&&(r=m.stateNode,r===null||r._visibility&1||(p=!0)),r=m,m=m.return;p&&o!==null&&r.tag===3&&(m=r.stateNode,p=31-Qt(u),m=m.hiddenUpdates,r=m[p],r===null?m[p]=[o]:r.push(o),o.lane=u|536870912)}function ul(r){if(50<qa)throw qa=0,Rh=null,Error(i(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var lr={},j_=new WeakMap;function cn(r,o){if(typeof r=="object"&&r!==null){var u=j_.get(r);return u!==void 0?u:(o={value:r,source:o,stack:D(o)},j_.set(r,o),o)}return{value:r,source:o,stack:D(o)}}var cr=[],ur=0,fl=null,hl=0,un=[],fn=0,_s=null,Jn=1,ei="";function ms(r,o){cr[ur++]=hl,cr[ur++]=fl,fl=r,hl=o}function $_(r,o,u){un[fn++]=Jn,un[fn++]=ei,un[fn++]=_s,_s=r;var h=Jn;r=ei;var p=32-Qt(h)-1;h&=~(1<<p),u+=1;var m=32-Qt(o)+p;if(30<m){var v=p-p%5;m=(h&(1<<v)-1).toString(32),h>>=v,p-=v,Jn=1<<32-Qt(o)+p|u<<p|h,ei=m+r}else Jn=1<<m|u<<p|h,ei=r}function xf(r){r.return!==null&&(ms(r,1),$_(r,1,0))}function Af(r){for(;r===fl;)fl=cr[--ur],cr[ur]=null,hl=cr[--ur],cr[ur]=null;for(;r===_s;)_s=un[--fn],un[fn]=null,ei=un[--fn],un[fn]=null,Jn=un[--fn],un[fn]=null}var Ht=null,Et=null,Fe=!1,En=null,Ln=!1,Sf=Error(i(519));function ys(r){var o=Error(i(418,""));throw Ea(cn(o,r)),Sf}function X_(r){var o=r.stateNode,u=r.type,h=r.memoizedProps;switch(o[Dt]=r,o[Xt]=h,u){case"dialog":Be("cancel",o),Be("close",o);break;case"iframe":case"object":case"embed":Be("load",o);break;case"video":case"audio":for(u=0;u<Za.length;u++)Be(Za[u],o);break;case"source":Be("error",o);break;case"img":case"image":case"link":Be("error",o),Be("load",o);break;case"details":Be("toggle",o);break;case"input":Be("invalid",o),o_(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),Jo(o);break;case"select":Be("invalid",o);break;case"textarea":Be("invalid",o),c_(o,h.value,h.defaultValue,h.children),Jo(o)}u=h.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||h.suppressHydrationWarning===!0||t0(o.textContent,u)?(h.popover!=null&&(Be("beforetoggle",o),Be("toggle",o)),h.onScroll!=null&&Be("scroll",o),h.onScrollEnd!=null&&Be("scrollend",o),h.onClick!=null&&(o.onclick=jl),o=!0):o=!1,o||ys(r)}function Y_(r){for(Ht=r.return;Ht;)switch(Ht.tag){case 3:case 27:Ln=!0;return;case 5:case 13:Ln=!1;return;default:Ht=Ht.return}}function Sa(r){if(r!==Ht)return!1;if(!Fe)return Y_(r),Fe=!0,!1;var o=!1,u;if((u=r.tag!==3&&r.tag!==27)&&((u=r.tag===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||jh(r.type,r.memoizedProps)),u=!u),u&&(o=!0),o&&Et&&ys(r),Y_(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8)if(u=r.data,u==="/$"){if(o===0){Et=Cn(r.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;r=r.nextSibling}Et=null}}else Et=Ht?Cn(r.stateNode.nextSibling):null;return!0}function wa(){Et=Ht=null,Fe=!1}function Ea(r){En===null?En=[r]:En.push(r)}var Ra=Error(i(460)),q_=Error(i(474)),wf={then:function(){}};function K_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function dl(){}function Z_(r,o,u){switch(u=r[u],u===void 0?r.push(o):u!==o&&(o.then(dl,dl),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,r===Ra?Error(i(483)):r;default:if(typeof o.status=="string")o.then(dl,dl);else{if(r=Qe,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=o,r.status="pending",r.then(function(h){if(o.status==="pending"){var p=o;p.status="fulfilled",p.value=h}},function(h){if(o.status==="pending"){var p=o;p.status="rejected",p.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,r===Ra?Error(i(483)):r}throw Ca=o,Ra}}var Ca=null;function Q_(){if(Ca===null)throw Error(i(459));var r=Ca;return Ca=null,r}var fr=null,Ma=0;function gl(r){var o=Ma;return Ma+=1,fr===null&&(fr=[]),Z_(fr,r,o)}function Oa(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function pl(r,o){throw o.$$typeof===a?Error(i(525)):(r=Object.prototype.toString.call(o),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function G_(r){var o=r._init;return o(r._payload)}function J_(r){function o(j,k){if(r){var Y=j.deletions;Y===null?(j.deletions=[k],j.flags|=16):Y.push(k)}}function u(j,k){if(!r)return null;for(;k!==null;)o(j,k),k=k.sibling;return null}function h(j){for(var k=new Map;j!==null;)j.key!==null?k.set(j.key,j):k.set(j.index,j),j=j.sibling;return k}function p(j,k){return j=Ui(j,k),j.index=0,j.sibling=null,j}function m(j,k,Y){return j.index=Y,r?(Y=j.alternate,Y!==null?(Y=Y.index,Y<k?(j.flags|=33554434,k):Y):(j.flags|=33554434,k)):(j.flags|=1048576,k)}function v(j){return r&&j.alternate===null&&(j.flags|=33554434),j}function A(j,k,Y,se){return k===null||k.tag!==6?(k=bh(Y,j.mode,se),k.return=j,k):(k=p(k,Y),k.return=j,k)}function O(j,k,Y,se){var ge=Y.type;return ge===f?te(j,k,Y.props.children,se,Y.key):k!==null&&(k.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===V&&G_(ge)===k.type)?(k=p(k,Y.props),Oa(k,Y),k.return=j,k):(k=Nl(Y.type,Y.key,Y.props,null,j.mode,se),Oa(k,Y),k.return=j,k)}function F(j,k,Y,se){return k===null||k.tag!==4||k.stateNode.containerInfo!==Y.containerInfo||k.stateNode.implementation!==Y.implementation?(k=vh(Y,j.mode,se),k.return=j,k):(k=p(k,Y.children||[]),k.return=j,k)}function te(j,k,Y,se,ge){return k===null||k.tag!==7?(k=Cs(Y,j.mode,se,ge),k.return=j,k):(k=p(k,Y),k.return=j,k)}function re(j,k,Y){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=bh(""+k,j.mode,Y),k.return=j,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case l:return Y=Nl(k.type,k.key,k.props,null,j.mode,Y),Oa(Y,k),Y.return=j,Y;case c:return k=vh(k,j.mode,Y),k.return=j,k;case V:var se=k._init;return k=se(k._payload),re(j,k,Y)}if(ee(k)||Z(k))return k=Cs(k,j.mode,Y,null),k.return=j,k;if(typeof k.then=="function")return re(j,gl(k),Y);if(k.$$typeof===b)return re(j,Ol(j,k),Y);pl(j,k)}return null}function q(j,k,Y,se){var ge=k!==null?k.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return ge!==null?null:A(j,k,""+Y,se);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case l:return Y.key===ge?O(j,k,Y,se):null;case c:return Y.key===ge?F(j,k,Y,se):null;case V:return ge=Y._init,Y=ge(Y._payload),q(j,k,Y,se)}if(ee(Y)||Z(Y))return ge!==null?null:te(j,k,Y,se,null);if(typeof Y.then=="function")return q(j,k,gl(Y),se);if(Y.$$typeof===b)return q(j,k,Ol(j,Y),se);pl(j,Y)}return null}function G(j,k,Y,se,ge){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return j=j.get(Y)||null,A(k,j,""+se,ge);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case l:return j=j.get(se.key===null?Y:se.key)||null,O(k,j,se,ge);case c:return j=j.get(se.key===null?Y:se.key)||null,F(k,j,se,ge);case V:var Oe=se._init;return se=Oe(se._payload),G(j,k,Y,se,ge)}if(ee(se)||Z(se))return j=j.get(Y)||null,te(k,j,se,ge,null);if(typeof se.then=="function")return G(j,k,Y,gl(se),ge);if(se.$$typeof===b)return G(j,k,Y,Ol(k,se),ge);pl(k,se)}return null}function me(j,k,Y,se){for(var ge=null,Oe=null,ye=k,xe=k=0,St=null;ye!==null&&xe<Y.length;xe++){ye.index>xe?(St=ye,ye=null):St=ye.sibling;var ze=q(j,ye,Y[xe],se);if(ze===null){ye===null&&(ye=St);break}r&&ye&&ze.alternate===null&&o(j,ye),k=m(ze,k,xe),Oe===null?ge=ze:Oe.sibling=ze,Oe=ze,ye=St}if(xe===Y.length)return u(j,ye),Fe&&ms(j,xe),ge;if(ye===null){for(;xe<Y.length;xe++)ye=re(j,Y[xe],se),ye!==null&&(k=m(ye,k,xe),Oe===null?ge=ye:Oe.sibling=ye,Oe=ye);return Fe&&ms(j,xe),ge}for(ye=h(ye);xe<Y.length;xe++)St=G(ye,j,xe,Y[xe],se),St!==null&&(r&&St.alternate!==null&&ye.delete(St.key===null?xe:St.key),k=m(St,k,xe),Oe===null?ge=St:Oe.sibling=St,Oe=St);return r&&ye.forEach(function(ji){return o(j,ji)}),Fe&&ms(j,xe),ge}function we(j,k,Y,se){if(Y==null)throw Error(i(151));for(var ge=null,Oe=null,ye=k,xe=k=0,St=null,ze=Y.next();ye!==null&&!ze.done;xe++,ze=Y.next()){ye.index>xe?(St=ye,ye=null):St=ye.sibling;var ji=q(j,ye,ze.value,se);if(ji===null){ye===null&&(ye=St);break}r&&ye&&ji.alternate===null&&o(j,ye),k=m(ji,k,xe),Oe===null?ge=ji:Oe.sibling=ji,Oe=ji,ye=St}if(ze.done)return u(j,ye),Fe&&ms(j,xe),ge;if(ye===null){for(;!ze.done;xe++,ze=Y.next())ze=re(j,ze.value,se),ze!==null&&(k=m(ze,k,xe),Oe===null?ge=ze:Oe.sibling=ze,Oe=ze);return Fe&&ms(j,xe),ge}for(ye=h(ye);!ze.done;xe++,ze=Y.next())ze=G(ye,j,xe,ze.value,se),ze!==null&&(r&&ze.alternate!==null&&ye.delete(ze.key===null?xe:ze.key),k=m(ze,k,xe),Oe===null?ge=ze:Oe.sibling=ze,Oe=ze);return r&&ye.forEach(function(YA){return o(j,YA)}),Fe&&ms(j,xe),ge}function at(j,k,Y,se){if(typeof Y=="object"&&Y!==null&&Y.type===f&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case l:e:{for(var ge=Y.key;k!==null;){if(k.key===ge){if(ge=Y.type,ge===f){if(k.tag===7){u(j,k.sibling),se=p(k,Y.props.children),se.return=j,j=se;break e}}else if(k.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===V&&G_(ge)===k.type){u(j,k.sibling),se=p(k,Y.props),Oa(se,Y),se.return=j,j=se;break e}u(j,k);break}else o(j,k);k=k.sibling}Y.type===f?(se=Cs(Y.props.children,j.mode,se,Y.key),se.return=j,j=se):(se=Nl(Y.type,Y.key,Y.props,null,j.mode,se),Oa(se,Y),se.return=j,j=se)}return v(j);case c:e:{for(ge=Y.key;k!==null;){if(k.key===ge)if(k.tag===4&&k.stateNode.containerInfo===Y.containerInfo&&k.stateNode.implementation===Y.implementation){u(j,k.sibling),se=p(k,Y.children||[]),se.return=j,j=se;break e}else{u(j,k);break}else o(j,k);k=k.sibling}se=vh(Y,j.mode,se),se.return=j,j=se}return v(j);case V:return ge=Y._init,Y=ge(Y._payload),at(j,k,Y,se)}if(ee(Y))return me(j,k,Y,se);if(Z(Y)){if(ge=Z(Y),typeof ge!="function")throw Error(i(150));return Y=ge.call(Y),we(j,k,Y,se)}if(typeof Y.then=="function")return at(j,k,gl(Y),se);if(Y.$$typeof===b)return at(j,k,Ol(j,Y),se);pl(j,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,k!==null&&k.tag===6?(u(j,k.sibling),se=p(k,Y),se.return=j,j=se):(u(j,k),se=bh(Y,j.mode,se),se.return=j,j=se),v(j)):u(j,k)}return function(j,k,Y,se){try{Ma=0;var ge=at(j,k,Y,se);return fr=null,ge}catch(ye){if(ye===Ra)throw ye;var Oe=pn(29,ye,null,j.mode);return Oe.lanes=se,Oe.return=j,Oe}finally{}}}var bs=J_(!0),em=J_(!1),hr=_e(null),_l=_e(0);function tm(r,o){r=fi,Te(_l,r),Te(hr,o),fi=r|o.baseLanes}function Ef(){Te(_l,fi),Te(hr,hr.current)}function Rf(){fi=_l.current,Ie(hr),Ie(_l)}var hn=_e(null),Fn=null;function Ei(r){var o=r.alternate;Te(mt,mt.current&1),Te(hn,r),Fn===null&&(o===null||hr.current!==null||o.memoizedState!==null)&&(Fn=r)}function nm(r){if(r.tag===22){if(Te(mt,mt.current),Te(hn,r),Fn===null){var o=r.alternate;o!==null&&o.memoizedState!==null&&(Fn=r)}}else Ri()}function Ri(){Te(mt,mt.current),Te(hn,hn.current)}function ti(r){Ie(hn),Fn===r&&(Fn=null),Ie(mt)}var mt=_e(0);function ml(r){for(var o=r;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Dx=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(u,h){r.push(h)}};this.abort=function(){o.aborted=!0,r.forEach(function(u){return u()})}},kx=n.unstable_scheduleCallback,Bx=n.unstable_NormalPriority,yt={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cf(){return{controller:new Dx,data:new Map,refCount:0}}function Ia(r){r.refCount--,r.refCount===0&&kx(Bx,function(){r.controller.abort()})}var Pa=null,Mf=0,dr=0,gr=null;function Ux(r,o){if(Pa===null){var u=Pa=[];Mf=0,dr=kh(),gr={status:"pending",value:void 0,then:function(h){u.push(h)}}}return Mf++,o.then(im,im),o}function im(){if(--Mf===0&&Pa!==null){gr!==null&&(gr.status="fulfilled");var r=Pa;Pa=null,dr=0,gr=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function Lx(r,o){var u=[],h={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return r.then(function(){h.status="fulfilled",h.value=o;for(var p=0;p<u.length;p++)(0,u[p])(o)},function(p){for(h.status="rejected",h.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),h}var sm=J.S;J.S=function(r,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Ux(r,o),sm!==null&&sm(r,o)};var vs=_e(null);function Of(){var r=vs.current;return r!==null?r:Qe.pooledCache}function yl(r,o){o===null?Te(vs,vs.current):Te(vs,o.pool)}function rm(){var r=Of();return r===null?null:{parent:yt._currentValue,pool:r}}var Ci=0,Me=null,je=null,ft=null,bl=!1,pr=!1,Ts=!1,vl=0,Na=0,_r=null,Fx=0;function ut(){throw Error(i(321))}function If(r,o){if(o===null)return!1;for(var u=0;u<o.length&&u<r.length;u++)if(!Gt(r[u],o[u]))return!1;return!0}function Pf(r,o,u,h,p,m){return Ci=m,Me=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,J.H=r===null||r.memoizedState===null?xs:Mi,Ts=!1,m=u(h,p),Ts=!1,pr&&(m=om(o,u,h,p)),am(r),m}function am(r){J.H=zn;var o=je!==null&&je.next!==null;if(Ci=0,ft=je=Me=null,bl=!1,Na=0,_r=null,o)throw Error(i(300));r===null||xt||(r=r.dependencies,r!==null&&Ml(r)&&(xt=!0))}function om(r,o,u,h){Me=r;var p=0;do{if(pr&&(_r=null),Na=0,pr=!1,25<=p)throw Error(i(301));if(p+=1,ft=je=null,r.updateQueue!=null){var m=r.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}J.H=As,m=o(u,h)}while(pr);return m}function zx(){var r=J.H,o=r.useState()[0];return o=typeof o.then=="function"?Da(o):o,r=r.useState()[0],(je!==null?je.memoizedState:null)!==r&&(Me.flags|=1024),o}function Nf(){var r=vl!==0;return vl=0,r}function Df(r,o,u){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~u}function kf(r){if(bl){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}bl=!1}Ci=0,ft=je=Me=null,pr=!1,Na=vl=0,_r=null}function qt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ft===null?Me.memoizedState=ft=r:ft=ft.next=r,ft}function ht(){if(je===null){var r=Me.alternate;r=r!==null?r.memoizedState:null}else r=je.next;var o=ft===null?Me.memoizedState:ft.next;if(o!==null)ft=o,je=r;else{if(r===null)throw Me.alternate===null?Error(i(467)):Error(i(310));je=r,r={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},ft===null?Me.memoizedState=ft=r:ft=ft.next=r}return ft}var Tl;Tl=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Da(r){var o=Na;return Na+=1,_r===null&&(_r=[]),r=Z_(_r,r,o),o=Me,(ft===null?o.memoizedState:ft.next)===null&&(o=o.alternate,J.H=o===null||o.memoizedState===null?xs:Mi),r}function xl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Da(r);if(r.$$typeof===b)return kt(r)}throw Error(i(438,String(r)))}function Bf(r){var o=null,u=Me.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var h=Me.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(p){return p.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Tl(),Me.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(r),h=0;h<r;h++)u[h]=H;return o.index++,u}function ni(r,o){return typeof o=="function"?o(r):o}function Al(r){var o=ht();return Uf(o,je,r)}function Uf(r,o,u){var h=r.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=u;var p=r.baseQueue,m=h.pending;if(m!==null){if(p!==null){var v=p.next;p.next=m.next,m.next=v}o.baseQueue=p=m,h.pending=null}if(m=r.baseState,p===null)r.memoizedState=m;else{o=p.next;var A=v=null,O=null,F=o,te=!1;do{var re=F.lane&-536870913;if(re!==F.lane?(Ue&re)===re:(Ci&re)===re){var q=F.revertLane;if(q===0)O!==null&&(O=O.next={lane:0,revertLane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),re===dr&&(te=!0);else if((Ci&q)===q){F=F.next,q===dr&&(te=!0);continue}else re={lane:0,revertLane:F.revertLane,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},O===null?(A=O=re,v=m):O=O.next=re,Me.lanes|=q,Li|=q;re=F.action,Ts&&u(m,re),m=F.hasEagerState?F.eagerState:u(m,re)}else q={lane:re,revertLane:F.revertLane,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},O===null?(A=O=q,v=m):O=O.next=q,Me.lanes|=re,Li|=re;F=F.next}while(F!==null&&F!==o);if(O===null?v=m:O.next=A,!Gt(m,r.memoizedState)&&(xt=!0,te&&(u=gr,u!==null)))throw u;r.memoizedState=m,r.baseState=v,r.baseQueue=O,h.lastRenderedState=m}return p===null&&(h.lanes=0),[r.memoizedState,h.dispatch]}function Lf(r){var o=ht(),u=o.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=r;var h=u.dispatch,p=u.pending,m=o.memoizedState;if(p!==null){u.pending=null;var v=p=p.next;do m=r(m,v.action),v=v.next;while(v!==p);Gt(m,o.memoizedState)||(xt=!0),o.memoizedState=m,o.baseQueue===null&&(o.baseState=m),u.lastRenderedState=m}return[m,h]}function lm(r,o,u){var h=Me,p=ht(),m=Fe;if(m){if(u===void 0)throw Error(i(407));u=u()}else u=o();var v=!Gt((je||p).memoizedState,u);if(v&&(p.memoizedState=u,xt=!0),p=p.queue,Vf(fm.bind(null,h,p,r),[r]),p.getSnapshot!==o||v||ft!==null&&ft.memoizedState.tag&1){if(h.flags|=2048,mr(9,um.bind(null,h,p,u,o),{destroy:void 0},null),Qe===null)throw Error(i(349));m||(Ci&60)!==0||cm(h,o,u)}return u}function cm(r,o,u){r.flags|=16384,r={getSnapshot:o,value:u},o=Me.updateQueue,o===null?(o=Tl(),Me.updateQueue=o,o.stores=[r]):(u=o.stores,u===null?o.stores=[r]:u.push(r))}function um(r,o,u,h){o.value=u,o.getSnapshot=h,hm(o)&&dm(r)}function fm(r,o,u){return u(function(){hm(o)&&dm(r)})}function hm(r){var o=r.getSnapshot;r=r.value;try{var u=o();return!Gt(r,u)}catch{return!0}}function dm(r){var o=wi(r,2);o!==null&&Wt(o,r,2)}function Ff(r){var o=qt();if(typeof r=="function"){var u=r;if(r=u(),Ts){xi(!0);try{u()}finally{xi(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:r},o}function gm(r,o,u,h){return r.baseState=u,Uf(r,je,typeof h=="function"?h:ni)}function Vx(r,o,u,h,p){if(El(r))throw Error(i(485));if(r=o.action,r!==null){var m={payload:p,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};J.T!==null?u(!0):m.isTransition=!1,h(m),u=o.pending,u===null?(m.next=o.pending=m,pm(o,m)):(m.next=u.next,o.pending=u.next=m)}}function pm(r,o){var u=o.action,h=o.payload,p=r.state;if(o.isTransition){var m=J.T,v={};J.T=v;try{var A=u(p,h),O=J.S;O!==null&&O(v,A),_m(r,o,A)}catch(F){zf(r,o,F)}finally{J.T=m}}else try{m=u(p,h),_m(r,o,m)}catch(F){zf(r,o,F)}}function _m(r,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(h){mm(r,o,h)},function(h){return zf(r,o,h)}):mm(r,o,u)}function mm(r,o,u){o.status="fulfilled",o.value=u,ym(o),r.state=u,o=r.pending,o!==null&&(u=o.next,u===o?r.pending=null:(u=u.next,o.next=u,pm(r,u)))}function zf(r,o,u){var h=r.pending;if(r.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=u,ym(o),o=o.next;while(o!==h)}r.action=null}function ym(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function bm(r,o){return o}function vm(r,o){if(Fe){var u=Qe.formState;if(u!==null){e:{var h=Me;if(Fe){if(Et){t:{for(var p=Et,m=Ln;p.nodeType!==8;){if(!m){p=null;break t}if(p=Cn(p.nextSibling),p===null){p=null;break t}}m=p.data,p=m==="F!"||m==="F"?p:null}if(p){Et=Cn(p.nextSibling),h=p.data==="F!";break e}}ys(h)}h=!1}h&&(o=u[0])}}return u=qt(),u.memoizedState=u.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bm,lastRenderedState:o},u.queue=h,u=Lm.bind(null,Me,h),h.dispatch=u,h=Ff(!1),m=Xf.bind(null,Me,!1,h.queue),h=qt(),p={state:o,dispatch:null,action:r,pending:null},h.queue=p,u=Vx.bind(null,Me,p,m,u),p.dispatch=u,h.memoizedState=r,[o,u,!1]}function Tm(r){var o=ht();return xm(o,je,r)}function xm(r,o,u){o=Uf(r,o,bm)[0],r=Al(ni)[0],o=typeof o=="object"&&o!==null&&typeof o.then=="function"?Da(o):o;var h=ht(),p=h.queue,m=p.dispatch;return u!==h.memoizedState&&(Me.flags|=2048,mr(9,Hx.bind(null,p,u),{destroy:void 0},null)),[o,m,r]}function Hx(r,o){r.action=o}function Am(r){var o=ht(),u=je;if(u!==null)return xm(o,u,r);ht(),o=o.memoizedState,u=ht();var h=u.queue.dispatch;return u.memoizedState=r,[o,h,!1]}function mr(r,o,u,h){return r={tag:r,create:o,inst:u,deps:h,next:null},o=Me.updateQueue,o===null&&(o=Tl(),Me.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=r.next=r:(h=u.next,u.next=r,r.next=h,o.lastEffect=r),r}function Sm(){return ht().memoizedState}function Sl(r,o,u,h){var p=qt();Me.flags|=r,p.memoizedState=mr(1|o,u,{destroy:void 0},h===void 0?null:h)}function wl(r,o,u,h){var p=ht();h=h===void 0?null:h;var m=p.memoizedState.inst;je!==null&&h!==null&&If(h,je.memoizedState.deps)?p.memoizedState=mr(o,u,m,h):(Me.flags|=r,p.memoizedState=mr(1|o,u,m,h))}function wm(r,o){Sl(8390656,8,r,o)}function Vf(r,o){wl(2048,8,r,o)}function Em(r,o){return wl(4,2,r,o)}function Rm(r,o){return wl(4,4,r,o)}function Cm(r,o){if(typeof o=="function"){r=r();var u=o(r);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Mm(r,o,u){u=u!=null?u.concat([r]):null,wl(4,4,Cm.bind(null,o,r),u)}function Hf(){}function Om(r,o){var u=ht();o=o===void 0?null:o;var h=u.memoizedState;return o!==null&&If(o,h[1])?h[0]:(u.memoizedState=[r,o],r)}function Im(r,o){var u=ht();o=o===void 0?null:o;var h=u.memoizedState;if(o!==null&&If(o,h[1]))return h[0];if(h=r(),Ts){xi(!0);try{r()}finally{xi(!1)}}return u.memoizedState=[h,o],h}function Wf(r,o,u){return u===void 0||(Ci&1073741824)!==0?r.memoizedState=o:(r.memoizedState=u,r=Ny(),Me.lanes|=r,Li|=r,u)}function Pm(r,o,u,h){return Gt(u,o)?u:hr.current!==null?(r=Wf(r,u,h),Gt(r,o)||(xt=!0),r):(Ci&42)===0?(xt=!0,r.memoizedState=u):(r=Ny(),Me.lanes|=r,Li|=r,o)}function Nm(r,o,u,h,p){var m=ie.p;ie.p=m!==0&&8>m?m:8;var v=J.T,A={};J.T=A,Xf(r,!1,o,u);try{var O=p(),F=J.S;if(F!==null&&F(A,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var te=Lx(O,h);ka(r,o,te,nn(r))}else ka(r,o,h,nn(r))}catch(re){ka(r,o,{then:function(){},status:"rejected",reason:re},nn())}finally{ie.p=m,J.T=v}}function Wx(){}function jf(r,o,u,h){if(r.tag!==5)throw Error(i(476));var p=Dm(r).queue;Nm(r,p,o,le,u===null?Wx:function(){return km(r),u(h)})}function Dm(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:le},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:u},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function km(r){var o=Dm(r).next.queue;ka(r,o,{},nn())}function $f(){return kt(to)}function Bm(){return ht().memoizedState}function Um(){return ht().memoizedState}function jx(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var u=nn();r=Pi(u);var h=Ni(o,r,u);h!==null&&(Wt(h,o,u),La(h,o,u)),o={cache:Cf()},r.payload=o;return}o=o.return}}function $x(r,o,u){var h=nn();u={lane:h,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},El(r)?Fm(o,u):(u=Tf(r,o,u,h),u!==null&&(Wt(u,r,h),zm(u,o,h)))}function Lm(r,o,u){var h=nn();ka(r,o,u,h)}function ka(r,o,u,h){var p={lane:h,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(El(r))Fm(o,p);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=o.lastRenderedReducer,m!==null))try{var v=o.lastRenderedState,A=m(v,u);if(p.hasEagerState=!0,p.eagerState=A,Gt(A,v))return cl(r,o,p,0),Qe===null&&ll(),!1}catch{}finally{}if(u=Tf(r,o,p,h),u!==null)return Wt(u,r,h),zm(u,o,h),!0}return!1}function Xf(r,o,u,h){if(h={lane:2,revertLane:kh(),action:h,hasEagerState:!1,eagerState:null,next:null},El(r)){if(o)throw Error(i(479))}else o=Tf(r,u,h,2),o!==null&&Wt(o,r,2)}function El(r){var o=r.alternate;return r===Me||o!==null&&o===Me}function Fm(r,o){pr=bl=!0;var u=r.pending;u===null?o.next=o:(o.next=u.next,u.next=o),r.pending=o}function zm(r,o,u){if((u&4194176)!==0){var h=o.lanes;h&=r.pendingLanes,u|=h,o.lanes=u,Qp(r,u)}}var zn={readContext:kt,use:xl,useCallback:ut,useContext:ut,useEffect:ut,useImperativeHandle:ut,useLayoutEffect:ut,useInsertionEffect:ut,useMemo:ut,useReducer:ut,useRef:ut,useState:ut,useDebugValue:ut,useDeferredValue:ut,useTransition:ut,useSyncExternalStore:ut,useId:ut};zn.useCacheRefresh=ut,zn.useMemoCache=ut,zn.useHostTransitionStatus=ut,zn.useFormState=ut,zn.useActionState=ut,zn.useOptimistic=ut;var xs={readContext:kt,use:xl,useCallback:function(r,o){return qt().memoizedState=[r,o===void 0?null:o],r},useContext:kt,useEffect:wm,useImperativeHandle:function(r,o,u){u=u!=null?u.concat([r]):null,Sl(4194308,4,Cm.bind(null,o,r),u)},useLayoutEffect:function(r,o){return Sl(4194308,4,r,o)},useInsertionEffect:function(r,o){Sl(4,2,r,o)},useMemo:function(r,o){var u=qt();o=o===void 0?null:o;var h=r();if(Ts){xi(!0);try{r()}finally{xi(!1)}}return u.memoizedState=[h,o],h},useReducer:function(r,o,u){var h=qt();if(u!==void 0){var p=u(o);if(Ts){xi(!0);try{u(o)}finally{xi(!1)}}}else p=o;return h.memoizedState=h.baseState=p,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:p},h.queue=r,r=r.dispatch=$x.bind(null,Me,r),[h.memoizedState,r]},useRef:function(r){var o=qt();return r={current:r},o.memoizedState=r},useState:function(r){r=Ff(r);var o=r.queue,u=Lm.bind(null,Me,o);return o.dispatch=u,[r.memoizedState,u]},useDebugValue:Hf,useDeferredValue:function(r,o){var u=qt();return Wf(u,r,o)},useTransition:function(){var r=Ff(!1);return r=Nm.bind(null,Me,r.queue,!0,!1),qt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,u){var h=Me,p=qt();if(Fe){if(u===void 0)throw Error(i(407));u=u()}else{if(u=o(),Qe===null)throw Error(i(349));(Ue&60)!==0||cm(h,o,u)}p.memoizedState=u;var m={value:u,getSnapshot:o};return p.queue=m,wm(fm.bind(null,h,m,r),[r]),h.flags|=2048,mr(9,um.bind(null,h,m,u,o),{destroy:void 0},null),u},useId:function(){var r=qt(),o=Qe.identifierPrefix;if(Fe){var u=ei,h=Jn;u=(h&~(1<<32-Qt(h)-1)).toString(32)+u,o=":"+o+"R"+u,u=vl++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=Fx++,o=":"+o+"r"+u.toString(32)+":";return r.memoizedState=o},useCacheRefresh:function(){return qt().memoizedState=jx.bind(null,Me)}};xs.useMemoCache=Bf,xs.useHostTransitionStatus=$f,xs.useFormState=vm,xs.useActionState=vm,xs.useOptimistic=function(r){var o=qt();o.memoizedState=o.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Xf.bind(null,Me,!0,u),u.dispatch=o,[r,o]};var Mi={readContext:kt,use:xl,useCallback:Om,useContext:kt,useEffect:Vf,useImperativeHandle:Mm,useInsertionEffect:Em,useLayoutEffect:Rm,useMemo:Im,useReducer:Al,useRef:Sm,useState:function(){return Al(ni)},useDebugValue:Hf,useDeferredValue:function(r,o){var u=ht();return Pm(u,je.memoizedState,r,o)},useTransition:function(){var r=Al(ni)[0],o=ht().memoizedState;return[typeof r=="boolean"?r:Da(r),o]},useSyncExternalStore:lm,useId:Bm};Mi.useCacheRefresh=Um,Mi.useMemoCache=Bf,Mi.useHostTransitionStatus=$f,Mi.useFormState=Tm,Mi.useActionState=Tm,Mi.useOptimistic=function(r,o){var u=ht();return gm(u,je,r,o)};var As={readContext:kt,use:xl,useCallback:Om,useContext:kt,useEffect:Vf,useImperativeHandle:Mm,useInsertionEffect:Em,useLayoutEffect:Rm,useMemo:Im,useReducer:Lf,useRef:Sm,useState:function(){return Lf(ni)},useDebugValue:Hf,useDeferredValue:function(r,o){var u=ht();return je===null?Wf(u,r,o):Pm(u,je.memoizedState,r,o)},useTransition:function(){var r=Lf(ni)[0],o=ht().memoizedState;return[typeof r=="boolean"?r:Da(r),o]},useSyncExternalStore:lm,useId:Bm};As.useCacheRefresh=Um,As.useMemoCache=Bf,As.useHostTransitionStatus=$f,As.useFormState=Am,As.useActionState=Am,As.useOptimistic=function(r,o){var u=ht();return je!==null?gm(u,je,r,o):(u.baseState=r,[r,u.queue.dispatch])};function Yf(r,o,u,h){o=r.memoizedState,u=u(h,o),u=u==null?o:oe({},o,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var qf={isMounted:function(r){return(r=r._reactInternals)?I(r)===r:!1},enqueueSetState:function(r,o,u){r=r._reactInternals;var h=nn(),p=Pi(h);p.payload=o,u!=null&&(p.callback=u),o=Ni(r,p,h),o!==null&&(Wt(o,r,h),La(o,r,h))},enqueueReplaceState:function(r,o,u){r=r._reactInternals;var h=nn(),p=Pi(h);p.tag=1,p.payload=o,u!=null&&(p.callback=u),o=Ni(r,p,h),o!==null&&(Wt(o,r,h),La(o,r,h))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var u=nn(),h=Pi(u);h.tag=2,o!=null&&(h.callback=o),o=Ni(r,h,u),o!==null&&(Wt(o,r,u),La(o,r,u))}};function Vm(r,o,u,h,p,m,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,m,v):o.prototype&&o.prototype.isPureReactComponent?!xa(u,h)||!xa(p,m):!0}function Hm(r,o,u,h){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,h),o.state!==r&&qf.enqueueReplaceState(o,o.state,null)}function Ss(r,o){var u=o;if("ref"in o){u={};for(var h in o)h!=="ref"&&(u[h]=o[h])}if(r=r.defaultProps){u===o&&(u=oe({},u));for(var p in r)u[p]===void 0&&(u[p]=r[p])}return u}var Rl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function Wm(r){Rl(r)}function jm(r){console.error(r)}function $m(r){Rl(r)}function Cl(r,o){try{var u=r.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function Xm(r,o,u){try{var h=r.onCaughtError;h(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Kf(r,o,u){return u=Pi(u),u.tag=3,u.payload={element:null},u.callback=function(){Cl(r,o)},u}function Ym(r){return r=Pi(r),r.tag=3,r}function qm(r,o,u,h){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var m=h.value;r.payload=function(){return p(m)},r.callback=function(){Xm(o,u,h)}}var v=u.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(r.callback=function(){Xm(o,u,h),typeof p!="function"&&(Fi===null?Fi=new Set([this]):Fi.add(this));var A=h.stack;this.componentDidCatch(h.value,{componentStack:A!==null?A:""})})}function Xx(r,o,u,h,p){if(u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=u.alternate,o!==null&&Ua(o,u,p,!0),u=hn.current,u!==null){switch(u.tag){case 13:return Fn===null?Oh():u.alternate===null&&rt===0&&(rt=3),u.flags&=-257,u.flags|=65536,u.lanes=p,h===wf?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([h]):o.add(h),Ph(r,h,p)),!1;case 22:return u.flags|=65536,h===wf?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([h]):u.add(h)),Ph(r,h,p)),!1}throw Error(i(435,u.tag))}return Ph(r,h,p),Oh(),!1}if(Fe)return o=hn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=p,h!==Sf&&(r=Error(i(422),{cause:h}),Ea(cn(r,u)))):(h!==Sf&&(o=Error(i(423),{cause:h}),Ea(cn(o,u))),r=r.current.alternate,r.flags|=65536,p&=-p,r.lanes|=p,h=cn(h,u),p=Kf(r.stateNode,h,p),uh(r,p),rt!==4&&(rt=2)),!1;var m=Error(i(520),{cause:h});if(m=cn(m,u),Xa===null?Xa=[m]:Xa.push(m),rt!==4&&(rt=2),o===null)return!0;h=cn(h,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,r=p&-p,u.lanes|=r,r=Kf(u.stateNode,h,r),uh(u,r),!1;case 1:if(o=u.type,m=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Fi===null||!Fi.has(m))))return u.flags|=65536,p&=-p,u.lanes|=p,p=Ym(p),qm(p,r,u,h),uh(u,p),!1}u=u.return}while(u!==null);return!1}var Km=Error(i(461)),xt=!1;function Rt(r,o,u,h){o.child=r===null?em(o,null,u,h):bs(o,r.child,u,h)}function Zm(r,o,u,h,p){u=u.render;var m=o.ref;if("ref"in h){var v={};for(var A in h)A!=="ref"&&(v[A]=h[A])}else v=h;return Es(o),h=Pf(r,o,u,v,m,p),A=Nf(),r!==null&&!xt?(Df(r,o,p),ii(r,o,p)):(Fe&&A&&xf(o),o.flags|=1,Rt(r,o,h,p),o.child)}function Qm(r,o,u,h,p){if(r===null){var m=u.type;return typeof m=="function"&&!yh(m)&&m.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=m,Gm(r,o,m,h,p)):(r=Nl(u.type,null,h,o,o.mode,p),r.ref=o.ref,r.return=o,o.child=r)}if(m=r.child,!sh(r,p)){var v=m.memoizedProps;if(u=u.compare,u=u!==null?u:xa,u(v,h)&&r.ref===o.ref)return ii(r,o,p)}return o.flags|=1,r=Ui(m,h),r.ref=o.ref,r.return=o,o.child=r}function Gm(r,o,u,h,p){if(r!==null){var m=r.memoizedProps;if(xa(m,h)&&r.ref===o.ref)if(xt=!1,o.pendingProps=h=m,sh(r,p))(r.flags&131072)!==0&&(xt=!0);else return o.lanes=r.lanes,ii(r,o,p)}return Zf(r,o,u,h,p)}function Jm(r,o,u){var h=o.pendingProps,p=h.children,m=(o.stateNode._pendingVisibility&2)!==0,v=r!==null?r.memoizedState:null;if(Ba(r,o),h.mode==="hidden"||m){if((o.flags&128)!==0){if(h=v!==null?v.baseLanes|u:u,r!==null){for(p=o.child=r.child,m=0;p!==null;)m=m|p.lanes|p.childLanes,p=p.sibling;o.childLanes=m&~h}else o.childLanes=0,o.child=null;return ey(r,o,h,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&yl(o,v!==null?v.cachePool:null),v!==null?tm(o,v):Ef(),nm(o);else return o.lanes=o.childLanes=536870912,ey(r,o,v!==null?v.baseLanes|u:u,u)}else v!==null?(yl(o,v.cachePool),tm(o,v),Ri(),o.memoizedState=null):(r!==null&&yl(o,null),Ef(),Ri());return Rt(r,o,p,u),o.child}function ey(r,o,u,h){var p=Of();return p=p===null?null:{parent:yt._currentValue,pool:p},o.memoizedState={baseLanes:u,cachePool:p},r!==null&&yl(o,null),Ef(),nm(o),r!==null&&Ua(r,o,h,!0),null}function Ba(r,o){var u=o.ref;if(u===null)r!==null&&r.ref!==null&&(o.flags|=2097664);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(r===null||r.ref!==u)&&(o.flags|=2097664)}}function Zf(r,o,u,h,p){return Es(o),u=Pf(r,o,u,h,void 0,p),h=Nf(),r!==null&&!xt?(Df(r,o,p),ii(r,o,p)):(Fe&&h&&xf(o),o.flags|=1,Rt(r,o,u,p),o.child)}function ty(r,o,u,h,p,m){return Es(o),o.updateQueue=null,u=om(o,h,u,p),am(r),h=Nf(),r!==null&&!xt?(Df(r,o,m),ii(r,o,m)):(Fe&&h&&xf(o),o.flags|=1,Rt(r,o,u,m),o.child)}function ny(r,o,u,h,p){if(Es(o),o.stateNode===null){var m=lr,v=u.contextType;typeof v=="object"&&v!==null&&(m=kt(v)),m=new u(h,m),o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=qf,o.stateNode=m,m._reactInternals=o,m=o.stateNode,m.props=h,m.state=o.memoizedState,m.refs={},lh(o),v=u.contextType,m.context=typeof v=="object"&&v!==null?kt(v):lr,m.state=o.memoizedState,v=u.getDerivedStateFromProps,typeof v=="function"&&(Yf(o,u,v,h),m.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&qf.enqueueReplaceState(m,m.state,null),za(o,h,m,p),Fa(),m.state=o.memoizedState),typeof m.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(r===null){m=o.stateNode;var A=o.memoizedProps,O=Ss(u,A);m.props=O;var F=m.context,te=u.contextType;v=lr,typeof te=="object"&&te!==null&&(v=kt(te));var re=u.getDerivedStateFromProps;te=typeof re=="function"||typeof m.getSnapshotBeforeUpdate=="function",A=o.pendingProps!==A,te||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(A||F!==v)&&Hm(o,m,h,v),Ii=!1;var q=o.memoizedState;m.state=q,za(o,h,m,p),Fa(),F=o.memoizedState,A||q!==F||Ii?(typeof re=="function"&&(Yf(o,u,re,h),F=o.memoizedState),(O=Ii||Vm(o,u,O,h,q,F,v))?(te||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(o.flags|=4194308)):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=F),m.props=h,m.state=F,m.context=v,h=O):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{m=o.stateNode,ch(r,o),v=o.memoizedProps,te=Ss(u,v),m.props=te,re=o.pendingProps,q=m.context,F=u.contextType,O=lr,typeof F=="object"&&F!==null&&(O=kt(F)),A=u.getDerivedStateFromProps,(F=typeof A=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==re||q!==O)&&Hm(o,m,h,O),Ii=!1,q=o.memoizedState,m.state=q,za(o,h,m,p),Fa();var G=o.memoizedState;v!==re||q!==G||Ii||r!==null&&r.dependencies!==null&&Ml(r.dependencies)?(typeof A=="function"&&(Yf(o,u,A,h),G=o.memoizedState),(te=Ii||Vm(o,u,te,h,q,G,O)||r!==null&&r.dependencies!==null&&Ml(r.dependencies))?(F||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(h,G,O),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(h,G,O)),typeof m.componentDidUpdate=="function"&&(o.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===r.memoizedProps&&q===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&q===r.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=G),m.props=h,m.state=G,m.context=O,h=te):(typeof m.componentDidUpdate!="function"||v===r.memoizedProps&&q===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&q===r.memoizedState||(o.flags|=1024),h=!1)}return m=h,Ba(r,o),h=(o.flags&128)!==0,m||h?(m=o.stateNode,u=h&&typeof u.getDerivedStateFromError!="function"?null:m.render(),o.flags|=1,r!==null&&h?(o.child=bs(o,r.child,null,p),o.child=bs(o,null,u,p)):Rt(r,o,u,p),o.memoizedState=m.state,r=o.child):r=ii(r,o,p),r}function iy(r,o,u,h){return wa(),o.flags|=256,Rt(r,o,u,h),o.child}var Qf={dehydrated:null,treeContext:null,retryLane:0};function Gf(r){return{baseLanes:r,cachePool:rm()}}function Jf(r,o,u){return r=r!==null?r.childLanes&~u:0,o&&(r|=_n),r}function sy(r,o,u){var h=o.pendingProps,p=!1,m=(o.flags&128)!==0,v;if((v=m)||(v=r!==null&&r.memoizedState===null?!1:(mt.current&2)!==0),v&&(p=!0,o.flags&=-129),v=(o.flags&32)!==0,o.flags&=-33,r===null){if(Fe){if(p?Ei(o):Ri(),Fe){var A=Et,O;if(O=A){e:{for(O=A,A=Ln;O.nodeType!==8;){if(!A){A=null;break e}if(O=Cn(O.nextSibling),O===null){A=null;break e}}A=O}A!==null?(o.memoizedState={dehydrated:A,treeContext:_s!==null?{id:Jn,overflow:ei}:null,retryLane:536870912},O=pn(18,null,null,0),O.stateNode=A,O.return=o,o.child=O,Ht=o,Et=null,O=!0):O=!1}O||ys(o)}if(A=o.memoizedState,A!==null&&(A=A.dehydrated,A!==null))return A.data==="$!"?o.lanes=16:o.lanes=536870912,null;ti(o)}return A=h.children,h=h.fallback,p?(Ri(),p=o.mode,A=th({mode:"hidden",children:A},p),h=Cs(h,p,u,null),A.return=o,h.return=o,A.sibling=h,o.child=A,p=o.child,p.memoizedState=Gf(u),p.childLanes=Jf(r,v,u),o.memoizedState=Qf,h):(Ei(o),eh(o,A))}if(O=r.memoizedState,O!==null&&(A=O.dehydrated,A!==null)){if(m)o.flags&256?(Ei(o),o.flags&=-257,o=nh(r,o,u)):o.memoizedState!==null?(Ri(),o.child=r.child,o.flags|=128,o=null):(Ri(),p=h.fallback,A=o.mode,h=th({mode:"visible",children:h.children},A),p=Cs(p,A,u,null),p.flags|=2,h.return=o,p.return=o,h.sibling=p,o.child=h,bs(o,r.child,null,u),h=o.child,h.memoizedState=Gf(u),h.childLanes=Jf(r,v,u),o.memoizedState=Qf,o=p);else if(Ei(o),A.data==="$!"){if(v=A.nextSibling&&A.nextSibling.dataset,v)var F=v.dgst;v=F,h=Error(i(419)),h.stack="",h.digest=v,Ea({value:h,source:null,stack:null}),o=nh(r,o,u)}else if(xt||Ua(r,o,u,!1),v=(u&r.childLanes)!==0,xt||v){if(v=Qe,v!==null){if(h=u&-u,(h&42)!==0)h=1;else switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=64;break;case 268435456:h=134217728;break;default:h=0}if(h=(h&(v.suspendedLanes|u))!==0?0:h,h!==0&&h!==O.retryLane)throw O.retryLane=h,wi(r,h),Wt(v,r,h),Km}A.data==="$?"||Oh(),o=nh(r,o,u)}else A.data==="$?"?(o.flags|=128,o.child=r.child,o=oA.bind(null,r),A._reactRetry=o,o=null):(r=O.treeContext,Et=Cn(A.nextSibling),Ht=o,Fe=!0,En=null,Ln=!1,r!==null&&(un[fn++]=Jn,un[fn++]=ei,un[fn++]=_s,Jn=r.id,ei=r.overflow,_s=o),o=eh(o,h.children),o.flags|=4096);return o}return p?(Ri(),p=h.fallback,A=o.mode,O=r.child,F=O.sibling,h=Ui(O,{mode:"hidden",children:h.children}),h.subtreeFlags=O.subtreeFlags&31457280,F!==null?p=Ui(F,p):(p=Cs(p,A,u,null),p.flags|=2),p.return=o,h.return=o,h.sibling=p,o.child=h,h=p,p=o.child,A=r.child.memoizedState,A===null?A=Gf(u):(O=A.cachePool,O!==null?(F=yt._currentValue,O=O.parent!==F?{parent:F,pool:F}:O):O=rm(),A={baseLanes:A.baseLanes|u,cachePool:O}),p.memoizedState=A,p.childLanes=Jf(r,v,u),o.memoizedState=Qf,h):(Ei(o),u=r.child,r=u.sibling,u=Ui(u,{mode:"visible",children:h.children}),u.return=o,u.sibling=null,r!==null&&(v=o.deletions,v===null?(o.deletions=[r],o.flags|=16):v.push(r)),o.child=u,o.memoizedState=null,u)}function eh(r,o){return o=th({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function th(r,o){return Oy(r,o,0,null)}function nh(r,o,u){return bs(o,r.child,null,u),r=eh(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function ry(r,o,u){r.lanes|=o;var h=r.alternate;h!==null&&(h.lanes|=o),ah(r.return,o,u)}function ih(r,o,u,h,p){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:p}:(m.isBackwards=o,m.rendering=null,m.renderingStartTime=0,m.last=h,m.tail=u,m.tailMode=p)}function ay(r,o,u){var h=o.pendingProps,p=h.revealOrder,m=h.tail;if(Rt(r,o,h.children,u),h=mt.current,(h&2)!==0)h=h&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&ry(r,u,o);else if(r.tag===19)ry(r,u,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}h&=1}switch(Te(mt,h),p){case"forwards":for(u=o.child,p=null;u!==null;)r=u.alternate,r!==null&&ml(r)===null&&(p=u),u=u.sibling;u=p,u===null?(p=o.child,o.child=null):(p=u.sibling,u.sibling=null),ih(o,!1,p,u,m);break;case"backwards":for(u=null,p=o.child,o.child=null;p!==null;){if(r=p.alternate,r!==null&&ml(r)===null){o.child=p;break}r=p.sibling,p.sibling=u,u=p,p=r}ih(o,!0,u,null,m);break;case"together":ih(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ii(r,o,u){if(r!==null&&(o.dependencies=r.dependencies),Li|=o.lanes,(u&o.childLanes)===0)if(r!==null){if(Ua(r,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(i(153));if(o.child!==null){for(r=o.child,u=Ui(r,r.pendingProps),o.child=u,u.return=o;r.sibling!==null;)r=r.sibling,u=u.sibling=Ui(r,r.pendingProps),u.return=o;u.sibling=null}return o.child}function sh(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Ml(r)))}function Yx(r,o,u){switch(o.tag){case 3:ke(o,o.stateNode.containerInfo),Oi(o,yt,r.memoizedState.cache),wa();break;case 27:case 5:Yu(o);break;case 4:ke(o,o.stateNode.containerInfo);break;case 10:Oi(o,o.type,o.memoizedProps.value);break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(Ei(o),o.flags|=128,null):(u&o.child.childLanes)!==0?sy(r,o,u):(Ei(o),r=ii(r,o,u),r!==null?r.sibling:null);Ei(o);break;case 19:var p=(r.flags&128)!==0;if(h=(u&o.childLanes)!==0,h||(Ua(r,o,u,!1),h=(u&o.childLanes)!==0),p){if(h)return ay(r,o,u);o.flags|=128}if(p=o.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Te(mt,mt.current),h)break;return null;case 22:case 23:return o.lanes=0,Jm(r,o,u);case 24:Oi(o,yt,r.memoizedState.cache)}return ii(r,o,u)}function oy(r,o,u){if(r!==null)if(r.memoizedProps!==o.pendingProps)xt=!0;else{if(!sh(r,u)&&(o.flags&128)===0)return xt=!1,Yx(r,o,u);xt=(r.flags&131072)!==0}else xt=!1,Fe&&(o.flags&1048576)!==0&&$_(o,hl,o.index);switch(o.lanes=0,o.tag){case 16:e:{r=o.pendingProps;var h=o.elementType,p=h._init;if(h=p(h._payload),o.type=h,typeof h=="function")yh(h)?(r=Ss(h,r),o.tag=1,o=ny(null,o,h,r,u)):(o.tag=0,o=Zf(null,o,h,r,u));else{if(h!=null){if(p=h.$$typeof,p===x){o.tag=11,o=Zm(null,o,h,r,u);break e}else if(p===N){o.tag=14,o=Qm(null,o,h,r,u);break e}}throw o=ue(h)||h,Error(i(306,o,""))}}return o;case 0:return Zf(r,o,o.type,o.pendingProps,u);case 1:return h=o.type,p=Ss(h,o.pendingProps),ny(r,o,h,p,u);case 3:e:{if(ke(o,o.stateNode.containerInfo),r===null)throw Error(i(387));var m=o.pendingProps;p=o.memoizedState,h=p.element,ch(r,o),za(o,m,null,u);var v=o.memoizedState;if(m=v.cache,Oi(o,yt,m),m!==p.cache&&oh(o,[yt],u,!0),Fa(),m=v.element,p.isDehydrated)if(p={element:m,isDehydrated:!1,cache:v.cache},o.updateQueue.baseState=p,o.memoizedState=p,o.flags&256){o=iy(r,o,m,u);break e}else if(m!==h){h=cn(Error(i(424)),o),Ea(h),o=iy(r,o,m,u);break e}else for(Et=Cn(o.stateNode.containerInfo.firstChild),Ht=o,Fe=!0,En=null,Ln=!0,u=em(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(wa(),m===h){o=ii(r,o,u);break e}Rt(r,o,m,u)}o=o.child}return o;case 26:return Ba(r,o),r===null?(u=u0(o.type,null,o.pendingProps,null))?o.memoizedState=u:Fe||(u=o.type,r=o.pendingProps,h=$l(Sn.current).createElement(u),h[Dt]=o,h[Xt]=r,Ct(h,u,r),Tt(h),o.stateNode=h):o.memoizedState=u0(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Yu(o),r===null&&Fe&&(h=o.stateNode=o0(o.type,o.pendingProps,Sn.current),Ht=o,Ln=!0,Et=Cn(h.firstChild)),h=o.pendingProps.children,r!==null||Fe?Rt(r,o,h,u):o.child=bs(o,null,h,u),Ba(r,o),o.child;case 5:return r===null&&Fe&&((p=h=Et)&&(h=AA(h,o.type,o.pendingProps,Ln),h!==null?(o.stateNode=h,Ht=o,Et=Cn(h.firstChild),Ln=!1,p=!0):p=!1),p||ys(o)),Yu(o),p=o.type,m=o.pendingProps,v=r!==null?r.memoizedProps:null,h=m.children,jh(p,m)?h=null:v!==null&&jh(p,v)&&(o.flags|=32),o.memoizedState!==null&&(p=Pf(r,o,zx,null,null,u),to._currentValue=p),Ba(r,o),Rt(r,o,h,u),o.child;case 6:return r===null&&Fe&&((r=u=Et)&&(u=SA(u,o.pendingProps,Ln),u!==null?(o.stateNode=u,Ht=o,Et=null,r=!0):r=!1),r||ys(o)),null;case 13:return sy(r,o,u);case 4:return ke(o,o.stateNode.containerInfo),h=o.pendingProps,r===null?o.child=bs(o,null,h,u):Rt(r,o,h,u),o.child;case 11:return Zm(r,o,o.type,o.pendingProps,u);case 7:return Rt(r,o,o.pendingProps,u),o.child;case 8:return Rt(r,o,o.pendingProps.children,u),o.child;case 12:return Rt(r,o,o.pendingProps.children,u),o.child;case 10:return h=o.pendingProps,Oi(o,o.type,h.value),Rt(r,o,h.children,u),o.child;case 9:return p=o.type._context,h=o.pendingProps.children,Es(o),p=kt(p),h=h(p),o.flags|=1,Rt(r,o,h,u),o.child;case 14:return Qm(r,o,o.type,o.pendingProps,u);case 15:return Gm(r,o,o.type,o.pendingProps,u);case 19:return ay(r,o,u);case 22:return Jm(r,o,u);case 24:return Es(o),h=kt(yt),r===null?(p=Of(),p===null&&(p=Qe,m=Cf(),p.pooledCache=m,m.refCount++,m!==null&&(p.pooledCacheLanes|=u),p=m),o.memoizedState={parent:h,cache:p},lh(o),Oi(o,yt,p)):((r.lanes&u)!==0&&(ch(r,o),za(o,null,null,u),Fa()),p=r.memoizedState,m=o.memoizedState,p.parent!==h?(p={parent:h,cache:h},o.memoizedState=p,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=p),Oi(o,yt,h)):(h=m.cache,Oi(o,yt,h),h!==p.cache&&oh(o,[yt],u,!0))),Rt(r,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}var rh=_e(null),ws=null,si=null;function Oi(r,o,u){Te(rh,o._currentValue),o._currentValue=u}function ri(r){r._currentValue=rh.current,Ie(rh)}function ah(r,o,u){for(;r!==null;){var h=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),r===u)break;r=r.return}}function oh(r,o,u,h){var p=r.child;for(p!==null&&(p.return=r);p!==null;){var m=p.dependencies;if(m!==null){var v=p.child;m=m.firstContext;e:for(;m!==null;){var A=m;m=p;for(var O=0;O<o.length;O++)if(A.context===o[O]){m.lanes|=u,A=m.alternate,A!==null&&(A.lanes|=u),ah(m.return,u,r),h||(v=null);break e}m=A.next}}else if(p.tag===18){if(v=p.return,v===null)throw Error(i(341));v.lanes|=u,m=v.alternate,m!==null&&(m.lanes|=u),ah(v,u,r),v=null}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===r){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}}function Ua(r,o,u,h){r=null;for(var p=o,m=!1;p!==null;){if(!m){if((p.flags&524288)!==0)m=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var v=p.alternate;if(v===null)throw Error(i(387));if(v=v.memoizedProps,v!==null){var A=p.type;Gt(p.pendingProps.value,v.value)||(r!==null?r.push(A):r=[A])}}else if(p===cs.current){if(v=p.alternate,v===null)throw Error(i(387));v.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(r!==null?r.push(to):r=[to])}p=p.return}r!==null&&oh(o,r,u,h),o.flags|=262144}function Ml(r){for(r=r.firstContext;r!==null;){if(!Gt(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Es(r){ws=r,si=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function kt(r){return ly(ws,r)}function Ol(r,o){return ws===null&&Es(r),ly(r,o)}function ly(r,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},si===null){if(r===null)throw Error(i(308));si=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else si=si.next=o;return u}var Ii=!1;function lh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ch(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Pi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ni(r,o,u){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,(nt&2)!==0){var p=h.pending;return p===null?o.next=o:(o.next=p.next,p.next=o),h.pending=o,o=ul(r),W_(r,null,u),o}return cl(r,h,o,u),ul(r)}function La(r,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194176)!==0)){var h=o.lanes;h&=r.pendingLanes,u|=h,o.lanes=u,Qp(r,u)}}function uh(r,o){var u=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,u===h)){var p=null,m=null;if(u=u.firstBaseUpdate,u!==null){do{var v={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};m===null?p=m=v:m=m.next=v,u=u.next}while(u!==null);m===null?p=m=o:m=m.next=o}else p=m=o;u={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:h.shared,callbacks:h.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=o:r.next=o,u.lastBaseUpdate=o}var fh=!1;function Fa(){if(fh){var r=gr;if(r!==null)throw r}}function za(r,o,u,h){fh=!1;var p=r.updateQueue;Ii=!1;var m=p.firstBaseUpdate,v=p.lastBaseUpdate,A=p.shared.pending;if(A!==null){p.shared.pending=null;var O=A,F=O.next;O.next=null,v===null?m=F:v.next=F,v=O;var te=r.alternate;te!==null&&(te=te.updateQueue,A=te.lastBaseUpdate,A!==v&&(A===null?te.firstBaseUpdate=F:A.next=F,te.lastBaseUpdate=O))}if(m!==null){var re=p.baseState;v=0,te=F=O=null,A=m;do{var q=A.lane&-536870913,G=q!==A.lane;if(G?(Ue&q)===q:(h&q)===q){q!==0&&q===dr&&(fh=!0),te!==null&&(te=te.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var me=r,we=A;q=o;var at=u;switch(we.tag){case 1:if(me=we.payload,typeof me=="function"){re=me.call(at,re,q);break e}re=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=we.payload,q=typeof me=="function"?me.call(at,re,q):me,q==null)break e;re=oe({},re,q);break e;case 2:Ii=!0}}q=A.callback,q!==null&&(r.flags|=64,G&&(r.flags|=8192),G=p.callbacks,G===null?p.callbacks=[q]:G.push(q))}else G={lane:q,tag:A.tag,payload:A.payload,callback:A.callback,next:null},te===null?(F=te=G,O=re):te=te.next=G,v|=q;if(A=A.next,A===null){if(A=p.shared.pending,A===null)break;G=A,A=G.next,G.next=null,p.lastBaseUpdate=G,p.shared.pending=null}}while(!0);te===null&&(O=re),p.baseState=O,p.firstBaseUpdate=F,p.lastBaseUpdate=te,m===null&&(p.shared.lanes=0),Li|=v,r.lanes=v,r.memoizedState=re}}function cy(r,o){if(typeof r!="function")throw Error(i(191,r));r.call(o)}function uy(r,o){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)cy(u[r],o)}function Va(r,o){try{var u=o.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var p=h.next;u=p;do{if((u.tag&r)===r){h=void 0;var m=u.create,v=u.inst;h=m(),v.destroy=h}u=u.next}while(u!==p)}}catch(A){qe(o,o.return,A)}}function Di(r,o,u){try{var h=o.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var m=p.next;h=m;do{if((h.tag&r)===r){var v=h.inst,A=v.destroy;if(A!==void 0){v.destroy=void 0,p=o;var O=u;try{A()}catch(F){qe(p,O,F)}}}h=h.next}while(h!==m)}}catch(F){qe(o,o.return,F)}}function fy(r){var o=r.updateQueue;if(o!==null){var u=r.stateNode;try{uy(o,u)}catch(h){qe(r,r.return,h)}}}function hy(r,o,u){u.props=Ss(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(h){qe(r,o,h)}}function Rs(r,o){try{var u=r.ref;if(u!==null){var h=r.stateNode;switch(r.tag){case 26:case 27:case 5:var p=h;break;default:p=h}typeof u=="function"?r.refCleanup=u(p):u.current=p}}catch(m){qe(r,o,m)}}function Jt(r,o){var u=r.ref,h=r.refCleanup;if(u!==null)if(typeof h=="function")try{h()}catch(p){qe(r,o,p)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){qe(r,o,p)}else u.current=null}function dy(r){var o=r.type,u=r.memoizedProps,h=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&h.focus();break e;case"img":u.src?h.src=u.src:u.srcSet&&(h.srcset=u.srcSet)}}catch(p){qe(r,r.return,p)}}function gy(r,o,u){try{var h=r.stateNode;yA(h,r.type,u,o),h[Xt]=o}catch(p){qe(r,r.return,p)}}function py(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27||r.tag===4}function hh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||py(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==27&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function dh(r,o,u){var h=r.tag;if(h===5||h===6)r=r.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(r,o):u.insertBefore(r,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(r,u)):(o=u,o.appendChild(r)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=jl));else if(h!==4&&h!==27&&(r=r.child,r!==null))for(dh(r,o,u),r=r.sibling;r!==null;)dh(r,o,u),r=r.sibling}function Il(r,o,u){var h=r.tag;if(h===5||h===6)r=r.stateNode,o?u.insertBefore(r,o):u.appendChild(r);else if(h!==4&&h!==27&&(r=r.child,r!==null))for(Il(r,o,u),r=r.sibling;r!==null;)Il(r,o,u),r=r.sibling}var ai=!1,st=!1,gh=!1,_y=typeof WeakSet=="function"?WeakSet:Set,At=null,my=!1;function qx(r,o){if(r=r.containerInfo,Hh=Ql,r=D_(r),_f(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var h=u.getSelection&&u.getSelection();if(h&&h.rangeCount!==0){u=h.anchorNode;var p=h.anchorOffset,m=h.focusNode;h=h.focusOffset;try{u.nodeType,m.nodeType}catch{u=null;break e}var v=0,A=-1,O=-1,F=0,te=0,re=r,q=null;t:for(;;){for(var G;re!==u||p!==0&&re.nodeType!==3||(A=v+p),re!==m||h!==0&&re.nodeType!==3||(O=v+h),re.nodeType===3&&(v+=re.nodeValue.length),(G=re.firstChild)!==null;)q=re,re=G;for(;;){if(re===r)break t;if(q===u&&++F===p&&(A=v),q===m&&++te===h&&(O=v),(G=re.nextSibling)!==null)break;re=q,q=re.parentNode}re=G}u=A===-1||O===-1?null:{start:A,end:O}}else u=null}u=u||{start:0,end:0}}else u=null;for(Wh={focusedElem:r,selectionRange:u},Ql=!1,At=o;At!==null;)if(o=At,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,At=r;else for(;At!==null;){switch(o=At,m=o.alternate,r=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&m!==null){r=void 0,u=o,p=m.memoizedProps,m=m.memoizedState,h=u.stateNode;try{var me=Ss(u.type,p,u.elementType===u.type);r=h.getSnapshotBeforeUpdate(me,m),h.__reactInternalSnapshotBeforeUpdate=r}catch(we){qe(u,u.return,we)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,u=r.nodeType,u===9)Yh(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Yh(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=o.sibling,r!==null){r.return=o.return,At=r;break}At=o.return}return me=my,my=!1,me}function yy(r,o,u){var h=u.flags;switch(u.tag){case 0:case 11:case 15:li(r,u),h&4&&Va(5,u);break;case 1:if(li(r,u),h&4)if(r=u.stateNode,o===null)try{r.componentDidMount()}catch(A){qe(u,u.return,A)}else{var p=Ss(u.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(p,o,r.__reactInternalSnapshotBeforeUpdate)}catch(A){qe(u,u.return,A)}}h&64&&fy(u),h&512&&Rs(u,u.return);break;case 3:if(li(r,u),h&64&&(h=u.updateQueue,h!==null)){if(r=null,u.child!==null)switch(u.child.tag){case 27:case 5:r=u.child.stateNode;break;case 1:r=u.child.stateNode}try{uy(h,r)}catch(A){qe(u,u.return,A)}}break;case 26:li(r,u),h&512&&Rs(u,u.return);break;case 27:case 5:li(r,u),o===null&&h&4&&dy(u),h&512&&Rs(u,u.return);break;case 12:li(r,u);break;case 13:li(r,u),h&4&&Ty(r,u);break;case 22:if(p=u.memoizedState!==null||ai,!p){o=o!==null&&o.memoizedState!==null||st;var m=ai,v=st;ai=p,(st=o)&&!v?ki(r,u,(u.subtreeFlags&8772)!==0):li(r,u),ai=m,st=v}h&512&&(u.memoizedProps.mode==="manual"?Rs(u,u.return):Jt(u,u.return));break;default:li(r,u)}}function by(r){var o=r.alternate;o!==null&&(r.alternate=null,by(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Ju(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var dt=null,en=!1;function oi(r,o,u){for(u=u.child;u!==null;)vy(r,o,u),u=u.sibling}function vy(r,o,u){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(ua,u)}catch{}switch(u.tag){case 26:st||Jt(u,o),oi(r,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:st||Jt(u,o);var h=dt,p=en;for(dt=u.stateNode,oi(r,o,u),u=u.stateNode,o=u.attributes;o.length;)u.removeAttributeNode(o[0]);Ju(u),dt=h,en=p;break;case 5:st||Jt(u,o);case 6:p=dt;var m=en;if(dt=null,oi(r,o,u),dt=p,en=m,dt!==null)if(en)try{r=dt,h=u.stateNode,r.nodeType===8?r.parentNode.removeChild(h):r.removeChild(h)}catch(v){qe(u,o,v)}else try{dt.removeChild(u.stateNode)}catch(v){qe(u,o,v)}break;case 18:dt!==null&&(en?(o=dt,u=u.stateNode,o.nodeType===8?Xh(o.parentNode,u):o.nodeType===1&&Xh(o,u),ro(o)):Xh(dt,u.stateNode));break;case 4:h=dt,p=en,dt=u.stateNode.containerInfo,en=!0,oi(r,o,u),dt=h,en=p;break;case 0:case 11:case 14:case 15:st||Di(2,u,o),st||Di(4,u,o),oi(r,o,u);break;case 1:st||(Jt(u,o),h=u.stateNode,typeof h.componentWillUnmount=="function"&&hy(u,o,h)),oi(r,o,u);break;case 21:oi(r,o,u);break;case 22:st||Jt(u,o),st=(h=st)||u.memoizedState!==null,oi(r,o,u),st=h;break;default:oi(r,o,u)}}function Ty(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{ro(r)}catch(u){qe(o,o.return,u)}}function Kx(r){switch(r.tag){case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new _y),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new _y),o;default:throw Error(i(435,r.tag))}}function ph(r,o){var u=Kx(r);o.forEach(function(h){var p=lA.bind(null,r,h);u.has(h)||(u.add(h),h.then(p,p))})}function dn(r,o){var u=o.deletions;if(u!==null)for(var h=0;h<u.length;h++){var p=u[h],m=r,v=o,A=v;e:for(;A!==null;){switch(A.tag){case 27:case 5:dt=A.stateNode,en=!1;break e;case 3:dt=A.stateNode.containerInfo,en=!0;break e;case 4:dt=A.stateNode.containerInfo,en=!0;break e}A=A.return}if(dt===null)throw Error(i(160));vy(m,v,p),dt=null,en=!1,m=p.alternate,m!==null&&(m.return=null),p.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)xy(o,r),o=o.sibling}var Rn=null;function xy(r,o){var u=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:dn(o,r),gn(r),h&4&&(Di(3,r,r.return),Va(3,r),Di(5,r,r.return));break;case 1:dn(o,r),gn(r),h&512&&(st||u===null||Jt(u,u.return)),h&64&&ai&&(r=r.updateQueue,r!==null&&(h=r.callbacks,h!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?h:u.concat(h))));break;case 26:var p=Rn;if(dn(o,r),gn(r),h&512&&(st||u===null||Jt(u,u.return)),h&4){var m=u!==null?u.memoizedState:null;if(h=r.memoizedState,u===null)if(h===null)if(r.stateNode===null){e:{h=r.type,u=r.memoizedProps,p=p.ownerDocument||p;t:switch(h){case"title":m=p.getElementsByTagName("title")[0],(!m||m[da]||m[Dt]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=p.createElement(h),p.head.insertBefore(m,p.querySelector("head > title"))),Ct(m,h,u),m[Dt]=r,Tt(m),h=m;break e;case"link":var v=d0("link","href",p).get(h+(u.href||""));if(v){for(var A=0;A<v.length;A++)if(m=v[A],m.getAttribute("href")===(u.href==null?null:u.href)&&m.getAttribute("rel")===(u.rel==null?null:u.rel)&&m.getAttribute("title")===(u.title==null?null:u.title)&&m.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){v.splice(A,1);break t}}m=p.createElement(h),Ct(m,h,u),p.head.appendChild(m);break;case"meta":if(v=d0("meta","content",p).get(h+(u.content||""))){for(A=0;A<v.length;A++)if(m=v[A],m.getAttribute("content")===(u.content==null?null:""+u.content)&&m.getAttribute("name")===(u.name==null?null:u.name)&&m.getAttribute("property")===(u.property==null?null:u.property)&&m.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&m.getAttribute("charset")===(u.charSet==null?null:u.charSet)){v.splice(A,1);break t}}m=p.createElement(h),Ct(m,h,u),p.head.appendChild(m);break;default:throw Error(i(468,h))}m[Dt]=r,Tt(m),h=m}r.stateNode=h}else g0(p,r.type,r.stateNode);else r.stateNode=h0(p,h,r.memoizedProps);else m!==h?(m===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):m.count--,h===null?g0(p,r.type,r.stateNode):h0(p,h,r.memoizedProps)):h===null&&r.stateNode!==null&&gy(r,r.memoizedProps,u.memoizedProps)}break;case 27:if(h&4&&r.alternate===null){p=r.stateNode,m=r.memoizedProps;try{for(var O=p.firstChild;O;){var F=O.nextSibling,te=O.nodeName;O[da]||te==="HEAD"||te==="BODY"||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&O.rel.toLowerCase()==="stylesheet"||p.removeChild(O),O=F}for(var re=r.type,q=p.attributes;q.length;)p.removeAttributeNode(q[0]);Ct(p,re,m),p[Dt]=r,p[Xt]=m}catch(me){qe(r,r.return,me)}}case 5:if(dn(o,r),gn(r),h&512&&(st||u===null||Jt(u,u.return)),r.flags&32){p=r.stateNode;try{tr(p,"")}catch(me){qe(r,r.return,me)}}h&4&&r.stateNode!=null&&(p=r.memoizedProps,gy(r,p,u!==null?u.memoizedProps:p)),h&1024&&(gh=!0);break;case 6:if(dn(o,r),gn(r),h&4){if(r.stateNode===null)throw Error(i(162));h=r.memoizedProps,u=r.stateNode;try{u.nodeValue=h}catch(me){qe(r,r.return,me)}}break;case 3:if(ql=null,p=Rn,Rn=Xl(o.containerInfo),dn(o,r),Rn=p,gn(r),h&4&&u!==null&&u.memoizedState.isDehydrated)try{ro(o.containerInfo)}catch(me){qe(r,r.return,me)}gh&&(gh=!1,Ay(r));break;case 4:h=Rn,Rn=Xl(r.stateNode.containerInfo),dn(o,r),gn(r),Rn=h;break;case 12:dn(o,r),gn(r);break;case 13:dn(o,r),gn(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Sh=Un()),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,ph(r,h)));break;case 22:if(h&512&&(st||u===null||Jt(u,u.return)),O=r.memoizedState!==null,F=u!==null&&u.memoizedState!==null,te=ai,re=st,ai=te||O,st=re||F,dn(o,r),st=re,ai=te,gn(r),o=r.stateNode,o._current=r,o._visibility&=-3,o._visibility|=o._pendingVisibility&2,h&8192&&(o._visibility=O?o._visibility&-2:o._visibility|1,O&&(o=ai||st,u===null||F||o||yr(r)),r.memoizedProps===null||r.memoizedProps.mode!=="manual"))e:for(u=null,o=r;;){if(o.tag===5||o.tag===26||o.tag===27){if(u===null){F=u=o;try{if(p=F.stateNode,O)m=p.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none";else{v=F.stateNode,A=F.memoizedProps.style;var G=A!=null&&A.hasOwnProperty("display")?A.display:null;v.style.display=G==null||typeof G=="boolean"?"":(""+G).trim()}}catch(me){qe(F,F.return,me)}}}else if(o.tag===6){if(u===null){F=o;try{F.stateNode.nodeValue=O?"":F.memoizedProps}catch(me){qe(F,F.return,me)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=r.updateQueue,h!==null&&(u=h.retryQueue,u!==null&&(h.retryQueue=null,ph(r,u))));break;case 19:dn(o,r),gn(r),h&4&&(h=r.updateQueue,h!==null&&(r.updateQueue=null,ph(r,h)));break;case 21:break;default:dn(o,r),gn(r)}}function gn(r){var o=r.flags;if(o&2){try{if(r.tag!==27){e:{for(var u=r.return;u!==null;){if(py(u)){var h=u;break e}u=u.return}throw Error(i(160))}switch(h.tag){case 27:var p=h.stateNode,m=hh(r);Il(r,m,p);break;case 5:var v=h.stateNode;h.flags&32&&(tr(v,""),h.flags&=-33);var A=hh(r);Il(r,A,v);break;case 3:case 4:var O=h.stateNode.containerInfo,F=hh(r);dh(r,F,O);break;default:throw Error(i(161))}}}catch(te){qe(r,r.return,te)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function Ay(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;Ay(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function li(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)yy(r,o.alternate,o),o=o.sibling}function yr(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Di(4,o,o.return),yr(o);break;case 1:Jt(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&hy(o,o.return,u),yr(o);break;case 26:case 27:case 5:Jt(o,o.return),yr(o);break;case 22:Jt(o,o.return),o.memoizedState===null&&yr(o);break;default:yr(o)}r=r.sibling}}function ki(r,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,p=r,m=o,v=m.flags;switch(m.tag){case 0:case 11:case 15:ki(p,m,u),Va(4,m);break;case 1:if(ki(p,m,u),h=m,p=h.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(F){qe(h,h.return,F)}if(h=m,p=h.updateQueue,p!==null){var A=h.stateNode;try{var O=p.shared.hiddenCallbacks;if(O!==null)for(p.shared.hiddenCallbacks=null,p=0;p<O.length;p++)cy(O[p],A)}catch(F){qe(h,h.return,F)}}u&&v&64&&fy(m),Rs(m,m.return);break;case 26:case 27:case 5:ki(p,m,u),u&&h===null&&v&4&&dy(m),Rs(m,m.return);break;case 12:ki(p,m,u);break;case 13:ki(p,m,u),u&&v&4&&Ty(p,m);break;case 22:m.memoizedState===null&&ki(p,m,u),Rs(m,m.return);break;default:ki(p,m,u)}o=o.sibling}}function _h(r,o){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&Ia(u))}function mh(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Ia(r))}function Bi(r,o,u,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Sy(r,o,u,h),o=o.sibling}function Sy(r,o,u,h){var p=o.flags;switch(o.tag){case 0:case 11:case 15:Bi(r,o,u,h),p&2048&&Va(9,o);break;case 3:Bi(r,o,u,h),p&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Ia(r)));break;case 12:if(p&2048){Bi(r,o,u,h),r=o.stateNode;try{var m=o.memoizedProps,v=m.id,A=m.onPostCommit;typeof A=="function"&&A(v,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(O){qe(o,o.return,O)}}else Bi(r,o,u,h);break;case 23:break;case 22:m=o.stateNode,o.memoizedState!==null?m._visibility&4?Bi(r,o,u,h):Ha(r,o):m._visibility&4?Bi(r,o,u,h):(m._visibility|=4,br(r,o,u,h,(o.subtreeFlags&10256)!==0)),p&2048&&_h(o.alternate,o);break;case 24:Bi(r,o,u,h),p&2048&&mh(o.alternate,o);break;default:Bi(r,o,u,h)}}function br(r,o,u,h,p){for(p=p&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var m=r,v=o,A=u,O=h,F=v.flags;switch(v.tag){case 0:case 11:case 15:br(m,v,A,O,p),Va(8,v);break;case 23:break;case 22:var te=v.stateNode;v.memoizedState!==null?te._visibility&4?br(m,v,A,O,p):Ha(m,v):(te._visibility|=4,br(m,v,A,O,p)),p&&F&2048&&_h(v.alternate,v);break;case 24:br(m,v,A,O,p),p&&F&2048&&mh(v.alternate,v);break;default:br(m,v,A,O,p)}o=o.sibling}}function Ha(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=r,h=o,p=h.flags;switch(h.tag){case 22:Ha(u,h),p&2048&&_h(h.alternate,h);break;case 24:Ha(u,h),p&2048&&mh(h.alternate,h);break;default:Ha(u,h)}o=o.sibling}}var Wa=8192;function vr(r){if(r.subtreeFlags&Wa)for(r=r.child;r!==null;)wy(r),r=r.sibling}function wy(r){switch(r.tag){case 26:vr(r),r.flags&Wa&&r.memoizedState!==null&&UA(Rn,r.memoizedState,r.memoizedProps);break;case 5:vr(r);break;case 3:case 4:var o=Rn;Rn=Xl(r.stateNode.containerInfo),vr(r),Rn=o;break;case 22:r.memoizedState===null&&(o=r.alternate,o!==null&&o.memoizedState!==null?(o=Wa,Wa=16777216,vr(r),Wa=o):vr(r));break;default:vr(r)}}function Ey(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function ja(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];At=h,Cy(h,r)}Ey(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ry(r),r=r.sibling}function Ry(r){switch(r.tag){case 0:case 11:case 15:ja(r),r.flags&2048&&Di(9,r,r.return);break;case 3:ja(r);break;case 12:ja(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&4&&(r.return===null||r.return.tag!==13)?(o._visibility&=-5,Pl(r)):ja(r);break;default:ja(r)}}function Pl(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];At=h,Cy(h,r)}Ey(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Di(8,o,o.return),Pl(o);break;case 22:u=o.stateNode,u._visibility&4&&(u._visibility&=-5,Pl(o));break;default:Pl(o)}r=r.sibling}}function Cy(r,o){for(;At!==null;){var u=At;switch(u.tag){case 0:case 11:case 15:Di(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var h=u.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Ia(u.memoizedState.cache)}if(h=u.child,h!==null)h.return=u,At=h;else e:for(u=r;At!==null;){h=At;var p=h.sibling,m=h.return;if(by(h),h===u){At=null;break e}if(p!==null){p.return=m,At=p;break e}At=m}}}function Zx(r,o,u,h){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pn(r,o,u,h){return new Zx(r,o,u,h)}function yh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Ui(r,o){var u=r.alternate;return u===null?(u=pn(r.tag,o,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=o,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&31457280,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,o=r.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function My(r,o){r.flags&=31457282;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,o=u.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Nl(r,o,u,h,p,m){var v=0;if(h=r,typeof r=="function")yh(r)&&(v=1);else if(typeof r=="string")v=kA(r,u,Nt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case f:return Cs(u.children,p,m,o);case d:v=8,p|=24;break;case g:return r=pn(12,u,o,p|2),r.elementType=g,r.lanes=m,r;case E:return r=pn(13,u,o,p),r.elementType=E,r.lanes=m,r;case M:return r=pn(19,u,o,p),r.elementType=M,r.lanes=m,r;case P:return Oy(u,p,m,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case _:case b:v=10;break e;case y:v=9;break e;case x:v=11;break e;case N:v=14;break e;case V:v=16,h=null;break e}v=29,u=Error(i(130,r===null?"null":typeof r,"")),h=null}return o=pn(v,u,o,p),o.elementType=r,o.type=h,o.lanes=m,o}function Cs(r,o,u,h){return r=pn(7,r,h,o),r.lanes=u,r}function Oy(r,o,u,h){r=pn(22,r,h,o),r.elementType=P,r.lanes=u;var p={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var m=p._current;if(m===null)throw Error(i(456));if((p._pendingVisibility&2)===0){var v=wi(m,2);v!==null&&(p._pendingVisibility|=2,Wt(v,m,2))}},attach:function(){var m=p._current;if(m===null)throw Error(i(456));if((p._pendingVisibility&2)!==0){var v=wi(m,2);v!==null&&(p._pendingVisibility&=-3,Wt(v,m,2))}}};return r.stateNode=p,r}function bh(r,o,u){return r=pn(6,r,null,o),r.lanes=u,r}function vh(r,o,u){return o=pn(4,r.children!==null?r.children:[],r.key,o),o.lanes=u,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function ci(r){r.flags|=4}function Iy(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!p0(o)){if(o=hn.current,o!==null&&((Ue&4194176)===Ue?Fn!==null:(Ue&62914560)!==Ue&&(Ue&536870912)===0||o!==Fn))throw Ca=wf,q_;r.flags|=8192}}function Dl(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Kp():536870912,r.lanes|=o,xr|=o)}function $a(r,o){if(!Fe)switch(r.tailMode){case"hidden":o=r.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function tt(r){var o=r.alternate!==null&&r.alternate.child===r.child,u=0,h=0;if(o)for(var p=r.child;p!==null;)u|=p.lanes|p.childLanes,h|=p.subtreeFlags&31457280,h|=p.flags&31457280,p.return=r,p=p.sibling;else for(p=r.child;p!==null;)u|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=r,p=p.sibling;return r.subtreeFlags|=h,r.childLanes=u,o}function Qx(r,o,u){var h=o.pendingProps;switch(Af(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(o),null;case 1:return tt(o),null;case 3:return u=o.stateNode,h=null,r!==null&&(h=r.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),ri(yt),Pe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(Sa(o)?ci(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,En!==null&&(Ch(En),En=null))),tt(o),null;case 26:return u=o.memoizedState,r===null?(ci(o),u!==null?(tt(o),Iy(o,u)):(tt(o),o.flags&=-16777217)):u?u!==r.memoizedState?(ci(o),tt(o),Iy(o,u)):(tt(o),o.flags&=-16777217):(r.memoizedProps!==h&&ci(o),tt(o),o.flags&=-16777217),null;case 27:Xo(o),u=Sn.current;var p=o.type;if(r!==null&&o.stateNode!=null)r.memoizedProps!==h&&ci(o);else{if(!h){if(o.stateNode===null)throw Error(i(166));return tt(o),null}r=Nt.current,Sa(o)?X_(o):(r=o0(p,h,u),o.stateNode=r,ci(o))}return tt(o),null;case 5:if(Xo(o),u=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==h&&ci(o);else{if(!h){if(o.stateNode===null)throw Error(i(166));return tt(o),null}if(r=Nt.current,Sa(o))X_(o);else{switch(p=$l(Sn.current),r){case 1:r=p.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:r=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":r=p.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":r=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":r=p.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof h.is=="string"?p.createElement("select",{is:h.is}):p.createElement("select"),h.multiple?r.multiple=!0:h.size&&(r.size=h.size);break;default:r=typeof h.is=="string"?p.createElement(u,{is:h.is}):p.createElement(u)}}r[Dt]=o,r[Xt]=h;e:for(p=o.child;p!==null;){if(p.tag===5||p.tag===6)r.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===o)break e;for(;p.sibling===null;){if(p.return===null||p.return===o)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}o.stateNode=r;e:switch(Ct(r,u,h),u){case"button":case"input":case"select":case"textarea":r=!!h.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&ci(o)}}return tt(o),o.flags&=-16777217,null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==h&&ci(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(i(166));if(r=Sn.current,Sa(o)){if(r=o.stateNode,u=o.memoizedProps,h=null,p=Ht,p!==null)switch(p.tag){case 27:case 5:h=p.memoizedProps}r[Dt]=o,r=!!(r.nodeValue===u||h!==null&&h.suppressHydrationWarning===!0||t0(r.nodeValue,u)),r||ys(o)}else r=$l(r).createTextNode(h),r[Dt]=o,o.stateNode=r}return tt(o),null;case 13:if(h=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(p=Sa(o),h!==null&&h.dehydrated!==null){if(r===null){if(!p)throw Error(i(318));if(p=o.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Dt]=o}else wa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;tt(o),p=!1}else En!==null&&(Ch(En),En=null),p=!0;if(!p)return o.flags&256?(ti(o),o):(ti(o),null)}if(ti(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=h!==null,r=r!==null&&r.memoizedState!==null,u){h=o.child,p=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(p=h.alternate.memoizedState.cachePool.pool);var m=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(m=h.memoizedState.cachePool.pool),m!==p&&(h.flags|=2048)}return u!==r&&u&&(o.child.flags|=8192),Dl(o,o.updateQueue),tt(o),null;case 4:return Pe(),r===null&&Fh(o.stateNode.containerInfo),tt(o),null;case 10:return ri(o.type),tt(o),null;case 19:if(Ie(mt),p=o.memoizedState,p===null)return tt(o),null;if(h=(o.flags&128)!==0,m=p.rendering,m===null)if(h)$a(p,!1);else{if(rt!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(m=ml(r),m!==null){for(o.flags|=128,$a(p,!1),r=m.updateQueue,o.updateQueue=r,Dl(o,r),o.subtreeFlags=0,r=u,u=o.child;u!==null;)My(u,r),u=u.sibling;return Te(mt,mt.current&1|2),o.child}r=r.sibling}p.tail!==null&&Un()>kl&&(o.flags|=128,h=!0,$a(p,!1),o.lanes=4194304)}else{if(!h)if(r=ml(m),r!==null){if(o.flags|=128,h=!0,r=r.updateQueue,o.updateQueue=r,Dl(o,r),$a(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!Fe)return tt(o),null}else 2*Un()-p.renderingStartTime>kl&&u!==536870912&&(o.flags|=128,h=!0,$a(p,!1),o.lanes=4194304);p.isBackwards?(m.sibling=o.child,o.child=m):(r=p.last,r!==null?r.sibling=m:o.child=m,p.last=m)}return p.tail!==null?(o=p.tail,p.rendering=o,p.tail=o.sibling,p.renderingStartTime=Un(),o.sibling=null,r=mt.current,Te(mt,h?r&1|2:r&1),o):(tt(o),null);case 22:case 23:return ti(o),Rf(),h=o.memoizedState!==null,r!==null?r.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(u&536870912)!==0&&(o.flags&128)===0&&(tt(o),o.subtreeFlags&6&&(o.flags|=8192)):tt(o),u=o.updateQueue,u!==null&&Dl(o,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==u&&(o.flags|=2048),r!==null&&Ie(vs),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),ri(yt),tt(o),null;case 25:return null}throw Error(i(156,o.tag))}function Gx(r,o){switch(Af(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return ri(yt),Pe(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Xo(o),null;case 13:if(ti(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(i(340));wa()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return Ie(mt),null;case 4:return Pe(),null;case 10:return ri(o.type),null;case 22:case 23:return ti(o),Rf(),r!==null&&Ie(vs),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return ri(yt),null;case 25:return null;default:return null}}function Py(r,o){switch(Af(o),o.tag){case 3:ri(yt),Pe();break;case 26:case 27:case 5:Xo(o);break;case 4:Pe();break;case 13:ti(o);break;case 19:Ie(mt);break;case 10:ri(o.type);break;case 22:case 23:ti(o),Rf(),r!==null&&Ie(vs);break;case 24:ri(yt)}}var Jx={getCacheForType:function(r){var o=kt(yt),u=o.data.get(r);return u===void 0&&(u=r(),o.data.set(r,u)),u}},eA=typeof WeakMap=="function"?WeakMap:Map,nt=0,Qe=null,Ne=null,Ue=0,Ge=0,tn=null,ui=!1,Tr=!1,Th=!1,fi=0,rt=0,Li=0,Ms=0,xh=0,_n=0,xr=0,Xa=null,Vn=null,Ah=!1,Sh=0,kl=1/0,Bl=null,Fi=null,Ul=!1,Os=null,Ya=0,wh=0,Eh=null,qa=0,Rh=null;function nn(){if((nt&2)!==0&&Ue!==0)return Ue&-Ue;if(J.T!==null){var r=dr;return r!==0?r:kh()}return Jp()}function Ny(){_n===0&&(_n=(Ue&536870912)===0||Fe?qp():536870912);var r=hn.current;return r!==null&&(r.flags|=32),_n}function Wt(r,o,u){(r===Qe&&Ge===2||r.cancelPendingCommit!==null)&&(Ar(r,0),hi(r,Ue,_n,!1)),ha(r,u),((nt&2)===0||r!==Qe)&&(r===Qe&&((nt&2)===0&&(Ms|=u),rt===4&&hi(r,Ue,_n,!1)),Hn(r))}function Dy(r,o,u){if((nt&6)!==0)throw Error(i(327));var h=!u&&(o&60)===0&&(o&r.expiredLanes)===0||fa(r,o),p=h?iA(r,o):Ih(r,o,!0),m=h;do{if(p===0){Tr&&!h&&hi(r,o,0,!1);break}else if(p===6)hi(r,o,0,!ui);else{if(u=r.current.alternate,m&&!tA(u)){p=Ih(r,o,!1),m=!1;continue}if(p===2){if(m=o,r.errorRecoveryDisabledLanes&m)var v=0;else v=r.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){o=v;e:{var A=r;p=Xa;var O=A.current.memoizedState.isDehydrated;if(O&&(Ar(A,v).flags|=256),v=Ih(A,v,!1),v!==2){if(Th&&!O){A.errorRecoveryDisabledLanes|=m,Ms|=m,p=4;break e}m=Vn,Vn=p,m!==null&&Ch(m)}p=v}if(m=!1,p!==2)continue}}if(p===1){Ar(r,0),hi(r,o,0,!0);break}e:{switch(h=r,p){case 0:case 1:throw Error(i(345));case 4:if((o&4194176)===o){hi(h,o,_n,!ui);break e}break;case 2:Vn=null;break;case 3:case 5:break;default:throw Error(i(329))}if(h.finishedWork=u,h.finishedLanes=o,(o&62914560)===o&&(m=Sh+300-Un(),10<m)){if(hi(h,o,_n,!ui),Zo(h,0)!==0)break e;h.timeoutHandle=s0(ky.bind(null,h,u,Vn,Bl,Ah,o,_n,Ms,xr,ui,2,-0,0),m);break e}ky(h,u,Vn,Bl,Ah,o,_n,Ms,xr,ui,0,-0,0)}}break}while(!0);Hn(r)}function Ch(r){Vn===null?Vn=r:Vn.push.apply(Vn,r)}function ky(r,o,u,h,p,m,v,A,O,F,te,re,q){var G=o.subtreeFlags;if((G&8192||(G&16785408)===16785408)&&(eo={stylesheets:null,count:0,unsuspend:BA},wy(o),o=LA(),o!==null)){r.cancelPendingCommit=o(Hy.bind(null,r,u,h,p,v,A,O,1,re,q)),hi(r,m,v,!F);return}Hy(r,u,h,p,v,A,O,te,re,q)}function tA(r){for(var o=r;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var h=0;h<u.length;h++){var p=u[h],m=p.getSnapshot;p=p.value;try{if(!Gt(m(),p))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function hi(r,o,u,h){o&=~xh,o&=~Ms,r.suspendedLanes|=o,r.pingedLanes&=~o,h&&(r.warmLanes|=o),h=r.expirationTimes;for(var p=o;0<p;){var m=31-Qt(p),v=1<<m;h[m]=-1,p&=~v}u!==0&&Zp(r,u,o)}function Ll(){return(nt&6)===0?(Ka(0),!1):!0}function Mh(){if(Ne!==null){if(Ge===0)var r=Ne.return;else r=Ne,si=ws=null,kf(r),fr=null,Ma=0,r=Ne;for(;r!==null;)Py(r.alternate,r),r=r.return;Ne=null}}function Ar(r,o){r.finishedWork=null,r.finishedLanes=0;var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,vA(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),Mh(),Qe=r,Ne=u=Ui(r.current,null),Ue=o,Ge=0,tn=null,ui=!1,Tr=fa(r,o),Th=!1,xr=_n=xh=Ms=Li=rt=0,Vn=Xa=null,Ah=!1,(o&8)!==0&&(o|=o&32);var h=r.entangledLanes;if(h!==0)for(r=r.entanglements,h&=o;0<h;){var p=31-Qt(h),m=1<<p;o|=r[p],h&=~m}return fi=o,ll(),u}function By(r,o){Me=null,J.H=zn,o===Ra?(o=Q_(),Ge=3):o===q_?(o=Q_(),Ge=4):Ge=o===Km?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,tn=o,Ne===null&&(rt=1,Cl(r,cn(o,r.current)))}function Uy(){var r=J.H;return J.H=zn,r===null?zn:r}function Ly(){var r=J.A;return J.A=Jx,r}function Oh(){rt=4,ui||(Ue&4194176)!==Ue&&hn.current!==null||(Tr=!0),(Li&134217727)===0&&(Ms&134217727)===0||Qe===null||hi(Qe,Ue,_n,!1)}function Ih(r,o,u){var h=nt;nt|=2;var p=Uy(),m=Ly();(Qe!==r||Ue!==o)&&(Bl=null,Ar(r,o)),o=!1;var v=rt;e:do try{if(Ge!==0&&Ne!==null){var A=Ne,O=tn;switch(Ge){case 8:Mh(),v=6;break e;case 3:case 2:case 6:hn.current===null&&(o=!0);var F=Ge;if(Ge=0,tn=null,Sr(r,A,O,F),u&&Tr){v=0;break e}break;default:F=Ge,Ge=0,tn=null,Sr(r,A,O,F)}}nA(),v=rt;break}catch(te){By(r,te)}while(!0);return o&&r.shellSuspendCounter++,si=ws=null,nt=h,J.H=p,J.A=m,Ne===null&&(Qe=null,Ue=0,ll()),v}function nA(){for(;Ne!==null;)Fy(Ne)}function iA(r,o){var u=nt;nt|=2;var h=Uy(),p=Ly();Qe!==r||Ue!==o?(Bl=null,kl=Un()+500,Ar(r,o)):Tr=fa(r,o);e:do try{if(Ge!==0&&Ne!==null){o=Ne;var m=tn;t:switch(Ge){case 1:Ge=0,tn=null,Sr(r,o,m,1);break;case 2:if(K_(m)){Ge=0,tn=null,zy(o);break}o=function(){Ge===2&&Qe===r&&(Ge=7),Hn(r)},m.then(o,o);break e;case 3:Ge=7;break e;case 4:Ge=5;break e;case 7:K_(m)?(Ge=0,tn=null,zy(o)):(Ge=0,tn=null,Sr(r,o,m,7));break;case 5:var v=null;switch(Ne.tag){case 26:v=Ne.memoizedState;case 5:case 27:var A=Ne;if(!v||p0(v)){Ge=0,tn=null;var O=A.sibling;if(O!==null)Ne=O;else{var F=A.return;F!==null?(Ne=F,Fl(F)):Ne=null}break t}}Ge=0,tn=null,Sr(r,o,m,5);break;case 6:Ge=0,tn=null,Sr(r,o,m,6);break;case 8:Mh(),rt=6;break e;default:throw Error(i(462))}}sA();break}catch(te){By(r,te)}while(!0);return si=ws=null,J.H=h,J.A=p,nt=u,Ne!==null?0:(Qe=null,Ue=0,ll(),rt)}function sA(){for(;Ne!==null&&!E2();)Fy(Ne)}function Fy(r){var o=oy(r.alternate,r,fi);r.memoizedProps=r.pendingProps,o===null?Fl(r):Ne=o}function zy(r){var o=r,u=o.alternate;switch(o.tag){case 15:case 0:o=ty(u,o,o.pendingProps,o.type,void 0,Ue);break;case 11:o=ty(u,o,o.pendingProps,o.type.render,o.ref,Ue);break;case 5:kf(o);default:Py(u,o),o=Ne=My(o,fi),o=oy(u,o,fi)}r.memoizedProps=r.pendingProps,o===null?Fl(r):Ne=o}function Sr(r,o,u,h){si=ws=null,kf(o),fr=null,Ma=0;var p=o.return;try{if(Xx(r,p,o,u,Ue)){rt=1,Cl(r,cn(u,r.current)),Ne=null;return}}catch(m){if(p!==null)throw Ne=p,m;rt=1,Cl(r,cn(u,r.current)),Ne=null;return}o.flags&32768?(Fe||h===1?r=!0:Tr||(Ue&536870912)!==0?r=!1:(ui=r=!0,(h===2||h===3||h===6)&&(h=hn.current,h!==null&&h.tag===13&&(h.flags|=16384))),Vy(o,r)):Fl(o)}function Fl(r){var o=r;do{if((o.flags&32768)!==0){Vy(o,ui);return}r=o.return;var u=Qx(o.alternate,o,fi);if(u!==null){Ne=u;return}if(o=o.sibling,o!==null){Ne=o;return}Ne=o=r}while(o!==null);rt===0&&(rt=5)}function Vy(r,o){do{var u=Gx(r.alternate,r);if(u!==null){u.flags&=32767,Ne=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(r=r.sibling,r!==null)){Ne=r;return}Ne=r=u}while(r!==null);rt=6,Ne=null}function Hy(r,o,u,h,p,m,v,A,O,F){var te=J.T,re=ie.p;try{ie.p=2,J.T=null,rA(r,o,u,h,re,p,m,v,A,O,F)}finally{J.T=te,ie.p=re}}function rA(r,o,u,h,p,m,v,A){do wr();while(Os!==null);if((nt&6)!==0)throw Error(i(327));var O=r.finishedWork;if(h=r.finishedLanes,O===null)return null;if(r.finishedWork=null,r.finishedLanes=0,O===r.current)throw Error(i(177));r.callbackNode=null,r.callbackPriority=0,r.cancelPendingCommit=null;var F=O.lanes|O.childLanes;if(F|=vf,U2(r,h,F,m,v,A),r===Qe&&(Ne=Qe=null,Ue=0),(O.subtreeFlags&10256)===0&&(O.flags&10256)===0||Ul||(Ul=!0,wh=F,Eh=u,cA(Yo,function(){return wr(),null})),u=(O.flags&15990)!==0,(O.subtreeFlags&15990)!==0||u?(u=J.T,J.T=null,m=ie.p,ie.p=2,v=nt,nt|=4,qx(r,O),xy(O,r),Mx(Wh,r.containerInfo),Ql=!!Hh,Wh=Hh=null,r.current=O,yy(r,O.alternate,O),R2(),nt=v,ie.p=m,J.T=u):r.current=O,Ul?(Ul=!1,Os=r,Ya=h):Wy(r,F),F=r.pendingLanes,F===0&&(Fi=null),P2(O.stateNode),Hn(r),o!==null)for(p=r.onRecoverableError,O=0;O<o.length;O++)F=o[O],p(F.value,{componentStack:F.stack});return(Ya&3)!==0&&wr(),F=r.pendingLanes,(h&4194218)!==0&&(F&42)!==0?r===Rh?qa++:(qa=0,Rh=r):qa=0,Ka(0),null}function Wy(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Ia(o)))}function wr(){if(Os!==null){var r=Os,o=wh;wh=0;var u=Gp(Ya),h=J.T,p=ie.p;try{if(ie.p=32>u?32:u,J.T=null,Os===null)var m=!1;else{u=Eh,Eh=null;var v=Os,A=Ya;if(Os=null,Ya=0,(nt&6)!==0)throw Error(i(331));var O=nt;if(nt|=4,Ry(v.current),Sy(v,v.current,A,u),nt=O,Ka(0,!1),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(ua,v)}catch{}m=!0}return m}finally{ie.p=p,J.T=h,Wy(r,o)}}return!1}function jy(r,o,u){o=cn(u,o),o=Kf(r.stateNode,o,2),r=Ni(r,o,2),r!==null&&(ha(r,2),Hn(r))}function qe(r,o,u){if(r.tag===3)jy(r,r,u);else for(;o!==null;){if(o.tag===3){jy(o,r,u);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Fi===null||!Fi.has(h))){r=cn(u,r),u=Ym(2),h=Ni(o,u,2),h!==null&&(qm(u,h,o,r),ha(h,2),Hn(h));break}}o=o.return}}function Ph(r,o,u){var h=r.pingCache;if(h===null){h=r.pingCache=new eA;var p=new Set;h.set(o,p)}else p=h.get(o),p===void 0&&(p=new Set,h.set(o,p));p.has(u)||(Th=!0,p.add(u),r=aA.bind(null,r,o,u),o.then(r,r))}function aA(r,o,u){var h=r.pingCache;h!==null&&h.delete(o),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,Qe===r&&(Ue&u)===u&&(rt===4||rt===3&&(Ue&62914560)===Ue&&300>Un()-Sh?(nt&2)===0&&Ar(r,0):xh|=u,xr===Ue&&(xr=0)),Hn(r)}function $y(r,o){o===0&&(o=Kp()),r=wi(r,o),r!==null&&(ha(r,o),Hn(r))}function oA(r){var o=r.memoizedState,u=0;o!==null&&(u=o.retryLane),$y(r,u)}function lA(r,o){var u=0;switch(r.tag){case 13:var h=r.stateNode,p=r.memoizedState;p!==null&&(u=p.retryLane);break;case 19:h=r.stateNode;break;case 22:h=r.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(o),$y(r,u)}function cA(r,o){return Ku(r,o)}var zl=null,Er=null,Nh=!1,Vl=!1,Dh=!1,Is=0;function Hn(r){r!==Er&&r.next===null&&(Er===null?zl=Er=r:Er=Er.next=r),Vl=!0,Nh||(Nh=!0,fA(uA))}function Ka(r,o){if(!Dh&&Vl){Dh=!0;do for(var u=!1,h=zl;h!==null;){if(r!==0){var p=h.pendingLanes;if(p===0)var m=0;else{var v=h.suspendedLanes,A=h.pingedLanes;m=(1<<31-Qt(42|r)+1)-1,m&=p&~(v&~A),m=m&201326677?m&201326677|1:m?m|2:0}m!==0&&(u=!0,qy(h,m))}else m=Ue,m=Zo(h,h===Qe?m:0),(m&3)===0||fa(h,m)||(u=!0,qy(h,m));h=h.next}while(u);Dh=!1}}function uA(){Vl=Nh=!1;var r=0;Is!==0&&(bA()&&(r=Is),Is=0);for(var o=Un(),u=null,h=zl;h!==null;){var p=h.next,m=Xy(h,o);m===0?(h.next=null,u===null?zl=p:u.next=p,p===null&&(Er=u)):(u=h,(r!==0||(m&3)!==0)&&(Vl=!0)),h=p}Ka(r)}function Xy(r,o){for(var u=r.suspendedLanes,h=r.pingedLanes,p=r.expirationTimes,m=r.pendingLanes&-62914561;0<m;){var v=31-Qt(m),A=1<<v,O=p[v];O===-1?((A&u)===0||(A&h)!==0)&&(p[v]=B2(A,o)):O<=o&&(r.expiredLanes|=A),m&=~A}if(o=Qe,u=Ue,u=Zo(r,r===o?u:0),h=r.callbackNode,u===0||r===o&&Ge===2||r.cancelPendingCommit!==null)return h!==null&&h!==null&&Zu(h),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||fa(r,u)){if(o=u&-u,o===r.callbackPriority)return o;switch(h!==null&&Zu(h),Gp(u)){case 2:case 8:u=Xp;break;case 32:u=Yo;break;case 268435456:u=Yp;break;default:u=Yo}return h=Yy.bind(null,r),u=Ku(u,h),r.callbackPriority=o,r.callbackNode=u,o}return h!==null&&h!==null&&Zu(h),r.callbackPriority=2,r.callbackNode=null,2}function Yy(r,o){var u=r.callbackNode;if(wr()&&r.callbackNode!==u)return null;var h=Ue;return h=Zo(r,r===Qe?h:0),h===0?null:(Dy(r,h,o),Xy(r,Un()),r.callbackNode!=null&&r.callbackNode===u?Yy.bind(null,r):null)}function qy(r,o){if(wr())return null;Dy(r,o,!0)}function fA(r){TA(function(){(nt&6)!==0?Ku($p,r):r()})}function kh(){return Is===0&&(Is=qp()),Is}function Ky(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:tl(""+r)}function Zy(r,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,r.id&&u.setAttribute("form",r.id),o.parentNode.insertBefore(u,o),r=new FormData(r),u.parentNode.removeChild(u),r}function hA(r,o,u,h,p){if(o==="submit"&&u&&u.stateNode===p){var m=Ky((p[Xt]||null).action),v=h.submitter;v&&(o=(o=v[Xt]||null)?Ky(o.formAction):v.getAttribute("formAction"),o!==null&&(m=o,v=null));var A=new rl("action","action",null,h,p);r.push({event:A,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Is!==0){var O=v?Zy(p,v):new FormData(p);jf(u,{pending:!0,data:O,method:p.method,action:m},null,O)}}else typeof m=="function"&&(A.preventDefault(),O=v?Zy(p,v):new FormData(p),jf(u,{pending:!0,data:O,method:p.method,action:m},m,O))},currentTarget:p}]})}}for(var Bh=0;Bh<H_.length;Bh++){var Uh=H_[Bh],dA=Uh.toLowerCase(),gA=Uh[0].toUpperCase()+Uh.slice(1);wn(dA,"on"+gA)}wn(U_,"onAnimationEnd"),wn(L_,"onAnimationIteration"),wn(F_,"onAnimationStart"),wn("dblclick","onDoubleClick"),wn("focusin","onFocus"),wn("focusout","onBlur"),wn(Ix,"onTransitionRun"),wn(Px,"onTransitionStart"),wn(Nx,"onTransitionCancel"),wn(z_,"onTransitionEnd"),Js("onMouseEnter",["mouseout","mouseover"]),Js("onMouseLeave",["mouseout","mouseover"]),Js("onPointerEnter",["pointerout","pointerover"]),Js("onPointerLeave",["pointerout","pointerover"]),hs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),hs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),hs("onBeforeInput",["compositionend","keypress","textInput","paste"]),hs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),hs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),hs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Za="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Za));function Qy(r,o){o=(o&4)!==0;for(var u=0;u<r.length;u++){var h=r[u],p=h.event;h=h.listeners;e:{var m=void 0;if(o)for(var v=h.length-1;0<=v;v--){var A=h[v],O=A.instance,F=A.currentTarget;if(A=A.listener,O!==m&&p.isPropagationStopped())break e;m=A,p.currentTarget=F;try{m(p)}catch(te){Rl(te)}p.currentTarget=null,m=O}else for(v=0;v<h.length;v++){if(A=h[v],O=A.instance,F=A.currentTarget,A=A.listener,O!==m&&p.isPropagationStopped())break e;m=A,p.currentTarget=F;try{m(p)}catch(te){Rl(te)}p.currentTarget=null,m=O}}}}function Be(r,o){var u=o[Gu];u===void 0&&(u=o[Gu]=new Set);var h=r+"__bubble";u.has(h)||(Gy(o,r,2,!1),u.add(h))}function Lh(r,o,u){var h=0;o&&(h|=4),Gy(u,r,h,o)}var Hl="_reactListening"+Math.random().toString(36).slice(2);function Fh(r){if(!r[Hl]){r[Hl]=!0,t_.forEach(function(u){u!=="selectionchange"&&(pA.has(u)||Lh(u,!1,r),Lh(u,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Hl]||(o[Hl]=!0,Lh("selectionchange",!1,o))}}function Gy(r,o,u,h){switch(T0(o)){case 2:var p=VA;break;case 8:p=HA;break;default:p=Gh}u=p.bind(null,o,u,r),p=void 0,!of||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(p=!0),h?p!==void 0?r.addEventListener(o,u,{capture:!0,passive:p}):r.addEventListener(o,u,!0):p!==void 0?r.addEventListener(o,u,{passive:p}):r.addEventListener(o,u,!1)}function zh(r,o,u,h,p){var m=h;if((o&1)===0&&(o&2)===0&&h!==null)e:for(;;){if(h===null)return;var v=h.tag;if(v===3||v===4){var A=h.stateNode.containerInfo;if(A===p||A.nodeType===8&&A.parentNode===p)break;if(v===4)for(v=h.return;v!==null;){var O=v.tag;if((O===3||O===4)&&(O=v.stateNode.containerInfo,O===p||O.nodeType===8&&O.parentNode===p))return;v=v.return}for(;A!==null;){if(v=fs(A),v===null)return;if(O=v.tag,O===5||O===6||O===26||O===27){h=m=v;continue e}A=A.parentNode}}h=h.return}d_(function(){var F=m,te=rf(u),re=[];e:{var q=V_.get(r);if(q!==void 0){var G=rl,me=r;switch(r){case"keypress":if(il(u)===0)break e;case"keydown":case"keyup":G=lx;break;case"focusin":me="focus",G=ff;break;case"focusout":me="blur",G=ff;break;case"beforeblur":case"afterblur":G=ff;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=__;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Z2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=fx;break;case U_:case L_:case F_:G=J2;break;case z_:G=dx;break;case"scroll":case"scrollend":G=q2;break;case"wheel":G=px;break;case"copy":case"cut":case"paste":G=tx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=y_;break;case"toggle":case"beforetoggle":G=mx}var we=(o&4)!==0,at=!we&&(r==="scroll"||r==="scrollend"),j=we?q!==null?q+"Capture":null:q;we=[];for(var k=F,Y;k!==null;){var se=k;if(Y=se.stateNode,se=se.tag,se!==5&&se!==26&&se!==27||Y===null||j===null||(se=pa(k,j),se!=null&&we.push(Qa(k,se,Y))),at)break;k=k.return}0<we.length&&(q=new G(q,me,null,u,te),re.push({event:q,listeners:we}))}}if((o&7)===0){e:{if(q=r==="mouseover"||r==="pointerover",G=r==="mouseout"||r==="pointerout",q&&u!==sf&&(me=u.relatedTarget||u.fromElement)&&(fs(me)||me[Zs]))break e;if((G||q)&&(q=te.window===te?te:(q=te.ownerDocument)?q.defaultView||q.parentWindow:window,G?(me=u.relatedTarget||u.toElement,G=F,me=me?fs(me):null,me!==null&&(at=I(me),we=me.tag,me!==at||we!==5&&we!==27&&we!==6)&&(me=null)):(G=null,me=F),G!==me)){if(we=__,se="onMouseLeave",j="onMouseEnter",k="mouse",(r==="pointerout"||r==="pointerover")&&(we=y_,se="onPointerLeave",j="onPointerEnter",k="pointer"),at=G==null?q:ga(G),Y=me==null?q:ga(me),q=new we(se,k+"leave",G,u,te),q.target=at,q.relatedTarget=Y,se=null,fs(te)===F&&(we=new we(j,k+"enter",me,u,te),we.target=Y,we.relatedTarget=at,se=we),at=se,G&&me)t:{for(we=G,j=me,k=0,Y=we;Y;Y=Rr(Y))k++;for(Y=0,se=j;se;se=Rr(se))Y++;for(;0<k-Y;)we=Rr(we),k--;for(;0<Y-k;)j=Rr(j),Y--;for(;k--;){if(we===j||j!==null&&we===j.alternate)break t;we=Rr(we),j=Rr(j)}we=null}else we=null;G!==null&&Jy(re,q,G,we,!1),me!==null&&at!==null&&Jy(re,at,me,we,!0)}}e:{if(q=F?ga(F):window,G=q.nodeName&&q.nodeName.toLowerCase(),G==="select"||G==="input"&&q.type==="file")var ge=E_;else if(S_(q))if(R_)ge=Rx;else{ge=wx;var Oe=Sx}else G=q.nodeName,!G||G.toLowerCase()!=="input"||q.type!=="checkbox"&&q.type!=="radio"?F&&nf(F.elementType)&&(ge=E_):ge=Ex;if(ge&&(ge=ge(r,F))){w_(re,ge,u,te);break e}Oe&&Oe(r,q,F),r==="focusout"&&F&&q.type==="number"&&F.memoizedProps.value!=null&&tf(q,"number",q.value)}switch(Oe=F?ga(F):window,r){case"focusin":(S_(Oe)||Oe.contentEditable==="true")&&(rr=Oe,mf=F,Aa=null);break;case"focusout":Aa=mf=rr=null;break;case"mousedown":yf=!0;break;case"contextmenu":case"mouseup":case"dragend":yf=!1,k_(re,u,te);break;case"selectionchange":if(Ox)break;case"keydown":case"keyup":k_(re,u,te)}var ye;if(df)e:{switch(r){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else sr?x_(r,u)&&(xe="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&(xe="onCompositionStart");xe&&(b_&&u.locale!=="ko"&&(sr||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&sr&&(ye=g_()):(Si=te,lf="value"in Si?Si.value:Si.textContent,sr=!0)),Oe=Wl(F,xe),0<Oe.length&&(xe=new m_(xe,r,null,u,te),re.push({event:xe,listeners:Oe}),ye?xe.data=ye:(ye=A_(u),ye!==null&&(xe.data=ye)))),(ye=bx?vx(r,u):Tx(r,u))&&(xe=Wl(F,"onBeforeInput"),0<xe.length&&(Oe=new m_("onBeforeInput","beforeinput",null,u,te),re.push({event:Oe,listeners:xe}),Oe.data=ye)),hA(re,r,F,u,te)}Qy(re,o)})}function Qa(r,o,u){return{instance:r,listener:o,currentTarget:u}}function Wl(r,o){for(var u=o+"Capture",h=[];r!==null;){var p=r,m=p.stateNode;p=p.tag,p!==5&&p!==26&&p!==27||m===null||(p=pa(r,u),p!=null&&h.unshift(Qa(r,p,m)),p=pa(r,o),p!=null&&h.push(Qa(r,p,m))),r=r.return}return h}function Rr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Jy(r,o,u,h,p){for(var m=o._reactName,v=[];u!==null&&u!==h;){var A=u,O=A.alternate,F=A.stateNode;if(A=A.tag,O!==null&&O===h)break;A!==5&&A!==26&&A!==27||F===null||(O=F,p?(F=pa(u,m),F!=null&&v.unshift(Qa(u,F,O))):p||(F=pa(u,m),F!=null&&v.push(Qa(u,F,O)))),u=u.return}v.length!==0&&r.push({event:o,listeners:v})}var _A=/\r\n?/g,mA=/\u0000|\uFFFD/g;function e0(r){return(typeof r=="string"?r:""+r).replace(_A,`
`).replace(mA,"")}function t0(r,o){return o=e0(o),e0(r)===o}function jl(){}function $e(r,o,u,h,p,m){switch(u){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||tr(r,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&tr(r,""+h);break;case"className":Go(r,"class",h);break;case"tabIndex":Go(r,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Go(r,u,h);break;case"style":f_(r,h,m);break;case"data":if(o!=="object"){Go(r,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||u!=="href")){r.removeAttribute(u);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(u);break}h=tl(""+h),r.setAttribute(u,h);break;case"action":case"formAction":if(typeof h=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(u==="formAction"?(o!=="input"&&$e(r,o,"name",p.name,p,null),$e(r,o,"formEncType",p.formEncType,p,null),$e(r,o,"formMethod",p.formMethod,p,null),$e(r,o,"formTarget",p.formTarget,p,null)):($e(r,o,"encType",p.encType,p,null),$e(r,o,"method",p.method,p,null),$e(r,o,"target",p.target,p,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){r.removeAttribute(u);break}h=tl(""+h),r.setAttribute(u,h);break;case"onClick":h!=null&&(r.onclick=jl);break;case"onScroll":h!=null&&Be("scroll",r);break;case"onScrollEnd":h!=null&&Be("scrollend",r);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(p.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"multiple":r.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":r.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){r.removeAttribute("xlink:href");break}u=tl(""+h),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,""+h):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":h===!0?r.setAttribute(u,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?r.setAttribute(u,h):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?r.setAttribute(u,h):r.removeAttribute(u);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?r.removeAttribute(u):r.setAttribute(u,h);break;case"popover":Be("beforetoggle",r),Be("toggle",r),Qo(r,"popover",h);break;case"xlinkActuate":Gn(r,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Gn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Gn(r,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Gn(r,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Gn(r,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Gn(r,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Gn(r,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Gn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Gn(r,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Qo(r,"is",h);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=X2.get(u)||u,Qo(r,u,h))}}function Vh(r,o,u,h,p,m){switch(u){case"style":f_(r,h,m);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(p.children!=null)throw Error(i(60));r.innerHTML=u}}break;case"children":typeof h=="string"?tr(r,h):(typeof h=="number"||typeof h=="bigint")&&tr(r,""+h);break;case"onScroll":h!=null&&Be("scroll",r);break;case"onScrollEnd":h!=null&&Be("scrollend",r);break;case"onClick":h!=null&&(r.onclick=jl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!n_.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),o=u.slice(2,p?u.length-7:void 0),m=r[Xt]||null,m=m!=null?m[u]:null,typeof m=="function"&&r.removeEventListener(o,m,p),typeof h=="function")){typeof m!="function"&&m!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(o,h,p);break e}u in r?r[u]=h:h===!0?r.setAttribute(u,""):Qo(r,u,h)}}}function Ct(r,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Be("error",r),Be("load",r);var h=!1,p=!1,m;for(m in u)if(u.hasOwnProperty(m)){var v=u[m];if(v!=null)switch(m){case"src":h=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$e(r,o,m,v,u,null)}}p&&$e(r,o,"srcSet",u.srcSet,u,null),h&&$e(r,o,"src",u.src,u,null);return;case"input":Be("invalid",r);var A=m=v=p=null,O=null,F=null;for(h in u)if(u.hasOwnProperty(h)){var te=u[h];if(te!=null)switch(h){case"name":p=te;break;case"type":v=te;break;case"checked":O=te;break;case"defaultChecked":F=te;break;case"value":m=te;break;case"defaultValue":A=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(137,o));break;default:$e(r,o,h,te,u,null)}}o_(r,m,A,O,F,v,p,!1),Jo(r);return;case"select":Be("invalid",r),h=v=m=null;for(p in u)if(u.hasOwnProperty(p)&&(A=u[p],A!=null))switch(p){case"value":m=A;break;case"defaultValue":v=A;break;case"multiple":h=A;default:$e(r,o,p,A,u,null)}o=m,u=v,r.multiple=!!h,o!=null?er(r,!!h,o,!1):u!=null&&er(r,!!h,u,!0);return;case"textarea":Be("invalid",r),m=p=h=null;for(v in u)if(u.hasOwnProperty(v)&&(A=u[v],A!=null))switch(v){case"value":h=A;break;case"defaultValue":p=A;break;case"children":m=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(i(91));break;default:$e(r,o,v,A,u,null)}c_(r,h,p,m),Jo(r);return;case"option":for(O in u)if(u.hasOwnProperty(O)&&(h=u[O],h!=null))switch(O){case"selected":r.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:$e(r,o,O,h,u,null)}return;case"dialog":Be("cancel",r),Be("close",r);break;case"iframe":case"object":Be("load",r);break;case"video":case"audio":for(h=0;h<Za.length;h++)Be(Za[h],r);break;case"image":Be("error",r),Be("load",r);break;case"details":Be("toggle",r);break;case"embed":case"source":case"link":Be("error",r),Be("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(F in u)if(u.hasOwnProperty(F)&&(h=u[F],h!=null))switch(F){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$e(r,o,F,h,u,null)}return;default:if(nf(o)){for(te in u)u.hasOwnProperty(te)&&(h=u[te],h!==void 0&&Vh(r,o,te,h,u,void 0));return}}for(A in u)u.hasOwnProperty(A)&&(h=u[A],h!=null&&$e(r,o,A,h,u,null))}function yA(r,o,u,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,m=null,v=null,A=null,O=null,F=null,te=null;for(G in u){var re=u[G];if(u.hasOwnProperty(G)&&re!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":O=re;default:h.hasOwnProperty(G)||$e(r,o,G,null,h,re)}}for(var q in h){var G=h[q];if(re=u[q],h.hasOwnProperty(q)&&(G!=null||re!=null))switch(q){case"type":m=G;break;case"name":p=G;break;case"checked":F=G;break;case"defaultChecked":te=G;break;case"value":v=G;break;case"defaultValue":A=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,o));break;default:G!==re&&$e(r,o,q,G,h,re)}}ef(r,v,A,O,F,te,m,p);return;case"select":G=v=A=q=null;for(m in u)if(O=u[m],u.hasOwnProperty(m)&&O!=null)switch(m){case"value":break;case"multiple":G=O;default:h.hasOwnProperty(m)||$e(r,o,m,null,h,O)}for(p in h)if(m=h[p],O=u[p],h.hasOwnProperty(p)&&(m!=null||O!=null))switch(p){case"value":q=m;break;case"defaultValue":A=m;break;case"multiple":v=m;default:m!==O&&$e(r,o,p,m,h,O)}o=A,u=v,h=G,q!=null?er(r,!!u,q,!1):!!h!=!!u&&(o!=null?er(r,!!u,o,!0):er(r,!!u,u?[]:"",!1));return;case"textarea":G=q=null;for(A in u)if(p=u[A],u.hasOwnProperty(A)&&p!=null&&!h.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:$e(r,o,A,null,h,p)}for(v in h)if(p=h[v],m=u[v],h.hasOwnProperty(v)&&(p!=null||m!=null))switch(v){case"value":q=p;break;case"defaultValue":G=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==m&&$e(r,o,v,p,h,m)}l_(r,q,G);return;case"option":for(var me in u)if(q=u[me],u.hasOwnProperty(me)&&q!=null&&!h.hasOwnProperty(me))switch(me){case"selected":r.selected=!1;break;default:$e(r,o,me,null,h,q)}for(O in h)if(q=h[O],G=u[O],h.hasOwnProperty(O)&&q!==G&&(q!=null||G!=null))switch(O){case"selected":r.selected=q&&typeof q!="function"&&typeof q!="symbol";break;default:$e(r,o,O,q,h,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var we in u)q=u[we],u.hasOwnProperty(we)&&q!=null&&!h.hasOwnProperty(we)&&$e(r,o,we,null,h,q);for(F in h)if(q=h[F],G=u[F],h.hasOwnProperty(F)&&q!==G&&(q!=null||G!=null))switch(F){case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(i(137,o));break;default:$e(r,o,F,q,h,G)}return;default:if(nf(o)){for(var at in u)q=u[at],u.hasOwnProperty(at)&&q!==void 0&&!h.hasOwnProperty(at)&&Vh(r,o,at,void 0,h,q);for(te in h)q=h[te],G=u[te],!h.hasOwnProperty(te)||q===G||q===void 0&&G===void 0||Vh(r,o,te,q,h,G);return}}for(var j in u)q=u[j],u.hasOwnProperty(j)&&q!=null&&!h.hasOwnProperty(j)&&$e(r,o,j,null,h,q);for(re in h)q=h[re],G=u[re],!h.hasOwnProperty(re)||q===G||q==null&&G==null||$e(r,o,re,q,h,G)}var Hh=null,Wh=null;function $l(r){return r.nodeType===9?r:r.ownerDocument}function n0(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function i0(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function jh(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var $h=null;function bA(){var r=window.event;return r&&r.type==="popstate"?r===$h?!1:($h=r,!0):($h=null,!1)}var s0=typeof setTimeout=="function"?setTimeout:void 0,vA=typeof clearTimeout=="function"?clearTimeout:void 0,r0=typeof Promise=="function"?Promise:void 0,TA=typeof queueMicrotask=="function"?queueMicrotask:typeof r0<"u"?function(r){return r0.resolve(null).then(r).catch(xA)}:s0;function xA(r){setTimeout(function(){throw r})}function Xh(r,o){var u=o,h=0;do{var p=u.nextSibling;if(r.removeChild(u),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(h===0){r.removeChild(p),ro(o);return}h--}else u!=="$"&&u!=="$?"&&u!=="$!"||h++;u=p}while(u);ro(o)}function Yh(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Yh(u),Ju(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function AA(r,o,u,h){for(;r.nodeType===1;){var p=u;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(h){if(!r[da])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(m=r.getAttribute("rel"),m==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(m!==p.rel||r.getAttribute("href")!==(p.href==null?null:p.href)||r.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||r.getAttribute("title")!==(p.title==null?null:p.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(m=r.getAttribute("src"),(m!==(p.src==null?null:p.src)||r.getAttribute("type")!==(p.type==null?null:p.type)||r.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&m&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var m=p.name==null?null:""+p.name;if(p.type==="hidden"&&r.getAttribute("name")===m)return r}else return r;if(r=Cn(r.nextSibling),r===null)break}return null}function SA(r,o,u){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=Cn(r.nextSibling),r===null))return null;return r}function Cn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return r}function a0(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return r;o--}else u==="/$"&&o++}r=r.previousSibling}return null}function o0(r,o,u){switch(o=$l(u),r){case"html":if(r=o.documentElement,!r)throw Error(i(452));return r;case"head":if(r=o.head,!r)throw Error(i(453));return r;case"body":if(r=o.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}var mn=new Map,l0=new Set;function Xl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.ownerDocument}var di=ie.d;ie.d={f:wA,r:EA,D:RA,C:CA,L:MA,m:OA,X:PA,S:IA,M:NA};function wA(){var r=di.f(),o=Ll();return r||o}function EA(r){var o=Qs(r);o!==null&&o.tag===5&&o.type==="form"?km(o):di.r(r)}var Cr=typeof document>"u"?null:document;function c0(r,o,u){var h=Cr;if(h&&typeof o=="string"&&o){var p=on(o);p='link[rel="'+r+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),l0.has(p)||(l0.add(p),r={rel:r,crossOrigin:u,href:o},h.querySelector(p)===null&&(o=h.createElement("link"),Ct(o,"link",r),Tt(o),h.head.appendChild(o)))}}function RA(r){di.D(r),c0("dns-prefetch",r,null)}function CA(r,o){di.C(r,o),c0("preconnect",r,o)}function MA(r,o,u){di.L(r,o,u);var h=Cr;if(h&&r&&o){var p='link[rel="preload"][as="'+on(o)+'"]';o==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+on(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+on(u.imageSizes)+'"]')):p+='[href="'+on(r)+'"]';var m=p;switch(o){case"style":m=Mr(r);break;case"script":m=Or(r)}mn.has(m)||(r=oe({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:r,as:o},u),mn.set(m,r),h.querySelector(p)!==null||o==="style"&&h.querySelector(Ga(m))||o==="script"&&h.querySelector(Ja(m))||(o=h.createElement("link"),Ct(o,"link",r),Tt(o),h.head.appendChild(o)))}}function OA(r,o){di.m(r,o);var u=Cr;if(u&&r){var h=o&&typeof o.as=="string"?o.as:"script",p='link[rel="modulepreload"][as="'+on(h)+'"][href="'+on(r)+'"]',m=p;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Or(r)}if(!mn.has(m)&&(r=oe({rel:"modulepreload",href:r},o),mn.set(m,r),u.querySelector(p)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Ja(m)))return}h=u.createElement("link"),Ct(h,"link",r),Tt(h),u.head.appendChild(h)}}}function IA(r,o,u){di.S(r,o,u);var h=Cr;if(h&&r){var p=Gs(h).hoistableStyles,m=Mr(r);o=o||"default";var v=p.get(m);if(!v){var A={loading:0,preload:null};if(v=h.querySelector(Ga(m)))A.loading=5;else{r=oe({rel:"stylesheet",href:r,"data-precedence":o},u),(u=mn.get(m))&&qh(r,u);var O=v=h.createElement("link");Tt(O),Ct(O,"link",r),O._p=new Promise(function(F,te){O.onload=F,O.onerror=te}),O.addEventListener("load",function(){A.loading|=1}),O.addEventListener("error",function(){A.loading|=2}),A.loading|=4,Yl(v,o,h)}v={type:"stylesheet",instance:v,count:1,state:A},p.set(m,v)}}}function PA(r,o){di.X(r,o);var u=Cr;if(u&&r){var h=Gs(u).hoistableScripts,p=Or(r),m=h.get(p);m||(m=u.querySelector(Ja(p)),m||(r=oe({src:r,async:!0},o),(o=mn.get(p))&&Kh(r,o),m=u.createElement("script"),Tt(m),Ct(m,"link",r),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(p,m))}}function NA(r,o){di.M(r,o);var u=Cr;if(u&&r){var h=Gs(u).hoistableScripts,p=Or(r),m=h.get(p);m||(m=u.querySelector(Ja(p)),m||(r=oe({src:r,async:!0,type:"module"},o),(o=mn.get(p))&&Kh(r,o),m=u.createElement("script"),Tt(m),Ct(m,"link",r),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(p,m))}}function u0(r,o,u,h){var p=(p=Sn.current)?Xl(p):null;if(!p)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Mr(u.href),u=Gs(p).hoistableStyles,h=u.get(o),h||(h={type:"style",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=Mr(u.href);var m=Gs(p).hoistableStyles,v=m.get(r);if(v||(p=p.ownerDocument||p,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(r,v),(m=p.querySelector(Ga(r)))&&!m._p&&(v.instance=m,v.state.loading=5),mn.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},mn.set(r,u),m||DA(p,r,u,v.state))),o&&h===null)throw Error(i(528,""));return v}if(o&&h!==null)throw Error(i(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Or(u),u=Gs(p).hoistableScripts,h=u.get(o),h||(h={type:"script",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Mr(r){return'href="'+on(r)+'"'}function Ga(r){return'link[rel="stylesheet"]['+r+"]"}function f0(r){return oe({},r,{"data-precedence":r.precedence,precedence:null})}function DA(r,o,u,h){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=r.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),Ct(o,"link",u),Tt(o),r.head.appendChild(o))}function Or(r){return'[src="'+on(r)+'"]'}function Ja(r){return"script[async]"+r}function h0(r,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var h=r.querySelector('style[data-href~="'+on(u.href)+'"]');if(h)return o.instance=h,Tt(h),h;var p=oe({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return h=(r.ownerDocument||r).createElement("style"),Tt(h),Ct(h,"style",p),Yl(h,u.precedence,r),o.instance=h;case"stylesheet":p=Mr(u.href);var m=r.querySelector(Ga(p));if(m)return o.state.loading|=4,o.instance=m,Tt(m),m;h=f0(u),(p=mn.get(p))&&qh(h,p),m=(r.ownerDocument||r).createElement("link"),Tt(m);var v=m;return v._p=new Promise(function(A,O){v.onload=A,v.onerror=O}),Ct(m,"link",h),o.state.loading|=4,Yl(m,u.precedence,r),o.instance=m;case"script":return m=Or(u.src),(p=r.querySelector(Ja(m)))?(o.instance=p,Tt(p),p):(h=u,(p=mn.get(m))&&(h=oe({},u),Kh(h,p)),r=r.ownerDocument||r,p=r.createElement("script"),Tt(p),Ct(p,"link",h),r.head.appendChild(p),o.instance=p);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,Yl(h,u.precedence,r));return o.instance}function Yl(r,o,u){for(var h=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=h.length?h[h.length-1]:null,m=p,v=0;v<h.length;v++){var A=h[v];if(A.dataset.precedence===o)m=A;else if(m!==p)break}m?m.parentNode.insertBefore(r,m.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(r,o.firstChild))}function qh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function Kh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var ql=null;function d0(r,o,u){if(ql===null){var h=new Map,p=ql=new Map;p.set(u,h)}else p=ql,h=p.get(u),h||(h=new Map,p.set(u,h));if(h.has(r))return h;for(h.set(r,null),u=u.getElementsByTagName(r),p=0;p<u.length;p++){var m=u[p];if(!(m[da]||m[Dt]||r==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(o)||"";v=r+v;var A=h.get(v);A?A.push(m):h.set(v,[m])}}return h}function g0(r,o,u){r=r.ownerDocument||r,r.head.insertBefore(u,o==="title"?r.querySelector("head > title"):null)}function kA(r,o,u){if(u===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function p0(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var eo=null;function BA(){}function UA(r,o,u){if(eo===null)throw Error(i(475));var h=eo;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var p=Mr(u.href),m=r.querySelector(Ga(p));if(m){r=m._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(h.count++,h=Kl.bind(h),r.then(h,h)),o.state.loading|=4,o.instance=m,Tt(m);return}m=r.ownerDocument||r,u=f0(u),(p=mn.get(p))&&qh(u,p),m=m.createElement("link"),Tt(m);var v=m;v._p=new Promise(function(A,O){v.onload=A,v.onerror=O}),Ct(m,"link",u),o.instance=m}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(h.count++,o=Kl.bind(h),r.addEventListener("load",o),r.addEventListener("error",o))}}function LA(){if(eo===null)throw Error(i(475));var r=eo;return r.stylesheets&&r.count===0&&Zh(r,r.stylesheets),0<r.count?function(o){var u=setTimeout(function(){if(r.stylesheets&&Zh(r,r.stylesheets),r.unsuspend){var h=r.unsuspend;r.unsuspend=null,h()}},6e4);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(u)}}:null}function Kl(){if(this.count--,this.count===0){if(this.stylesheets)Zh(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Zl=null;function Zh(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Zl=new Map,o.forEach(FA,r),Zl=null,Kl.call(r))}function FA(r,o){if(!(o.state.loading&4)){var u=Zl.get(r);if(u)var h=u.get(null);else{u=new Map,Zl.set(r,u);for(var p=r.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<p.length;m++){var v=p[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(u.set(v.dataset.precedence,v),h=v)}h&&u.set(null,h)}p=o.instance,v=p.getAttribute("data-precedence"),m=u.get(v)||h,m===h&&u.set(null,p),u.set(v,p),this.count++,h=Kl.bind(this),p.addEventListener("load",h),p.addEventListener("error",h),m?m.parentNode.insertBefore(p,m.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(p,r.firstChild)),o.state.loading|=4}}var to={$$typeof:b,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function zA(r,o,u,h,p,m,v,A){this.tag=1,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qu(0),this.hiddenUpdates=Qu(null),this.identifierPrefix=h,this.onUncaughtError=p,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=A,this.incompleteTransitions=new Map}function _0(r,o,u,h,p,m,v,A,O,F,te,re){return r=new zA(r,o,u,v,A,O,F,re),o=1,m===!0&&(o|=24),m=pn(3,null,null,o),r.current=m,m.stateNode=r,o=Cf(),o.refCount++,r.pooledCache=o,o.refCount++,m.memoizedState={element:h,isDehydrated:u,cache:o},lh(m),r}function m0(r){return r?(r=lr,r):lr}function y0(r,o,u,h,p,m){p=m0(p),h.context===null?h.context=p:h.pendingContext=p,h=Pi(o),h.payload={element:u},m=m===void 0?null:m,m!==null&&(h.callback=m),u=Ni(r,h,o),u!==null&&(Wt(u,r,o),La(u,r,o))}function b0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<o?u:o}}function Qh(r,o){b0(r,o),(r=r.alternate)&&b0(r,o)}function v0(r){if(r.tag===13){var o=wi(r,67108864);o!==null&&Wt(o,r,67108864),Qh(r,67108864)}}var Ql=!0;function VA(r,o,u,h){var p=J.T;J.T=null;var m=ie.p;try{ie.p=2,Gh(r,o,u,h)}finally{ie.p=m,J.T=p}}function HA(r,o,u,h){var p=J.T;J.T=null;var m=ie.p;try{ie.p=8,Gh(r,o,u,h)}finally{ie.p=m,J.T=p}}function Gh(r,o,u,h){if(Ql){var p=Jh(h);if(p===null)zh(r,o,h,Gl,u),x0(r,h);else if(jA(p,r,o,u,h))h.stopPropagation();else if(x0(r,h),o&4&&-1<WA.indexOf(r)){for(;p!==null;){var m=Qs(p);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=us(m.pendingLanes);if(v!==0){var A=m;for(A.pendingLanes|=2,A.entangledLanes|=2;v;){var O=1<<31-Qt(v);A.entanglements[1]|=O,v&=~O}Hn(m),(nt&6)===0&&(kl=Un()+500,Ka(0))}}break;case 13:A=wi(m,2),A!==null&&Wt(A,m,2),Ll(),Qh(m,2)}if(m=Jh(h),m===null&&zh(r,o,h,Gl,u),m===p)break;p=m}p!==null&&h.stopPropagation()}else zh(r,o,h,null,u)}}function Jh(r){return r=rf(r),ed(r)}var Gl=null;function ed(r){if(Gl=null,r=fs(r),r!==null){var o=I(r);if(o===null)r=null;else{var u=o.tag;if(u===13){if(r=Q(o),r!==null)return r;r=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Gl=r,null}function T0(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(C2()){case $p:return 2;case Xp:return 8;case Yo:case M2:return 32;case Yp:return 268435456;default:return 32}default:return 32}}var td=!1,zi=null,Vi=null,Hi=null,no=new Map,io=new Map,Wi=[],WA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x0(r,o){switch(r){case"focusin":case"focusout":zi=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":no.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":io.delete(o.pointerId)}}function so(r,o,u,h,p,m){return r===null||r.nativeEvent!==m?(r={blockedOn:o,domEventName:u,eventSystemFlags:h,nativeEvent:m,targetContainers:[p]},o!==null&&(o=Qs(o),o!==null&&v0(o)),r):(r.eventSystemFlags|=h,o=r.targetContainers,p!==null&&o.indexOf(p)===-1&&o.push(p),r)}function jA(r,o,u,h,p){switch(o){case"focusin":return zi=so(zi,r,o,u,h,p),!0;case"dragenter":return Vi=so(Vi,r,o,u,h,p),!0;case"mouseover":return Hi=so(Hi,r,o,u,h,p),!0;case"pointerover":var m=p.pointerId;return no.set(m,so(no.get(m)||null,r,o,u,h,p)),!0;case"gotpointercapture":return m=p.pointerId,io.set(m,so(io.get(m)||null,r,o,u,h,p)),!0}return!1}function A0(r){var o=fs(r.target);if(o!==null){var u=I(o);if(u!==null){if(o=u.tag,o===13){if(o=Q(u),o!==null){r.blockedOn=o,L2(r.priority,function(){if(u.tag===13){var h=nn(),p=wi(u,h);p!==null&&Wt(p,u,h),Qh(u,h)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Jl(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var u=Jh(r.nativeEvent);if(u===null){u=r.nativeEvent;var h=new u.constructor(u.type,u);sf=h,u.target.dispatchEvent(h),sf=null}else return o=Qs(u),o!==null&&v0(o),r.blockedOn=u,!1;o.shift()}return!0}function S0(r,o,u){Jl(r)&&u.delete(o)}function $A(){td=!1,zi!==null&&Jl(zi)&&(zi=null),Vi!==null&&Jl(Vi)&&(Vi=null),Hi!==null&&Jl(Hi)&&(Hi=null),no.forEach(S0),io.forEach(S0)}function ec(r,o){r.blockedOn===o&&(r.blockedOn=null,td||(td=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,$A)))}var tc=null;function w0(r){tc!==r&&(tc=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){tc===r&&(tc=null);for(var o=0;o<r.length;o+=3){var u=r[o],h=r[o+1],p=r[o+2];if(typeof h!="function"){if(ed(h||u)===null)continue;break}var m=Qs(u);m!==null&&(r.splice(o,3),o-=3,jf(m,{pending:!0,data:p,method:u.method,action:h},h,p))}}))}function ro(r){function o(O){return ec(O,r)}zi!==null&&ec(zi,r),Vi!==null&&ec(Vi,r),Hi!==null&&ec(Hi,r),no.forEach(o),io.forEach(o);for(var u=0;u<Wi.length;u++){var h=Wi[u];h.blockedOn===r&&(h.blockedOn=null)}for(;0<Wi.length&&(u=Wi[0],u.blockedOn===null);)A0(u),u.blockedOn===null&&Wi.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(h=0;h<u.length;h+=3){var p=u[h],m=u[h+1],v=p[Xt]||null;if(typeof m=="function")v||w0(u);else if(v){var A=null;if(m&&m.hasAttribute("formAction")){if(p=m,v=m[Xt]||null)A=v.formAction;else if(ed(p)!==null)continue}else A=v.action;typeof A=="function"?u[h+1]=A:(u.splice(h,3),h-=3),w0(u)}}}function nd(r){this._internalRoot=r}nc.prototype.render=nd.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(i(409));var u=o.current,h=nn();y0(u,h,r,o,null,null)},nc.prototype.unmount=nd.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;r.tag===0&&wr(),y0(r.current,2,null,r,null,null),Ll(),o[Zs]=null}};function nc(r){this._internalRoot=r}nc.prototype.unstable_scheduleHydration=function(r){if(r){var o=Jp();r={blockedOn:null,target:r,priority:o};for(var u=0;u<Wi.length&&o!==0&&o<Wi[u].priority;u++);Wi.splice(u,0,r),u===0&&A0(r)}};var E0=e.version;if(E0!=="19.0.0")throw Error(i(527,E0,"19.0.0"));ie.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=B(o),r=r!==null?K(r):null,r=r===null?null:r.stateNode,r};var XA={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:J,findFiberByHostInstance:fs,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{ua=ic.inject(XA),Zt=ic}catch{}}return oo.createRoot=function(r,o){if(!s(r))throw Error(i(299));var u=!1,h="",p=Wm,m=jm,v=$m,A=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(p=o.onUncaughtError),o.onCaughtError!==void 0&&(m=o.onCaughtError),o.onRecoverableError!==void 0&&(v=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(A=o.unstable_transitionCallbacks)),o=_0(r,1,!1,null,null,u,h,p,m,v,A,null),r[Zs]=o.current,Fh(r.nodeType===8?r.parentNode:r),new nd(o)},oo.hydrateRoot=function(r,o,u){if(!s(r))throw Error(i(299));var h=!1,p="",m=Wm,v=jm,A=$m,O=null,F=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(m=u.onUncaughtError),u.onCaughtError!==void 0&&(v=u.onCaughtError),u.onRecoverableError!==void 0&&(A=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(O=u.unstable_transitionCallbacks),u.formState!==void 0&&(F=u.formState)),o=_0(r,1,!0,o,u??null,h,p,m,v,A,O,F),o.context=m0(null),u=o.current,h=nn(),p=Pi(h),p.callback=null,Ni(u,p,h),o.current.lanes=h,ha(o,h),Hn(o),r[Zs]=o.current,Fh(r),new nc(o)},oo.version="19.0.0",oo}var B0;function rS(){if(B0)return rd.exports;B0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),rd.exports=sS(),rd.exports}var aS=rS();function jc(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Kg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),U0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);U0&&parseFloat(U0[1]);const sc=globalThis,Ir=globalThis.process||{},oS=globalThis.navigator||{};function O1(n){var i,s;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Ys(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||O1()}function lS(n){return Ys()?O1()?"Electron":(oS.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const I1="4.1.0";function cS(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class uS{constructor(e,t,i="sessionStorage"){this.storage=cS(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function fS(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function hS(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var $c;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})($c||($c={}));const dS=10;function L0(n){return typeof n!="string"?n:(n=n.toUpperCase(),$c[n]||$c.WHITE)}function gS(n,e,t){return!Ys&&typeof n=="string"&&(e&&(n=`\x1B[${L0(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${L0(t)+dS}m${n}\x1B[49m`)),n}function pS(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const a of i){const l=s[a];typeof l=="function"&&(e.find(c=>a===c)||(s[a]=l.bind(n)))}}function Zg(n,e){if(!n)throw new Error("Assertion failed")}function Pr(){var e,t,i;let n;if(Ys()&&sc.performance)n=(t=(e=sc==null?void 0:sc.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ir){const s=(i=Ir==null?void 0:Ir.hrtime)==null?void 0:i.call(Ir);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const Nr={debug:Ys()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},_S={enabled:!0,level:0};function Dr(){}const F0={},z0={once:!0};class Vo{constructor({id:e}={id:""}){this.VERSION=I1,this._startTs=Pr(),this._deltaTs=Pr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new uS(`__probe-${this.id}__`,_S),this.timeStamp(`${this.id} started`),pS(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Pr()-this._startTs).toPrecision(10))}getDelta(){return Number((Pr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Nr.warn,arguments,z0)}error(e){return this._getLogFunction(0,e,Nr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Nr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Nr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Nr.debug||Nr.info,arguments,z0)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Dr,i&&[i],{tag:yS(t)}):Dr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Dr)}group(e,t,i={collapsed:!1}){const s=V0({logLevel:e,message:t,opts:i}),{collapsed:a}=i;return s.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Dr)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=P1(e)}_getLogFunction(e,t,i,s,a){if(this._shouldLog(e)){a=V0({logLevel:e,message:t,args:s,opts:a}),i=i||a.method,Zg(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Pr();const l=a.tag||a.message;if(a.once&&l)if(!F0[l])F0[l]=Pr();else return Dr;return t=mS(this.id,a.message,a),i.bind(console,t,...a.args)}return Dr}}Vo.VERSION=I1;function P1(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Zg(Number.isFinite(e)&&e>=0),e}function V0(n){const{logLevel:e,message:t}=n;n.logLevel=P1(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Zg(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function mS(n,e,t){if(typeof e=="string"){const i=t.time?hS(fS(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=gS(e,t.color,t.background)}return e}function yS(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const cd="4.3.2",bS=cd[0]>="0"&&cd[0]<="9"?`v${cd}`:"";function vS(){const n=new Vo({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=bS,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const TS=vS();function xS(n,e){return N1(n||{},e)}function N1(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?i[s]=N1(i[s]||{},e[s],t+1):i[s]=e[s];return i}const AS="latest";function SS(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const wS=SS();function as(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Us=typeof process!="object"||String(process)!=="[object process]"||process.browser,ES=typeof window<"u"&&typeof window.orientation<"u",H0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);H0&&parseFloat(H0[1]);class RS{constructor(e,t){T(this,"name");T(this,"workerThread");T(this,"isRunning",!0);T(this,"result");T(this,"_resolve",()=>{});T(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){as(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){as(this.isRunning),this.isRunning=!1,this._reject(e)}}class ud{terminate(){}}const fd=new Map;function CS(n){as(n.source&&!n.url||!n.source&&n.url);let e=fd.get(n.source||n.url);return e||(n.url&&(e=MS(n.url),fd.set(n.url,e)),n.source&&(e=D1(n.source),fd.set(n.source,e))),as(e),e}function MS(n){if(!n.startsWith("http"))return n;const e=OS(n);return D1(e)}function D1(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function OS(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function k1(n,e=!0,t){const i=t||new Set;if(n){if(W0(n))i.add(n);else if(W0(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)k1(n[s],e,i)}}return t===void 0?Array.from(i):[]}function W0(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const hd=()=>{};class Qd{constructor(e){T(this,"name");T(this,"source");T(this,"url");T(this,"terminated",!1);T(this,"worker");T(this,"onMessage");T(this,"onError");T(this,"_loadableURL","");const{name:t,source:i,url:s}=e;as(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=hd,this.onError=a=>console.log(a),this.worker=Us?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Us||typeof ud<"u"&&!Us}destroy(){this.onMessage=hd,this.onError=hd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||k1(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=CS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new ud(i,{eval:!1})}else if(this.source)e=new ud(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class IS{constructor(e){T(this,"name","unnamed");T(this,"source");T(this,"url");T(this,"maxConcurrency",1);T(this,"maxMobileConcurrency",1);T(this,"onDebug",()=>{});T(this,"reuseWorkers",!0);T(this,"props",{});T(this,"jobQueue",[]);T(this,"idleQueue",[]);T(this,"count",0);T(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Qd.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,a,l)=>s.done(l),i=(s,a)=>s.error(a)){const s=new Promise(a=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new RS(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Us||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Qd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return ES?this.maxMobileConcurrency:this.maxConcurrency}}const PS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Qi=class Qi{constructor(e){T(this,"props");T(this,"workerPools",new Map);this.props={...PS},this.setProps(e),this.workerPools=new Map}static isSupported(){return Qd.isSupported()}static getWorkerFarm(e={}){return Qi._workerFarm=Qi._workerFarm||new Qi({}),Qi._workerFarm.setProps(e),Qi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let a=this.workerPools.get(t);return a||(a=new IS({name:t,source:i,url:s}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};T(Qi,"_workerFarm");let Xc=Qi;function NS(n,e={}){const t=e[n.id]||{},i=Us?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Us?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let a=n.version;a==="latest"&&(a=AS);const l=a?`@${a}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return as(s),s}function DS(n,e=wS){as(n,"no worker provided");const t=n.version;return!(!e||!t)}function kS(n,e){return!Xc.isSupported()||!Us&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function BS(n,e,t,i,s){const a=n.id,l=NS(n,t),f=Xc.getWorkerFarm(t).getWorkerPool({name:a,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await f.startJob("process-on-worker",US.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function US(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:a,options:l}=i;try{const c=await n(a,l);e.postMessage("done",{id:s,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:s,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function LS(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==s[a])return!1;return!0}function FS(...n){return zS(n)}function zS(n){const e=n.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),t=e.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const a of e)i.set(a,s),s+=a.byteLength;return i.buffer}async function VS(n){const e=[];for await(const t of n)e.push(t);return FS(...e)}function j0(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class $0{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=j0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(j0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ho{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof $0?s=e:s=new $0(t,i),this.stats[t]=s),s}}const HS="Queued Requests",WS="Active Requests",jS="Cancelled Requests",$S="Queued Requests Ever",XS="Active Requests Ever",YS={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class qS{constructor(e={}){T(this,"props");T(this,"stats");T(this,"activeRequestCount",0);T(this,"requestQueue",[]);T(this,"requestMap",new Map);T(this,"updateTimer",null);this.props={...YS,...e},this.stats=new Ho({id:this.props.id}),this.stats.get(HS),this.stats.get(WS),this.stats.get(jS),this.stats.get($S),this.stats.get(XS)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:t},s=new Promise(a=>(i.resolve=a,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const a=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:a}):Promise.resolve({done:a})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let KS="";const X0={};function ZS(n){for(const e in X0)if(n.startsWith(e)){const t=X0[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${KS}${n}`),n}function QS(n){return n&&typeof n=="object"&&n.isBuffer}function B1(n){if(QS(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function U1(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function GS(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const JS=n=>typeof n=="boolean",xo=n=>typeof n=="function",Wo=n=>n!==null&&typeof n=="object",Y0=n=>Wo(n)&&n.constructor==={}.constructor,ew=n=>!!n&&typeof n[Symbol.iterator]=="function",tw=n=>n&&typeof n[Symbol.asyncIterator]=="function",qs=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Ks=n=>typeof Blob<"u"&&n instanceof Blob,nw=n=>n&&typeof n=="object"&&n.isBuffer,iw=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Wo(n)&&xo(n.tee)&&xo(n.cancel)&&xo(n.getReader),sw=n=>Wo(n)&&xo(n.read)&&xo(n.pipe)&&JS(n.readable),L1=n=>iw(n)||sw(n);class rw extends Error{constructor(t,i){super(t);T(this,"reason");T(this,"url");T(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const aw=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ow=/^([-\w.]+\/[-\w.+]+)/;function q0(n,e){return n.toLowerCase()===e.toLowerCase()}function lw(n){const e=ow.exec(n);return e?e[1]:n}function K0(n){const e=aw.exec(n);return e?e[1]:""}const F1=/\?.*/;function cw(n){const e=n.match(F1);return e&&e[0]}function Qg(n){return n.replace(F1,"")}function uw(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Du(n){return qs(n)?n.url:Ks(n)?n.name||"":typeof n=="string"?n:""}function Gg(n){if(qs(n)){const e=n,t=e.headers.get("content-type")||"",i=Qg(e.url);return lw(t)||K0(i)}return Ks(n)?n.type||"":typeof n=="string"?K0(n):""}function fw(n){return qs(n)?n.headers["content-length"]||-1:Ks(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function z1(n){if(qs(n))return n;const e={},t=fw(n);t>=0&&(e["content-length"]=String(t));const i=Du(n),s=Gg(n);s&&(e["content-type"]=s);const a=await gw(n);a&&(e["x-first-bytes"]=a),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function hw(n){if(!n.ok)throw await dw(n)}async function dw(n){const e=uw(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new rw(t,i)}async function gw(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=a=>{var l;return i((l=a==null?void 0:a.target)==null?void 0:l.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${pw(t)}`}return null}function pw(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function _w(n){return!mw(n)&&!yw(n)}function mw(n){return n.startsWith("http:")||n.startsWith("https:")}function yw(n){return n.startsWith("data:")}async function Z0(n,e){var t,i;if(typeof n=="string"){const s=ZS(n);return _w(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(s,e):await fetch(s,e)}return await z1(n)}const Q0=new Vo({id:"loaders.gl"});class bw{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class vw{constructor(){T(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const V1={fetch:null,mimeType:void 0,nothrow:!1,log:new vw,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Kg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Tw={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function H1(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function W1(){const n=H1();return n.globalOptions=n.globalOptions||{...V1},n.globalOptions}function xw(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],Aw(n,t),ww(e,n,i)}function Aw(n,e){G0(n,null,V1,Tw,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};G0(i,t.id,s,a,e)}}function G0(n,e,t,i,s){const a=e||"Top level",l=e?`${e}.`:"";for(const c in n){const f=!e&&Wo(n[c]),d=c==="baseUri"&&!e,g=c==="workerUrl"&&e;if(!(c in t)&&!d&&!g){if(c in i)Q0.warn(`${a} loader option '${l}${c}' no longer supported, use '${i[c]}'`)();else if(!f){const _=Sw(c,s);Q0.warn(`${a} loader option '${l}${c}' not recognized. ${_}`)()}}}}function Sw(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const a in s.options){if(n===a)return`Did you mean '${s.id}.${a}'?`;const l=a.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${a}'?`)}return i}function ww(n,e,t){const s={...n.options||{}};return Ew(s,t),s.log===null&&(s.log=new bw),J0(s,W1()),J0(s,e),s}function J0(n,e){for(const t in e)if(t in e){const i=e[t];Y0(i)&&Y0(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function Ew(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Jg(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function ep(n){jc(n,"null loader"),jc(Jg(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const j1=()=>{const n=H1();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Rw(n){const e=j1();n=Array.isArray(n)?n:[n];for(const t of n){const i=ep(t);e.find(s=>i===s)||e.unshift(i)}}function Cw(){return j1()}const Mw=/\.([^.]+)$/;async function Ow(n,e=[],t,i){if(!$1(n))return null;let s=eb(n,e,{...t,nothrow:!0},i);if(s)return s;if(Ks(n)&&(n=await n.slice(0,10).arrayBuffer(),s=eb(n,e,t,i)),!s&&!(t!=null&&t.nothrow))throw new Error(X1(n));return s}function eb(n,e=[],t,i){if(!$1(n))return null;if(e&&!Array.isArray(e))return ep(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...Cw()),Pw(s);const a=Iw(n,s,t,i);if(!a&&!(t!=null&&t.nothrow))throw new Error(X1(n));return a}function Iw(n,e,t,i){const s=Du(n),a=Gg(n),l=Qg(s)||(i==null?void 0:i.url);let c=null,f="";return t!=null&&t.mimeType&&(c=dd(e,t==null?void 0:t.mimeType),f=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),c=c||Nw(e,l),f=f||(c?`matched url ${l}`:""),c=c||dd(e,a),f=f||(c?`matched MIME type ${a}`:""),c=c||kw(e,n),f=f||(c?`matched initial data ${Y1(n)}`:""),t!=null&&t.fallbackMimeType&&(c=c||dd(e,t==null?void 0:t.fallbackMimeType),f=f||(c?`matched fallback MIME type ${a}`:"")),f&&TS.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${f}.`),c}function $1(n){return!(n instanceof Response&&n.status===204)}function X1(n){const e=Du(n),t=Gg(n);let i="No valid loader found (";i+=e?`${U1(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Y1(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function Pw(n){for(const e of n)ep(e)}function Nw(n,e){const t=e&&Mw.exec(e),i=t&&t[1];return i?Dw(n,i):null}function Dw(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function dd(n,e){var t;for(const i of n)if((t=i.mimeTypes)!=null&&t.some(s=>q0(e,s))||q0(e,`application/x.${i.id}`))return i;return null}function kw(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(Bw(e,t))return t}else if(ArrayBuffer.isView(e)){if(tb(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&tb(e,0,t))return t;return null}function Bw(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function tb(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>Uw(n,e,t,s))}function Uw(n,e,t,i){if(i instanceof ArrayBuffer)return LS(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=Gd(n,e,i.length);return i===s;default:return!1}}function Y1(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Gd(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Gd(n,0,e):""}function Gd(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let a=0;a<t;a++)s+=String.fromCharCode(i.getUint8(e+a));return s}const Lw=256*1024;function*Fw(n,e){const t=(e==null?void 0:e.chunkSize)||Lw;let i=0;const s=new TextEncoder;for(;i<n.length;){const a=Math.min(n.length-i,t),l=n.slice(i,i+a);i+=a,yield s.encode(l)}}const zw=256*1024;function*Vw(n,e={}){const{chunkSize:t=zw}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),a=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(a).set(l),i+=s,yield a}}const Hw=1024*1024;async function*Ww(n,e){const t=(e==null?void 0:e.chunkSize)||Hw;let i=0;for(;i<n.size;){const s=i+t,a=await n.slice(i,s).arrayBuffer();i=s,yield a}}function nb(n,e){return Kg?jw(n,e):$w(n)}async function*jw(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());const{done:a,value:l}=await s;if(a)return;yield B1(l)}}catch{t.releaseLock()}}async function*$w(n,e){for await(const t of n)yield B1(t)}function Xw(n,e){if(typeof n=="string")return Fw(n,e);if(n instanceof ArrayBuffer)return Vw(n,e);if(Ks(n))return Ww(n,e);if(L1(n))return nb(n,e);if(qs(n))return nb(n.body,e);throw new Error("makeIterator")}const q1="Cannot convert supplied data type";function Yw(n,e,t){if(e.text&&typeof n=="string")return n;if(nw(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(q1)}async function qw(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return Yw(n,e);if(Ks(n)&&(n=await z1(n)),qs(n)){const s=n;return await hw(s),e.binary?await s.arrayBuffer():await s.text()}if(L1(n)&&(n=Xw(n,t)),ew(n)||tw(n))return VS(n);throw new Error(q1)}function K1(n,e){const t=W1(),i=n||t;return typeof i.fetch=="function"?i.fetch:Wo(i.fetch)?s=>Z0(s,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Z0}function Kw(n,e,t){if(t)return t;const i={fetch:K1(e,n),...n};if(i.url){const s=Qg(i.url);i.baseUrl=s,i.queryString=cw(i.url),i.filename=U1(s),i.baseUrl=GS(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function Zw(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function Yc(n,e,t,i){e&&!Array.isArray(e)&&!Jg(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Du(n),l=Zw(e,i),c=await Ow(n,l,t);return c?(t=xw(t,c,l,s),i=Kw({url:s,_parse:Yc,loaders:l},t,i||null),await Qw(c,n,t,i)):null}async function Qw(n,e,t,i){if(DS(n),t=xS(n.options,t),qs(e)){const a=e,{ok:l,redirected:c,status:f,statusText:d,type:g,url:_}=a,y=Object.fromEntries(a.headers.entries());i.response={headers:y,ok:l,redirected:c,status:f,statusText:d,type:g,url:_}}e=await qw(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(kS(n,t))return await BS(n,e,t,i,Yc);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw as(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function qc(n,e,t,i){let s,a;!Array.isArray(e)&&!Jg(e)?(s=[],a=e):(s=e,a=t);const l=K1(a);let c=n;return typeof n=="string"&&(c=await l(n)),Ks(n)&&(c=await l(n)),Array.isArray(s)?await Yc(c,s,a):await Yc(c,s,a)}const Gw="4.3.2";var M1;const Jw=(M1=globalThis.loaders)==null?void 0:M1.parseImageNode,Jd=typeof Image<"u",eg=typeof ImageBitmap<"u",eE=!!Jw,tg=Kg?!0:eE;function tE(n){switch(n){case"auto":return eg||Jd||tg;case"imagebitmap":return eg;case"image":return Jd;case"data":return tg;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function nE(){if(eg)return"imagebitmap";if(Jd)return"image";if(tg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function iE(n){const e=rE(n);if(!e)throw new Error("Not an image");return e}function sE(n){switch(iE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function rE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const aE=/^data:image\/svg\+xml/,oE=/\.svg((\?|#).*)?$/;function tp(n){return n&&(aE.test(n)||oE.test(n))}function lE(n,e){if(tp(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Z1(n,e)}function Z1(n,e){if(tp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Q1(n,e,t){const i=lE(n,t),s=self.URL||self.webkitURL,a=typeof i!="string"&&s.createObjectURL(i);try{return await cE(a||i,e)}finally{a&&s.revokeObjectURL(a)}}async function cE(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=a=>{const l=a instanceof Error?a.message:"error";s(new Error(l))}}catch(a){s(a)}})}const uE={};let ib=!0;async function fE(n,e,t){let i;tp(t)?i=await Q1(n,e,t):i=Z1(n,t);const s=e&&e.imagebitmap;return await hE(i,s)}async function hE(n,e=null){if((dE(e)||!ib)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),ib=!1}return await createImageBitmap(n)}function dE(n){for(const e in n||uE)return!1;return!0}function gE(n){return!yE(n,"ftyp",4)||(n[8]&96)===0?null:pE(n)}function pE(n){switch(_E(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function _E(n,e,t){return String.fromCharCode(...n.slice(e,t))}function mE(n){return[...n].map(e=>e.charCodeAt(0))}function yE(n,e,t=0){const i=mE(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const Yn=!1,Ao=!0;function G1(n){const e=jo(n);return vE(e)||AE(e)||TE(e)||xE(e)||bE(e)}function bE(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=gE(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function vE(n){const e=jo(n);return e.byteLength>=24&&e.getUint32(0,Yn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yn),height:e.getUint32(20,Yn)}:null}function TE(n){const e=jo(n);return e.byteLength>=10&&e.getUint32(0,Yn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ao),height:e.getUint16(8,Ao)}:null}function xE(n){const e=jo(n);return e.byteLength>=14&&e.getUint16(0,Yn)===16973&&e.getUint32(2,Ao)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ao),height:e.getUint32(22,Ao)}:null}function AE(n){const e=jo(n);if(!(e.byteLength>=3&&e.getUint16(0,Yn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=SE();let a=2;for(;a+9<e.byteLength;){const l=e.getUint16(a,Yn);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(a+5,Yn),width:e.getUint16(a+7,Yn)};if(!i.has(l))return null;a+=2,a+=e.getUint16(a,Yn)}return null}function SE(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function jo(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function wE(n,e){var s;const{mimeType:t}=G1(n)||{},i=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return jc(i),await i(n,t)}async function EE(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:a}=t||{},l=RE(s);let c;switch(l){case"imagebitmap":c=await fE(n,e,a);break;case"image":c=await Q1(n,e,a);break;case"data":c=await wE(n);break;default:jc(!1)}return s==="data"&&(c=sE(c)),c}function RE(n){switch(n){case"auto":case"data":return nE();default:return tE(n),n}}const CE=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ME=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],OE={image:{type:"auto",decode:!0}},IE={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Gw,mimeTypes:ME,extensions:CE,parse:EE,tests:[n=>!!G1(new DataView(n))],options:OE},De=new Vo({id:"deck"});let ng={};function PE(n){ng=n}function zt(n,e,t,i){De.level>0&&ng[n]&&ng[n].call(null,e,t,i)}function NE(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const DE={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:NE,parseTextSync:JSON.parse};function kE(){const n="9.1.5",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(De.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:De,_registerLoggers:PE},Rw([DE,[IE,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const BE=kE();function np(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const gd={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function UE(n){const e={};for(const[t,i]of Object.entries(n))e[t]=LE(i);return e}function LE(n){let e=sb(n);if(e!=="object")return{value:n,...gd[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...gd[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=sb(n.value),{...n,...gd[e],type:e}):{type:"object",value:null};throw new Error("props")}function sb(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const FE=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,zE=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,VE={vertex:FE,fragment:zE},rb=/void\s+main\s*\([^)]*\)\s*\{\n?/,ab=/}\n?[^{}]*$/,pd=[],Ic="__LUMA_INJECT_DECLARATIONS__";function HE(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=WE(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function WE(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Kc(n,e,t,i=!1){const s=e==="vertex";for(const a in t){const l=t[a];l.sort((f,d)=>f.order-d.order),pd.length=l.length;for(let f=0,d=l.length;f<d;++f)pd[f]=l[f].injection;const c=`${pd.join(`
`)}
`;switch(a){case"vs:#decl":s&&(n=n.replace(Ic,c));break;case"vs:#main-start":s&&(n=n.replace(rb,f=>f+c));break;case"vs:#main-end":s&&(n=n.replace(ab,f=>c+f));break;case"fs:#decl":s||(n=n.replace(Ic,c));break;case"fs:#main-start":s||(n=n.replace(rb,f=>f+c));break;case"fs:#main-end":s||(n=n.replace(ab,f=>c+f));break;default:n=n.replace(a,f=>f+c)}}return n=n.replace(Ic,""),i&&(n=n.replace(/\}\s*$/,a=>a+VE[e])),n}function Zc(n){n.map(e=>jE(e))}function jE(n){if(n.instance)return;Zc(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:HE(i),parsedDeprecations:$E(t)};e&&(s.propValidators=UE(e)),n.instance=s;let a={};e&&(a=Object.entries(e).reduce((l,[c,f])=>{const d=f==null?void 0:f.value;return d&&(l[c]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...a}}function J1(n,e,t){var i;(i=n.deprecations)==null||i.forEach(s=>{var a;(a=s.regex)!=null&&a.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function $E(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function ip(n){Zc(n);const e={},t={};eT({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,a)=>t[a]-t[s]).map(s=>e[s]);return Zc(i),i}function eT(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(s[a.name]===void 0||s[a.name]<t)&&(s[a.name]=t);for(const a of e)a.dependencies&&eT({modules:a.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function XE(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function YE(n,e){var i;if(Number(((i=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=ob(n,qE),n;case"fragment":return n=ob(n,KE),n;default:throw new Error(e)}}const tT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qE=[...tT,[ig("attribute"),"in $1"],[ig("varying"),"out $1"]],KE=[...tT,[ig("varying"),"in $1"]];function ob(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function ig(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function nT(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const a=e[i];a.sort((l,c)=>l.order-c.order);for(const l of a)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function iT(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[a,l]=s.split(":"),c=s.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(a){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(a)}}return e}function ZE(n,e){return{name:QE(n,e),language:"glsl",version:GE(n)}}function QE(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function GE(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const sT=`

${Ic}
`,JE=`precision highp float;
`;function eR(n){const e=ip(n.modules||[]);return{source:nR(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:rT(e)}}function tR(n){const{vs:e,fs:t}=n,i=ip(n.modules||[]);return{vs:lb(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:lb(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:rT(i)}}function nR(n,e){var E;const{source:t,stage:i,modules:s,hookFunctions:a=[],inject:l={},log:c}=e;np(typeof t=="string","shader source must be a string");const f=t;let d="";const g=iT(a),_={},y={},b={};for(const M in l){const N=typeof l[M]=="string"?{injection:l[M],order:0}:l[M],V=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(V){const P=V[2],H=V[3];P?H==="decl"?y[M]=[N]:b[M]=[N]:_[M]=[N]}else b[M]=[N]}const x=s;for(const M of x){c&&J1(M,f,c);const N=aT(M,"wgsl");d+=N;const V=((E=M.injections)==null?void 0:E[i])||{};for(const P in V){const H=/^(v|f)s:#([\w-]+)$/.exec(P);if(H){const Z=H[2]==="decl"?y:b;Z[P]=Z[P]||[],Z[P].push(V[P])}else _[P]=_[P]||[],_[P].push(V[P])}}return d+=sT,d=Kc(d,i,y),d+=nT(g[i],_),d+=f,d=Kc(d,i,b),d}function lb(n,e){var he;const{id:t,source:i,stage:s,language:a="glsl",modules:l,defines:c={},hookFunctions:f=[],inject:d={},prologue:g=!0,log:_}=e;np(typeof i=="string","shader source must be a string");const y=a==="glsl"?ZE(i).version:-1,b=n.shaderLanguageVersion,x=y===100?"#version 100":"#version 300 es",M=i.split(`
`).slice(1).join(`
`),N={};l.forEach(ue=>{Object.assign(N,ue.defines)}),Object.assign(N,c);let V="";switch(a){case"wgsl":break;case"glsl":V=g?`${x}

// ----- PROLOGUE -------------------------
${iR({id:t,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${XE(n)}
${s==="fragment"?JE:""}

// ----- APPLICATION DEFINES -------------------------

${sR(N)}

`:`${x}
`;break}const P=iT(f),H={},X={},Z={};for(const ue in d){const J=typeof d[ue]=="string"?{injection:d[ue],order:0}:d[ue],oe=/^(v|f)s:(#)?([\w-]+)$/.exec(ue);if(oe){const de=oe[2],ve=oe[3];de?ve==="decl"?X[ue]=[J]:Z[ue]=[J]:H[ue]=[J]}else Z[ue]=[J]}for(const ue of l){_&&J1(ue,M,_);const J=aT(ue,s);V+=J;const oe=((he=ue.instance)==null?void 0:he.normalizedInjections[s])||{};for(const de in oe){const ve=/^(v|f)s:#([\w-]+)$/.exec(de);if(ve){const Se=ve[2]==="decl"?X:Z;Se[de]=Se[de]||[],Se[de].push(oe[de])}else H[de]=H[de]||[],H[de].push(oe[de])}}return V+="// ----- MAIN SHADER SOURCE -------------------------",V+=sT,V=Kc(V,s,X),V+=nT(P[s],H),V+=M,V=Kc(V,s,Z),a==="glsl"&&y!==b&&(V=YE(V,s)),V.trim()}function rT(n){return function(t){var s;const i={};for(const a of n){const l=(s=a.getUniforms)==null?void 0:s.call(a,t,i);Object.assign(i,l)}return i}}function iR(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function sR(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function aT(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:np(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const rR=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,aR=/^\s*\#\s*endif\s*$/;function oR(n,e){var l;const t=n.split(`
`),i=[];let s=!0,a=null;for(const c of t){const f=c.match(rR),d=c.match(aR);f?(a=f[1],s=!!((l=e==null?void 0:e.defines)!=null&&l[a])):d?s=!0:s&&i.push(c)}return i.join(`
`)}const ks=class ks{constructor(){T(this,"_hookFunctions",[]);T(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return ks.defaultShaderAssembler=ks.defaultShaderAssembler||new ks,ks.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:a}=eR({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?oR(s):s,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...tR({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let a=0,l=this._defaultModules.length;a<l;++a){const c=this._defaultModules[a],f=c.name;t[s++]=c,i[f]=!0}for(let a=0,l=e.length;a<l;++a){const c=e[a],f=c.name;i[f]||(t[s++]=c,i[f]=!0)}return t.length=s,Zc(t),t}};T(ks,"defaultShaderAssembler");let Qc=ks;const lR=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,cR=`#version 300 es
${lR}`;function uR(n){const{input:e,inputChannels:t,output:i}={};if(!e)return cR;if(!t)throw new Error("inputChannels");const s=fR(t),a=hR(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function fR(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function hR(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class dR{constructor(){T(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ho({id:e})),this.stats.get(e)}}const oT=new dR,ae=new Vo({id:"luma.gl"}),_d={};function ku(n="id"){_d[n]=_d[n]||1;const e=_d[n]++;return`${n}-${e}`}var Zd;let Ye=(Zd=class{constructor(e,t,i){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"_device");T(this,"destroyed",!1);T(this,"allocatedBytes",0);T(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=gR(t,i);const s=this.props.id!=="undefined"?this.props.id:ku(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},T(Zd,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Zd);function gR(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}const Mt=class Mt extends Ye{constructor(t,i){const s={...i};(i.usage||0)&Mt.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?s.indexType="uint32":i.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,Mt.defaultProps);T(this,"usage");T(this,"indexType");T(this,"updateTimestamp");T(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,i){throw new Error("not implemented")}_setDebugData(t,i,s){const a=ArrayBuffer.isView(t)?t.buffer:t,l=Math.min(t?t.byteLength:s,Mt.DEBUG_DATA_MAX_LENGTH);a===null?this.debugData=new ArrayBuffer(l):i===0&&s===a.byteLength?this.debugData=a.slice(0,l):this.debugData=a.slice(i,i+l)}};T(Mt,"defaultProps",{...Ye.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),T(Mt,"MAP_READ",1),T(Mt,"MAP_WRITE",2),T(Mt,"COPY_SRC",4),T(Mt,"COPY_DST",8),T(Mt,"INDEX",16),T(Mt,"VERTEX",32),T(Mt,"UNIFORM",64),T(Mt,"STORAGE",128),T(Mt,"INDIRECT",256),T(Mt,"QUERY_RESOLVE",512),T(Mt,"DEBUG_DATA_MAX_LENGTH",32);let Je=Mt;function lT(n){const e=cb[n],t=pR(e),i=n.includes("norm"),s=!i&&!n.startsWith("float"),a=n.startsWith("s");return{dataType:cb[n],byteLength:t,integer:s,signed:a,normalized:i}}function pR(n){return _R[n]}const cb={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},_R={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ut="texture-compression-bc",Xe="texture-compression-astc",Wn="texture-compression-etc2",mR="texture-compression-etc1-webgl",rc="texture-compression-pvrtc-webgl",md="texture-compression-atc-webgl",ac="float32-renderable-webgl",yd="float16-renderable-webgl",yR="rgb9e5ufloat-renderable-webgl",bd="snorm8-renderable-webgl",lo="norm16-renderable-webgl",vd="snorm16-renderable-webgl",oc="float32-filterable",ub="float16-filterable-webgl";function cT(n){const e=bR[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const bR={r8unorm:{},r8snorm:{render:bd},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:bd},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:yd,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:lo},"r16snorm-webgl":{f:vd},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:bd},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:yd,filter:ub},"rg16unorm-webgl":{render:lo},"rg16snorm-webgl":{render:vd},r32uint:{},r32sint:{},r32float:{render:ac,filter:oc},rgb9e5ufloat:{channels:"rgb",packed:!0,render:yR},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:ac},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:lo},"rgb16snorm-webgl":{f:lo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:oc},rgba16uint:{},rgba16sint:{},rgba16float:{render:yd,filter:ub},"rgba16unorm-webgl":{render:lo},"rgba16snorm-webgl":{render:vd},"rgb32float-webgl":{render:ac,filter:oc},rgba32uint:{},rgba32sint:{},rgba32float:{render:ac,filter:oc},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ut},"bc1-rgb-unorm-srgb-webgl":{f:Ut},"bc1-rgba-unorm":{f:Ut},"bc1-rgba-unorm-srgb":{f:Ut},"bc2-rgba-unorm":{f:Ut},"bc2-rgba-unorm-srgb":{f:Ut},"bc3-rgba-unorm":{f:Ut},"bc3-rgba-unorm-srgb":{f:Ut},"bc4-r-unorm":{f:Ut},"bc4-r-snorm":{f:Ut},"bc5-rg-unorm":{f:Ut},"bc5-rg-snorm":{f:Ut},"bc6h-rgb-ufloat":{f:Ut},"bc6h-rgb-float":{f:Ut},"bc7-rgba-unorm":{f:Ut},"bc7-rgba-unorm-srgb":{f:Ut},"etc2-rgb8unorm":{f:Wn},"etc2-rgb8unorm-srgb":{f:Wn},"etc2-rgb8a1unorm":{f:Wn},"etc2-rgb8a1unorm-srgb":{f:Wn},"etc2-rgba8unorm":{f:Wn},"etc2-rgba8unorm-srgb":{f:Wn},"eac-r11unorm":{f:Wn},"eac-r11snorm":{f:Wn},"eac-rg11unorm":{f:Wn},"eac-rg11snorm":{f:Wn},"astc-4x4-unorm":{f:Xe},"astc-4x4-unorm-srgb":{f:Xe},"astc-5x4-unorm":{f:Xe},"astc-5x4-unorm-srgb":{f:Xe},"astc-5x5-unorm":{f:Xe},"astc-5x5-unorm-srgb":{f:Xe},"astc-6x5-unorm":{f:Xe},"astc-6x5-unorm-srgb":{f:Xe},"astc-6x6-unorm":{f:Xe},"astc-6x6-unorm-srgb":{f:Xe},"astc-8x5-unorm":{f:Xe},"astc-8x5-unorm-srgb":{f:Xe},"astc-8x6-unorm":{f:Xe},"astc-8x6-unorm-srgb":{f:Xe},"astc-8x8-unorm":{f:Xe},"astc-8x8-unorm-srgb":{f:Xe},"astc-10x5-unorm":{f:Xe},"astc-10x5-unorm-srgb":{f:Xe},"astc-10x6-unorm":{f:Xe},"astc-10x6-unorm-srgb":{f:Xe},"astc-10x8-unorm":{f:Xe},"astc-10x8-unorm-srgb":{f:Xe},"astc-10x10-unorm":{f:Xe},"astc-10x10-unorm-srgb":{f:Xe},"astc-12x10-unorm":{f:Xe},"astc-12x10-unorm-srgb":{f:Xe},"astc-12x12-unorm":{f:Xe},"astc-12x12-unorm-srgb":{f:Xe},"pvrtc-rgb4unorm-webgl":{f:rc},"pvrtc-rgba4unorm-webgl":{f:rc},"pvrtc-rbg2unorm-webgl":{f:rc},"pvrtc-rgba2unorm-webgl":{f:rc},"etc1-rbg-unorm-webgl":{f:mR},"atc-rgb-unorm-webgl":{f:md},"atc-rgba-unorm-webgl":{f:md},"atc-rgbai-unorm-webgl":{f:md}},vR=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],TR=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function uT(n){return vR.some(e=>n.startsWith(e))}function sp(n){let e=xR(n);if(uT(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=AR(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=TR.exec(n);if(t){const[,i,s,a,l,c]=t,f=`${a}${s}`,d=lT(f),g=d.byteLength*8,_=i.length,y=[g,_>=2?g:0,_>=3?g:0,_>=4?g:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function xR(n){var a;const e=cT(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((a=e.channels)==null?void 0:a.length)||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function AR(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function SR(n){const e=cT(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=sp(n),s=n.startsWith("depth")||n.startsWith("stencil"),a=i==null?void 0:i.signed,l=i==null?void 0:i.integer,c=i==null?void 0:i.webgl;return t.render&&(t.render=!a),t.filter&&(t.filter=!s&&!a&&!l&&!c),t}class wR{}class ER{constructor(e=[],t){T(this,"features");T(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const bu=class bu{constructor(e){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"statsManager",oT);T(this,"timestamp",0);T(this,"_reused",!1);T(this,"_lumaData",{});this.props={...bu.defaultProps,...e},this.id=this.props.id||ku(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=SR(e),i=l=>(typeof l=="string"?this.features.has(l):l)??!0,s=i(t.create),a={format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(a)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return uT(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Je.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ae.warn("indices buffer content must be of integer type")()),t}};T(bu,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ae.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ae.get("debug")||void 0,debugShaders:ae.get("debug-shaders")||void 0,debugFramebuffers:!!ae.get("debug-framebuffers"),debugWebGL:!!ae.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let is=bu;const RR=Ys()&&typeof document<"u",CR=()=>RR&&document.readyState==="complete",MR="set luma.log.level=1 (or higher) to trace rendering",fb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Gi=class Gi{constructor(){T(this,"stats",oT);T(this,"log",ae);T(this,"VERSION","9.1.5");T(this,"spector");T(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ae.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ae.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ae.error("This version of luma.gl has already been initialized")()}ae.log(1,`${this.VERSION} - ${MR}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>{var s;return(s=i.isSupported)==null?void 0:s.call(i)}).map(i=>i.type)}getBestAvailableAdapter(e=[]){var i,s,a,l;const t=this.getAdapterMap(e);return(s=(i=t.get("webgpu"))==null?void 0:i.isSupported)!=null&&s.call(i)?"webgpu":(l=(a=t.get("webgl"))==null?void 0:a.isSupported)!=null&&l.call(a)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Gi.defaultProps,e)}async createDevice(e={}){var c;e={...Gi.defaultProps,...e},e.waitForPageLoad&&await Gi.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const a=(this.getAdapterMap(e.adapters)||t).get(i),l=await((c=a==null?void 0:a.create)==null?void 0:c.call(a,e));if(l)return l;throw new Error(fb)}async attachDevice(e){var l;const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await Gi.pageLoaded,e.handle===null&&(i="unknown");const s=t.get(i),a=await((l=s==null?void 0:s.attach)==null?void 0:l.call(s,null));if(a)return a;throw new Error(fb)}enforceWebGL2(e=!0,t=[]){var a;const s=this.getAdapterMap(t).get("webgl");s||ae.warn("enforceWebGL2: webgl adapter not found")(),(a=s==null?void 0:s.enforceWebGL2)==null||a.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){ae.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}};T(Gi,"defaultProps",{...is.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),T(Gi,"pageLoaded",OR().then(()=>{ae.probe(2,"DOM is loaded")()}));let sg=Gi;const rg=new sg;function OR(){return CR()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class IR{}const vu=class vu{constructor(e){T(this,"id");T(this,"props");T(this,"canvas");T(this,"htmlCanvas");T(this,"offscreenCanvas");T(this,"type");T(this,"width",1);T(this,"height",1);T(this,"resizeObserver");T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...vu.defaultProps,...e},e=this.props,!Ys()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=NR(e.canvas):this.canvas=e.canvas;else{const t=DR(e),i=PR((e==null?void 0:e.container)||null);i.insertBefore(t,i.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return i?t/i:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,a]=this.getDrawingBufferSize();return kR(e,i,s,a,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!s)&&(ae.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==s||a.devicePixelRatio!==e){let l=e;const c=Math.floor(i*l),f=Math.floor(s*l);if(this.htmlCanvas.width=c,this.htmlCanvas.height=f,this.device.gl){const[g,_]=this.getDrawingBufferSize();(g!==c||_!==f)&&(l=Math.min(g/i,_/s),this.htmlCanvas.width=Math.floor(i*l),this.htmlCanvas.height=Math.floor(s*l),ae.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};T(vu,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let ag=vu;function PR(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function NR(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function DR(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=ku("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function kR(n,e,t,i,s){const a=n,l=hb(a[0],e,t);let c=db(a[1],e,i,s),f=hb(a[0]+1,e,t);const d=f===t-1?f:f-1;f=db(a[1]+1,e,i,s);let g;return s?(f=f===0?f:f+1,g=c,c=f):g=f===i-1?f:f-1,{x:l,y:c,width:Math.max(d-l+1,1),height:Math.max(g-c+1,1)}}function hb(n,e,t){return Math.min(Math.round(n*e),t-1)}function db(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Ot=class Ot extends Ye{constructor(t,i){i=Ot.normalizeProps(t,i);super(t,i,Ot.defaultProps);T(this,"dimension");T(this,"format");T(this,"width");T(this,"height");T(this,"depth");T(this,"mipLevels");T(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=Ot.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Ot.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const i=t==null?void 0:t.data;return ArrayBuffer.isView(i)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Ot.getTextureDataSize(t[0]);if(Ot.isExternalImage(t))return Ot.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,i){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:i.width,height:i.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,i){return Math.floor(Math.log2(Math.max(t,i)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,i){var f,d;const s={...i},a=((d=(f=t==null?void 0:t.props)==null?void 0:f._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(s,a);const{width:l,height:c}=s;return typeof l=="number"&&(s.width=Math.max(1,Math.ceil(l))),typeof c=="number"&&(s.height=Math.max(1,Math.ceil(c))),s}};T(Ot,"COPY_SRC",1),T(Ot,"COPY_DST",2),T(Ot,"TEXTURE",4),T(Ot,"STORAGE",8),T(Ot,"RENDER_ATTACHMENT",16),T(Ot,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),T(Ot,"defaultProps",{...Ye.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),T(Ot,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let lt=Ot;const Tu=class Tu extends Ye{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Tu.defaultProps)}};T(Tu,"defaultProps",{...Ye.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Gc=Tu;function BR(n,e,t){let i="";const s=e.split(/\r?\n/),a=n.slice().sort((l,c)=>l.lineNum-c.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let l=0;for(let c=1;c<=s.length;c++)for(i+=fT(s[c-1],c,t);a.length>l&&a[l].lineNum===c;){const f=a[l++];i+=gb(f,s,f.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const c of n)i+=gb(c,s,c.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return i}}function gb(n,e,t,i){if(i!=null&&i.inlineSource){const a=UR(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${a}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function UR(n,e,t){let i="";for(let s=e-2;s<=e;s++){const a=n[s-1];a!==void 0&&(i+=fT(a,e,t))}return i}function fT(n,e,t){const i=t!=null&&t.html?FR(n):n;return`${LR(String(e),4)}: ${i}${t!=null&&t.html?"<br/>":`
`}`}function LR(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function FR(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const xu=class xu extends Ye{constructor(t,i){i={...i,debugShaders:i.debugShaders||t.props.debugShaders||"errors"};super(t,{id:zR(i),...i},xu.defaultProps);T(this,"stage");T(this,"source");T(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();t==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(t){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=hT(this.source),s=`${this.stage} ${i}`;let a=BR(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),c.onclick=()=>{const g=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(g)}}};T(xu,"defaultProps",{...Ye.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Jc=xu;function zR(n){return hT(n.source)||n.id||ku(`unnamed ${n.stage}-shader`)}function hT(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}const Io=class Io extends Ye{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Io.normalizeProps(e,t),super(e,t,Io.defaultProps)}static normalizeProps(e,t){var a,l;const i=((l=(a=e==null?void 0:e.props)==null?void 0:a._resourceDefaults)==null?void 0:l.sampler)||{};return{...t,...i}}};T(Io,"defaultProps",{...Ye.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let eu=Io;const Au=class Au extends Ye{constructor(t,i={}){super(t,i,Au.defaultProps);T(this,"width");T(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const i=this.colorAttachments.map(a=>a.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:s})}resize(t){let i=!t;if(t){const[s,a]=Array.isArray(t)?t:[t.width,t.height];i=i||a!==this.height||s!==this.width,this.width=s,this.height=a}i&&(ae.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,s)=>{if(typeof i=="string"){const a=this.createColorTexture(i,s);return this.attachResource(a),a.view}return i instanceof lt?i.view:i});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const i=this.createDepthStencilTexture(t);this.attachResource(i),this.depthStencilAttachment=i.view}else t instanceof lt?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:lt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:lt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,i){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const a=this.colorAttachments[s].texture.clone({width:t,height:i});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};T(Au,"defaultProps",{...Ye.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let tu=Au;const Su=class Su extends Ye{constructor(t,i){super(t,i,Su.defaultProps);T(this,"shaderLayout");T(this,"bufferLayout");T(this,"linkStatus","pending");T(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};T(Su,"defaultProps",{...Ye.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Qr=Su;const In=class In extends Ye{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=In.normalizeProps(e,t),super(e,t,In.defaultProps)}static normalizeProps(e,t){var a;return{...(a=e.props._resourceDefaults)==null?void 0:a.renderPass,...t}}};T(In,"defaultClearColor",[0,0,0,1]),T(In,"defaultClearDepth",1),T(In,"defaultClearStencil",0),T(In,"defaultProps",{...Ye.defaultProps,framebuffer:null,parameters:void 0,clearColor:In.defaultClearColor,clearColors:void 0,clearDepth:In.defaultClearDepth,clearStencil:In.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let og=In;const wu=class wu extends Ye{constructor(t,i){super(t,i,wu.defaultProps);T(this,"hash","");T(this,"shaderLayout");this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};T(wu,"defaultProps",{...Ye.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let nu=wu;const Eu=class Eu extends Ye{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Eu.defaultProps)}};T(Eu,"defaultProps",{...Ye.defaultProps,measureExecutionTime:void 0});let lg=Eu;const Ru=class Ru extends Ye{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Ru.defaultProps)}};T(Ru,"defaultProps",{...Ye.defaultProps});let cg=Ru;function VR(n){const[e,t]=WR[n],i=e==="i32"||e==="u32",s=e!=="u32",a=jR[e]*t,l=HR(e,t);return{dataType:e,components:t,defaultVertexFormat:l,byteLength:a,integer:i,signed:s}}function HR(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const WR={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},jR={f32:4,f16:2,i32:4,u32:4};function dT(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,a=i?parseInt(i):1,l=lT(s),c={type:s,components:a,byteLength:l.byteLength*a,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(c.webglOnly=!0),c}function gT(n,e){const t={};for(const i of n.attributes){const s=XR(n,e,i.name);s&&(t[i.name]=s)}return t}function $R(n,e,t=16){const i=gT(n,e),s=new Array(t).fill(null);for(const a of Object.values(i))s[a.location]=a;return s}function XR(n,e,t){const i=YR(n,t),s=qR(e,t);if(!i)return null;const a=VR(i.type),l=(s==null?void 0:s.vertexFormat)||a.defaultVertexFormat,c=dT(l);return{attributeName:(s==null?void 0:s.attributeName)||i.name,bufferName:(s==null?void 0:s.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:l,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:a.integer,stepMode:(s==null?void 0:s.stepMode)||i.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function YR(n,e){const t=n.attributes.find(i=>i.name===e);return t||ae.warn(`shader layout attribute "${e}" not present in shader`),t||null}function qR(n,e){KR(n);let t=ZR(n,e);return t||(t=QR(n,e),t)?t:(ae.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function KR(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ae.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function ZR(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function QR(n,e){var t;for(const i of n){let s=i.byteStride;if(typeof i.byteStride!="number")for(const l of i.attributes||[]){const c=dT(l.format);s+=c.byteLength}const a=(t=i.attributes)==null?void 0:t.find(l=>l.attribute===e);if(a)return{attributeName:a.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:s}}return null}const Cu=class Cu extends Ye{constructor(t,i){super(t,i,Cu.defaultProps);T(this,"maxVertexAttributes");T(this,"attributeInfos");T(this,"indexBuffer",null);T(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:a}=i.renderPipeline||{};if(!s||!a)throw new Error("VertexArray");this.attributeInfos=$R(s,a,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,i){this.device.reportError(new Error("constant attributes not supported"))}};T(Cu,"defaultProps",{...Ye.defaultProps,renderPipeline:null});let ug=Cu;const Mu=class Mu extends Ye{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Mu.defaultProps)}};T(Mu,"defaultProps",{...Ye.defaultProps,layout:void 0,buffers:{}});let fg=Mu;const Ou=class Ou extends Ye{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Ou.defaultProps)}};T(Ou,"defaultProps",{...Ye.defaultProps,type:void 0,count:void 0});let hg=Ou;const GR={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function JR(n){return GR[n]}function eC(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let lc;function pT(n){return(!lc||lc.byteLength<n)&&(lc=new ArrayBuffer(n)),lc}function tC(n,e){const t=pT(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function nC(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function iu(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":nC(n)}const pb=1024;class iC{constructor(e){T(this,"layout",{});T(this,"byteLength");let t=0;for(const[s,a]of Object.entries(e)){const l=JR(a),{type:c,components:f}=l;t=eC(t,f);const d=t;t+=f,this.layout[s]={type:c,size:f,offset:d}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,pb)}getData(e){const t=Math.max(this.byteLength,pb),i=pT(t),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[a,l]of Object.entries(e)){const c=this.layout[a];if(!c){ae.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:f,size:d,offset:g}=c,_=s[f];if(d===1){if(typeof l!="number"&&typeof l!="boolean"){ae.warn(`Supplied value for single component uniform ${a} is not a number: ${l}`)();continue}_[g]=Number(l)}else{if(!iu(l)){ae.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${l}`)();continue}_.set(l,g)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function sC(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!iu(i))return!1;if(iu(s)&&i.length===s.length){for(let a=0;a<i.length;++a)if(s[a]!==i[a])return!1}return!0}function rC(n){return iu(n)?n.slice():n}class aC{constructor(e){T(this,"name");T(this,"uniforms",{});T(this,"modifiedUniforms",{});T(this,"modified",!0);T(this,"bindingLayout",{});T(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(a=>a.type==="uniform"&&a.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const s=i;for(const a of s.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){sC(this.uniforms[e],t)||(this.uniforms[e]=rC(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class oC{constructor(e){T(this,"uniformBlocks",new Map);T(this,"uniformBufferLayouts",new Map);T(this,"uniformBuffers",new Map);for(const[t,i]of Object.entries(e)){const s=t,a=new iC(i.uniformTypes||{});this.uniformBufferLayouts.set(s,a);const l=new aC({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[i,s]of Object.entries(e))(t=this.uniformBlocks.get(i))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var i,s;const t=((i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),a=e.createBuffer({usage:Je.UNIFORM|Je.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return a.write(l),a}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Je.UNIFORM|Je.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||(e=i)}return e&&ae.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var a;const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const l=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i==null||i.write(l);const c=(a=this.uniformBlocks.get(e))==null?void 0:a.getAllUniforms();ae.log(4,`Writing to uniform buffer ${String(e)}`,l,c)()}return s}}function _T(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function mT(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function lC(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=_T(n);if(s==="uint8"&&t&&i===1)return"unorm8-webgl";if(s==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class Td{constructor(e){T(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(i=>i.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const a=i.findIndex(l=>l.name===s.name);a<0?i.push(s):i[a]=s}return i}}class yn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class _b{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ji extends yn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ss extends yn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class Hs extends yn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Zi;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Zi||(Zi={}));class cc{constructor(e,t,i,s,a,l,c){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=a,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class cC{constructor(e,t){this.name=e,this.type=t}}class uC{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}class mb{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}}class fC{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class hC{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class dC{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class gC{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const yT=new Float32Array(1),pC=new Int32Array(yT.buffer),Lt=new Uint16Array(1);function _C(n){yT[0]=n;const e=pC[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Lt[0]=t<<15|31744|(s!==0?512:0),Lt[0];if(i===0){if(s===0)return Lt[0]=t<<15,Lt[0];s|=8388608;let a=113;for(;!(8388608&s);)s<<=1,a--;return i=127-a,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Lt[0]=t<<15|i<<10|s>>13,Lt[0]):(Lt[0]=t<<15,Lt[0])}return i=i-127+15,i>=31?(Lt[0]=t<<15|31744,Lt[0]):i<=0?i<-10?(Lt[0]=t<<15,Lt[0]):(s=(8388608|s)>>1-i,Lt[0]=t<<15|s>>13,Lt[0]):(s>>=13,Lt[0]=t<<15|i<<10|s,Lt[0])}const rp=new Uint32Array(1),bT=new Float32Array(rp.buffer,0,1);function yb(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return rp[0]=e,bT[0]}function mC(n,e,t,i,s,a,l,c,f){const d=i*(l>>=s)*(a>>=s)+t*l+e*c;switch(f){case"r8unorm":return[Ve(n,d,"8unorm",1)[0]];case"r8snorm":return[Ve(n,d,"8snorm",1)[0]];case"r8uint":return[Ve(n,d,"8uint",1)[0]];case"r8sint":return[Ve(n,d,"8sint",1)[0]];case"rg8unorm":{const g=Ve(n,d,"8unorm",2);return[g[0],g[1]]}case"rg8snorm":{const g=Ve(n,d,"8snorm",2);return[g[0],g[1]]}case"rg8uint":{const g=Ve(n,d,"8uint",2);return[g[0],g[1]]}case"rg8sint":{const g=Ve(n,d,"8sint",2);return[g[0],g[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const g=Ve(n,d,"8unorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8snorm":{const g=Ve(n,d,"8snorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8uint":{const g=Ve(n,d,"8uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba8sint":{const g=Ve(n,d,"8sint",4);return[g[0],g[1],g[2],g[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const g=Ve(n,d,"8unorm",4);return[g[2],g[1],g[0],g[3]]}case"r16uint":return[Ve(n,d,"16uint",1)[0]];case"r16sint":return[Ve(n,d,"16sint",1)[0]];case"r16float":return[Ve(n,d,"16float",1)[0]];case"rg16uint":{const g=Ve(n,d,"16uint",2);return[g[0],g[1]]}case"rg16sint":{const g=Ve(n,d,"16sint",2);return[g[0],g[1]]}case"rg16float":{const g=Ve(n,d,"16float",2);return[g[0],g[1]]}case"rgba16uint":{const g=Ve(n,d,"16uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16sint":{const g=Ve(n,d,"16sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16float":{const g=Ve(n,d,"16float",4);return[g[0],g[1],g[2],g[3]]}case"r32uint":return[Ve(n,d,"32uint",1)[0]];case"r32sint":return[Ve(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ve(n,d,"32float",1)[0]];case"rg32uint":{const g=Ve(n,d,"32uint",2);return[g[0],g[1]]}case"rg32sint":{const g=Ve(n,d,"32sint",2);return[g[0],g[1]]}case"rg32float":{const g=Ve(n,d,"32float",2);return[g[0],g[1]]}case"rgba32uint":{const g=Ve(n,d,"32uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32sint":{const g=Ve(n,d,"32sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32float":{const g=Ve(n,d,"32float",4);return[g[0],g[1],g[2],g[3]]}case"rg11b10ufloat":{const g=new Uint32Array(n.buffer,d,1)[0],_=(4192256&g)>>11,y=(4290772992&g)>>22;return[yb(2047&g),yb(_),function(b){const x=112+(b>>5&31)<<23|(31&b)<<18;return rp[0]=x,bT[0]}(y),1]}}return null}function Ve(n,e,t,i){const s=[0,0,0,0];for(let d=0;d<i;++d)switch(t){case"8unorm":s[d]=n[e]/255,e++;break;case"8snorm":s[d]=n[e]/255*2-1,e++;break;case"8uint":s[d]=n[e],e++;break;case"8sint":s[d]=n[e]-127,e++;break;case"16uint":s[d]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[d]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[d]=(a=n[e]|n[e+1]<<8,l=void 0,c=void 0,f=void 0,l=(32768&a)>>15,f=1023&a,(c=(31744&a)>>10)==0?(l?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):c==31?f?NaN:1/0*(l?-1:1):(l?-1:1)*Math.pow(2,c-15)*(1+f/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[d]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[d]=new Float32Array(n.buffer,e,1)[0],e+=4}var a,l,c,f;return s}function He(n,e,t,i,s){for(let a=0;a<i;++a)switch(t){case"8unorm":n[e]=255*s[a],e++;break;case"8snorm":n[e]=.5*(s[a]+1)*255,e++;break;case"8uint":n[e]=s[a],e++;break;case"8sint":n[e]=s[a]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16float":{const l=_C(s[a]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[a],e+=4}return s}const xd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class xn{constructor(){this.id=xn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(su.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(ru.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}xn._id=0;class su extends xn{}su.instance=new su;class ru extends xn{}ru.instance=new ru;const vT=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class et extends xn{constructor(){super()}}class No extends et{constructor(e,t,i,s,a,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=a,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class yC extends et{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class TT extends et{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class dg extends et{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class xT extends et{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class mi extends et{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class ap extends et{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class So extends et{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Pc extends et{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Fr,po,$,L;(n=>{n.increment="++",n.decrement="--"})(Fr||(Fr={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Fr||(Fr={}));class AT extends et{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(po||(po={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(po||(po={}));class ST extends et{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class op extends et{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return vT.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class wT extends et{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class ET extends et{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class RT extends et{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class CT extends et{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class bC extends et{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class vC extends et{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class MT extends et{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class lp extends et{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class TC extends et{constructor(){super()}get astNodeType(){return"discard"}}class OT extends et{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class IT extends et{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ne extends et{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=ne._priority.get(t.name);ne._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?ne.i32:t}getTypeName(){return this.name}}ne.x32=new ne("x32"),ne.f32=new ne("f32"),ne.i32=new ne("i32"),ne.u32=new ne("u32"),ne.f16=new ne("f16"),ne.bool=new ne("bool"),ne.void=new ne("void"),ne._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class bb extends ne{constructor(e){super(e)}}class pi extends ne{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class W extends ne{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}W.vec2f=new W("vec2",ne.f32,null),W.vec3f=new W("vec3",ne.f32,null),W.vec4f=new W("vec4",ne.f32,null),W.vec2i=new W("vec2",ne.i32,null),W.vec3i=new W("vec3",ne.i32,null),W.vec4i=new W("vec4",ne.i32,null),W.vec2u=new W("vec2",ne.u32,null),W.vec3u=new W("vec3",ne.u32,null),W.vec4u=new W("vec4",ne.u32,null),W.vec2h=new W("vec2",ne.f16,null),W.vec3h=new W("vec3",ne.f16,null),W.vec4h=new W("vec4",ne.f16,null),W.vec2b=new W("vec2",ne.bool,null),W.vec3b=new W("vec3",ne.bool,null),W.vec4b=new W("vec4",ne.bool,null),W.mat2x2f=new W("mat2x2",ne.f32,null),W.mat2x3f=new W("mat2x3",ne.f32,null),W.mat2x4f=new W("mat2x4",ne.f32,null),W.mat3x2f=new W("mat3x2",ne.f32,null),W.mat3x3f=new W("mat3x3",ne.f32,null),W.mat3x4f=new W("mat3x4",ne.f32,null),W.mat4x2f=new W("mat4x2",ne.f32,null),W.mat4x3f=new W("mat4x3",ne.f32,null),W.mat4x4f=new W("mat4x4",ne.f32,null),W.mat2x2h=new W("mat2x2",ne.f16,null),W.mat2x3h=new W("mat2x3",ne.f16,null),W.mat2x4h=new W("mat2x4",ne.f16,null),W.mat3x2h=new W("mat3x2",ne.f16,null),W.mat3x3h=new W("mat3x3",ne.f16,null),W.mat3x4h=new W("mat3x4",ne.f16,null),W.mat4x2h=new W("mat4x2",ne.f16,null),W.mat4x3h=new W("mat4x3",ne.f16,null),W.mat4x4h=new W("mat4x4",ne.f16,null),W.mat2x2i=new W("mat2x2",ne.i32,null),W.mat2x3i=new W("mat2x3",ne.i32,null),W.mat2x4i=new W("mat2x4",ne.i32,null),W.mat3x2i=new W("mat3x2",ne.i32,null),W.mat3x3i=new W("mat3x3",ne.i32,null),W.mat3x4i=new W("mat3x4",ne.i32,null),W.mat4x2i=new W("mat4x2",ne.i32,null),W.mat4x3i=new W("mat4x3",ne.i32,null),W.mat4x4i=new W("mat4x4",ne.i32,null),W.mat2x2u=new W("mat2x2",ne.u32,null),W.mat2x3u=new W("mat2x3",ne.u32,null),W.mat2x4u=new W("mat2x4",ne.u32,null),W.mat3x2u=new W("mat3x2",ne.u32,null),W.mat3x3u=new W("mat3x3",ne.u32,null),W.mat3x4u=new W("mat3x4",ne.u32,null),W.mat4x2u=new W("mat4x2",ne.u32,null),W.mat4x3u=new W("mat4x3",ne.u32,null),W.mat4x4u=new W("mat4x4",ne.u32,null);class Ad extends ne{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class wo extends ne{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class _o extends ne{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class Kn extends xn{constructor(){super(),this.postfix=null}}class Ws extends Kn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Xn extends Kn{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class cp extends Kn{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return vT.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class rn extends Kn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class PT extends Kn{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class bt extends Kn{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof U}get isVector(){return this.value instanceof C||this.value instanceof Ae}get scalarValue(){return this.value instanceof U?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof C||this.value instanceof Ae?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class NT extends Kn{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Gr extends Kn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class DT extends Kn{constructor(){super()}}class pt extends DT{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class On extends DT{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?ne.f32:e.name==="u32"||t.name==="u32"?ne.u32:ne.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class kT extends xn{constructor(e){super(),this.body=e}}class Nc extends Kn{constructor(){super()}get astNodeType(){return"default"}}class BT extends kT{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class UT extends kT{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class vb extends xn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class xC extends xn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Tb extends xn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class LT extends xn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Tn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Tn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Tn._id=0;class gg extends Tn{constructor(){super(new yn("void",null),null)}toString(){return"void"}}gg.void=new gg;class kr extends Tn{constructor(e){super(new yn("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}}class U extends Tn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new U(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new U(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new U(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);let a=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function AC(n,e,t){const i=e.length;return i===2?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class C extends Tn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new C(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new C(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new C(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof Ws?console.error("TODO: Set vector postfix"):t instanceof C?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof Hs)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let a=this;for(;t!==null&&a!==null;){if(t instanceof Gr){const l=t.index;let c=-1;if(l instanceof bt){if(!(l.value instanceof U))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const f=e.evalExpression(l,i);if(!(f instanceof U))return console.error("GetSubData: Unknown index type",l),null;c=f.value}if(c<0||c>=a.data.length)return console.error("GetSubData: Index out of range",c),null;if(a.data instanceof Float32Array){const f=new Float32Array(a.data.buffer,a.data.byteOffset+4*c,1);return new U(f,s)}if(a.data instanceof Int32Array){const f=new Int32Array(a.data.buffer,a.data.byteOffset+4*c,1);return new U(f,s)}if(a.data instanceof Uint32Array){const f=new Uint32Array(a.data.buffer,a.data.byteOffset+4*c,1);return new U(f,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ws))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new U(d,s,this)}}const c=[];for(const f of l)f==="x"||f==="r"?c.push(this.data[0]):f==="y"||f==="g"?c.push(this.data[1]):f==="z"||f==="b"?c.push(this.data[2]):f==="w"||f==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);a=AC(e,c,s.name)}t=t.postfix}return a}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ae extends Tn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Ae(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof Ws?console.error("TODO: Set matrix postfix"):t instanceof Ae?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Hs)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof Gr){const a=t.index;let l=-1;if(a instanceof bt){if(!(a.value instanceof U))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;l=a.value.value}else{const d=e.evalExpression(a,i);if(!(d instanceof U))return console.error("GetDataValue: Unknown index type",a),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=s.endsWith("h")?"h":"f";let f;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${c}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${c}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;f=new C(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${c}`))}return t.postfix?f.getSubData(e,t.postfix,i):f}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ct extends Tn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new ct(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let a=this.offset,l=this.typeInfo;for(;i;){if(i instanceof Gr)if(l instanceof ss){const c=i.index;if(c instanceof bt){if(!(c.value instanceof U))return void console.error(`SetDataValue: Invalid index type ${c.value}`);a+=c.value.value*l.stride}else{const f=e.evalExpression(c,s);if(!(f instanceof U))return void console.error("SetDataValue: Unknown index type",c);a+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof Ws))return void console.error("SetDataValue: Unknown postfix type",i);{const c=i.value;if(l instanceof Ji){let f=!1;for(const d of l.members)if(d.name===c){a+=d.offset,l=d.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof yn){const f=l.getTypeName();let d=0;if(c==="x"||c==="r")d=0;else if(c==="y"||c==="g")d=1;else if(c==="z"||c==="b")d=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);d=3}if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);const g=t.value;return f==="vec2f"?void(new Float32Array(this.buffer,a,2)[d]=g):f==="vec3f"?void(new Float32Array(this.buffer,a,3)[d]=g):f==="vec4f"?void(new Float32Array(this.buffer,a,4)[d]=g):f==="vec2i"?void(new Int32Array(this.buffer,a,2)[d]=g):f==="vec3i"?void(new Int32Array(this.buffer,a,3)[d]=g):f==="vec4i"?void(new Int32Array(this.buffer,a,4)[d]=g):f==="vec2u"?void(new Uint32Array(this.buffer,a,2)[d]=g):f==="vec3u"?void(new Uint32Array(this.buffer,a,3)[d]=g):f==="vec4u"?void(new Uint32Array(this.buffer,a,4)[d]=g):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,a,s)}setData(e,t,i,s,a){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool")if(l!=="vec2f"&&l!=="vec2h")if(l!=="vec3f"&&l!=="vec3h")if(l!=="vec4f"&&l!=="vec4h")if(l!=="vec2i")if(l!=="vec3i")if(l!=="vec4i")if(l!=="vec2u")if(l!=="vec3u")if(l!=="vec4u")if(l!=="vec2b")if(l!=="vec3b")if(l!=="vec4b")if(l!=="mat2x2f"&&l!=="mat2x2h")if(l!=="mat2x3f"&&l!=="mat2x3h")if(l!=="mat2x4f"&&l!=="mat2x4h")if(l!=="mat3x2f"&&l!=="mat3x2h")if(l!=="mat3x3f"&&l!=="mat3x3h")if(l!=="mat3x4f"&&l!=="mat3x4h")if(l!=="mat4x2f"&&l!=="mat4x2h")if(l!=="mat4x3f"&&l!=="mat4x3h")if(l!=="mat4x4f"&&l!=="mat4x4h")if(t instanceof ct){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`);else{const c=new Float32Array(this.buffer,s,16);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11],c[12]=t.data[12],c[13]=t.data[13],c[14]=t.data[14],c[15]=t.data[15]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11],c[12]=t[12],c[13]=t[13],c[14]=t[14],c[15]=t[15])}else{const c=new Float32Array(this.buffer,s,12);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,s,8);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,s,12);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,s,9);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8])}else{const c=new Float32Array(this.buffer,s,6);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,s,8);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,s,6);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,s,4);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,s,4);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,s,3);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,s,2);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Uint32Array(this.buffer,s,4);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,s,3);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,s,2);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Int32Array(this.buffer,s,4);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Int32Array(this.buffer,s,3);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Int32Array(this.buffer,s,2);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Float32Array(this.buffer,s,4);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Float32Array(this.buffer,s,3);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Float32Array(this.buffer,s,2);t instanceof C?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,a,l;if(t===null)return this;let c=this.offset,f=this.typeInfo;for(;t;){if(t instanceof Gr){const g=t.index,_=e.evalExpression(g,i);let y=0;if(_ instanceof U?y=_.value:console.error("GetDataValue: Invalid index type",g),f instanceof ss)c+=y*f.stride,f=f.format;else{const b=f.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(c+=16*y,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(t instanceof Ws))return console.error("GetDataValue: Unknown postfix type",t),null;{const g=t.value;if(f instanceof Ji){let _=!1;for(const y of f.members)if(y.name===g){c+=y.offset,f=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${g} not found`),null}else if(f instanceof yn){const _=f.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(g.length>0&&g.length<5){let y="f";const b=[];for(let x=0;x<g.length;++x){const E=g[x].toLowerCase();let M=0;if(E==="x"||E==="r")M=0;else if(E==="y"||E==="g")M=1;else if(E==="z"||E==="b")M=2;else{if(E!=="w"&&E!=="a")return console.error(`Unknown member ${g}`),null;M=3}if(g.length===1){if(_.endsWith("f"))return this.buffer.byteLength<c+4*M+4?(console.log("Insufficient buffer data"),null):new U(new Float32Array(this.buffer,c+4*M,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new U(new Float32Array(this.buffer,c+4*M,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new U(new Int32Array(this.buffer,c+4*M,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new U(new Int32Array(this.buffer,c+4*M,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new U(new Uint32Array(this.buffer,c+4*M,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")b.push(new Float32Array(this.buffer,c,2)[M]);else if(_==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const N=new Float32Array(this.buffer,c,3);b.push(N[M])}else if(_==="vec4f")b.push(new Float32Array(this.buffer,c,4)[M]);else if(_==="vec2i")y="i",b.push(new Int32Array(this.buffer,c,2)[M]);else if(_==="vec3i")y="i",b.push(new Int32Array(this.buffer,c,3)[M]);else if(_==="vec4i")y="i",b.push(new Int32Array(this.buffer,c,4)[M]);else if(_==="vec2u"){y="u";const N=new Uint32Array(this.buffer,c,2);b.push(N[M])}else _==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,c,3)[M])):_==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,c,4)[M]))}return b.length===2?f=e.getTypeInfo(`vec2${y}`):b.length===3?f=e.getTypeInfo(`vec3${y}`):b.length===4?f=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new C(b,f,null)}return console.error(`GetDataValue: Unknown member ${g}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const d=f.getTypeName();return d==="f32"?new U(new Float32Array(this.buffer,c,1),f,this):d==="i32"?new U(new Int32Array(this.buffer,c,1),f,this):d==="u32"?new U(new Uint32Array(this.buffer,c,1),f,this):d==="vec2f"?new C(new Float32Array(this.buffer,c,2),f,this):d==="vec3f"?new C(new Float32Array(this.buffer,c,3),f,this):d==="vec4f"?new C(new Float32Array(this.buffer,c,4),f,this):d==="vec2i"?new C(new Int32Array(this.buffer,c,2),f,this):d==="vec3i"?new C(new Int32Array(this.buffer,c,3),f,this):d==="vec4i"?new C(new Int32Array(this.buffer,c,4),f,this):d==="vec2u"?new C(new Uint32Array(this.buffer,c,2),f,this):d==="vec3u"?new C(new Uint32Array(this.buffer,c,3),f,this):d==="vec4u"?new C(new Uint32Array(this.buffer,c,4),f,this):f instanceof Hs&&f.name==="atomic"?((s=f.format)===null||s===void 0?void 0:s.name)==="u32"?new U(new Uint32Array(this.buffer,c,1)[0],f.format,this):((a=f.format)===null||a===void 0?void 0:a.name)==="i32"?new U(new Int32Array(this.buffer,c,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new ct(this.buffer,f,c,this)}toString(){let e="";if(this.typeInfo instanceof ss)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Ji?e+="{...}":e="[...]";return e}}class _i extends Tn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new _i(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=xd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=xd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=xd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,a=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*a}getPixel(e,t,i=0,s=0){const a=this.texelByteSize,l=this.bytesPerRow,c=this.height,f=this.data[s];return mC(new Uint8Array(f),e,t,i,s,c,l,a,this.format)}setPixel(e,t,i,s,a){const l=this.texelByteSize,c=this.bytesPerRow,f=this.height,d=this.data[s];(function(g,_,y,b,x,E,M,N,V,P){const H=b*(M>>=x)*(E>>=x)+y*M+_*N;switch(V){case"r8unorm":return void He(g,H,"8unorm",1,P);case"r8snorm":return void He(g,H,"8snorm",1,P);case"r8uint":return void He(g,H,"8uint",1,P);case"r8sint":return void He(g,H,"8sint",1,P);case"rg8unorm":return void He(g,H,"8unorm",2,P);case"rg8snorm":return void He(g,H,"8snorm",2,P);case"rg8uint":return void He(g,H,"8uint",2,P);case"rg8sint":return void He(g,H,"8sint",2,P);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void He(g,H,"8unorm",4,P);case"rgba8snorm":return void He(g,H,"8snorm",4,P);case"rgba8uint":return void He(g,H,"8uint",4,P);case"rgba8sint":return void He(g,H,"8sint",4,P);case"r16uint":return void He(g,H,"16uint",1,P);case"r16sint":return void He(g,H,"16sint",1,P);case"r16float":return void He(g,H,"16float",1,P);case"rg16uint":return void He(g,H,"16uint",2,P);case"rg16sint":return void He(g,H,"16sint",2,P);case"rg16float":return void He(g,H,"16float",2,P);case"rgba16uint":return void He(g,H,"16uint",4,P);case"rgba16sint":return void He(g,H,"16sint",4,P);case"rgba16float":return void He(g,H,"16float",4,P);case"r32uint":return void He(g,H,"32uint",1,P);case"r32sint":return void He(g,H,"32sint",1,P);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void He(g,H,"32float",1,P);case"rg32uint":return void He(g,H,"32uint",2,P);case"rg32sint":return void He(g,H,"32sint",2,P);case"rg32float":return void He(g,H,"32float",2,P);case"rgba32uint":return void He(g,H,"32uint",4,P);case"rgba32sint":return void He(g,H,"32sint",4,P);case"rgba32float":return void He(g,H,"32float",4,P);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,f,c,l,this.format,a)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(L||(L={}));class z{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class w{}$=w,w.none=new z("",L.reserved,""),w.eof=new z("EOF",L.token,""),w.reserved={asm:new z("asm",L.reserved,"asm"),bf16:new z("bf16",L.reserved,"bf16"),do:new z("do",L.reserved,"do"),enum:new z("enum",L.reserved,"enum"),f16:new z("f16",L.reserved,"f16"),f64:new z("f64",L.reserved,"f64"),handle:new z("handle",L.reserved,"handle"),i8:new z("i8",L.reserved,"i8"),i16:new z("i16",L.reserved,"i16"),i64:new z("i64",L.reserved,"i64"),mat:new z("mat",L.reserved,"mat"),premerge:new z("premerge",L.reserved,"premerge"),regardless:new z("regardless",L.reserved,"regardless"),typedef:new z("typedef",L.reserved,"typedef"),u8:new z("u8",L.reserved,"u8"),u16:new z("u16",L.reserved,"u16"),u64:new z("u64",L.reserved,"u64"),unless:new z("unless",L.reserved,"unless"),using:new z("using",L.reserved,"using"),vec:new z("vec",L.reserved,"vec"),void:new z("void",L.reserved,"void")},w.keywords={array:new z("array",L.keyword,"array"),atomic:new z("atomic",L.keyword,"atomic"),bool:new z("bool",L.keyword,"bool"),f32:new z("f32",L.keyword,"f32"),i32:new z("i32",L.keyword,"i32"),mat2x2:new z("mat2x2",L.keyword,"mat2x2"),mat2x3:new z("mat2x3",L.keyword,"mat2x3"),mat2x4:new z("mat2x4",L.keyword,"mat2x4"),mat3x2:new z("mat3x2",L.keyword,"mat3x2"),mat3x3:new z("mat3x3",L.keyword,"mat3x3"),mat3x4:new z("mat3x4",L.keyword,"mat3x4"),mat4x2:new z("mat4x2",L.keyword,"mat4x2"),mat4x3:new z("mat4x3",L.keyword,"mat4x3"),mat4x4:new z("mat4x4",L.keyword,"mat4x4"),ptr:new z("ptr",L.keyword,"ptr"),sampler:new z("sampler",L.keyword,"sampler"),sampler_comparison:new z("sampler_comparison",L.keyword,"sampler_comparison"),struct:new z("struct",L.keyword,"struct"),texture_1d:new z("texture_1d",L.keyword,"texture_1d"),texture_2d:new z("texture_2d",L.keyword,"texture_2d"),texture_2d_array:new z("texture_2d_array",L.keyword,"texture_2d_array"),texture_3d:new z("texture_3d",L.keyword,"texture_3d"),texture_cube:new z("texture_cube",L.keyword,"texture_cube"),texture_cube_array:new z("texture_cube_array",L.keyword,"texture_cube_array"),texture_multisampled_2d:new z("texture_multisampled_2d",L.keyword,"texture_multisampled_2d"),texture_storage_1d:new z("texture_storage_1d",L.keyword,"texture_storage_1d"),texture_storage_2d:new z("texture_storage_2d",L.keyword,"texture_storage_2d"),texture_storage_2d_array:new z("texture_storage_2d_array",L.keyword,"texture_storage_2d_array"),texture_storage_3d:new z("texture_storage_3d",L.keyword,"texture_storage_3d"),texture_depth_2d:new z("texture_depth_2d",L.keyword,"texture_depth_2d"),texture_depth_2d_array:new z("texture_depth_2d_array",L.keyword,"texture_depth_2d_array"),texture_depth_cube:new z("texture_depth_cube",L.keyword,"texture_depth_cube"),texture_depth_cube_array:new z("texture_depth_cube_array",L.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new z("texture_depth_multisampled_2d",L.keyword,"texture_depth_multisampled_2d"),texture_external:new z("texture_external",L.keyword,"texture_external"),u32:new z("u32",L.keyword,"u32"),vec2:new z("vec2",L.keyword,"vec2"),vec3:new z("vec3",L.keyword,"vec3"),vec4:new z("vec4",L.keyword,"vec4"),bitcast:new z("bitcast",L.keyword,"bitcast"),block:new z("block",L.keyword,"block"),break:new z("break",L.keyword,"break"),case:new z("case",L.keyword,"case"),continue:new z("continue",L.keyword,"continue"),continuing:new z("continuing",L.keyword,"continuing"),default:new z("default",L.keyword,"default"),diagnostic:new z("diagnostic",L.keyword,"diagnostic"),discard:new z("discard",L.keyword,"discard"),else:new z("else",L.keyword,"else"),enable:new z("enable",L.keyword,"enable"),fallthrough:new z("fallthrough",L.keyword,"fallthrough"),false:new z("false",L.keyword,"false"),fn:new z("fn",L.keyword,"fn"),for:new z("for",L.keyword,"for"),function:new z("function",L.keyword,"function"),if:new z("if",L.keyword,"if"),let:new z("let",L.keyword,"let"),const:new z("const",L.keyword,"const"),loop:new z("loop",L.keyword,"loop"),while:new z("while",L.keyword,"while"),private:new z("private",L.keyword,"private"),read:new z("read",L.keyword,"read"),read_write:new z("read_write",L.keyword,"read_write"),return:new z("return",L.keyword,"return"),requires:new z("requires",L.keyword,"requires"),storage:new z("storage",L.keyword,"storage"),switch:new z("switch",L.keyword,"switch"),true:new z("true",L.keyword,"true"),alias:new z("alias",L.keyword,"alias"),type:new z("type",L.keyword,"type"),uniform:new z("uniform",L.keyword,"uniform"),var:new z("var",L.keyword,"var"),override:new z("override",L.keyword,"override"),workgroup:new z("workgroup",L.keyword,"workgroup"),write:new z("write",L.keyword,"write"),r8unorm:new z("r8unorm",L.keyword,"r8unorm"),r8snorm:new z("r8snorm",L.keyword,"r8snorm"),r8uint:new z("r8uint",L.keyword,"r8uint"),r8sint:new z("r8sint",L.keyword,"r8sint"),r16uint:new z("r16uint",L.keyword,"r16uint"),r16sint:new z("r16sint",L.keyword,"r16sint"),r16float:new z("r16float",L.keyword,"r16float"),rg8unorm:new z("rg8unorm",L.keyword,"rg8unorm"),rg8snorm:new z("rg8snorm",L.keyword,"rg8snorm"),rg8uint:new z("rg8uint",L.keyword,"rg8uint"),rg8sint:new z("rg8sint",L.keyword,"rg8sint"),r32uint:new z("r32uint",L.keyword,"r32uint"),r32sint:new z("r32sint",L.keyword,"r32sint"),r32float:new z("r32float",L.keyword,"r32float"),rg16uint:new z("rg16uint",L.keyword,"rg16uint"),rg16sint:new z("rg16sint",L.keyword,"rg16sint"),rg16float:new z("rg16float",L.keyword,"rg16float"),rgba8unorm:new z("rgba8unorm",L.keyword,"rgba8unorm"),rgba8unorm_srgb:new z("rgba8unorm_srgb",L.keyword,"rgba8unorm_srgb"),rgba8snorm:new z("rgba8snorm",L.keyword,"rgba8snorm"),rgba8uint:new z("rgba8uint",L.keyword,"rgba8uint"),rgba8sint:new z("rgba8sint",L.keyword,"rgba8sint"),bgra8unorm:new z("bgra8unorm",L.keyword,"bgra8unorm"),bgra8unorm_srgb:new z("bgra8unorm_srgb",L.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new z("rgb10a2unorm",L.keyword,"rgb10a2unorm"),rg11b10float:new z("rg11b10float",L.keyword,"rg11b10float"),rg32uint:new z("rg32uint",L.keyword,"rg32uint"),rg32sint:new z("rg32sint",L.keyword,"rg32sint"),rg32float:new z("rg32float",L.keyword,"rg32float"),rgba16uint:new z("rgba16uint",L.keyword,"rgba16uint"),rgba16sint:new z("rgba16sint",L.keyword,"rgba16sint"),rgba16float:new z("rgba16float",L.keyword,"rgba16float"),rgba32uint:new z("rgba32uint",L.keyword,"rgba32uint"),rgba32sint:new z("rgba32sint",L.keyword,"rgba32sint"),rgba32float:new z("rgba32float",L.keyword,"rgba32float"),static_assert:new z("static_assert",L.keyword,"static_assert")},w.tokens={decimal_float_literal:new z("decimal_float_literal",L.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new z("hex_float_literal",L.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new z("int_literal",L.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new z("uint_literal",L.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new z("name",L.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new z("ident",L.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new z("and",L.token,"&"),and_and:new z("and_and",L.token,"&&"),arrow:new z("arrow ",L.token,"->"),attr:new z("attr",L.token,"@"),forward_slash:new z("forward_slash",L.token,"/"),bang:new z("bang",L.token,"!"),bracket_left:new z("bracket_left",L.token,"["),bracket_right:new z("bracket_right",L.token,"]"),brace_left:new z("brace_left",L.token,"{"),brace_right:new z("brace_right",L.token,"}"),colon:new z("colon",L.token,":"),comma:new z("comma",L.token,","),equal:new z("equal",L.token,"="),equal_equal:new z("equal_equal",L.token,"=="),not_equal:new z("not_equal",L.token,"!="),greater_than:new z("greater_than",L.token,">"),greater_than_equal:new z("greater_than_equal",L.token,">="),shift_right:new z("shift_right",L.token,">>"),less_than:new z("less_than",L.token,"<"),less_than_equal:new z("less_than_equal",L.token,"<="),shift_left:new z("shift_left",L.token,"<<"),modulo:new z("modulo",L.token,"%"),minus:new z("minus",L.token,"-"),minus_minus:new z("minus_minus",L.token,"--"),period:new z("period",L.token,"."),plus:new z("plus",L.token,"+"),plus_plus:new z("plus_plus",L.token,"++"),or:new z("or",L.token,"|"),or_or:new z("or_or",L.token,"||"),paren_left:new z("paren_left",L.token,"("),paren_right:new z("paren_right",L.token,")"),semicolon:new z("semicolon",L.token,";"),star:new z("star",L.token,"*"),tilde:new z("tilde",L.token,"~"),underscore:new z("underscore",L.token,"_"),xor:new z("xor",L.token,"^"),plus_equal:new z("plus_equal",L.token,"+="),minus_equal:new z("minus_equal",L.token,"-="),times_equal:new z("times_equal",L.token,"*="),division_equal:new z("division_equal",L.token,"/="),modulo_equal:new z("modulo_equal",L.token,"%="),and_equal:new z("and_equal",L.token,"&="),or_equal:new z("or_equal",L.token,"|="),xor_equal:new z("xor_equal",L.token,"^="),shift_right_equal:new z("shift_right_equal",L.token,">>="),shift_left_equal:new z("shift_left_equal",L.token,"<<=")},w.simpleTokens={"@":$.tokens.attr,"{":$.tokens.brace_left,"}":$.tokens.brace_right,":":$.tokens.colon,",":$.tokens.comma,"(":$.tokens.paren_left,")":$.tokens.paren_right,";":$.tokens.semicolon},w.literalTokens={"&":$.tokens.and,"&&":$.tokens.and_and,"->":$.tokens.arrow,"/":$.tokens.forward_slash,"!":$.tokens.bang,"[":$.tokens.bracket_left,"]":$.tokens.bracket_right,"=":$.tokens.equal,"==":$.tokens.equal_equal,"!=":$.tokens.not_equal,">":$.tokens.greater_than,">=":$.tokens.greater_than_equal,">>":$.tokens.shift_right,"<":$.tokens.less_than,"<=":$.tokens.less_than_equal,"<<":$.tokens.shift_left,"%":$.tokens.modulo,"-":$.tokens.minus,"--":$.tokens.minus_minus,".":$.tokens.period,"+":$.tokens.plus,"++":$.tokens.plus_plus,"|":$.tokens.or,"||":$.tokens.or_or,"*":$.tokens.star,"~":$.tokens.tilde,_:$.tokens.underscore,"^":$.tokens.xor,"+=":$.tokens.plus_equal,"-=":$.tokens.minus_equal,"*=":$.tokens.times_equal,"/=":$.tokens.division_equal,"%=":$.tokens.modulo_equal,"&=":$.tokens.and_equal,"|=":$.tokens.or_equal,"^=":$.tokens.xor_equal,">>=":$.tokens.shift_right_equal,"<<=":$.tokens.shift_left_equal},w.regexTokens={decimal_float_literal:$.tokens.decimal_float_literal,hex_float_literal:$.tokens.hex_float_literal,int_literal:$.tokens.int_literal,uint_literal:$.tokens.uint_literal,ident:$.tokens.ident},w.storage_class=[$.keywords.function,$.keywords.private,$.keywords.workgroup,$.keywords.uniform,$.keywords.storage],w.access_mode=[$.keywords.read,$.keywords.write,$.keywords.read_write],w.sampler_type=[$.keywords.sampler,$.keywords.sampler_comparison],w.sampled_texture_type=[$.keywords.texture_1d,$.keywords.texture_2d,$.keywords.texture_2d_array,$.keywords.texture_3d,$.keywords.texture_cube,$.keywords.texture_cube_array],w.multisampled_texture_type=[$.keywords.texture_multisampled_2d],w.storage_texture_type=[$.keywords.texture_storage_1d,$.keywords.texture_storage_2d,$.keywords.texture_storage_2d_array,$.keywords.texture_storage_3d],w.depth_texture_type=[$.keywords.texture_depth_2d,$.keywords.texture_depth_2d_array,$.keywords.texture_depth_cube,$.keywords.texture_depth_cube_array,$.keywords.texture_depth_multisampled_2d],w.texture_external_type=[$.keywords.texture_external],w.any_texture_type=[...$.sampled_texture_type,...$.multisampled_texture_type,...$.storage_texture_type,...$.depth_texture_type,...$.texture_external_type],w.texel_format=[$.keywords.r8unorm,$.keywords.r8snorm,$.keywords.r8uint,$.keywords.r8sint,$.keywords.r16uint,$.keywords.r16sint,$.keywords.r16float,$.keywords.rg8unorm,$.keywords.rg8snorm,$.keywords.rg8uint,$.keywords.rg8sint,$.keywords.r32uint,$.keywords.r32sint,$.keywords.r32float,$.keywords.rg16uint,$.keywords.rg16sint,$.keywords.rg16float,$.keywords.rgba8unorm,$.keywords.rgba8unorm_srgb,$.keywords.rgba8snorm,$.keywords.rgba8uint,$.keywords.rgba8sint,$.keywords.bgra8unorm,$.keywords.bgra8unorm_srgb,$.keywords.rgb10a2unorm,$.keywords.rg11b10float,$.keywords.rg32uint,$.keywords.rg32sint,$.keywords.rg32float,$.keywords.rgba16uint,$.keywords.rgba16sint,$.keywords.rgba16float,$.keywords.rgba32uint,$.keywords.rgba32sint,$.keywords.rgba32float],w.const_literal=[$.tokens.int_literal,$.tokens.uint_literal,$.tokens.decimal_float_literal,$.tokens.hex_float_literal,$.keywords.true,$.keywords.false],w.literal_or_ident=[$.tokens.ident,$.tokens.int_literal,$.tokens.uint_literal,$.tokens.decimal_float_literal,$.tokens.hex_float_literal,$.tokens.name],w.element_count_expression=[$.tokens.int_literal,$.tokens.uint_literal,$.tokens.ident],w.template_types=[$.keywords.vec2,$.keywords.vec3,$.keywords.vec4,$.keywords.mat2x2,$.keywords.mat2x3,$.keywords.mat2x4,$.keywords.mat3x2,$.keywords.mat3x3,$.keywords.mat3x4,$.keywords.mat4x2,$.keywords.mat4x3,$.keywords.mat4x4,$.keywords.atomic,$.keywords.bitcast,...$.any_texture_type],w.attribute_name=[$.tokens.ident,$.keywords.block,$.keywords.diagnostic],w.assignment_operators=[$.tokens.equal,$.tokens.plus_equal,$.tokens.minus_equal,$.tokens.times_equal,$.tokens.division_equal,$.tokens.modulo_equal,$.tokens.and_equal,$.tokens.or_equal,$.tokens.xor_equal,$.tokens.shift_right_equal,$.tokens.shift_left_equal],w.increment_operators=[$.tokens.plus_plus,$.tokens.minus_minus];class xb{constructor(e,t,i,s,a){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=a}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class SC{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new xb(w.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=w.simpleTokens[e];if(t)return this._addToken(t),!0;let i=w.none;const s=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=w.keywords[e];if(l)return this._addToken(l),!0}if(s||a)return this._addToken(w.tokens.ident),!0;for(;;){let l=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(w.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(w.tokens.minus_minus),!0;const f=this._tokens.length-1;if((w.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==w.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,d=this._tokens.length-1;for(let g=0;g<5&&d>=0&&w.assignment_operators.indexOf(this._tokens[d].type)===-1;++g,--d)if(this._tokens[d].type===w.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===w.none){let f=e,d=0;const g=2;for(let _=0;_<g;++_)if(f+=this._peekAhead(_),l=this._findType(f),l!==w.none){d=_;break}if(l===w.none)return i!==w.none&&(this._current--,this._addToken(i),!0);e=f,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==w.none&&(this._addToken(i),!0)}_findType(e){for(const i in w.regexTokens){const s=w.regexTokens[i];if(this._match(e,s.rule))return s}return w.literalTokens[e]||w.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new xb(e,t,this._line,this._start,this._current))}}function ce(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const au=new Float32Array(1),wC=new Uint32Array(au.buffer),EC=new Uint32Array(au.buffer),ou=new Int32Array(1),RC=new Float32Array(ou.buffer),CC=new Uint32Array(ou.buffer),lu=new Uint32Array(1),MC=new Float32Array(lu.buffer),OC=new Int32Array(lu.buffer);function Ab(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return au[0]=n,wC[0];if(t==="u32")return au[0]=n,EC[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return ou[0]=n,RC[0];if(t==="u32")return ou[0]=n,CC[0]}else if(e==="u32"){if(t==="f32")return lu[0]=n,MC[0];if(t==="i32"||t==="x32")return lu[0]=n,OC[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class IC{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class uc{constructor(e,t){this.align=e,this.size=t}}class qn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new gC,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof No&&this._functions.set(t.name,new IC(t));for(const t of e)if(t instanceof pi){const i=this.getTypeInfo(t,null);i instanceof Ji&&this.structs.push(i)}for(const t of e)if(t instanceof lp)this.aliases.push(this._getAliasInfo(t));else if(t instanceof ap){const i=t,s=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new fC(i.name,a,i.attributes,s))}else if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new cc(i.name,l,s,a,i.attributes,Zi.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new cc(i.name,l,s,a,i.attributes,c?Zi.StorageTexture:Zi.Storage,i.access);f.access||(f.access="read"),this.storage.push(f)}else if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new cc(i.name,l,s,a,i.attributes,c?Zi.StorageTexture:Zi.Texture,i.access);f.access||(f.access="read"),c?this.storage.push(f):this.textures.push(f)}else if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new cc(i.name,l,s,a,i.attributes,Zi.Sampler,i.access);this.samplers.push(c)}else if(t instanceof No){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),a=this._getAttribute(t,"compute"),l=i||s||a,c=new dC(t.name,l==null?void 0:l.name,t.attributes);c.attributes=t.attributes,c.startLine=t.startLine,c.endLine=t.endLine,this.functions.push(c),this._functions.get(t.name).info=c,l&&(this._functions.get(t.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(t,!!l),c.inputs=this._getInputs(t.args),c.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(c)),c.arguments=t.args.map(f=>new hC(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),c.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,a,l;if(i instanceof LT){if(i.value)if(ce(i.value))for(const c of i.value)for(const f of this.overrides)c===f.name&&((s=t.info)===null||s===void 0||s.overrides.push(f));else for(const c of this.overrides)i.value===c.name&&((a=t.info)===null||a===void 0||a.overrides.push(c))}else if(i instanceof rn)for(const c of this.overrides)i.name===c.name&&((l=t.info)===null||l===void 0||l.overrides.push(c))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const a=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;a&&t.add(a)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.vertex)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.fragment)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,a=[];return e.search(l=>{if(l instanceof su)a.push({});else if(l instanceof ru)a.pop();else if(l instanceof mi){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),a.length>0&&(a[a.length-1][c.name]=c)}else if(l instanceof Xn){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof So){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),a.length>0&&(a[a.length-1][c.name]=c)}else if(l instanceof rn){const c=l;if(a.length>0&&a[a.length-1][c.name])return;const f=s._findResource(c.name);f&&i.push(f)}else if(l instanceof cp){const c=l,f=s._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}else if(l instanceof op){const c=l,f=s._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,t)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof pi)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof pi)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const a=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),c=new mb(i.name,a,s.name,l);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new mb("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof pi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof pi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(t.value),l=new uC(e.name,s,t.name,a);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new cC(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof wo){const s=e,a=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new ss(s.name,t);return l.format=a,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof pi){const s=e,a=new Ji(s.name,t);a.startLine=s.startLine,a.endLine=s.endLine;for(const l of s.members){const c=this.getTypeInfo(l.type,l.attributes);a.members.push(new _b(l.name,c,l.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof _o){const s=e,a=s.format instanceof ne,l=s.format?a?this.getTypeInfo(s.format,null):new yn(s.format,null):null,c=new Hs(s.name,l,t,s.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof W){const s=e,a=s.format?this.getTypeInfo(s.format,null):null,l=new Hs(s.name,a,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new yn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const a=this._getTypeSize(e);if(e.size=(t=a==null?void 0:a.size)!==null&&t!==void 0?t:0,e instanceof ss&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l==null?void 0:l.size)!==null&&i!==void 0?i:0,(s=l==null?void 0:l.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Ji&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,a=0,l=0;for(let c=0,f=e.members.length;c<f;++c){const d=e.members[c],g=this._getTypeSize(d);if(!g)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=g.align,y=g.size;i=this._roundUp(_,i+s),s=y,a=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,a+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof _b&&(e=e.type),e instanceof yn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=qn._typeInfo[e.name];if(l!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new uc(Math.max(a,l.align/c),Math.max(s,l.size/c))}}{const l=qn._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const c=e.name[e.name.length-1]==="h"?2:1;return new uc(Math.max(a,l.align/c),Math.max(s,l.size/c))}}if(e instanceof ss){let l=e,c=8,f=8;const d=this._getTypeSize(l.format);return d!==null&&(f=d.size,c=d.align),f=l.count*this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,f)),s&&(f=s),new uc(Math.max(a,c),Math.max(s,f))}if(e instanceof Ji){let l=0,c=0,f=0,d=0,g=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+d),d=y.size,g=f)}return c=this._roundUp(l,g+d),new uc(Math.max(a,l),Math.max(s,c))}return null}_isUniformVar(e){return e instanceof mi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof mi&&e.storage=="storage"}_isTextureVar(e){return e instanceof mi&&e.type!==null&&qn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof mi&&e.type!==null&&qn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let a of s)if(a.name==t)return a;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let a=s!==null&&s.value!==null?s.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}qn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},qn._textureTypes=w.any_texture_type.map(n=>n.name),qn._samplerTypes=w.sampler_type.map(n=>n.name);class up{constructor(e,t,i){this.name=e,this.value=t,this.node=i}clone(){return new up(this.name,this.value,this.node)}}class fp{constructor(e){this.name=e.name,this.node=e}clone(){return new fp(this.node)}}class hp{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new up(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i==null?void 0:i.value)!==null&&t!==void 0?t:null}clone(){return new hp(this)}}class PC{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class NC{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof C)return i.data.forEach(a=>{a||(s=!1)}),new U(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=i.data.some(a=>a);return new U(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof U))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof ct&&s.typeInfo.size===0){const a=s.typeInfo,l=s.buffer.byteLength/a.stride;return new U(l,this.getTypeInfo("u32"))}return new U(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.abs(a)),i.typeInfo);const s=i;return new U(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.acos(a)),i.typeInfo);const s=i;return new U(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.acosh(a)),i.typeInfo);const s=i;return new U(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.asin(a)),i.typeInfo);const s=i;return new U(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.asinh(a)),i.typeInfo);const s=i;return new U(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.atan(a)),i.typeInfo);const s=i;return new U(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.atanh(a)),i.typeInfo);const s=i;return new U(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((c,f)=>Math.atan2(c,s.data[f])),i.typeInfo);const a=i,l=s;return new U(Math.atan2(a.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.ceil(a)),i.typeInfo);const s=i;return new U(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return new C(i.data.map((d,g)=>this._clamp(d,s.data[g],a.data[g])),i.typeInfo);const l=i,c=s,f=a;return new U(this._clamp(l.value,c.value,f.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.cos(a)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.cosh(a)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.clz32(a)),i.typeInfo);const s=i;return new U(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._countOneBits(a)),i.typeInfo);const s=i;return new U(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._countTrailingZeros(a)),i.typeInfo);const s=i;return new U(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=i.data,l=s.data;return new C([a[1]*l[2]-l[1]*a[2],a[2]*l[0]-l[2]*a[0],a[0]*l[1]-l[0]*a[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof C?new C(i.data.map(a=>a*s),i.typeInfo):new U(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Ae){const s=i.data,a=i.typeInfo.getTypeName(),l=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new U(s[0]*s[3]-s[1]*s[2],l);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){let c=0;for(let f=0;f<i.data.length;++f)c+=(i.data[f]-s.data[f])*(i.data[f]-s.data[f]);return new U(Math.sqrt(c),this.getTypeInfo("f32"))}const a=i,l=s;return new U(Math.abs(a.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof C&&s instanceof C?new U(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.exp(a)),i.typeInfo);const s=i;return new U(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.pow(2,a)),i.typeInfo);const s=i;return new U(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,c=a.value;if(i instanceof C)return new C(i.data.map(d=>d>>l&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=i.value;return new U(f>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C){const l=this._dot(s.data,a.data);return new C(l<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._firstLeadingBit(a)),i.typeInfo);const s=i;return new U(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._firstTrailingBit(a)),i.typeInfo);const s=i;return new U(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.floor(a)),i.typeInfo);const s=i;return new U(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return i.data.length!==s.data.length||i.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new C(i.data.map((d,g)=>d*s.data[g]+a.data[g]),i.typeInfo);const l=i,c=s,f=a;return new U(l.value*c.value+f.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>a-Math.floor(a)),i.typeInfo);const s=i;return new U(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const c=a.value,f=(1<<l.value)-1<<c,d=~f;if(i instanceof C&&s instanceof C)return new C(i.data.map((y,b)=>y&d|s.data[b]<<c&f),i.typeInfo);const g=i.value,_=s.value;return new U(g&d|_<<c&f,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>1/Math.sqrt(a)),i.typeInfo);const s=i;return new U(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){let a=0;return i.data.forEach(l=>{a+=l*l}),new U(Math.sqrt(a),this.getTypeInfo("f32"))}const s=i;return new U(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.log(a)),i.typeInfo);const s=i;return new U(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.log2(a)),i.typeInfo);const s=i;return new U(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((c,f)=>Math.max(c,s.data[f])),i.typeInfo);const a=i,l=s;return new U(Math.max(a.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((c,f)=>Math.min(c,s.data[f])),i.typeInfo);const a=i,l=s;return new U(Math.min(a.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return new C(i.data.map((f,d)=>i.data[d]*(1-a.data[d])+s.data[d]*a.data[d]),i.typeInfo);const l=s,c=a;return new U(i.value*(1-c.value)+l.value*c.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((l,c)=>l%s.data[c]),i.typeInfo);const a=s;return new U(i.value%a.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=this.Length(e,t).value;return new C(i.data.map(a=>a/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((c,f)=>Math.pow(c,s.data[f])),i.typeInfo);const a=i,l=s;return new U(Math.pow(a.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s),i.typeInfo):new U(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s*Math.PI/180),i.typeInfo):new U(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){const a=this._dot(i.data,s.data);return new C(i.data.map((l,c)=>l-2*a*s.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof U){const l=this._dot(s.data,i.data);return new C(i.data.map((c,f)=>{const d=1-a.value*a.value*(1-l*l);if(d<0)return 0;const g=Math.sqrt(d);return a.value*c-(a.value*l+g)*s.data[f]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.round(a)),i.typeInfo);const s=i;return new U(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.min(Math.max(a,0),1)),i.typeInfo);const s=i;return new U(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sign(a)),i.typeInfo);const s=i;return new U(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sin(a)),i.typeInfo);const s=i;return new U(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sinh(a)),i.typeInfo);const s=i;return new U(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(a instanceof C&&i instanceof C&&s instanceof C)return new C(a.data.map((d,g)=>this._smoothstep(i.data[g],s.data[g],d)),a.typeInfo);const l=i,c=s,f=a;return new U(this._smoothstep(l.value,c.value,f.value),a.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sqrt(a)),i.typeInfo);const s=i;return new U(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof C&&i instanceof C)return new C(s.data.map((l,c)=>l<i.data[c]?0:1),s.typeInfo);const a=i;return new U(s.value<a.value?0:1,a.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.tan(a)),i.typeInfo);const s=i;return new U(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.tanh(a)),i.typeInfo);const s=i;return new U(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Ae))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const a=i.data;return new Ae([a[0],a[2],a[1],a[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const a=i.data;return new Ae([a[0],a[3],a[6],a[1],a[4],a[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const a=i.data;return new Ae([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const a=i.data;return new Ae([a[0],a[3],a[1],a[4],a[2],a[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const a=i.data;return new Ae([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const a=i.data;return new Ae([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const a=i.data;return new Ae([a[0],a[4],a[1],a[5],a[2],a[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const a=i.data;return new Ae([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const a=i.data;return new Ae([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.trunc(a)),i.typeInfo);const s=i;return new U(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof rn){const a=i.name,l=t.getVariableValue(a);if(l instanceof _i){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const c=l.getMipLevelSize(s),f=l.dimension;return f==="1d"?new U(c[0],this.getTypeInfo("u32")):f==="3d"?new C(c,this.getTypeInfo("vec3u")):f==="2d"?new C(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof rn){const l=i.name,c=t.getVariableValue(l);if(c instanceof _i){const f=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(f<0||f>=c.width||d<0||d>=c.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const g=c.getPixel(f,d,0,a);return g===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new C(g,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof rn){const s=i.name,a=t.getVariableValue(s);return a instanceof _i?new U(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof rn){const s=i.name,a=t.getVariableValue(s);return a instanceof _i?new U(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof rn){const s=i.name,a=t.getVariableValue(s);return a instanceof _i?new U(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof rn){const c=i.name,f=t.getVariableValue(c);if(f instanceof _i){const d=f.getMipLevelSize(0),g=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return g<0||g>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(f.setPixel(g,_,0,a,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t);return f instanceof U&&c instanceof U&&(f.value=c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value+=c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value-=c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=Math.max(f.value,c.value)),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=Math.min(f.value,c.value)),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value&c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value|c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=f.value^c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=a.value.getSubData(this.exec,i.postfix,t),d=new U(f.value,f.typeInfo);return f instanceof U&&c instanceof U&&(f.value=c.value),a.value instanceof ct&&a.value.setDataValue(this.exec,f,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Sd={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},jt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ft extends PC{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new qn,this.reflection.updateAST(this.ast),this.context=(i=t==null?void 0:t.clone())!==null&&i!==void 0?i:new hp,this.builtins=new NC(this),this.typeInfo={bool:this.getTypeInfo(ne.bool),i32:this.getTypeInfo(ne.i32),u32:this.getTypeInfo(ne.u32),f32:this.getTypeInfo(ne.f32),f16:this.getTypeInfo(ne.f16),vec2f:this.getTypeInfo(W.vec2f),vec2u:this.getTypeInfo(W.vec2u),vec2i:this.getTypeInfo(W.vec2i),vec2h:this.getTypeInfo(W.vec2h),vec3f:this.getTypeInfo(W.vec3f),vec3u:this.getTypeInfo(W.vec3u),vec3i:this.getTypeInfo(W.vec3i),vec3h:this.getTypeInfo(W.vec3h),vec4f:this.getTypeInfo(W.vec4f),vec4u:this.getTypeInfo(W.vec4u),vec4i:this.getTypeInfo(W.vec4i),vec4h:this.getTypeInfo(W.vec4h),mat2x2f:this.getTypeInfo(W.mat2x2f),mat2x3f:this.getTypeInfo(W.mat2x3f),mat2x4f:this.getTypeInfo(W.mat2x4f),mat3x2f:this.getTypeInfo(W.mat3x2f),mat3x3f:this.getTypeInfo(W.mat3x3f),mat3x4f:this.getTypeInfo(W.mat3x4f),mat4x2f:this.getTypeInfo(W.mat4x2f),mat4x3f:this.getTypeInfo(W.mat4x3f),mat4x4f:this.getTypeInfo(W.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof U)return s.value;if(s instanceof C||s instanceof Ae)return Array.from(s.data);if(s instanceof ct&&s.typeInfo instanceof ss){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const a=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,a),this._execStatements(this.ast,a);const l=a.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const c=t[0],f=t[1],d=t[2],g=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new C(t,g));for(const _ in i)for(const y in i[_]){const b=i[_][y];a.variables.forEach(x=>{var E;const M=x.node;if(M!=null&&M.attributes){let N=null,V=null;for(const P of M.attributes)P.name==="binding"?N=P.value:P.name==="group"&&(V=P.value);if(y==N&&_==V)if(b.texture!==void 0&&b.descriptor!==void 0){const P=new _i(b.texture,this.getTypeInfo(M.type),b.descriptor,(E=b.texture.view)!==null&&E!==void 0?E:null);x.value=P}else b.uniform!==void 0?x.value=new ct(b.uniform,this.getTypeInfo(M.type)):x.value=new ct(b,this.getTypeInfo(M.type))}})}for(let _=0;_<d;++_)for(let y=0;y<f;++y)for(let b=0;b<c;++b)a.setVariable("@workgroup_id",new C([b,y,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[b,y,_],a)}execStatement(e,t){if(e instanceof CT)return this.evalExpression(e.value,t);if(e instanceof OT){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof U))throw new Error("Invalid break-if condition");if(!i.value)return null}return Ft._breakObj}if(e instanceof IT)return Ft._continueObj;if(e instanceof So)this._let(e,t);else if(e instanceof mi)this._var(e,t);else if(e instanceof Pc)this._const(e,t);else if(e instanceof No)this._function(e,t);else{if(e instanceof RT)return this._if(e,t);if(e instanceof ET)return this._switch(e,t);if(e instanceof xT)return this._for(e,t);if(e instanceof TT)return this._while(e,t);if(e instanceof wT)return this._loop(e,t);if(e instanceof dg){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof ST)this._assign(e,t);else if(e instanceof AT)this._increment(e,t);else{if(e instanceof pi)return null;if(e instanceof ap){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new U(0,this.getTypeInfo("u32")))}else if(e instanceof op)this._call(e,t);else{if(e instanceof MT||e instanceof lp)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof On?this._evalBinaryOp(e,t):e instanceof bt?this._evalLiteral(e,t):e instanceof rn?this._evalVariable(e,t):e instanceof cp?this._evalCall(e,t):e instanceof Xn?this._evalCreate(e,t):e instanceof PT?this._evalConst(e,t):e instanceof NT?this._evalBitcast(e,t):e instanceof pt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof ne){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],a=this.reflection.getOverrideInfo(i);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?t.setVariable(i,new U(s,a.type)):a.type.name==="bool"?t.setVariable(i,new U(s?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?t.setVariable(i,new C(s,a.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const g of e.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const _=i.getVariableValue(g.value[0]);s[0]=_ instanceof U?_.value:parseInt(g.value[0])}if(g.value.length>1){const _=i.getVariableValue(g.value[1]);s[1]=_ instanceof U?_.value:parseInt(g.value[1])}if(g.value.length>2){const _=i.getVariableValue(g.value[2]);s[2]=_ instanceof U?_.value:parseInt(g.value[2])}}const a=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new C(s,a));const c=s[0],f=s[1],d=s[2];for(let g=0,_=0;g<d;++g)for(let y=0;y<f;++y)for(let b=0;b<c;++b,++_){const x=[b,y,g],E=[b+t[0]*s[0],y+t[1]*s[1],g+t[2]*s[2]];i.setVariable("@local_invocation_id",new C(x,a)),i.setVariable("@global_invocation_id",new C(E,a)),i.setVariable("@local_invocation_index",new U(_,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const a=`@${s.value}`,l=t.getVariable(a);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof pt;)e=e.right;return e instanceof rn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const a=t.clone(),l=this._execStatements(i,a);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],c=this.evalExpression(e.args[a],i);i.setVariable(l.name,c,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof U?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof U?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof rn){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof pt){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof kr?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new kr(i)}}return null}_assign(e,t){let i=null,s="<var>",a=null;if(e.variable instanceof pt){const f=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),g=e.operator;if(g==="="){if(f instanceof U||f instanceof C||f instanceof Ae){if(d instanceof U||d instanceof C||d instanceof Ae&&f.data.length===d.data.length)return void f.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof ct&&d instanceof ct&&f.buffer.byteLength-f.offset>=d.buffer.byteLength-d.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(g==="+=")return f instanceof U||f instanceof C||f instanceof Ae?d instanceof U||d instanceof C||d instanceof Ae?void f.data.set(d.data.map((_,y)=>f.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(g==="-=")return(f instanceof U||f instanceof C||f instanceof Ae)&&(d instanceof U||d instanceof C||d instanceof Ae)?void f.data.set(d.data.map((_,y)=>f.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof pt){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const f=t.getVariable(s);if(!(f&&f.value instanceof kr))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=f.value.reference;let d=e.variable.postfix;if(!d){let g=e.variable.right;for(;g instanceof pt;){if(g.postfix){d=g.postfix;break}g=g.right}}d&&(i=i.getSubData(this,d,t))}}else{a=e.variable.postfix,s=this.getVariableName(e.variable,t);const f=t.getVariable(s);if(f===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=f.value}if(i instanceof kr&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),c=e.operator;if(c==="=")if(i instanceof ct)i.setDataValue(this,l,a,t);else if(a){if(!(i instanceof C||i instanceof Ae))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(a instanceof Gr){const f=this.evalExpression(a.index,t).value;if(i instanceof C){if(!(l instanceof U))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[f]=l.value}else{if(!(i instanceof Ae))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(a.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const g=i.typeInfo.getTypeName();if(g==="mat2x2"||g==="mat2x2f"||g==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(g==="mat2x3"||g==="mat2x3f"||g==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(g==="mat2x4"||g==="mat2x4f"||g==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(g==="mat3x2"||g==="mat3x2f"||g==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(g==="mat3x3"||g==="mat3x3f"||g==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(g==="mat3x4"||g==="mat3x4f"||g==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(g==="mat4x2"||g==="mat4x2f"||g==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(g==="mat4x3"||g==="mat4x3f"||g==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(g!=="mat4x4"&&g!=="mat4x4f"&&g!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(a instanceof Ws){const f=a.value;if(!(i instanceof C))return void console.error(`Invalid assignment to ${f}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof U){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);if(f==="x")i.data[0]=l.value;else if(f==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(f==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(f==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${e.line}`);for(let d=0;d<f.length;++d){const g=f[d];if(g==="x"||g==="r")i.data[0]=l.data[d];else if(g==="y"||g==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(g==="z"||g==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(g!=="w"&&g!=="a")return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof U&&l instanceof U?i.value=l.value:i instanceof C&&l instanceof C||i instanceof Ae&&l instanceof Ae?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const f=i.getSubData(this,a,t);if(f instanceof C&&l instanceof U){const d=f.data,g=l.value;if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=g;else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=g;else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=g;else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=g;else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=g;else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=g;else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=g;else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=g;else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=g;else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=g;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(f instanceof C&&l instanceof C){const d=f.data,g=l.data;if(d.length!==g.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=g[_];else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=g[_];else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=g[_];else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=g[_];else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=g[_];else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=g[_];else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=g[_];else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=g[_];else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=g[_];else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=g[_];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(f instanceof U&&l instanceof U))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?f.value+=l.value:c==="-="?f.value-=l.value:c==="*="?f.value*=l.value:c==="/="?f.value/=l.value:c==="%="?f.value%=l.value:c==="&="?f.value&=l.value:c==="|="?f.value|=l.value:c==="^="?f.value^=l.value:c==="<<="?f.value<<=l.value:c===">>="?f.value>>=l.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}i instanceof ct&&i.setDataValue(this,f,a,t)}}_function(e,t){const i=new fp(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof pt||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const a=new Xn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof pt||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof wo||e.type instanceof pi||e.type instanceof W){const a=new Xn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const a of e.cases)if(a instanceof BT)for(const l of a.selectors){if(l instanceof Nc){s=a;continue}const c=this.evalExpression(l,t);if(!(c instanceof U))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(a.body,t)}else a instanceof UT&&(s=a);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const a=this.evalExpression(s.condition,t);if(!(a instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof U?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Ft._breakObj)break;if(i!==null&&i!==Ft._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Ft._breakObj)break;if(i===Ft._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Ft._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Ft._breakObj)break;if(i!==Ft._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof U){const a=Ab(i.value,i.typeInfo.name,s.name);return new U(a,this.getTypeInfo(s))}if(i instanceof C){const a=i.typeInfo.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;l="f16"}const c=s.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const d=function(g,_,y){if(_===y)return g;const b=new Array(g.length);for(let x=0;x<g.length;x++)b[x]=Ab(g[x],_,y);return b}(Array.from(i.data),l,f);return new C(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof Xn){if(e.type===null)return gg.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof Xn?e.type.name:e.name,a=e instanceof Xn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(a.size===0)return null;const l=new ct(new ArrayBuffer(a.size),a,0);if(a instanceof Ji){if(e.args)for(let c=0;c<e.args.length;++c){const f=a.members[c],d=e.args[c],g=this.evalExpression(d,t);l.setData(this,g,f.type,f.offset,t)}}else if(a instanceof ss){let c=0;if(e.args)for(let f=0;f<e.args.length;++f){const d=e.args[f],g=this.evalExpression(d,t);a.format===null&&(((i=g.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=g.typeInfo),l.setData(this,g,a.format,c,t),c+=a.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Xn?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new U(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Ft._priority.get(t.name);Ft._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new kr(i);if(e.operator==="*")return i instanceof kr?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof U?i.value:i instanceof C?Array.from(i.data):null;switch(e.operator){case"+":{if(ce(s)){const c=s.map((f,d)=>+f);return new C(c,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(+a,l)}case"-":{if(ce(s)){const c=s.map((f,d)=>-f);return new C(c,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(-a,l)}case"!":{if(ce(s)){const c=s.map((f,d)=>f?0:1);return new C(c,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(a?0:1,l)}case"~":{if(ce(s)){const c=s.map((f,d)=>~f);return new C(c,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(~a,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),a=i instanceof U?i.value:i instanceof C||i instanceof Ae?Array.from(i.data):null,l=s instanceof U?s.value:s instanceof C||s instanceof Ae?Array.from(s.data):null;switch(e.operator){case"+":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b+_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y+g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g+y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c+f,d)}case"-":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b-_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y-g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g-y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c-f,d)}case"*":{if(ce(a)&&ce(l)){const g=a,_=l;if(i instanceof Ae&&s instanceof Ae){const y=function(M,N,V,P){if(jt[N.name]===void 0||jt[P.name]===void 0)return null;const H=jt[N.name][0],X=jt[N.name][1],Z=jt[P.name][0];if(H!==jt[P.name][1])return null;const he=new Array(Z*X);for(let ue=0;ue<X;ue++)for(let J=0;J<Z;J++){let oe=0;for(let de=0;de<H;de++)oe+=M[de*X+ue]*V[J*H+de];he[ue*Z+J]=oe}return he}(g,i.typeInfo,_,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=jt[s.typeInfo.name][0],x=jt[i.typeInfo.name][1],E=this.getTypeInfo(`mat${b}x${x}f`);return new Ae(y,E)}if(i instanceof Ae&&s instanceof C){const y=function(b,x,E,M){if(jt[x.name]===void 0||Sd[M.name]===void 0)return null;const N=jt[x.name][0],V=jt[x.name][1];if(N!==E.length)return null;const P=new Array(V);for(let H=0;H<V;H++){let X=0;for(let Z=0;Z<N;Z++)X+=b[Z*V+H]*E[Z];P[H]=X}return P}(g,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,s.typeInfo)}if(i instanceof C&&s instanceof Ae){const y=function(b,x,E,M){if(Sd[x.name]===void 0||jt[M.name]===void 0)return null;const N=jt[M.name][0],V=jt[M.name][1];if(V!==b.length)return null;const P=[];for(let H=0;H<N;H++){let X=0;for(let Z=0;Z<V;Z++)X+=b[Z]*E[Z*N+H];P[H]=X}return P}(g,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,i.typeInfo)}{if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b*_[x]);return new C(y,i.typeInfo)}}if(ce(a)){const g=l,_=a.map((y,b)=>y*g);return i instanceof Ae?new Ae(_,i.typeInfo):new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g*y);return s instanceof Ae?new Ae(_,s.typeInfo):new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c*f,d)}case"%":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b%_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y%g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g%y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c%f,d)}case"/":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b/_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y/g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g/y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c/f,d)}case"&":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b&_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y&g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g&y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c&f,d)}case"|":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b|_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y|g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g|y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c|f,d)}case"^":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b^_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y^g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g^y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c^f,d)}case"<<":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b<<_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y<<g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g<<y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c<<f,d)}case">>":{if(ce(a)&&ce(l)){const g=a,_=l;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((b,x)=>b>>_[x]);return new C(y,i.typeInfo)}if(ce(a)){const g=l,_=a.map((y,b)=>y>>g);return new C(_,i.typeInfo)}if(ce(l)){const g=a,_=l.map((y,b)=>g>>y);return new C(_,s.typeInfo)}const c=a,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(c>>f,d)}case">":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g>f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d>c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c>d?1:0);return new C(f,s.typeInfo)}return new U(a>l?1:0,this.getTypeInfo("bool"));case"<":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g<f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d<c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c<d?1:0);return new C(f,s.typeInfo)}return new U(a<l?1:0,this.getTypeInfo("bool"));case"==":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g===f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d==c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c==d?1:0);return new C(f,s.typeInfo)}return new U(a===l?1:0,this.getTypeInfo("bool"));case"!=":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g!==f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d!==c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c!==d?1:0);return new C(f,s.typeInfo)}return new U(a!==l?1:0,this.getTypeInfo("bool"));case">=":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g>=f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d>=c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c>=d?1:0);return new C(f,s.typeInfo)}return new U(a>=l?1:0,this.getTypeInfo("bool"));case"<=":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g<=f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d<=c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c<=d?1:0);return new C(f,s.typeInfo)}return new U(a<=l?1:0,this.getTypeInfo("bool"));case"&&":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g&&f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d&&c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c&&d?1:0);return new C(f,s.typeInfo)}return new U(a&&l?1:0,this.getTypeInfo("bool"));case"||":if(ce(a)&&ce(l)){const c=a,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=c.map((g,_)=>g||f[_]?1:0);return new C(d,i.typeInfo)}if(ce(a)){const c=l,f=a.map((d,g)=>d||c?1:0);return new C(f,i.typeInfo)}if(ce(l)){const c=a,f=l.map((d,g)=>c||d?1:0);return new C(f,s.typeInfo)}return new U(a||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],c=this.evalExpression(e.args[a],i);i.createVariable(l.name,c,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let a=0;a<i.node.args.length;++a){const l=i.node.args[a],c=this.evalExpression(e.args[a],s);s.setVariable(l.name,c,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new U(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=Sd[s];if(a===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof bt)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);if(f instanceof C){const d=f.data;for(let g=0;g<d.length;++g){let _=d[g];l.push(_)}}else if(f instanceof U){let d=f.value;l.push(d)}}if(e.type instanceof W&&e.type.format===null&&(e.type.format=W.f32),l.length===0){const c=new Array(a).fill(0);return new C(c,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<a;)l.push(l[0]);return l.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new C(l.length>a?l.slice(0,a):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=jt[s];if(a===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof bt)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);f instanceof C?l.push(...f.data):f instanceof U?l.push(f.value):f instanceof Ae&&l.push(...f.data)}if(i instanceof Hs&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(a[2]).fill(0);return new Ae(c,i).getSubData(this,e.postfix,t)}return l.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ae(l,i).getSubData(this,e.postfix,t)}}Ft._breakObj=new Tn(new yn("BREAK",null),null),Ft._continueObj=new Tn(new yn("CONTINUE",null),null),Ft._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class DC{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class kC{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new DC,this._exec=new Ft,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,a=i.countNode;if(a instanceof rn){const l=a.name,c=this._context.constants.get(l);if(c)try{const f=c.constEvaluate(this._exec);s.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof Tb||s instanceof Ad?s.type=this._forwardType(s.type):s instanceof wo?s.format=this._forwardType(s.format):s instanceof mi||s instanceof So||s instanceof Pc?s.type=this._forwardType(s.type):s instanceof No?s.returnType=this._forwardType(s.returnType):s instanceof vb&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof bb){const t=this._getType(e.name);if(t)return t}else e instanceof Ad?e.type=this._forwardType(e.type):e instanceof wo&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new SC(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(e){if(e instanceof z)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const a of e){if(i===a)return!0;a===w.tokens.name&&(s=!0)}if(s){const a=w.tokens.name.rule.exec(t.lexeme);if(a&&a.index==0&&a[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===w.tokens.name){const i=w.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const t=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.diagnostic)){const t=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.requires)){const t=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.enable)){const t=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(w.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const c=this._attribute(),f=this._consume(w.tokens.name,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=d,i.push(this._updateNode(new vb(f,g,c))))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(w.tokens.arrow)){const c=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=c)}const a=this._compound_statement(),l=this._currentLine;return this._updateNode(new No(t,i,s,a,e,l),e)}_compound_statement(){const e=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(w.keywords.return))e=this._return_statement();else if(this._check([w.keywords.var,w.keywords.let,w.keywords.const]))e=this._variable_statement();else if(this._match(w.keywords.discard))e=this._updateNode(new TC);else if(this._match(w.keywords.break)){const t=this._updateNode(new OT);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(w.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(w.keywords.continue)){const t=this._updateNode(new IT);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new yC(t),e)}_while_statement(){if(!this._match(w.keywords.while))return null;const e=this._updateNode(new TT(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(w.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new dg(i,e),t)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const e=this._updateNode(new xT(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(w.tokens.semicolon)?null:this._for_init(),this._consume(w.tokens.semicolon,"Expected ';'."),e.condition=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(w.tokens.semicolon,"Expected ';'."),e.increment=this._check(w.tokens.paren_right)?null:this._for_increment(),this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(w.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new mi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(w.keywords.let)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(w.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new So(t,i,null,null,s),e)}if(this._match(w.keywords.const)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(w.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof bt&&(i=s.type),this._updateNode(new Pc(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(w.increment_operators))return this._current=e,null;const i=this._consume(w.increment_operators,"Expected increment operator");return this._updateNode(new AT(i.type===w.tokens.plus_plus?Fr.increment:Fr.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(w.tokens.brace_right))return null;let i=this._match(w.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(w.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new ST(po.parse(s.lexeme),e,a),t)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(w.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new op(i.lexeme,s),e)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new wT([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof dg){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(w.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(w.keywords.switch))return null;const e=this._updateNode(new ET(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([w.keywords.default,w.keywords.case]);){if(this._match(w.keywords.case)){const i=this._case_selectors();for(const a of i)if(a instanceof Nc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new BT(i,s)))}if(this._match(w.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new UT(i)))}}return e}_case_selectors(){const e=[];for(this._match(w.keywords.default)?e.push(this._updateNode(new Nc)):e.push(this._shift_expression());this._match(w.tokens.comma);)this._match(w.keywords.default)?e.push(this._updateNode(new Nc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let a=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new RT(t,i,s,a),e)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new xC(t,i))),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(w.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new CT(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)e=this._updateNode(new On(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)e=this._updateNode(new On(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(w.tokens.or);)e=this._updateNode(new On(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(w.tokens.xor);)e=this._updateNode(new On(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(w.tokens.and);)e=this._updateNode(new On(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?this._updateNode(new On(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)e=this._updateNode(new On(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)e=this._updateNode(new On(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)e=this._updateNode(new On(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)e=this._updateNode(new On(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?this._updateNode(new pt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Gr(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(w.tokens.period)){const e=this._consume(w.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Ws(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return ne.void;case"bool":return ne.bool;case"i32":return ne.i32;case"u32":return ne.u32;case"f32":return ne.f32;case"f16":return ne.f16;case"vec2f":return W.vec2f;case"vec3f":return W.vec3f;case"vec4f":return W.vec4f;case"vec2i":return W.vec2i;case"vec3i":return W.vec3i;case"vec4i":return W.vec4i;case"vec2u":return W.vec2u;case"vec3u":return W.vec3u;case"vec4u":return W.vec4u;case"vec2h":return W.vec2h;case"vec3h":return W.vec3h;case"vec4h":return W.vec4h;case"mat2x2f":return W.mat2x2f;case"mat2x3f":return W.mat2x3f;case"mat2x4f":return W.mat2x4f;case"mat3x2f":return W.mat3x2f;case"mat3x3f":return W.mat3x3f;case"mat3x4f":return W.mat3x4f;case"mat4x2f":return W.mat4x2f;case"mat4x3f":return W.mat4x3f;case"mat4x4f":return W.mat4x4f;case"mat2x2h":return W.mat2x2h;case"mat2x3h":return W.mat2x3h;case"mat2x4h":return W.mat2x4h;case"mat3x2h":return W.mat3x2h;case"mat3x3h":return W.mat3x3h;case"mat3x4h":return W.mat3x4h;case"mat4x2h":return W.mat4x2h;case"mat4x3h":return W.mat4x3h;case"mat4x4h":return W.mat4x4h;case"mat2x2i":return W.mat2x2i;case"mat2x3i":return W.mat2x3i;case"mat2x4i":return W.mat2x4i;case"mat3x2i":return W.mat3x2i;case"mat3x3i":return W.mat3x3i;case"mat3x4i":return W.mat3x4i;case"mat4x2i":return W.mat4x2i;case"mat4x3i":return W.mat4x3i;case"mat4x4i":return W.mat4x4i;case"mat2x2u":return W.mat2x2u;case"mat2x3u":return W.mat2x3u;case"mat2x4u":return W.mat2x4u;case"mat3x2u":return W.mat3x2u;case"mat3x3u":return W.mat3x3u;case"mat3x4u":return W.mat3x4u;case"mat4x2u":return W.mat4x2u;case"mat4x3u":return W.mat4x3u;case"mat4x4u":return W.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(w.tokens.ident)){const i=this._previous().toString();if(this._check(w.tokens.paren_left)){const s=this._argument_expression_list(),a=this._getType(i);return a!==null?this._updateNode(new Xn(a,s)):this._updateNode(new cp(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new PT(i,s.value))}return this._updateNode(new rn(i))}if(this._match(w.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?ne.i32:i.endsWith("u")||i.endsWith("U")?ne.u32:ne.x32;const a=parseInt(i);return this._validateTypeRange(a,s),this._updateNode(new bt(new U(a,this._exec.getTypeInfo(s)),s))}if(this._match(w.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,ne.u32),this._updateNode(new bt(new U(i,this._exec.getTypeInfo(ne.u32)),ne.u32))}if(this._match([w.tokens.decimal_float_literal,w.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const a=parseFloat(i);this._validateTypeRange(a,s?ne.f16:ne.f32);const l=s?ne.f16:ne.f32;return this._updateNode(new bt(new U(a,this._exec.getTypeInfo(l)),l))}if(this._match([w.keywords.true,w.keywords.false])){let i=this._previous().toString()===w.keywords.true.rule;return this._updateNode(new bt(new U(i?1:0,this._exec.getTypeInfo(ne.bool)),ne.bool))}if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new NT(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Xn(e,t))}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const e=[];do{if(this._check(w.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(w.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),e}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(w.keywords.struct))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(w.tokens.brace_right);){const l=this._attribute(),c=this._consume(w.tokens.name,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new Tb(c,d,l)))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,a=this._updateNode(new pi(t,i,e,s),e);return this._context.structs.set(t,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(w.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof bt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof bt&&(e.type=e.value.type.name==="x32"?ne.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(w.keywords.const))return null;const t=this._consume(w.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(w.tokens.colon)){const f=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=f)}let a=null;this._consume(w.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[ne.f32],d=l.constEvaluate(this._exec,f);d instanceof U&&this._validateTypeRange(d.value,f[0]),f[0]instanceof W&&f[0].format===null&&d.typeInfo instanceof Hs&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?f[0].format=ne.f16:d.typeInfo.format.name==="f32"?f[0].format=ne.f32:d.typeInfo.format.name==="i32"?f[0].format=ne.i32:d.typeInfo.format.name==="u32"?f[0].format=ne.u32:d.typeInfo.format.name==="bool"?f[0].format=ne.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),a=this._updateNode(new bt(d,f[0])),this._exec.context.setVariable(t.toString(),d)}catch{a=l}if(s!==null&&a instanceof bt){if(a.type.name!=="x32"&&s.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${s.name}. Line:${this._currentLine}`);a.type=s,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else s===null&&a instanceof bt&&(s=(e=a==null?void 0:a.type)!==null&&e!==void 0?e:ne.f32,s===ne.x32&&(s=ne.i32));const c=this._updateNode(new Pc(t.toString(),s,"","",a),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(w.keywords.let))return null;const e=this._currentLine,t=this._consume(w.tokens.name,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let s=null;if(this._match(w.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof bt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof bt&&(i=s.type.name==="x32"?ne.i32:s.type);return s instanceof bt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new So(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(w.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(w.tokens.less_than)&&(t=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(i=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const s=this._consume(w.tokens.name,"Expected variable name");let a=null;if(this._match(w.tokens.colon)){const l=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=l)}return this._updateNode(new mi(s.toString(),a,t,i,null),e)}_override_decl(){if(!this._match(w.keywords.override))return null;const e=this._consume(w.tokens.name,"Expected variable name");let t=null;if(this._match(w.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new ap(e.toString(),t,null))}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const e=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");let t=this._consume(w.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(w.tokens.period)&&(t+=`.${this._consume(w.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(w.tokens.paren_right,"Expected ')'"),this._updateNode(new MT(e.toString(),t))}_enable_directive(){const e=this._consume(w.tokens.ident,"identity expected.");return this._updateNode(new bC(e.toString()))}_requires_directive(){const e=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const t=this._consume(w.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new vC(e))}_type_alias(){const e=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new lp(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new bb(i));return this._forwardTypeCount++,s}return this._updateNode(new ne(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(w.template_types)){let i=this._advance().toString(),s=null,a=null;return this._match(w.tokens.less_than)&&(s=this._type_decl(),a=null,this._match(w.tokens.comma)&&(a=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new W(i,s,a))}if(this._match(w.keywords.ptr)){let i=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let l=null;return this._match(w.tokens.comma)&&(l=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ad(i,s.toString(),a,l))}const t=this._attribute();if(this._match(w.keywords.array)){let i=null,s=-1;const a=this._previous();let l=null;if(this._match(w.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(w.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),s=f?parseInt(f):0}const c=this._updateNode(new wo(a.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return this._updateNode(new _o(this._previous().toString(),null,null));if(this._match(w.depth_texture_type))return this._updateNode(new _o(this._previous().toString(),null,null));if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new _o(e.toString(),t,null))}if(this._match(w.storage_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const i=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new _o(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(w.tokens.attr);){const t=this._consume(w.attribute_name,"Expected attribute name"),i=this._updateNode(new LT(t.toString(),null));if(this._match(w.tokens.paren_left)){if(i.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const s=this._consume(w.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class BC extends qn{constructor(e){super(),e&&this.update(e)}update(e){const t=new kC().parse(e);this.updateAST(t)}}function UC(n){var a;const e={attributes:[],bindings:[]};let t;try{t=LC(n)}catch(l){return ae.error(l.message)(),e}for(const l of t.uniforms){const c=[];for(const f of((a=l.type)==null?void 0:a.members)||[])c.push({name:f.name,type:Sb(f.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:c})}for(const l of t.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of t.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const i=t.entry.vertex[0],s=(i==null?void 0:i.inputs.length)||0;for(let l=0;l<s;l++){const c=i.inputs[l];if(c.locationType==="location"){const f=Sb(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:f})}}return e}function Sb(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function LC(n){try{return new BC(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const FC={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...FC}};const Kt=globalThis.mathgl.config;function zC(n,{precision:e=Kt.precision}={}){return n=VC(n),`${parseFloat(n.toPrecision(e))}`}function js(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function es(n,e,t){return WC(n,i=>Math.max(e,Math.min(t,i)))}function Ls(n,e,t){return js(n)?n.map((i,s)=>Ls(i,e[s],t)):t*e+(1-t)*n}function bi(n,e,t){const i=Kt.EPSILON;try{if(n===e)return!0;if(js(n)&&js(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!bi(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Kt.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Kt.EPSILON=i}}function VC(n){return Math.round(n/Kt.EPSILON)*Kt.EPSILON}function HC(n){return n.clone?n.clone():new Array(n.length)}function WC(n,e,t){if(js(n)){const i=n;t=t||HC(i);for(let s=0;s<t.length&&s<i.length;++s){const a=typeof n=="number"?n:n[s];t[s]=e(a,s,t)}return t}return e(n)}class dp extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:js(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Kt)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+zC(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!bi(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const a=e[s],l=typeof t=="number"?t:t[s];this[s]=a+i*(l-a)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Kt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function jC(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Ze(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Eo(n,e,t=""){if(Kt.debug&&!jC(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Do(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class FT extends dp{get x(){return this[0]}set x(e){this[0]=Ze(e)}get y(){return this[1]}set y(e){this[1]=Ze(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return Ze(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return Ze(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Do(e>=0&&e<this.ELEMENTS,"index is out of range"),Ze(this[e])}setComponent(e,t){return Do(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Ro=1e-6;let Bn=typeof Float32Array<"u"?Float32Array:Array;function $C(){const n=new Bn(2);return Bn!=Float32Array&&(n[0]=0,n[1]=0),n}function wb(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function XC(n,e){return n[0]=-e[0],n[1]=-e[1],n}function zT(n,e,t,i){const s=e[0],a=e[1];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n}function YC(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function qC(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}(function(){const n=$C();return function(e,t,i,s,a,l){let c,f;for(t||(t=2),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],a(n,n,l),e[c]=n[0],e[c+1]=n[1];return e}})();function KC(n,e,t){const i=e[0],s=e[1],a=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/a,n[1]=(t[1]*i+t[5]*s)/a,n}function VT(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[3]*i+t[7]*s+t[11]*a||1;return n[0]=(t[0]*i+t[4]*s+t[8]*a)/l,n[1]=(t[1]*i+t[5]*s+t[9]*a)/l,n[2]=(t[2]*i+t[6]*s+t[10]*a)/l,n}function ZC(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function QC(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n[3]=e[3],n}function HT(n,e,t){const i=e[0],s=e[1],a=e[2];return n[0]=t[0]*i+t[3]*s+t[6]*a,n[1]=t[1]*i+t[4]*s+t[7]*a,n[2]=t[2]*i+t[5]*s+t[8]*a,n[3]=e[3],n}function WT(){const n=new Bn(3);return Bn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function GC(n){const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function Eb(n,e,t){const i=new Bn(3);return i[0]=n,i[1]=e,i[2]=t,i}function JC(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function eM(n){const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function tM(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function nM(n,e){const t=e[0],i=e[1],s=e[2];let a=t*t+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n}function jT(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Dc(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[0],c=t[1],f=t[2];return n[0]=s*f-a*c,n[1]=a*l-i*f,n[2]=i*c-s*l,n}function iM(n,e,t,i){const s=e[0],a=e[1],l=e[2];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n[2]=l+i*(t[2]-l),n}function gp(n,e,t){const i=e[0],s=e[1],a=e[2];let l=t[3]*i+t[7]*s+t[11]*a+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*a+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*a+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*a+t[14])/l,n}function $T(n,e,t){const i=e[0],s=e[1],a=e[2];return n[0]=i*t[0]+s*t[3]+a*t[6],n[1]=i*t[1]+s*t[4]+a*t[7],n[2]=i*t[2]+s*t[5]+a*t[8],n}function XT(n,e,t){const i=t[0],s=t[1],a=t[2],l=t[3],c=e[0],f=e[1],d=e[2];let g=s*d-a*f,_=a*c-i*d,y=i*f-s*c,b=s*y-a*_,x=a*g-i*y,E=i*_-s*g;const M=l*2;return g*=M,_*=M,y*=M,b*=2,x*=2,E*=2,n[0]=c+g+b,n[1]=f+_+x,n[2]=d+y+E,n}function sM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function rM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function aM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function oM(n,e){const t=n[0],i=n[1],s=n[2],a=e[0],l=e[1],c=e[2],f=Math.sqrt((t*t+i*i+s*s)*(a*a+l*l+c*c)),d=f&&jT(n,e)/f;return Math.acos(Math.min(Math.max(d,-1),1))}const YT=JC,qT=GC,wd=eM;(function(){const n=WT();return function(e,t,i,s,a,l){let c,f;for(t||(t=3),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],a(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();const Ed=[0,0,0];let fc;class fe extends FT{static get ZERO(){return fc||(fc=new fe(0,0,0),Object.freeze(fc)),fc}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&js(e)?this.copy(e):(Kt.debug&&(Ze(e),Ze(t),Ze(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Kt.debug&&(Ze(e.x),Ze(e.y),Ze(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ze(e)}angle(e){return oM(this,e)}cross(e){return Dc(this,this,e),this.check()}rotateX({radians:e,origin:t=Ed}){return sM(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ed}){return rM(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ed}){return aM(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return gp(this,this,e),this.check()}transformAsVector(e){return VT(this,this,e),this.check()}transformByMatrix3(e){return $T(this,this,e),this.check()}transformByMatrix2(e){return ZC(this,this,e),this.check()}transformByQuaternion(e){return XT(this,this,e),this.check()}}let hc;class pp extends FT{static get ZERO(){return hc||(hc=new pp(0,0,0,0),Object.freeze(hc)),hc}constructor(e=0,t=0,i=0,s=0){super(-0,-0,-0,-0),js(e)&&arguments.length===1?this.copy(e):(Kt.debug&&(Ze(e),Ze(t),Ze(i),Ze(s)),this[0]=e,this[1]=t,this[2]=i,this[3]=s)}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Kt.debug&&(Ze(e.x),Ze(e.y),Ze(e.z),Ze(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ze(e)}get w(){return this[3]}set w(e){this[3]=Ze(e)}transform(e){return gp(this,this,e),this.check()}transformByMatrix3(e){return HT(this,this,e),this.check()}transformByMatrix2(e){return QC(this,this,e),this.check()}transformByQuaternion(e){return XT(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class KT extends dp{toString(){let e="[";if(Kt.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=Ze(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function lM(){const n=new Bn(9);return Bn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function cM(n,e){if(n===e){const t=e[1],i=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=i,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function uM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=e[4],c=e[5],f=e[6],d=e[7],g=e[8],_=g*l-c*d,y=-g*a+c*f,b=d*a-l*f;let x=t*_+i*y+s*b;return x?(x=1/x,n[0]=_*x,n[1]=(-g*i+s*d)*x,n[2]=(c*i-s*l)*x,n[3]=y*x,n[4]=(g*t-s*f)*x,n[5]=(-c*t+s*a)*x,n[6]=b*x,n[7]=(-d*t+i*f)*x,n[8]=(l*t-i*a)*x,n):null}function fM(n){const e=n[0],t=n[1],i=n[2],s=n[3],a=n[4],l=n[5],c=n[6],f=n[7],d=n[8];return e*(d*a-l*f)+t*(-d*s+l*c)+i*(f*s-a*c)}function Rb(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],c=e[4],f=e[5],d=e[6],g=e[7],_=e[8],y=t[0],b=t[1],x=t[2],E=t[3],M=t[4],N=t[5],V=t[6],P=t[7],H=t[8];return n[0]=y*i+b*l+x*d,n[1]=y*s+b*c+x*g,n[2]=y*a+b*f+x*_,n[3]=E*i+M*l+N*d,n[4]=E*s+M*c+N*g,n[5]=E*a+M*f+N*_,n[6]=V*i+P*l+H*d,n[7]=V*s+P*c+H*g,n[8]=V*a+P*f+H*_,n}function hM(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],c=e[4],f=e[5],d=e[6],g=e[7],_=e[8],y=t[0],b=t[1];return n[0]=i,n[1]=s,n[2]=a,n[3]=l,n[4]=c,n[5]=f,n[6]=y*i+b*l+d,n[7]=y*s+b*c+g,n[8]=y*a+b*f+_,n}function dM(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],c=e[4],f=e[5],d=e[6],g=e[7],_=e[8],y=Math.sin(t),b=Math.cos(t);return n[0]=b*i+y*l,n[1]=b*s+y*c,n[2]=b*a+y*f,n[3]=b*l-y*i,n[4]=b*c-y*s,n[5]=b*f-y*a,n[6]=d,n[7]=g,n[8]=_,n}function Cb(n,e,t){const i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function gM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t+t,c=i+i,f=s+s,d=t*l,g=i*l,_=i*c,y=s*l,b=s*c,x=s*f,E=a*l,M=a*c,N=a*f;return n[0]=1-_-x,n[3]=g-N,n[6]=y+M,n[1]=g+N,n[4]=1-d-x,n[7]=b-E,n[2]=y-M,n[5]=b+E,n[8]=1-d-_,n}var pg;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(pg||(pg={}));const pM=Object.freeze([1,0,0,0,1,0,0,0,1]);class Pt extends KT{static get IDENTITY(){return mM()}static get ZERO(){return _M()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return pg}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(pM)}fromObject(e){return this.check()}fromQuaternion(e){return gM(this,e),this.check()}set(e,t,i,s,a,l,c,f,d){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=a,this[5]=l,this[6]=c,this[7]=f,this[8]=d,this.check()}setRowMajor(e,t,i,s,a,l,c,f,d){return this[0]=e,this[1]=s,this[2]=c,this[3]=t,this[4]=a,this[5]=f,this[6]=i,this[7]=l,this[8]=d,this.check()}determinant(){return fM(this)}transpose(){return cM(this,this),this.check()}invert(){return uM(this,this),this.check()}multiplyLeft(e){return Rb(this,e,this),this.check()}multiplyRight(e){return Rb(this,this,e),this.check()}rotate(e){return dM(this,this,e),this.check()}scale(e){return Array.isArray(e)?Cb(this,this,e):Cb(this,this,[e,e]),this.check()}translate(e){return hM(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=YC(t||[-0,-0],e,this);break;case 3:i=$T(t||[-0,-0,-0],e,this);break;case 4:i=HT(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Eo(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let dc,gc=null;function _M(){return dc||(dc=new Pt([0,0,0,0,0,0,0,0,0]),Object.freeze(dc)),dc}function mM(){return gc||(gc=new Pt,Object.freeze(gc)),gc}function yM(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function bM(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],a=e[6],l=e[7],c=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=a,n[11]=e[14],n[12]=s,n[13]=l,n[14]=c}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function _g(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=e[4],c=e[5],f=e[6],d=e[7],g=e[8],_=e[9],y=e[10],b=e[11],x=e[12],E=e[13],M=e[14],N=e[15],V=t*c-i*l,P=t*f-s*l,H=t*d-a*l,X=i*f-s*c,Z=i*d-a*c,he=s*d-a*f,ue=g*E-_*x,J=g*M-y*x,oe=g*N-b*x,de=_*M-y*E,ve=_*N-b*E,be=y*N-b*M;let Se=V*be-P*ve+H*de+X*oe-Z*J+he*ue;return Se?(Se=1/Se,n[0]=(c*be-f*ve+d*de)*Se,n[1]=(s*ve-i*be-a*de)*Se,n[2]=(E*he-M*Z+N*X)*Se,n[3]=(y*Z-_*he-b*X)*Se,n[4]=(f*oe-l*be-d*J)*Se,n[5]=(t*be-s*oe+a*J)*Se,n[6]=(M*H-x*he-N*P)*Se,n[7]=(g*he-y*H+b*P)*Se,n[8]=(l*ve-c*oe+d*ue)*Se,n[9]=(i*oe-t*ve-a*ue)*Se,n[10]=(x*Z-E*H+N*V)*Se,n[11]=(_*H-g*Z-b*V)*Se,n[12]=(c*J-l*de-f*ue)*Se,n[13]=(t*de-i*J+s*ue)*Se,n[14]=(E*P-x*X-M*V)*Se,n[15]=(g*X-_*P+y*V)*Se,n):null}function vM(n){const e=n[0],t=n[1],i=n[2],s=n[3],a=n[4],l=n[5],c=n[6],f=n[7],d=n[8],g=n[9],_=n[10],y=n[11],b=n[12],x=n[13],E=n[14],M=n[15],N=e*l-t*a,V=e*c-i*a,P=t*c-i*l,H=d*x-g*b,X=d*E-_*b,Z=g*E-_*x,he=e*Z-t*X+i*H,ue=a*Z-l*X+c*H,J=d*P-g*V+_*N,oe=b*P-x*V+E*N;return f*he-s*ue+M*J-y*oe}function Fs(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],c=e[4],f=e[5],d=e[6],g=e[7],_=e[8],y=e[9],b=e[10],x=e[11],E=e[12],M=e[13],N=e[14],V=e[15];let P=t[0],H=t[1],X=t[2],Z=t[3];return n[0]=P*i+H*c+X*_+Z*E,n[1]=P*s+H*f+X*y+Z*M,n[2]=P*a+H*d+X*b+Z*N,n[3]=P*l+H*g+X*x+Z*V,P=t[4],H=t[5],X=t[6],Z=t[7],n[4]=P*i+H*c+X*_+Z*E,n[5]=P*s+H*f+X*y+Z*M,n[6]=P*a+H*d+X*b+Z*N,n[7]=P*l+H*g+X*x+Z*V,P=t[8],H=t[9],X=t[10],Z=t[11],n[8]=P*i+H*c+X*_+Z*E,n[9]=P*s+H*f+X*y+Z*M,n[10]=P*a+H*d+X*b+Z*N,n[11]=P*l+H*g+X*x+Z*V,P=t[12],H=t[13],X=t[14],Z=t[15],n[12]=P*i+H*c+X*_+Z*E,n[13]=P*s+H*f+X*y+Z*M,n[14]=P*a+H*d+X*b+Z*N,n[15]=P*l+H*g+X*x+Z*V,n}function cu(n,e,t){const i=t[0],s=t[1],a=t[2];let l,c,f,d,g,_,y,b,x,E,M,N;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*a+e[12],n[13]=e[1]*i+e[5]*s+e[9]*a+e[13],n[14]=e[2]*i+e[6]*s+e[10]*a+e[14],n[15]=e[3]*i+e[7]*s+e[11]*a+e[15]):(l=e[0],c=e[1],f=e[2],d=e[3],g=e[4],_=e[5],y=e[6],b=e[7],x=e[8],E=e[9],M=e[10],N=e[11],n[0]=l,n[1]=c,n[2]=f,n[3]=d,n[4]=g,n[5]=_,n[6]=y,n[7]=b,n[8]=x,n[9]=E,n[10]=M,n[11]=N,n[12]=l*i+g*s+x*a+e[12],n[13]=c*i+_*s+E*a+e[13],n[14]=f*i+y*s+M*a+e[14],n[15]=d*i+b*s+N*a+e[15]),n}function _p(n,e,t){const i=t[0],s=t[1],a=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*a,n[9]=e[9]*a,n[10]=e[10]*a,n[11]=e[11]*a,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function TM(n,e,t,i){let s=i[0],a=i[1],l=i[2],c=Math.sqrt(s*s+a*a+l*l),f,d,g,_,y,b,x,E,M,N,V,P,H,X,Z,he,ue,J,oe,de,ve,be,Se,We;return c<Ro?null:(c=1/c,s*=c,a*=c,l*=c,d=Math.sin(t),f=Math.cos(t),g=1-f,_=e[0],y=e[1],b=e[2],x=e[3],E=e[4],M=e[5],N=e[6],V=e[7],P=e[8],H=e[9],X=e[10],Z=e[11],he=s*s*g+f,ue=a*s*g+l*d,J=l*s*g-a*d,oe=s*a*g-l*d,de=a*a*g+f,ve=l*a*g+s*d,be=s*l*g+a*d,Se=a*l*g-s*d,We=l*l*g+f,n[0]=_*he+E*ue+P*J,n[1]=y*he+M*ue+H*J,n[2]=b*he+N*ue+X*J,n[3]=x*he+V*ue+Z*J,n[4]=_*oe+E*de+P*ve,n[5]=y*oe+M*de+H*ve,n[6]=b*oe+N*de+X*ve,n[7]=x*oe+V*de+Z*ve,n[8]=_*be+E*Se+P*We,n[9]=y*be+M*Se+H*We,n[10]=b*be+N*Se+X*We,n[11]=x*be+V*Se+Z*We,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function ZT(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[4],l=e[5],c=e[6],f=e[7],d=e[8],g=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=a*s+d*i,n[5]=l*s+g*i,n[6]=c*s+_*i,n[7]=f*s+y*i,n[8]=d*s-a*i,n[9]=g*s-l*i,n[10]=_*s-c*i,n[11]=y*s-f*i,n}function xM(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],c=e[2],f=e[3],d=e[8],g=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s-d*i,n[1]=l*s-g*i,n[2]=c*s-_*i,n[3]=f*s-y*i,n[8]=a*i+d*s,n[9]=l*i+g*s,n[10]=c*i+_*s,n[11]=f*i+y*s,n}function QT(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],c=e[2],f=e[3],d=e[4],g=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s+d*i,n[1]=l*s+g*i,n[2]=c*s+_*i,n[3]=f*s+y*i,n[4]=d*s-a*i,n[5]=g*s-l*i,n[6]=_*s-c*i,n[7]=y*s-f*i,n}function AM(n,e){const t=e[0],i=e[1],s=e[2],a=e[4],l=e[5],c=e[6],f=e[8],d=e[9],g=e[10];return n[0]=Math.sqrt(t*t+i*i+s*s),n[1]=Math.sqrt(a*a+l*l+c*c),n[2]=Math.sqrt(f*f+d*d+g*g),n}function SM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t+t,c=i+i,f=s+s,d=t*l,g=i*l,_=i*c,y=s*l,b=s*c,x=s*f,E=a*l,M=a*c,N=a*f;return n[0]=1-_-x,n[1]=g+N,n[2]=y-M,n[3]=0,n[4]=g-N,n[5]=1-d-x,n[6]=b+E,n[7]=0,n[8]=y+M,n[9]=b-E,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function wM(n,e,t,i,s,a,l){const c=1/(t-e),f=1/(s-i),d=1/(a-l);return n[0]=a*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a*2*f,n[6]=0,n[7]=0,n[8]=(t+e)*c,n[9]=(s+i)*f,n[10]=(l+a)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*a*2*d,n[15]=0,n}function EM(n,e,t,i,s){const a=1/Math.tan(e/2);if(n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const RM=EM;function CM(n,e,t,i,s,a,l){const c=1/(e-t),f=1/(i-s),d=1/(a-l);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*c,n[13]=(s+i)*f,n[14]=(l+a)*d,n[15]=1,n}const MM=CM;function OM(n,e,t,i){let s,a,l,c,f,d,g,_,y,b;const x=e[0],E=e[1],M=e[2],N=i[0],V=i[1],P=i[2],H=t[0],X=t[1],Z=t[2];return Math.abs(x-H)<Ro&&Math.abs(E-X)<Ro&&Math.abs(M-Z)<Ro?yM(n):(_=x-H,y=E-X,b=M-Z,s=1/Math.sqrt(_*_+y*y+b*b),_*=s,y*=s,b*=s,a=V*b-P*y,l=P*_-N*b,c=N*y-V*_,s=Math.sqrt(a*a+l*l+c*c),s?(s=1/s,a*=s,l*=s,c*=s):(a=0,l=0,c=0),f=y*c-b*l,d=b*a-_*c,g=_*l-y*a,s=Math.sqrt(f*f+d*d+g*g),s?(s=1/s,f*=s,d*=s,g*=s):(f=0,d=0,g=0),n[0]=a,n[1]=f,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=c,n[9]=g,n[10]=b,n[11]=0,n[12]=-(a*x+l*E+c*M),n[13]=-(f*x+d*E+g*M),n[14]=-(_*x+y*E+b*M),n[15]=1,n)}function IM(){const n=new Bn(4);return Bn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function PM(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function mp(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function NM(n){const e=n[0],t=n[1],i=n[2],s=n[3];return Math.sqrt(e*e+t*t+i*i+s*s)}function DM(n){const e=n[0],t=n[1],i=n[2],s=n[3];return e*e+t*t+i*i+s*s}function kM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3];let l=t*t+i*i+s*s+a*a;return l>0&&(l=1/Math.sqrt(l)),n[0]=t*l,n[1]=i*l,n[2]=s*l,n[3]=a*l,n}function BM(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function UM(n,e,t,i){const s=e[0],a=e[1],l=e[2],c=e[3];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n[2]=l+i*(t[2]-l),n[3]=c+i*(t[3]-c),n}function ra(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*a+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*a+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*a+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*a+t[15]*l,n}function LM(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[0],c=t[1],f=t[2],d=t[3],g=d*i+c*a-f*s,_=d*s+f*i-l*a,y=d*a+l*s-c*i,b=-l*i-c*s-f*a;return n[0]=g*d+b*-l+_*-f-y*-c,n[1]=_*d+b*-c+y*-l-g*-f,n[2]=y*d+b*-f+g*-c-_*-l,n[3]=e[3],n}(function(){const n=IM();return function(e,t,i,s,a,l){let c,f;for(t||(t=4),i||(i=0),s?f=Math.min(s*t+i,e.length):f=e.length,c=i;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],n[3]=e[c+3],a(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2],e[c+3]=n[3];return e}})();var mg;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(mg||(mg={}));const FM=45*Math.PI/180,zM=1,Rd=.1,Cd=500,VM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class $t extends KT{static get IDENTITY(){return WM()}static get ZERO(){return HM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return mg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,a,l,c,f,d,g,_,y,b,x,E,M){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=a,this[5]=l,this[6]=c,this[7]=f,this[8]=d,this[9]=g,this[10]=_,this[11]=y,this[12]=b,this[13]=x,this[14]=E,this[15]=M,this.check()}setRowMajor(e,t,i,s,a,l,c,f,d,g,_,y,b,x,E,M){return this[0]=e,this[1]=a,this[2]=d,this[3]=b,this[4]=t,this[5]=l,this[6]=g,this[7]=x,this[8]=i,this[9]=c,this[10]=_,this[11]=E,this[12]=s,this[13]=f,this[14]=y,this[15]=M,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(VM)}fromObject(e){return this.check()}fromQuaternion(e){return SM(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:a,near:l=Rd,far:c=Cd}=e;return c===1/0?jM(this,t,i,s,a,l):wM(this,t,i,s,a,l,c),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return OM(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:a,near:l=Rd,far:c=Cd}=e;return MM(this,t,i,s,a,l,c),this.check()}orthographic(e){const{fovy:t=FM,aspect:i=zM,focalDistance:s=1,near:a=Rd,far:l=Cd}=e;Mb(t);const c=t/2,f=s*Math.tan(c),d=f*i;return this.ortho({left:-d,right:d,bottom:-f,top:f,near:a,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:a=500}=e;return Mb(t),RM(this,t,i,s,a),this.check()}determinant(){return vM(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*a,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*a,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*a,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*a,e[8]=this[10]*l,e}transpose(){return bM(this,this),this.check()}invert(){return _g(this,this),this.check()}multiplyLeft(e){return Fs(this,e,this),this.check()}multiplyRight(e){return Fs(this,this,e),this.check()}rotateX(e){return ZT(this,this,e),this.check()}rotateY(e){return xM(this,this,e),this.check()}rotateZ(e){return QT(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return TM(this,this,e,t),this.check()}scale(e){return _p(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return cu(this,this,e),this.check()}transform(e,t){return e.length===4?(t=ra(t||[-0,-0,-0,-0],e,this),Eo(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=qC(t||[-0,-0],e,this);break;case 3:s=gp(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Eo(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=KC(t||[-0,-0],e,this);break;case 3:i=VT(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Eo(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let pc,_c;function HM(){return pc||(pc=new $t([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(pc)),pc}function WM(){return _c||(_c=new $t,Object.freeze(_c)),_c}function Mb(n){if(n>Math.PI*2)throw Error("expected radians")}function jM(n,e,t,i,s,a){const l=2*a/(t-e),c=2*a/(s-i),f=(t+e)/(t-e),d=(s+i)/(s-i),g=-1,_=-1,y=-2*a;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=f,n[9]=d,n[10]=g,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function Ob(){const n=new Bn(4);return Bn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function $M(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function GT(n,e,t){t=t*.5;const i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function Ib(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],c=t[0],f=t[1],d=t[2],g=t[3];return n[0]=i*g+l*c+s*d-a*f,n[1]=s*g+l*f+a*c-i*d,n[2]=a*g+l*d+i*f-s*c,n[3]=l*g-i*c-s*f-a*d,n}function XM(n,e,t){t*=.5;const i=e[0],s=e[1],a=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f+l*c,n[1]=s*f+a*c,n[2]=a*f-s*c,n[3]=l*f-i*c,n}function YM(n,e,t){t*=.5;const i=e[0],s=e[1],a=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f-a*c,n[1]=s*f+l*c,n[2]=a*f+i*c,n[3]=l*f-s*c,n}function qM(n,e,t){t*=.5;const i=e[0],s=e[1],a=e[2],l=e[3],c=Math.sin(t),f=Math.cos(t);return n[0]=i*f+s*c,n[1]=s*f-i*c,n[2]=a*f+l*c,n[3]=l*f-a*c,n}function KM(n,e){const t=e[0],i=e[1],s=e[2];return n[0]=t,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-s*s)),n}function kc(n,e,t,i){const s=e[0],a=e[1],l=e[2],c=e[3];let f=t[0],d=t[1],g=t[2],_=t[3],y,b,x,E,M;return y=s*f+a*d+l*g+c*_,y<0&&(y=-y,f=-f,d=-d,g=-g,_=-_),1-y>Ro?(b=Math.acos(y),M=Math.sin(b),x=Math.sin((1-i)*b)/M,E=Math.sin(i*b)/M):(x=1-i,E=i),n[0]=x*s+E*f,n[1]=x*a+E*d,n[2]=x*l+E*g,n[3]=x*c+E*_,n}function ZM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t*t+i*i+s*s+a*a,c=l?1/l:0;return n[0]=-t*c,n[1]=-i*c,n[2]=-s*c,n[3]=a*c,n}function QM(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function JT(n,e){const t=e[0]+e[4]+e[8];let i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const a=(s+1)%3,l=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[a*3+a]-e[l*3+l]+1),n[s]=.5*i,i=.5/i,n[3]=(e[a*3+l]-e[l*3+a])*i,n[a]=(e[a*3+s]+e[s*3+a])*i,n[l]=(e[l*3+s]+e[s*3+l])*i}return n}const GM=PM,JM=mp,eO=BM,tO=UM,nO=NM,iO=DM,e3=kM,sO=function(){const n=WT(),e=Eb(1,0,0),t=Eb(0,1,0);return function(i,s,a){const l=jT(s,a);return l<-.999999?(Dc(n,e,s),qT(n)<1e-6&&Dc(n,t,s),nM(n,n),GT(i,n,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Dc(n,s,a),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+l,e3(i,i))}}();(function(){const n=Ob(),e=Ob();return function(t,i,s,a,l,c){return kc(n,i,l,c),kc(e,s,a,c),kc(t,n,e,2*c*(1-c)),t}})();(function(){const n=lM();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],e3(e,JT(e,n))}})();const rO=[0,0,0,1];class Pb extends dp{constructor(e=0,t=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return JT(this,e),this.check()}fromAxisRotation(e,t){return GT(this,e,t),this.check()}identity(){return $M(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ze(e)}get y(){return this[1]}set y(e){this[1]=Ze(e)}get z(){return this[2]}set z(e){this[2]=Ze(e)}get w(){return this[3]}set w(e){this[3]=Ze(e)}len(){return nO(this)}lengthSquared(){return iO(this)}dot(e){return eO(this,e)}rotationTo(e,t){return sO(this,e,t),this.check()}add(e){return GM(this,this,e),this.check()}calculateW(){return KM(this,this),this.check()}conjugate(){return QM(this,this),this.check()}invert(){return ZM(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(tO(this,e,t,i),this.check())}multiplyRight(e){return Ib(this,this,e),this.check()}multiplyLeft(e){return Ib(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return XM(this,this,e),this.check()}rotateY(e){return YM(this,this,e),this.check()}rotateZ(e){return qM(this,this,e),this.check()}scale(e){return JM(this,this,e),this.check()}slerp(e,t,i){let s,a,l;switch(arguments.length){case 1:({start:s=rO,target:a,ratio:l}=e);break;case 2:s=this,a=e,l=t;break;default:s=e,a=t,l=i}return kc(this,s,a,l),this.check()}transformVector4(e,t=new pp){return LM(t,e,this),Eo(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const aO=1e-15,oO=1e-20;function t3(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function lO(n){return n-Math.fround(n)}function cO(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;t3(n[i*4+t],e,s*2)}return e}const uO=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fO={name:"fp32",vs:uO},hO=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,dO={ONE:1},gO={name:"fp64arithmetic",vs:hO,defaultUniforms:dO,uniformTypes:{ONE:"f32"},fp64ify:t3,fp64LowPart:lO,fp64ifyMatrix4:cO},pO=[0,1,1,1],_O=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,mO=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Nb={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:pO},vs:_O,fs:mO,getUniforms:yO};function yO(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Db=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,bO=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,n3=3,vO=255;var ko;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(ko||(ko={}));const Bc={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:n3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:ko.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:bO,vs:Db,fs:Db,getUniforms:TO};function TO(n,e={}){if(n=n&&{...n},!n)return{...Bc.defaultUniforms};n.lights&&(n={...n,...AO(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...Bc.defaultUniforms,enabled:0};const l={...Bc.defaultUniforms,...e,...xO({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function xO({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientLightColor=Md(n);let s=0;for(const a of e){i.lightType=ko.POINT;const l=s;i[`lightColor${l}`]=Md(a),i[`lightPosition${l}`]=a.position,i[`lightAttenuation${l}`]=a.attenuation||[1,0,0],s++}for(const a of t){i.lightType=ko.DIRECTIONAL;const l=s;i[`lightColor${l}`]=Md(a),i[`lightDirection${l}`]=a.direction,s++}return s>n3&&ae.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function AO(n){var t,i;const e={pointLights:[],directionalLights:[]};for(const s of n||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(i=e.pointLights)==null||i.push(s);break}return e}function Md(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/vO)}const SO=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,wO=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,i3={props:{},name:"gouraudMaterial",vs:wO.replace("phongMaterial","gouraudMaterial"),fs:SO.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Bc],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...i3.defaultUniforms,...e}}},kb=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,EO={name:"layer",vs:kb,fs:kb,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},s3="#define SMOOTH_EDGE_RADIUS 0.5",RO=`
${s3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,CO=`
${s3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,r3={name:"geometry",vs:RO,fs:CO},MO=25;var _t;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(_t||(_t={}));var vt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(vt||(vt={}));var Ee;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ee||(Ee={}));const OO="compute",IO="auto",yg="manipulation",Uc="none",bg="pan-x",vg="pan-y";function PO(n){if(n.includes(Uc))return Uc;const e=n.includes(bg),t=n.includes(vg);return e&&t?Uc:e||t?e?bg:vg:n.includes(yg)?yg:IO}class NO{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===OO&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return PO(e.join(" "))}}function uu(n){return n.trim().split(/\s+/g)}function Od(n,e,t){if(n)for(const i of uu(e))n.addEventListener(i,t,!1)}function Id(n,e,t){if(n)for(const i of uu(e))n.removeEventListener(i,t,!1)}function Bb(n){return(n.ownerDocument||n).defaultView}function DO(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function a3(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function Ub(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:a3(e),deltaX:n.deltaX,deltaY:n.deltaY}}function o3(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Lb(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function kO(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Fb(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function l3(n,e){return n===e?vt.None:Math.abs(n)>=Math.abs(e)?n<0?vt.Left:vt.Right:e<0?vt.Up:vt.Down}function BO(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const a=n.prevInput;return(e.eventType===_t.Start||(a==null?void 0:a.eventType)===_t.End)&&(s=n.prevDelta={x:(a==null?void 0:a.deltaX)||0,y:(a==null?void 0:a.deltaY)||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function c3(n,e,t){return{x:e/n||0,y:t/n||0}}function UO(n,e){return Lb(e[0],e[1])/Lb(n[0],n[1])}function LO(n,e){return Fb(e[1],e[0])-Fb(n[1],n[0])}function FO(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,a,l,c;if(e.eventType!==_t.Cancel&&(i>MO||t.velocity===void 0)){const f=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,g=c3(i,f,d);a=g.x,l=g.y,s=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,c=l3(f,d),n.lastInterval=e}else s=t.velocity,a=t.velocityX,l=t.velocityY,c=t.direction;e.velocity=s,e.velocityX=a,e.velocityY=l,e.direction=c}function zO(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=Ub(e)),s>1&&!t.firstMultiple?t.firstMultiple=Ub(e):s===1&&(t.firstMultiple=!1);const{firstInput:a,firstMultiple:l}=t,c=l?l.center:a.center,f=e.center=a3(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=kO(c,f),e.distance=o3(c,f);const{deltaX:d,deltaY:g}=BO(t,e);e.deltaX=d,e.deltaY=g,e.offsetDirection=l3(e.deltaX,e.deltaY);const _=c3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?UO(l.pointers,i):1,e.rotation=l?LO(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return DO(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,FO(t,e),e}function VO(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,a=e&_t.Start&&i-s===0,l=e&(_t.End|_t.Cancel)&&i-s===0;t.isFirst=!!a,t.isFinal=!!l,a&&(n.session={}),t.eventType=e;const c=zO(n,t);n.emit("hammer.input",c),n.recognize(c),n.session.prevInput=c}let HO=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){VO(this.manager,e,t)}init(){Od(this.element,this.evEl,this.domHandler),Od(this.target,this.evTarget,this.domHandler),Od(Bb(this.element),this.evWin,this.domHandler)}destroy(){Id(this.element,this.evEl,this.domHandler),Id(this.target,this.evTarget,this.domHandler),Id(Bb(this.element),this.evWin,this.domHandler)}};const WO={pointerdown:_t.Start,pointermove:_t.Move,pointerup:_t.End,pointercancel:_t.Cancel,pointerout:_t.Cancel},jO="pointerdown",$O="pointermove pointerup pointercancel";class XO extends HO{constructor(e){super(e),this.evEl=jO,this.evWin=$O,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=WO[e.type],a=e.pointerType,l=a==="touch";let c=t.findIndex(f=>f.pointerId===e.pointerId);s&_t.Start&&(e.buttons||l)?c<0&&(t.push(e),c=t.length-1):s&(_t.End|_t.Cancel)&&(i=!0),!(c<0)&&(t[c]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:a,srcEvent:e}),i&&t.splice(c,1))}}const YO=["","webkit","Moz","MS","ms","o"];function qO(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of YO){const s=i?i+t:e;if(s in n)return s}}const KO=1,zb=2,Vb={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class ZO{constructor(e,t){this.options={...Vb,...t,cssProps:{...Vb.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new XO(this),this.touchAction=new NO(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?zb:KO}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:a}=t;(!a||a&&a.state&Ee.Recognized)&&(a=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==zb&&(!a||i===a||i.canRecognizeWith(a))?i.recognize(e):i.reset(),!a&&i.state&(Ee.Began|Ee.Changed|Ee.Ended)&&(a=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of uu(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of uu(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let a=0;for(;a<i.length;)i[a](s),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const a=qO(t.style,i);e?(this.oldCssProps[a]=t.style[a],t.style[a]=s):t.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let QO=1;function GO(){return QO++}function Hb(n){return n&Ee.Cancelled?"cancel":n&Ee.Ended?"end":n&Ee.Changed?"move":n&Ee.Began?"start":""}class u3{constructor(e){this.options=e,this.id=GO(),this.state=Ee.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ee.Ended&&this.manager.emit(this.options.event+Hb(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ee.Ended&&this.manager.emit(this.options.event+Hb(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ee.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ee.Failed|Ee.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ee.Failed;return}this.state&(Ee.Recognized|Ee.Cancelled|Ee.Failed)&&(this.state=Ee.Possible),this.state=this.process(t),this.state&(Ee.Began|Ee.Changed|Ee.Ended|Ee.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class f3 extends u3{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Ee.Began|Ee.Changed),a=this.attrTest(e);return s&&(i&_t.Cancel||!a)?t|Ee.Cancelled:s||a?i&_t.End?t|Ee.Ended:t&Ee.Began?t|Ee.Changed:Ee.Began:Ee.Failed}}class Wb extends u3{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[yg]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&_t.Start&&this.count===0)return this.failTimeout();if(s&&a&&i){if(e.eventType!==_t.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||o3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ee.Recognized,this.tryEmit(this._input)},t.interval),Ee.Began):Ee.Recognized}return Ee.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ee.Failed},this.options.interval),Ee.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ee.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const JO=["","start","move","end","cancel","up","down","left","right"];class jb extends f3{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:vt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&vt.Horizontal&&t.push(vg),e&vt.Vertical&&t.push(bg),t}getEventNames(){return JO.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:a}=e;const l=e.deltaX,c=e.deltaY;return a&t.direction||(t.direction&vt.Horizontal?(a=l===0?vt.None:l<0?vt.Left:vt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(a=c===0?vt.None:c<0?vt.Up:vt.Down,i=c!==this.pY,s=Math.abs(e.deltaY))),e.direction=a,i&&s>t.threshold&&!!(a&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ee.Began)||!(this.state&Ee.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=vt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const eI=["","start","move","end","cancel","in","out"];class tI extends f3{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Uc]}getEventNames(){return eI.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ee.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Bu{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const nI=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",iI=nI.indexOf("firefox")!==-1,$b=4.000244140625,sI=40,rI=.25;class aI extends Bu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let a=s.deltaY;globalThis.WheelEvent&&(iI&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=sI)),a!==0&&a%$b===0&&(a=Math.floor(a/$b)),s.shiftKey&&a&&(a=a*rI),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-a,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Xb=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class oI extends Bu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Xb.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){Xb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Yb=["keydown","keyup"];class lI extends Bu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const a=s.target||s.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Yb.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Yb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class cI extends Bu{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const qb=1,Tg=2,Kb=4,uI={pointerdown:qb,pointermove:Tg,pointerup:Kb,mousedown:qb,mousemove:Tg,mouseup:Kb},fI=0,hI=1,dI=2,gI=1,pI=2,_I=4;function mI(n){const e=uI[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,a=!1,l=!1;return e===Tg?(s=!!(t&gI),a=!!(t&_I),l=!!(t&pI)):(s=i===fI,a=i===hI,l=i===dI),{leftButton:s,middleButton:a,rightButton:l}}function yI(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/a};return{center:t,offsetCenter:l}}const bI={srcElement:"root",priority:0};class vI{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,a=!1){const{handlers:l,handlersByElement:c}=this,f={...bI,...i};let d=c.get(f.srcElement);d||(d=[],c.set(f.srcElement,d));const g={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};s&&(g.once=!0),a&&(g.passive=!0),l.push(g),this._active=this._active||!g.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=g.priority);)_--;d.splice(_+1,0,g)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.type===e&&l.handler===t){i.splice(a,1);const c=s.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&s.delete(l.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const a=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},c=[];for(let f=0;f<i.length;f++){const{type:d,handler:g,once:_}=i[f];if(g({...e,type:d,stopPropagation:a,stopImmediatePropagation:l}),_&&c.push(i[f]),s)break}for(let f=0;f<c.length;f++){const{type:d,handler:g}=c[f];this.remove(d,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...mI(e),...yI(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function TI(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class xI{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new ZO(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:a,requireFailure:l}=TI(i);this.manager.add(s),a&&s.recognizeWith(a),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new aI(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oI(e,this._onOtherEvent,{enable:!1}),this.keyInput=new lI(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new cI(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var a,l,c,f;const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),(a=this.wheelInput)==null||a.enableEventType(e,t),(l=this.moveInput)==null||l.enableEventType(e,t),(c=this.keyInput)==null||c.enableEventType(e,t),(f=this.contextmenuInput)==null||f.enableEventType(e,t)}_addEventHandler(e,t,i,s,a){if(typeof e!="string"){i=t;for(const[d,g]of Object.entries(e))this._addEventHandler(d,g,i,s,a);return}const{manager:l,events:c}=this;if(!l)return;let f=c.get(e);if(!f){const d=this._getRecognizerName(e)||e;f=new vI(this,d),c.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,t,i,s,a),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[a,l]of Object.entries(e))this._removeEventHandler(a,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:a}=s;let l=!1;for(const c of i.values())if(c.recognizerName===a&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(i=>i.getEventNames().includes(e)))==null?void 0:t.options.event}}const Le={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Le,"IDENTITY",{get:()=>(De.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Pn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},$s={common:0,meters:1,pixels:2},xg={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Zb={multipan:[jb,{threshold:10,direction:vt.Vertical,pointers:2}],pinch:[tI,{},null,["multipan"]],pan:[jb,{threshold:1},["pinch"],["multipan"]],dblclick:[Wb,{event:"dblclick",taps:2}],click:[Wb,{event:"click"},null,["dblclick"]]};function AI(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function $o(n){let e={},t;return i=>{for(const s in i)if(!AI(i[s],e[s])){t=n(i),e=i;break}return t}}const Qb=[0,0,0,0],SI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],h3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wI=[0,0,0],d3=[0,0,0],EI=$o(MI);function g3(n,e,t=d3){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,a=!0;switch(e===Le.LNGLAT_OFFSETS||e===Le.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Pn.WEB_MERCATOR:(e===Le.LNGLAT||e===Le.CARTESIAN)&&(s=[0,0,0],a=!1);break;case Pn.WEB_MERCATOR_AUTO_OFFSET:e===Le.LNGLAT?i=s:e===Le.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Pn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Pn.GLOBE:a=!1,s=null;break;default:a=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:a}}function RI(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:a,viewProjectionMatrix:l}=n,c=Qb,f=Qb,d=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:y}=g3(n,e,t);return y&&(f=n.projectPosition(g||_),d=[d[0]-f[0],d[1]-f[1],d[2]-f[2]],f[3]=1,c=ra([],f,l),a=i||a,l=Fs([],s,a),l=Fs([],l,SI)),{viewMatrix:a,viewProjectionMatrix:l,projectionCenter:c,originCommon:f,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:g}}function CI({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Le.DEFAULT,coordinateOrigin:s=d3,autoWrapLongitude:a=!1}){i===Le.DEFAULT&&(i=n.isGeospatial?Le.LNGLAT:Le.CARTESIAN);const l=EI({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=a,l.modelMatrix=t||h3,l}function MI({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:d}=RI(n,t,i),g=n.getDistanceScales(),_=[n.width*e,n.height*e],y=ra([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:wI,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:h3,cameraPosition:c};if(d){const x=n.getDistanceScales(d);switch(t){case Le.METER_OFFSETS:b.commonUnitsPerWorldUnit=x.unitsPerMeter,b.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case Le.LNGLAT:case Le.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=x.unitsPerMeter),b.commonUnitsPerWorldUnit=x.unitsPerDegree,b.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case Le.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return b}const OI=Object.keys(Le).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Le[n]};`).join(""),II=Object.keys(Pn).map(n=>`const int PROJECTION_MODE_${n} = ${Pn[n]};`).join(""),PI=Object.keys($s).map(n=>`const int UNIT_${n.toUpperCase()} = ${$s[n]};`).join(""),NI=`${OI}
${II}
${PI}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,DI={};function kI(n=DI){return"viewport"in n?CI(n):{}}const yp={name:"project",dependencies:[fO,r3],vs:NI,getUniforms:kI,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},BI=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,aa={name:"project32",dependencies:[yp],vs:BI};function UI(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function qr(n,e){const t=ra([],e,n);return mp(t,t,1/t[3]),t}function Gb(n,e){const t=n%e;return t<0?e+t:t}function Ag(n,e,t){return n<e?e:n>t?t:n}function LI(n){return Math.log(n)*Math.LOG2E}const bp=Math.log2||LI;function vi(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Nn=Math.PI,p3=Nn/4,bn=Nn/180,Sg=180/Nn,Jr=512,fu=4003e4,wg=85.051129,FI=1.5;function zI(n){return bp(n)}function os(n){const[e,t]=n;vi(Number.isFinite(e)),vi(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*bn,s=t*bn,a=Jr*(i+Nn)/(2*Nn),l=Jr*(Nn+Math.log(Math.tan(p3+s*.5)))/(2*Nn);return[a,l]}function ea(n){const[e,t]=n,i=e/Jr*(2*Nn)-Nn,s=2*(Math.atan(Math.exp(t/Jr*(2*Nn)-Nn))-p3);return[i*Sg,s*Sg]}function VI(n){const{latitude:e}=n;vi(Number.isFinite(e));const t=Math.cos(e*bn);return zI(fu*t)-9}function Pd(n){const e=Math.cos(n*bn);return Jr/fu/e}function Eg(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;vi(Number.isFinite(e)&&Number.isFinite(t));const s=Jr,a=Math.cos(e*bn),l=s/360,c=l/a,f=s/fu/a,d={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,c,f],degreesPerUnit:[1/l,1/c,1/f]};if(i){const g=bn*Math.tan(e*bn)/a,_=l*g/2,y=s/fu*g,b=y/c*f;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[b,0,b]}return d}function _3(n,e){const[t,i,s]=n,[a,l,c]=e,{unitsPerMeter:f,unitsPerMeter2:d}=Eg({longitude:t,latitude:i,highPrecision:!0}),g=os(n);g[0]+=a*(f[0]+d[0]*l),g[1]+=l*(f[1]+d[1]*l);const _=ea(g),y=(s||0)+(c||0);return Number.isFinite(s)||Number.isFinite(c)?[_[0],_[1],y]:_}function HI(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:a,center:l}=n,c=UI();cu(c,c,[0,0,-s]),ZT(c,c,-t*bn),QT(c,c,i*bn);const f=a/e;return _p(c,c,[f,f,f]),l&&cu(c,c,tM([],l)),c}function WI(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:a,center:l,scale:c,nearZMultiplier:f=1,farZMultiplier:d=1}=n;let{fovy:g=Bo(FI)}=n;i!==void 0&&(g=Bo(i));const _=g*bn,y=s*bn,b=vp(g);let x=b;l&&(x+=l[2]*c/Math.cos(y)/t);const E=_*(.5+(a?a[1]:0)/t),M=Math.sin(E)*x/Math.sin(Ag(Math.PI/2-y-E,.01,Math.PI-.01)),N=Math.sin(y)*M+x,V=x*10,P=Math.min(N*d,V);return{fov:_,aspect:e/t,focalDistance:b,near:f,far:P}}function Bo(n){return 2*Math.atan(.5/n)*Sg}function vp(n){return .5/Math.tan(.5*n*bn)}function m3(n,e){const[t,i,s=0]=n;return vi(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),qr(e,[t,i,s,1])}function Tp(n,e,t=0){const[i,s,a]=n;if(vi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(a))return qr(e,[i,s,a,1]);const l=qr(e,[i,s,0,1]),c=qr(e,[i,s,1,1]),f=l[2],d=c[2],g=f===d?0:((t||0)-f)/(d-f);return zT([],l,c,g)}function jI(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:a=24,offset:l=[0,0]}=n,[[c,f],[d,g]]=i,_=$I(n.padding),y=os([c,Ag(g,-85.051129,wg)]),b=os([d,Ag(f,-85.051129,wg)]),x=[Math.max(Math.abs(b[0]-y[0]),s),Math.max(Math.abs(b[1]-y[1]),s)],E=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];vi(E[0]>0&&E[1]>0);const M=E[0]/x[0],N=E[1]/x[1],V=(_.right-_.left)/2/M,P=(_.top-_.bottom)/2/N,H=[(b[0]+y[0])/2+V,(b[1]+y[1])/2+P],X=ea(H),Z=Math.min(a,bp(Math.abs(Math.min(M,N))));return vi(Number.isFinite(Z)),{longitude:X[0],latitude:X[1],zoom:Z}}function $I(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(vi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Jb=Math.PI/180;function XI(n,e=0){const{width:t,height:i,unproject:s}=n,a={targetZ:e},l=s([0,i],a),c=s([t,i],a);let f,d;const g=n.fovy?.5*n.fovy*Jb:Math.atan(.5/n.altitude),_=(90-n.pitch)*Jb;return g>_-.01?(f=ev(n,0,e),d=ev(n,t,e)):(f=s([0,0],a),d=s([t,0],a)),[l,c,d,f]}function ev(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=qr(i,[e,0,1,1]),a=qr(i,[e,n.height,1,1]),c=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(a[2]-s[2]),f=zT([],s,a,c),d=ea(f);return d.push(t),d}const tv=512;function YI(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:a,zoom:l,bearing:c=0}=n;(s<-180||s>180)&&(s=Gb(s+180,360)-180),(c<-180||c>180)&&(c=Gb(c+180,360)-180);const f=bp(t/tv);if(l<=f)l=f,a=0;else{const d=t/2/Math.pow(2,l),g=ea([0,d])[1];if(a<g)a=g;else{const _=ea([0,tv-d])[1];a>_&&(a=_)}}return{width:e,height:t,longitude:s,latitude:a,zoom:l,pitch:i,bearing:c}}const y3=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,qI=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,KI=`
${y3}
${qI}
`,ZI=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,QI=`
${y3}
${ZI}
`,GI=$o(iP),JI=$o(sP),eP=[0,0,0,1],tP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function nP(n,e){const[t,i,s]=n,a=Tp([t,i,s],e);return Number.isFinite(s)?a:[a[0],a[1],0]}function iP({viewport:n,center:e}){return new $t(n.viewProjectionMatrix).invert().transform(e)}function sP({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,a=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>nP(l,i));for(const l of e){const c=l.clone().translate(new fe(n.center).negate()),f=a.map(g=>c.transform(g)),d=new $t().ortho({left:Math.min(...f.map(g=>g[0])),right:Math.max(...f.map(g=>g[0])),bottom:Math.min(...f.map(g=>g[1])),top:Math.max(...f.map(g=>g[1])),near:Math.min(...f.map(g=>-g[2])),far:Math.max(...f.map(g=>-g[2]))});t.push(d.multiplyRight(l))}return t}function rP(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=yp.getUniforms(t),s=GI({viewport:t.viewport,center:i.center}),a=[],l=JI({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const d=l[f],g=d.clone().translate(new fe(t.viewport.center).negate());i.coordinateSystem===Le.LNGLAT&&i.projectionMode===Pn.WEB_MERCATOR?(l[f]=g,a[f]=s):(l[f]=d.clone().multiplyRight(tP),a[f]=g.transform(s))}const c={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||eP,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<l.length;f++)c[`viewProjectionMatrix${f}`]=l[f],c[`projectCenter${f}`]=a[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return c}const nv={name:"shadow",dependencies:[yp],vs:KI,fs:QI,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:rP,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},oa={...Nb,defaultUniforms:{...Nb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},aP=[r3],oP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],lP=[];function cP(n){const e=Qc.getDefaultShaderAssembler();for(const i of aP)e.addDefaultModule(i);const t=n==="glsl"?oP:lP;for(const i of t)e.addShaderHook(i);return e}const uP=[255,255,255],fP=1;let hP=0;class dP{constructor(e={}){this.type="ambient";const{color:t=uP}=e,{intensity:i=fP}=e;this.id=e.id||`ambient-${hP++}`,this.color=t,this.intensity=i}}const gP=[255,255,255],pP=1,_P=[0,0,-1];let mP=0;class iv{constructor(e={}){this.type="directional";const{color:t=gP}=e,{intensity:i=pP}=e,{direction:s=_P}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${mP++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new fe(s).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class yP{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class xp extends yP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,a=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,c=s?0:!1,f=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=f),e.scissorRect&&(d.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:a,clearDepth:l,clearStencil:c});try{return this._drawLayers(g,e)}finally{g.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:a,views:l,onViewportActive:c,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const d=[];for(const g of a){const _=l&&l[g.id];c==null||c(g);const y=this._getDrawLayerParams(g,t),b=g.subViewports||[g];for(const x of b){const E=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:x,view:_,pass:t.pass,layers:t.layers},y);d.push(E)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:a,cullRect:l,effects:c,shaderModuleProps:f},d=!1){var x;const g=[],_=b3(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},b={};for(let E=0;E<t.length;E++){const M=t[E],N=this._shouldDrawLayer(M,y,a,b),V={shouldDrawLayer:N};N&&!d&&(V.shouldDrawLayer=!0,V.layerRenderIndex=_(M,N),V.shaderModuleProps=this._getShaderModuleProps(M,c,i,f),V.layerParameters={...(x=M.context.deck)==null?void 0:x.props.parameters,...this.getLayerParameters(M,E,e)}),g[E]=V}return g}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:a,viewport:l,view:c},f){const d=bP(this.device,{shaderModuleProps:i,target:a,viewport:l});if(c&&c.props.clear){const _=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:a,parameters:{viewport:d,scissorRect:d},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<t.length;_++){const y=t[_],b=f[_],{shouldDrawLayer:x}=b;if(x&&y.props.pickable&&g.pickableCount++,y.isComposite&&g.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:E,shaderModuleProps:M,layerParameters:N}=b;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),M.project&&(M.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:M,uniforms:{layerIndex:E},parameters:N})}catch(V){y.raiseError(V,`drawing ${y} to ${s}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const c=t.layer.id;if(c in s||(s[c]=i(t)),!s[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){var f,d;const a=this.device.canvasContext.cssToDeviceRatio(),l=((f=e.internalState)==null?void 0:f.propsInTransition)||e.props,c={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const g of t)sv(c,(d=g.getShaderModuleProps)==null?void 0:d.call(g,e,c));return sv(c,this.getShaderModuleProps(e,t,c),s)}}function b3(n=0,e={}){const t={},i=(s,a)=>{const l=s.props._offset,c=s.id,f=s.parent&&s.parent.id;let d;if(f&&!(f in e)&&i(s.parent,!1),f in t){const g=t[f]=t[f]||b3(e[f],e);d=g(s,a),t[c]=g}else Number.isFinite(l)?(d=l+(e[f]||0),t[c]=null):d=n;return a&&d>=n&&(n=d+1),e[c]=d,d};return i}function bP(n,{shaderModuleProps:e,target:t,viewport:i}){var f;const s=((f=e==null?void 0:e.project)==null?void 0:f.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,a]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:a,c=i;return[c.x*s,l-(c.y+c.height)*s,c.width*s,c.height*s,0,1]}function sv(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class vP extends xp{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],a=s.width*i,l=s.height*i,c=[1,1,1,1];(a!==t.width||l!==t.height)&&t.resize({width:a,height:l}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const TP={color:[255,255,255],intensity:1},rv=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],xP=[0,0,0,200/255];class v3{constructor(e={}){this.id="lighting-effect",this.shadowColor=xP,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(nv),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:i,lighting:s,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(nv))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new $t().lookAt({eye:new fe(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new vP(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new dP(TP),this.directionalLights.push(new iv(rv[0]),new iv(rv[1])))}}class AP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:a=0,copy:l=!1,initialize:c=!1,maxCount:f}){const d=s||e&&e.constructor||Float32Array,g=t*i+a;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,g)}let _=1/0;f&&(_=f*i+a);const y=this._allocate(d,g,c,_);return e&&l?y.set(e):c||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let a=Math.max(Math.ceil(t*this.opts.overAlloc),1);a>s&&(a=s);const l=this._pool,c=e.BYTES_PER_ELEMENT*a,f=l.findIndex(d=>d.byteLength>=c);if(f>=0){const d=new e(l.splice(f,1)[0],0,a);return i&&d.fill(0),d}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,a=t.findIndex(l=>l.byteLength>=s);a<0?t.push(i):(a>0||t.length<this.opts.poolSize)&&t.splice(a,0,i),t.length>this.opts.poolSize&&t.shift()}}const ta=new AP;function mo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function SP(n){return[n[12],n[13],n[14]]}function wP(n){return{left:Br(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Br(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Br(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Br(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Br(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Br(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const av=new fe;function Br(n,e,t,i){av.set(n,e,t);const s=av.len();return{distance:i/s,normal:new fe(-n/s,-e/s,-t/s)}}function EP(n){return n-Math.fround(n)}let co;function Nd(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,a=(s-i)/t;co=ta.allocate(co,a,{type:Float32Array,size:t*2});let l=i,c=0;for(;l<s;){for(let f=0;f<t;f++){const d=n[l++];co[c+f]=d,co[c+f+t]=EP(d)}c+=t*2}return co.subarray(0,a*t*2)}function RP(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const CP=Math.PI/180,MP=mo(),ov=[0,0,0],OP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function IP({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:a,near:l,far:c}){const f=n/e,d=t?new $t().orthographic({fovy:i,aspect:f,focalDistance:s,near:l,far:c}):new $t().perspective({fovy:i,aspect:f,near:l,far:c});if(a){const{left:g=0,right:_=0,top:y=0,bottom:b=0}=a,x=es((g+n-_)/2,0,n)-n/2,E=es((y+e-b)/2,0,e)-e/2;d[8]-=x*2/n,d[9]+=E*2/e}return d}class la{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||OP,this.focalDistance=e.focalDistance||1,this.position=e.position||ov,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Pn.WEB_MERCATOR:Pn.WEB_MERCATOR_AUTO_OFFSET:Pn.IDENTITY}equals(e){return e instanceof la?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&bi(e.projectionMatrix,this.projectionMatrix)&&bi(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=m3(i,this.pixelProjectionMatrix),[a,l]=s,c=t?l:this.height-l;return e.length===2?[a,c]:[a,c,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,c=t?a:this.height-a,f=i&&i*this.distanceScales.unitsPerMeter[2],d=Tp([s,c,l],this.pixelUnprojectionMatrix,f),[g,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[g,_,y]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=os(e);return t[1]=es(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ea(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),a=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],a[0],l[0]),Math.min(i[1],s[1],a[1],l[1]),Math.max(i[0],s[0],a[0],l[0]),Math.max(i[1],s[1],a[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?Eg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,wP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=VI({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Eg({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:a,modelMatrix:l}=e;let c=ov;if(a&&(c=l?new $t(l).transformAsVector(a,[]):a),this.isGeospatial){const f=this.projectPosition([t,i,0]);this.center=new fe(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=MP,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:a,fovy:l=75,near:c=.1,far:f=1e3,padding:d=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new $t().multiplyRight(t).translate(new fe(this.center).negate()),this.projectionMatrix=i||IP({width:this.width,height:this.height,orthographic:s,fovyRadians:a||l*CP,focalDistance:g,padding:d,near:c,far:f});const _=mo();Fs(_,_,this.projectionMatrix),Fs(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=_g([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=SP(this.viewMatrixInverse);const y=mo(),b=mo();_p(y,y,[this.width/2,-this.height/2,1]),cu(y,y,[1,-1,0]),Fs(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=_g(mo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||De.warn("Pixel project matrix not invertible")()}}la.displayName="Viewport";class ls extends la{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:a=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:d,farZ:g,orthographic:_=!1,projectionMatrix:y,repeat:b=!1,worldOffset:x=0,position:E,padding:M,legacyMeterSizes:N=!1}=e;let{width:V,height:P,altitude:H=1.5}=e;const X=Math.pow(2,s);V=V||1,P=P||1;let Z,he=null;if(y)H=y[5]/2,Z=Bo(H);else{e.fovy?(Z=e.fovy,H=vp(Z)):Z=Bo(H);let J;if(M){const{top:oe=0,bottom:de=0}=M;J=[0,es((oe+P-de)/2,0,P)-P/2]}he=WI({width:V,height:P,scale:X,center:E&&[0,0,E[2]*Pd(t)],offset:J,pitch:a,fovy:Z,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(d)&&(he.near=d),Number.isFinite(g)&&(he.far=g)}let ue=HI({height:P,pitch:a,bearing:l,scale:X,altitude:H});x&&(ue=new $t().translate([512*x,0,0]).multiplyLeft(ue)),super({...e,width:V,height:P,viewMatrix:ue,longitude:i,latitude:t,zoom:s,...he,fovy:Z,focalDistance:H}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=a,this.bearing=l,this.altitude=H,this.fovy=Z,this.orthographic=_,this._subViewports=b?[]:null,this._pseudoMeters=N,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const a=s?new ls({...this,worldOffset:s}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*Pd(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/Pd(i);return[t,i,s]}addMetersToLngLat(e,t){return _3(e,t)}panByPosition(e,t){const i=Tp(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),a=wb([],s,XC([],i)),l=wb([],this.center,a),[c,f]=this.unprojectFlat(l);return{longitude:c,latitude:f}}getBounds(e={}){const t=XI(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:a,latitude:l,zoom:c}=jI({width:i,height:s,bounds:e,...t});return new ls({width:i,height:s,longitude:a,latitude:l,zoom:c})}}ls.displayName="WebMercatorViewport";const lv=[0,0,0];function Dd(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof ls){const[s,a,l=0]=n,c=e.getDistanceScales([s,a]);i[2]=l*c.unitsPerMeter[2]}return i}function PP(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:a,fromCoordinateOrigin:l}=n;return s===Le.DEFAULT&&(s=e.isGeospatial?Le.LNGLAT:Le.CARTESIAN),a===void 0&&(a=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:a,fromCoordinateOrigin:l}}function T3(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}){let[l,c,f=0]=n;switch(t&&([l,c,f]=ra([],[l,c,f,1],t)),i){case Le.LNGLAT:return Dd([l,c,f],e,a);case Le.LNGLAT_OFFSETS:return Dd([l+s[0],c+s[1],f+(s[2]||0)],e,a);case Le.METER_OFFSETS:return Dd(_3(s,[l,c,f]),e,a);case Le.CARTESIAN:default:return e.isGeospatial?[l+s[0],c+s[1],f+s[2]]:e.projectPosition([l,c,f])}}function NP(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:a,fromCoordinateSystem:l,fromCoordinateOrigin:c}=PP(e),{autoOffset:f=!0}=e,{geospatialOrigin:d=lv,shaderCoordinateOrigin:g=lv,offsetMode:_=!1}=f?g3(t,i,s):{},y=T3(n,{viewport:t,modelMatrix:a,coordinateSystem:l,coordinateOrigin:c,offsetMode:_});if(_){const b=t.projectPosition(d||g);YT(y,y,b)}return y}let DP=1,kP=1;class x3{constructor(){T(this,"time",0);T(this,"channels",new Map);T(this,"animations",new Map);T(this,"playing",!1);T(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:a=1}=e,l=DP++,c={time:0,delay:t,duration:i,rate:s,repeat:a};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:a,channel:l}=s;a.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=kP++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function BP(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function UP(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let LP=0;const FP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:rg.stats.get(`animation-loop-${LP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class zP{constructor(e){T(this,"device",null);T(this,"canvas",null);T(this,"props");T(this,"animationProps",null);T(this,"timeline",null);T(this,"stats");T(this,"cpuTime");T(this,"gpuTime");T(this,"frameRate");T(this,"display");T(this,"needsRedraw","initialized");T(this,"_initialized",!1);T(this,"_running",!1);T(this,"_animationFrameId",null);T(this,"_nextFramePromise",null);T(this,"_resolveNextFrame",null);T(this,"_cpuStartTime",0);T(this,"_error",null);if(this.props={...FP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Ho({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var i,s;if(this.props.onError(e),this._error=Error(),((s=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const a=document.createElement("h1");a.innerHTML=e.message,a.style.position="absolute",a.style.top="20%",a.style.left="10px",a.style.color="black",a.style.backgroundColor="red",document.body.appendChild(a)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=BP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(UP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,i;const e=(i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){var a,l,c,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.getPixelSize())||[1,1];let i=1;const s=(f=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:f.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const kd={};function Uu(n="id"){kd[n]=kd[n]||1;const e=kd[n]++;return`${n}-${e}`}class cv{constructor(e){T(this,"id");T(this,"userData",{});T(this,"topology");T(this,"bufferLayout",[]);T(this,"vertexCount");T(this,"indices");T(this,"attributes");if(this.id=e.id||Uu("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Je.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function VP(n,e){if(e instanceof cv)return e;const t=HP(n,e),{attributes:i,bufferLayout:s}=WP(n,e);return new cv({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function HP(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Je.INDEX,data:t})}function WP(n,e){const t=[],i={};for(const[a,l]of Object.entries(e.attributes)){let c=a;switch(a){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){i[c]=n.createBuffer({data:l.value,id:`${a}-buffer`});const{value:f,size:d,normalized:g}=l;t.push({name:c,format:lC(f,d,g)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}const Iu=class Iu{constructor(e){T(this,"device");T(this,"destroyPolicy");T(this,"_hashCounter",0);T(this,"_hashes",{});T(this,"_renderPipelineCache",{});T(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Iu(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Qr.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...nu.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof nu?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",a=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${s}BL${a}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${s}T${e.topology}P${l}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};T(Iu,"defaultProps",{...Qr.defaultProps});let Rg=Iu;const Pu=class Pu{constructor(e){T(this,"device");T(this,"destroyPolicy");T(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Pu(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};T(Pu,"defaultProps",{...Jc.defaultProps});let Cg=Pu;function jP(n,e){var s;const t={},i="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const a of n.attributes)if(a){const l=`${a.location} ${a.name}: ${a.type}`;t[`in ${l}`]={[i]:a.stepMode||"vertex"}}for(const a of n.varyings||[]){const l=`${a.location} ${a.name}`;t[`out ${l}`]={[i]:JSON.stringify(a)}}return t}let wt=null,Ps=null;function $P(n,{id:e,minimap:t,opaque:i,top:s="0",left:a="0",rgbaScale:l=1}){wt||(wt=document.createElement("canvas"),wt.id=e,wt.title=e,wt.style.zIndex="100",wt.style.position="absolute",wt.style.top=s,wt.style.left=a,wt.style.border="blue 5px solid",wt.style.transform="scaleY(-1)",document.body.appendChild(wt),Ps=wt.getContext("2d")),(wt.width!==n.width||wt.height!==n.height)&&(wt.width=n.width/2,wt.height=n.height/2,wt.style.width="400px",wt.style.height="400px");const c=n.device.readPixelsToArrayWebGL(n),f=Ps==null?void 0:Ps.createImageData(n.width,n.height);if(f){for(let g=0;g<c.length;g+=4)f.data[0+g+0]=c[g+0]*l,f.data[0+g+1]=c[g+1]*l,f.data[0+g+2]=c[g+2]*l,f.data[0+g+3]=i?255:c[g+3]*l;Ps==null||Ps.putImageData(f,0,0)}}function Mg(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Mg(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!Mg(n[a],e[a],t-1))return!1;return!0}return!1}function XP(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function YP(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function A3(n){return XP(n)||YP(n)}function qP(n){return A3(n)||typeof n=="number"||typeof n=="boolean"}function S3(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];qP(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class KP{constructor(e,t){T(this,"options",{disableWarnings:!1});T(this,"modules");T(this,"moduleUniforms");T(this,"moduleBindings");Object.assign(this.options,t);const i=ip(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;ae.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,a]of Object.entries(e))this._addModule(a),a.name&&s!==a.name&&!this.options.disableWarnings&&ae.warn(`Module name: ${s} vs ${a.name}`)()}destroy(){}setProps(e){var t;for(const i of Object.keys(e)){const s=i,a=e[s]||{},l=this.modules[s];if(!l){this.options.disableWarnings||ae.warn(`Module ${i} not found`)();continue}const c=this.moduleUniforms[s],f=this.moduleBindings[s],d=((t=l.getUniforms)==null?void 0:t.call(l,a,c))||a,{uniforms:g,bindings:_}=S3(d);this.moduleUniforms[s]={...c,...g},this.moduleBindings[s]={...f,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[i,s]of Object.entries(this.moduleUniforms))for(const[a,l]of Object.entries(s))e[`${i}.${a}`]={type:(t=this.modules[i].uniformTypes)==null?void 0:t[a],value:String(l)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let ZP="";async function QP(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:ZP+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Bd{constructor(e,t){T(this,"device");T(this,"id");T(this,"texture");T(this,"sampler");T(this,"view");T(this,"ready");T(this,"isReady",!1);T(this,"destroyed",!1);T(this,"resolveReady",()=>{});T(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Uu("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:QP(t.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,i;const s=e.data,a=await w3(s).then(t,i);if(this.destroyed)return;const l={...e,data:a};this.texture=this.device.createTexture(l),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function w3(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(w3));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let a=0;a<i.length;a++)s[i[a]]=t[a];return s}return n}const Ns=2,GP=1e4,Nu=class Nu{constructor(e,t){T(this,"device");T(this,"id");T(this,"source");T(this,"vs");T(this,"fs");T(this,"pipelineFactory");T(this,"shaderFactory");T(this,"userData",{});T(this,"parameters");T(this,"topology");T(this,"bufferLayout");T(this,"isInstanced");T(this,"instanceCount",0);T(this,"vertexCount");T(this,"indexBuffer",null);T(this,"bufferAttributes",{});T(this,"constantAttributes",{});T(this,"bindings",{});T(this,"uniforms",{});T(this,"vertexArray");T(this,"transformFeedback",null);T(this,"pipeline");T(this,"shaderInputs");T(this,"_uniformStore");T(this,"_attributeInfos",{});T(this,"_gpuGeometry",null);T(this,"_getModuleUniforms");T(this,"props");T(this,"_pipelineNeedsUpdate","newly created");T(this,"_needsRedraw","initializing");T(this,"_destroyed",!1);T(this,"_lastDrawTimestamp",-1);T(this,"_lastLogTime",0);T(this,"_logOpen",!1);T(this,"_drawCount",0);var f,d,g,_;this.props={...Nu.defaultProps,...t},t=this.props,this.id=t.id||Uu("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(y=>[y.name,y]))||[]),s=t.shaderInputs||new KP(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const a=e4(e),l=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(g=this.shaderInputs)==null?void 0:g.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:y,getUniforms:b}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:l});this.source=y,this._getModuleUniforms=b,(_=this.props).shaderLayout||(_.shaderLayout=UC(this.source))}else{const{vs:y,fs:b,getUniforms:x}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:l});this.vs=y,this.fs=b,this._getModuleUniforms=x}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Rg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Cg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ae.info(Ns,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Og(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:a}=this.vertexArray,l=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const t=e&&VP(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new Td(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Td(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Mg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new oC(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(JP(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ae.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const s=new Td(this.bufferLayout);for(const[a,l]of Object.entries(e)){const c=s.getBufferLayout(a);if(!c){i||ae.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const f=s.getAttributeNamesForBuffer(c);let d=!1;for(const g of f){const _=this._attributeInfos[g];_&&(this.vertexArray.setBuffer(_.location,l),d=!0)}!d&&!i&&ae.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ae.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Og(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=S3(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Bd&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Bd?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Gc?e=Math.max(e,t.texture.updateTimestamp):t instanceof Je||t instanceof lt?e=Math.max(e,t.updateTimestamp):t instanceof Bd?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof eu||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ae.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=gT(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ae.level>3?0:GP;ae.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ae.group(Ns,`>>> DRAWING MODEL ${this.id}`,{collapsed:ae.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=jP(this.pipeline.shaderLayout,this.id);ae.table(Ns,e)();const t=this.shaderInputs.getDebugTable();for(const[s,a]of Object.entries(this.uniforms))t[s]={value:a};ae.table(Ns,t)();const i=this._getAttributeDebugTable();ae.table(Ns,this._attributeInfos)(),ae.table(Ns,i)(),ae.groupEnd(Ns)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&$P(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=mT(t);return(e instanceof Je?new i(e.debugData):e).toString()}};T(Nu,"defaultProps",{...Qr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Qc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let vn=Nu;function JP(n){return!!(n.uniformTypes&&!Og(n.uniformTypes))}function e4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Og(n){for(const e in n)return!1;return!0}const Po=class Po{constructor(e,t=Po.defaultProps){T(this,"device");T(this,"model");T(this,"transformFeedback");if(!Po.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new vn(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||uR(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Je)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:a=i.byteLength}=t;return i.readAsync(s,a)}};T(Po,"defaultProps",{...vn.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Uo=Po;class na{constructor(e){T(this,"id");T(this,"topology");T(this,"vertexCount");T(this,"indices");T(this,"attributes");T(this,"userData",{});const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||Uu("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,l]of Object.entries(t)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!c.size&&(c.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[a]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:a,size:l,constant:c}=s;!c&&a&&l!==void 0&&l>=1&&(i=Math.min(i,a.length/l))}return i}}const t4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class E3 extends xp{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,pickingFBO:l,deviceRect:{x:c,y:f,width:d,height:g},cullRect:_,effects:y,pass:b="picking",pickZ:x,shaderModuleProps:E}){this.pickZ=x;const M=this._resetColorEncoder(x),N=[c,f,d,g],V=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,cullRect:_,effects:y==null?void 0:y.filter(H=>H.useInPicking),pass:b,isPicking:!0,shaderModuleProps:E,clearColor:[0,0,0,0],colorMask:15,scissorRect:N});return this._colorEncoderState=null,{decodePickingColor:M&&i4.bind(null,M),stats:V}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:a,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:a&&l.includes("draw")&&(Object.assign(s,t4),s.blend=!0,s.blendColor=n4(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function n4(n,e,t){const{byLayer:i,byAlpha:s}=n;let a,l=i.get(e);return l?(l.viewports.push(t),a=l.a):(a=i.size+1,a<=255?(l={a,layer:e,viewports:[t]},i.set(e,l),s[a]=l):(De.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function i4(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Lr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},hu=Symbol.for("component"),rs=Symbol.for("propTypes"),Ud=Symbol.for("deprecatedProps"),Kr=Symbol.for("asyncPropDefaults"),Xs=Symbol.for("asyncPropOriginal"),ts=Symbol.for("asyncPropResolved");function Lu(n,e=()=>!0){return Array.isArray(n)?R3(n,e,[]):e(n)?[n]:[]}function R3(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?R3(s,e,t):e(s)&&t.push(s)}return t}function s4({target:n,source:e,start:t=0,count:i=1}){const s=e.length,a=i*s;let l=0;for(let c=t;l<s;l++)n[c++]=e[l];for(;l<a;)l<a-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+a-l),l=a);return n}class r4{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=qc(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class a4{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let a=this._resources[e];a?a.setData(t,i):(a=new r4(e,t,this._context),this._resources[e]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:a,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=a[e];if(this._track(i,s,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const a=this._consumers,l=a[e]=a[e]||{};let c=l[t];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),i&&(c?(c.onChange=s,c.resourceId=i.id):c={onChange:s,resourceId:i.id},l[t]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const o4="layerManager.setLayers",l4="layerManager.activateViewport";class c4{constructor(e,t){var c;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{zt(l4,this,f),f&&(this.context.viewport=f)};const{deck:i,stats:s,viewport:a,timeline:l}=t||{};this.layers=[],this.resourceManager=new a4({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:cP(((c=e==null?void 0:e.info)==null?void 0:c.shadingLanguage)||"glsl"),defaultShaderModules:[EO],renderPass:void 0,stats:s||new Ho({id:"deck.gl"}),viewport:a||new la({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new x3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){zt(o4,this,t,e),this._lastRenderedLayers=e;const i=Lu(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?De.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let a=!1;for(const l of s)if(l.hasUniformTransition()){a=`Uniform transition in ${l}`;break}this._needsUpdate=a,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const a=t[s.id];a===null&&De.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&a!==s&&s.validateProps(),a?(this._transferLayerState(a,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(c){this._handleError("matching",c,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Lr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Lr.MATCHED,t!==e&&(e.lifecycle=Lr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Lr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Lr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Dn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Dn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!Dn(n[a],e[a],t-1))return!1;return!0}return!1}class u4{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.containsPixel(s)){const c=e.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Lu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Dn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):De.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var l;return(l=this.getView(e.id))==null?void 0:l.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,t,i,s){const a=e.controller;if(a&&i){const l={...t,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==a.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const a=e[s],l=this.getViewState(a),c=a.makeViewport({viewState:l,width:this.width,height:this.height});let f=t[a.id];const d=!!a.controller;d&&!f&&(i=!0),(i||!d)&&f&&(f.finalize(),f=null),this.controllers[a.id]=this._updateController(a,l,c,f),c&&this._viewports.unshift(c)}for(const s in t){const a=t[s];a&&!this.controllers[s]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const f4=/([0-9]+\.?[0-9]*)(%|px)/;function $i(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=f4.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Xi(n,e){return n.relative?Math.round(n.position*e):n.position}class ia{constructor(e){const{id:t,x:i=0,y:s=0,width:a="100%",height:l="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=$i(i),this._y=$i(s),this._width=$i(a),this._height=$i(l),this._padding=c&&{left:$i(c.left||0),right:$i(c.right||0),top:$i(c.top||0),bottom:$i(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Dn(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Xi(this._x,e),y:Xi(this._y,t),width:Xi(this._width,e),height:Xi(this._height,t)};return this._padding&&(i.padding={left:Xi(this._padding.left,e),top:Xi(this._padding.top,t),right:Xi(this._padding.right,e),bottom:Xi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Fu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(t=this.settings).onStart)==null||i.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const uv=()=>{},Ig={BREAK:1,SNAP_TO_END:2,IGNORE:3},h4=n=>n,d4=Ig.BREAK;class g4{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:a,endProps:l,duration:c,easing:f}}=t,d=f(i/c),g=s.interpolateProps(a,l,d);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Fu(e.timeline),this.onViewStateChange=e.onViewStateChange||uv,this.onStateChange=e.onStateChange||uv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:a,endProps:l}=this.transition.settings;s={...i,...a===Ig.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Ig.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),a=t.transitionInterpolator,l=a.getDuration?a.getDuration(e,t):t.transitionDuration;if(l===0)return;const c=a.initializeProps(e,s);this.propsInTransition={};const f={duration:l,easing:t.transitionEasing||h4,interpolator:a,interruption:t.transitionInterruption||d4,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function It(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class p4{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!bi(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const a of this._propsToExtract)(a in e||a in t)&&(i[a]=e[a],s[a]=t[a]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];It(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const _4=["longitude","latitude","zoom","bearing","pitch"],m4=["longitude","latitude","zoom"];class C3 extends p4{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:_4,required:m4},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:a}=this.opts;if(s&&a){const l=s(e),c=s(t),f=l.unproject(a);i.start.around=a,Object.assign(i.end,{around:c.project(f),aroundPosition:f,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const a of this._propsToExtract)s[a]=Ls(e[a]||0,t[a]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...t,...s});Object.assign(s,a.panByPosition(t.aroundPosition,Ls(e.around,t.around,i)))}return s}}const Yi={transitionDuration:0},y4=300,mc=n=>1-(1-n)*(1-n),Ur={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ds={};class b4{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new g4({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return a&&t&&t.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?y4:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:a=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:d=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(Ur.WHEEL,g&&i),this.toggleEvents(Ur.PAN,g),this.toggleEvents(Ur.PINCH,g&&(c||f)),this.toggleEvents(Ur.MULTI_PAN,g&&f),this.toggleEvents(Ur.DOUBLE_CLICK,g&&l),this.toggleEvents(Ur.KEYBOARD,g&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=a,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Yi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:mc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:mc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let l=2/(1+Math.exp(-Math.abs(a*i)));a<0&&l!==0&&(l=1/l);const c=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Yi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],a=this.controllerState.rotate({pos:s});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:mc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Ds._startPinchRotation=e.rotation,Ds._lastPinchEvent=e,this.updateViewport(i,Yi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Ds._startPinchRotation-i})}return this.updateViewport(t,Yi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ds._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Ds;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let a=this.controllerState.rotateEnd();const l=Math.log2(e.scale),c=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,l+c*t/2);a=a.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:mc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ds._startPinchRotation=null,Ds._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:a,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const d={};switch(e.srcEvent.code){case"Minus":f=t?c.zoomOut(i).zoomOut(i):c.zoomOut(i),d.isZooming=!0;break;case"Equal":f=t?c.zoomIn(i).zoomIn(i):c.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(f=c.rotateLeft(a),d.isRotating=!0):(f=c.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(f=c.rotateRight(a),d.isRotating=!0):(f=c.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(f=c.rotateUp(l),d.isRotating=!0):(f=c.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(f=c.rotateDown(l),d.isRotating=!0):(f=c.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Yi:e?{...t,transitionInterpolator:new C3({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class v4{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const fv=5,T4=1.2;class x4 extends v4{constructor(e){const{width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:c=0,pitch:f=0,altitude:d=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:b=60,minPitch:x=0,startPanLngLat:E,startZoomLngLat:M,startRotatePos:N,startBearing:V,startPitch:P,startZoom:H,normalize:X=!0}=e;It(Number.isFinite(a)),It(Number.isFinite(s)),It(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:c,pitch:f,altitude:d,maxZoom:_,minZoom:y,maxPitch:b,minPitch:x,normalize:X,position:g},{startPanLngLat:E,startZoomLngLat:M,startRotatePos:N,startBearing:V,startPitch:P,startZoom:H}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:a,startPitch:l}=this.getState();if(!s||a===void 0||l===void 0)return this;let c;return e?c=this._getNewRotation(e,s,l,a):c={bearing:a+t,pitch:l+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(t)||this._unproject(e)),!a)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let f=s+Math.log2(i);f=es(f,c,l);const d=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...d.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:a}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(a-t.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=es(s,i,t);const{maxPitch:a,minPitch:l,pitch:c}=e;e.pitch=es(c,l,a);const{normalize:f=!0}=e;return f&&Object.assign(e,YI(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const a=e[0]-t[0],l=e[1]-t[1],c=e[1],f=t[1],{width:d,height:g}=this.getViewportProps(),_=a/d;let y=0;l>0?Math.abs(g-f)>fv&&(y=l/(f-g)*T4):l<0&&f>fv&&(y=1-c/f),y=es(y,-1,1);const{minPitch:b,maxPitch:x}=this.getViewportProps(),E=s+180*_;let M=i;return y>0?M=i+y*(x-i):y<0&&(M=i-y*(b-i)),{pitch:M,bearing:E}}}class A4 extends b4{constructor(){super(...arguments),this.ControllerState=x4,this.transition={transitionDuration:300,transitionInterpolator:new C3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Ap extends ia{constructor(e={}){super(e)}getViewportType(){return ls}get ControllerType(){return A4}}Ap.displayName="MapView";const S4=new v3;function w4(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class E4{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>w4(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Dn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const a=t[s.id];let l=s;a&&a!==s?a.setProps?(a.setProps(s.props),l=a):a.cleanup(this._context):a||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof v3)||this._resolvedEffects.push(S4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class R4 extends xp{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const C4="deckRenderer.renderLayers";class M4{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new R4(e),this.pickLayersPass=new E3(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=t.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,zt(C4,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const a of e)if(a.postRender){s.target=a.id===this.lastPostProcessEffect?t.target:void 0;const l=a.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const O4={pickedColor:null,pickedObjectIndex:-1};function I4({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:a}){const{x:l,y:c,width:f,height:d}=a;let g=s*s,_=-1,y=0;for(let b=0;b<d;b++){const x=b+c-i,E=x*x;if(E>g)y+=4*f;else for(let M=0;M<f;M++){if(n[y+3]-1>=0){const V=M+l-t,P=V*V+E;P<=g&&(g=P,_=y)}y+=4}}if(_>=0){const b=n.slice(_,_+4),x=e(b);if(x){const E=Math.floor(_/4/f),M=_/4-E*f;return{...x,pickedColor:b,pickedX:l+M,pickedY:c+E}}De.error("Picked non-existent layer. Is picking buffer corrupt?")()}return O4}function P4({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const a=n.slice(i,i+4),l=a.join(",");if(!t.has(l)){const c=e(a);c?t.set(l,{...c,color:a}):De.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function M3({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:a}){let l=e[0];e.length>1&&(l=D4((n==null?void 0:n.pickedViewports)||e,{x:i,y:s}));let c;if(l){const f=[i-l.x,s-l.y];a!==void 0&&(f[2]=a),c=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:c,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function N4(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:a,pickedLayer:l,pickedObjectIndex:c}=e,f=l?[l]:[];if(i==="hover"){const _=t.index,y=t.layerId,b=l?l.props.id:null;if(b!==y||c!==_){if(b!==y){const x=s.find(E=>E.props.id===y);x&&f.unshift(x)}t.layerId=b,t.index=c,t.info=null}}const d=M3(n),g=new Map;return g.set(null,d),f.forEach(_=>{let y={...d};_===l&&(y.color=a,y.index=c,y.picked=!0),y=O3({layer:_,info:y,mode:i});const b=y.layer;_===l&&i==="hover"&&(t.info=y),g.set(b.id,y),i==="hover"&&b.updateAutoHighlight(y)}),g}function O3({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function D4(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class k4{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new E3(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},a=this.lastPickedInfo.info){const l=a&&a.layer&&a.layer.id,c=a&&a.viewport&&a.viewport.id,f=l?i.find(y=>y.id===l):null,d=c&&s.find(y=>y.id===c)||s[0],g=d&&d.unproject([e-d.x,t-d.y]);return{...a,...{x:e,y:t,viewport:d,coordinate:g,layer:f}}}_resizeBuffer(){var t,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(i=this.depthFBO)==null||i.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:a,radius:l=0,depth:c=1,mode:f="query",unproject3D:d,onViewportActive:g,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||i.length===0)return{result:[],emptyInfo:M3({viewports:i,x:s,y:a,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,a],!0),E=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],M=Math.round(l*y),{width:N,height:V}=this.pickingFBO,P=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:M,deviceWidth:N,deviceHeight:V}),H={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let X;const Z=[],he=new Set;for(let ue=0;ue<c;ue++){let J;if(P){const de=this._drawAndSample({layers:b,views:t,viewports:i,onViewportActive:g,deviceRect:P,cullRect:H,effects:_,pass:`picking:${f}`});J=I4({...de,deviceX:E[0],deviceY:E[1],deviceRadius:M,deviceRect:P})}else J={pickedColor:null,pickedObjectIndex:-1};let oe;if(J.pickedLayer&&d&&this.depthFBO){const{pickedColors:de}=this._drawAndSample({layers:[J.pickedLayer],views:t,viewports:i,onViewportActive:g,deviceRect:{x:J.pickedX,y:J.pickedY,width:1,height:1},cullRect:H,effects:_,pass:`picking:${f}:z`},!0);de[3]&&(oe=de[0])}J.pickedLayer&&ue+1<c&&(he.add(J.pickedLayer),J.pickedLayer.disablePickingIndex(J.pickedObjectIndex)),X=N4({pickInfo:J,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:a,z:oe,pixelRatio:y});for(const de of X.values())de.layer&&Z.push(de);if(!J.pickedColor)break}for(const ue of he)ue.restorePickingColors();return{result:Z,emptyInfo:X.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:a,width:l=1,height:c=1,mode:f="query",maxObjects:d=null,onViewportActive:g,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,a],!0),E=x.x,M=x.y+x.height,N=this.device.canvasContext.cssToDevicePixels([s+l,a+c],!0),V=N.x+N.width,P=N.y,H={x:E,y:P,width:V-E,height:M-P},X=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:g,deviceRect:H,cullRect:{x:s,y:a,width:l,height:c},effects:_,pass:`picking:${f}`}),Z=P4(X),he=new Map,ue=[],J=Number.isFinite(d);for(let oe=0;oe<Z.length&&!(J&&ue.length>=d);oe++){const de=Z[oe];let ve={color:de.pickedColor,layer:null,index:de.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:b};ve=O3({layer:de.pickedLayer,info:ve,mode:f});const be=ve.layer.id;he.has(be)||he.set(be,new Set);const Se=he.get(be),We=ve.object??ve.index;Se.has(We)||(Se.add(We),ue.push(ve))}return ue}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:a,cullRect:l,effects:c,pass:f},d=!1){const g=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:g,deviceRect:a,cullRect:l,effects:c,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const V of c)V.useInPicking&&(_.preRenderStats[V.id]=V.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:b,y:x,width:E,height:M}=a,N=new(d?Float32Array:Uint8Array)(E*M*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:b,sourceY:x,sourceWidth:E,sourceHeight:M,target:N}),{pickedColors:N,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:a}){const l=Math.max(0,e-i),c=Math.max(0,t-i),f=Math.min(s,e+i+1)-l,d=Math.min(a,t+i+1)-c;return f<=0||d<=0?null:{x:l,y:c,width:f,height:d}}}const B4={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},U4="top-left",hv="__root";class L4{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Dn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=U4}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,i).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var l;const i=e||hv;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(l=this.parentElement)==null||l.append(s),this.containers[i]=s);let a=s.querySelector(`.${t}`);return a||(a=document.createElement("div"),a.className=t,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,B4[t]),s.append(a)),a}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,a=i===hv||s,l=this.containers[i];a?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,a;const i=e.reduce((l,c)=>(l[c.id]=c,l),{});for(const l of this.getWidgets()){const{viewId:c}=l;if(c){const f=i[c];f&&(l.onViewportChange&&l.onViewportChange(f),(s=l.onRedraw)==null||s.call(l,{viewports:[f],layers:t}))}else{if(l.onViewportChange)for(const f of e)l.onViewportChange(f);(a=l.onRedraw)==null||a.call(l,{viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){var i,s;for(const a of this.getWidgets()){const{viewId:l}=a;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=a.onHover)==null||s.call(a,e,t))}}onEvent(e,t){var s,a;const i=xg[t.type];if(i)for(const l of this.getWidgets()){const{viewId:c}=l;(!c||c===((s=e.viewport)==null?void 0:s.id))&&((a=l[i])==null||a.call(l,e,t))}}}const F4={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class z4{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,F4),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var zr;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(zr||(zr={}));const Sp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},gt=(n,e,t)=>e?n.enable(t):n.disable(t),dv=(n,e,t)=>n.hint(t,e),sn=(n,e,t)=>n.pixelStorei(t,e),gv=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},uo=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function Ld(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const V4={3042:gt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:gt,2885:(n,e)=>n.cullFace(e),2929:gt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:gt,35723:dv,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:gv,36010:gv,34964:uo,36662:uo,36663:uo,35053:uo,35055:uo,2886:(n,e)=>n.frontFace(e),33170:dv,2849:(n,e)=>n.lineWidth(e),32823:gt,32824:"polygonOffset",10752:"polygonOffset",35977:gt,32926:gt,32928:gt,32938:"sampleCoverage",32939:"sampleCoverage",3089:gt,3088:(n,e)=>n.scissor(...e),2960:gt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:gt,10754:gt,12288:gt,12289:gt,12290:gt,12291:gt,12292:gt,12293:gt,12294:gt,12295:gt,3333:sn,3317:sn,37440:sn,37441:sn,37443:sn,3330:sn,3332:sn,3331:sn,3314:sn,32878:sn,3316:sn,3315:sn,32877:sn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Ld(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Ld(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,c]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,a,l,c)},stencilOp:(n,e)=>{e=Ld(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,c]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,a,l,c)},viewport:(n,e)=>n.viewport(...e)};function ot(n,e,t){return e[n]!==void 0?e[n]:t[n]}const H4={blendEquation:(n,e,t)=>n.blendEquationSeparate(ot(32777,e,t),ot(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ot(32969,e,t),ot(32968,e,t),ot(32971,e,t),ot(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ot(32824,e,t),ot(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ot(32938,e,t),ot(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ot(2962,e,t),ot(2967,e,t),ot(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ot(34816,e,t),ot(36003,e,t),ot(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ot(2964,e,t),ot(2965,e,t),ot(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ot(34817,e,t),ot(34818,e,t),ot(34819,e,t))},pv={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},jn=(n,e)=>n.isEnabled(e),_v={3042:jn,2884:jn,2929:jn,3024:jn,32823:jn,32926:jn,32928:jn,3089:jn,2960:jn,35977:jn},W4=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ca(n,e){if($4(e))return;const t={};for(const s in e){const a=Number(s),l=V4[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],a))}const i=n.state&&n.state.cache;if(i)for(const s in t){const a=H4[s];a(n,e,i)}}function I3(n,e=Sp){if(typeof e=="number"){const s=e,a=_v[s];return a?a(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const a=_v[s];i[s]=a?a(n,Number(s)):n.getParameter(Number(s))}return i}function j4(n){ca(n,Sp)}function $4(n){for(const e in n)return!1;return!0}function X4(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class zs{constructor(e,t){T(this,"gl");T(this,"program",null);T(this,"stateStack",[]);T(this,"enable",!0);T(this,"cache",null);T(this,"log");T(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ca(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?I3(e):Object.assign({},Sp),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,q4(e);for(const i in pv){const s=pv[i];Y4(e,i,s)}mv(e,"getParameter"),mv(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const l=e[a],c=this.cache[a];X4(l,c)||(t=!0,i=c,s&&!(a in s)&&(s[a]=c),this.cache[a]=l)}return{valueChanged:t,oldValue:i}}}function mv(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||W4.has(s))return t(s);const a=zs.get(n);return s in a.cache||(a.cache[s]=t(s)),a.enable?a.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Y4(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...a){const l=zs.get(n),{valueChanged:c,oldValue:f}=t(l._updateCache,...a);return c&&i(...a),f},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function q4(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=zs.get(n);s.program!==i&&(e(i),s.program=i)}}function K4(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let a=null;if(a||(a=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!a&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,a=n.getContext("webgl2",s),a.luma||(a.luma={}),a.luma.softwareRenderer=!0),a||(a=n.getContext("webgl",{}),a&&(a=null,i||(i="Your browser only supports WebGL1"))),!a)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:c}=e;return n.addEventListener("webglcontextlost",f=>l(f),!1),n.addEventListener("webglcontextrestored",f=>c(f),!1),a.luma||(a.luma={}),a}function sa(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function Z4(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);sa(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,a=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),c=a||t,f=l||i,d=n.getParameter(7938),g=P3(c,f),_=Q4(c,f),y=G4(c,f);return{type:"webgl",gpu:g,gpuType:y,gpuBackend:_,vendor:c,renderer:f,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function P3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function Q4(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function G4(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(P3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function N3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const yo="WEBGL_compressed_texture_s3tc",bo="WEBGL_compressed_texture_s3tc_srgb",Vr="EXT_texture_compression_rgtc",Hr="EXT_texture_compression_bptc",J4="WEBGL_compressed_texture_etc",eN="WEBGL_compressed_texture_astc",tN="WEBGL_compressed_texture_etc1",nN="WEBGL_compressed_texture_pvrtc",iN="WEBGL_compressed_texture_atc",yv="EXT_texture_norm16",bv="EXT_render_snorm",sN="EXT_color_buffer_float",wp={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[bv],"norm16-renderable-webgl":[yv],"snorm16-renderable-webgl":[yv,bv],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[yo,bo,Vr,Hr],"texture-compression-bc5-webgl":[Vr],"texture-compression-bc7-webgl":[Hr],"texture-compression-etc2":[J4],"texture-compression-astc":[eN],"texture-compression-etc1-webgl":[tN],"texture-compression-pvrtc-webgl":[nN],"texture-compression-atc-webgl":[iN]};function rN(n){return n in wp}function aN(n,e,t){return(wp[e]||[]).every(s=>sa(n,s,t))}const Ep={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:sN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:yo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:bo},"bc1-rgba-unorm":{gl:33777,x:yo},"bc1-rgba-unorm-srgb":{gl:35916,x:bo},"bc2-rgba-unorm":{gl:33778,x:yo},"bc2-rgba-unorm-srgb":{gl:35918,x:bo},"bc3-rgba-unorm":{gl:33779,x:yo},"bc3-rgba-unorm-srgb":{gl:35919,x:bo},"bc4-r-unorm":{gl:36283,x:Vr},"bc4-r-snorm":{gl:36284,x:Vr},"bc5-rg-unorm":{gl:36285,x:Vr},"bc5-rg-snorm":{gl:36286,x:Vr},"bc6h-rgb-ufloat":{gl:36495,x:Hr},"bc6h-rgb-float":{gl:36494,x:Hr},"bc7-rgba-unorm":{gl:36492,x:Hr},"bc7-rgba-unorm-srgb":{gl:36493,x:Hr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function oN(n,e,t){let i=e.create;const s=Ep[e.format];return(s==null?void 0:s.gl)===void 0&&(i=!1),s!=null&&s.x&&(i=i&&!!sa(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function D3(n){var s;const e=Ep[n],t=uN(n),i=sp(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||cN(i.channels,i.integer,i.normalized,t),type:i.dataType?N3(i.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:i.compressed||!1}}function lN(n){switch(sp(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function cN(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function uN(n){const e=Ep[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const vv={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class fN extends ER{constructor(t,i,s){super([],s);T(this,"gl");T(this,"extensions");T(this,"testedFeatures",new Set);this.gl=t,this.extensions=i,sa(t,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const t=this.getFeatures();for(const i of t)this.has(i)&&(yield i);return[]}has(t){var i;return(i=this.disabledFeatures)!=null&&i[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),rN(t)&&aN(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of t)this.has(i)}getFeatures(){return[...Object.keys(vv),...Object.keys(wp)]}getWebGLFeature(t){const i=vv[t];return typeof i=="string"?!!sa(this.gl,i,this.extensions):!!i}}class hN extends wR{constructor(t){super();T(this,"gl");T(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Co extends tu{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"colorAttachments",[]);T(this,"depthStencilAttachment",null);const s=i.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const s=this.colorAttachments[i];if(s){const a=36064+i;this._attachTextureView(a,s)}}if(this.depthStencilAttachment){const i=lN(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${gN(i)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,i){const{gl:s}=this.device,{texture:a}=i,l=i.props.baseMipLevel,c=i.props.baseArrayLayer;switch(s.bindTexture(a.glTarget,a.handle),a.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,a.handle,l,c);break;case 34067:const f=dN(c);s.framebufferTexture2D(36160,t,f,a.handle,l);break;case 3553:s.framebufferTexture2D(36160,t,3553,a.handle,l);break;default:throw new Error("Illegal texture type")}s.bindTexture(a.glTarget,null)}}function dN(n){return n<34069?n+34069:n}function gN(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class pN extends ag{constructor(t,i){super(i);T(this,"device");T(this,"format","rgba8unorm");T(this,"depthStencilFormat","depth24plus");T(this,"presentationSize");T(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Co(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(i,t);return}}commit(){}}async function k3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,a)=>{i.onload=s,i.onerror=l=>a(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const _N=1;let Ke=null,Tv=!1;const Rp={debugSpectorJS:ae.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function mN(n){if(!globalThis.SPECTOR)try{await k3(n.debugSpectorJSUrl||Rp.debugSpectorJSUrl)}catch(e){ae.warn(String(e))}}function yN(n){var e;if(n={...Rp,...n},!n.debugSpectorJS)return null;if(!Ke&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ae.probe(_N,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Ke=new t,globalThis.luma&&(globalThis.luma.spector=Ke)}if(!Ke)return null;if(Tv||(Tv=!0,Ke.spyCanvases(),Ke==null||Ke.onCaptureStarted.add(t=>ae.info("Spector capture started:",t)()),Ke==null||Ke.onCapture.add(t=>{ae.info("Spector capture complete:",t)(),Ke==null||Ke.getResultUI(),Ke==null||Ke.resultView.display(),Ke==null||Ke.resultView.addCapture(t)})),n.gl){const t=n.gl,i=t.device;Ke==null||Ke.startCapture(n.gl,500),t.device=i,new Promise(s=>setTimeout(s,2e3)).then(s=>{ae.info("Spector capture stopped after 2 seconds")(),Ke==null||Ke.stopCapture()})}return Ke}const bN="https://unpkg.com/webgl-debug@2.0.1/index.js";function B3(n){return n.luma=n.luma||{},n.luma}async function vN(){Ys()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await k3(bN))}function TN(n,e={}){return e.debugWebGL||e.traceWebGL?AN(n,e):xN(n)}function xN(n){const e=B3(n);return e.realContext?e.realContext:n}function AN(n,e){if(!globalThis.WebGLDebugUtils)return ae.warn("webgl-debug not loaded")(),n;const t=B3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...zr,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,SN.bind(null,e),wN.bind(null,e));for(const l in zr)!(l in i)&&typeof zr[l]=="number"&&(i[l]=zr[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const a=Object.create(s);return t.realContext=n,t.debugContext=a,a.debug=!0,a}function xv(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function SN(n,e,t,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);const s=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${a})`;ae.error(l)();debugger}function wN(n,e,t){let i="";ae.level>=1&&(i=xv(e,t),n.traceWebGL&&ae.log(1,i)());for(const s of t)if(s===void 0){i=i||xv(e,t);debugger}}const Fd={};function EN(n="id"){Fd[n]=Fd[n]||1;const e=Fd[n]++;return`${n}-${e}`}class Mo extends Je{constructor(t,i={}){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"glTarget");T(this,"glUsage");T(this,"glIndexType",5123);T(this,"byteLength");T(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof i=="object"?i.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=RN(this.props.usage),this.glUsage=CN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(t,i=0,s=t.byteLength+i){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,s,this.glUsage),this.gl.bufferSubData(a,i,t),this.gl.bindBuffer(a,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,i,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let i=t;t===0&&(i=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,i,t.byteLength)}async readAsync(t=0,i){return this.readSyncWebGL(t,i)}readSyncWebGL(t=0,i){i=i??this.byteLength-t;const s=new Uint8Array(i),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,a,i),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,i),s}}function RN(n){return n&Je.INDEX?34963:n&Je.VERTEX?34962:n&Je.UNIFORM?35345:34962}function CN(n){return n&Je.INDEX||n&Je.VERTEX?35044:n&Je.UNIFORM?35048:35044}function MN(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,y]=s;t.push({message:y.trim(),type:Av(_),lineNum:0,linePos:0});continue}const[a,l,c,...f]=s;let d=parseInt(c,10);isNaN(d)&&(d=0);let g=parseInt(l,10);isNaN(g)&&(g=0),t.push({message:f.join(":").trim(),type:Av(a),lineNum:d,linePos:g})}return t}function Av(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class ON extends Jc{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?MN(t):[]}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(i==null?void 0:i.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ae.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ae.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function IN(n,e,t,i){if(kN(e))return i(n);const s=n;s.pushState();try{return PN(n,e),ca(s.gl,t),i(n)}finally{s.popState()}}function PN(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Vs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const a=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Vs("provokingVertex",e.provokingVertex,{first:36429,last:36430});a==null||a.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Vs("polygonMode",e.polygonMode,{fill:6914,line:6913});a==null||a.polygonModeWEBGL(1028,l),a==null||a.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(DN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Pg("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ae.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,a=Pg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,s),i.stencilFuncSeparate(1029,a,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=zd("stencilPassOperation",e.stencilPassOperation),a=zd("stencilFailOperation",e.stencilFailOperation),l=zd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,l,s),i.stencilOpSeparate(1029,a,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=Sv("blendColorOperation",e.blendColorOperation||"add"),a=Sv("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,a);const l=yc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=yc("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=yc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=yc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,c,f,d)}}function Pg(n,e){return Vs(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function zd(n,e){return Vs(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Sv(n,e){return Vs(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function yc(n,e){return Vs(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function NN(n,e){return`Illegal parameter ${e} for ${n}`}function Vs(n,e,t){if(!(e in t))throw new Error(NN(n,e));return t[e]}function DN(n,e){return e}function kN(n){let e=!0;for(const t in n){e=!1;break}return e}function U3(n){const e={};return n.addressModeU&&(e[10242]=Vd(n.addressModeU)),n.addressModeV&&(e[10243]=Vd(n.addressModeV)),n.addressModeW&&(e[32882]=Vd(n.addressModeW)),n.magFilter&&(e[10240]=Ng(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=BN(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=Pg("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Vd(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ng(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function BN(n,e="none"){if(!e)return Ng(n);switch(e){case"none":return Ng(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Dg extends eu{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"parameters");this.device=t,this.parameters=U3(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[i,s]of Object.entries(t)){const a=Number(i);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,s);break;default:this.device.gl.samplerParameteri(this.handle,a,s);break}}}}class Wr extends Gc{constructor(t,i){super(t,{...lt.defaultProps,...i});T(this,"device");T(this,"gl");T(this,"handle");T(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const UN="Failed to deduce GL constant from typed array";function LN(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(UN)}}function FN(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function L3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function zN(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function du(n,e,t){if(VN(e))return t(n);const{nocatch:i=!0}=e,s=zs.get(n);s.push(),ca(n,e);let a;if(i)a=t(n),s.pop();else try{a=t(n)}finally{s.pop()}return a}function VN(n){for(const e in n)return!1;return!0}function HN(n,e,t){const{dimension:i,width:s,height:a,depth:l=0}=t,{glInternalFormat:c}=t,f=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(f,e,c,s,a,l);break;default:n.texStorage2D(f,e,c,s,a)}}function wv(n,e,t,i){const{width:s,height:a}=i,{dimension:l,depth:c=0,mipLevel:f=0}=i,{x:d=0,y:g=0,z:_=0}=i,{glFormat:y,glType:b}=i,x=F3(i.glTarget,l,c),E=i.flipY?{37440:!0}:{};du(n,E,()=>{switch(l){case"2d-array":case"3d":n.bindTexture(x,e),n.texSubImage3D(x,f,d,g,_,s,a,c,y,b,t),n.bindTexture(x,null);break;case"2d":case"cube":n.bindTexture(x,e),n.texSubImage2D(x,f,d,g,s,a,y,b,t),n.bindTexture(x,null);break;default:throw new Error(l)}})}function Ev(n,e,t){const{dimension:i,width:s,height:a,depth:l=0,mipLevel:c=0,byteOffset:f=0}=t,{x:d=0,y:g=0,z:_=0}=t,{glFormat:y,glType:b,compressed:x}=t,E=F3(t.glTarget,i,l);switch(i){case"2d-array":case"3d":x?n.compressedTexSubImage3D(E,c,d,g,_,s,a,l,y,e,f):n.texSubImage3D(E,c,d,g,_,s,a,l,y,b,e,f);break;case"2d":case"cube":x?n.compressedTexSubImage2D(E,c,d,g,s,a,y,e,f):n.texSubImage2D(E,c,d,g,s,a,y,b,e,f);break;default:throw new Error(i)}}function WN(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function F3(n,e,t){return e==="cube"?34069+t:n}function jN(n,e){var N;const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:a=null,sourceWidth:l,sourceHeight:c,sourceDepth:f,sourceFormat:d,sourceType:g}=e||{};const{framebuffer:_,deleteFramebuffer:y}=z3(n),{gl:b,handle:x}=_;l||(l=_.width),c||(c=_.height);const E=(N=_.colorAttachments[s])==null?void 0:N.texture;if(!E)throw new Error(`Invalid framebuffer attachment ${s}`);f=(E==null?void 0:E.depth)||1,d||(d=(E==null?void 0:E.glFormat)||6408),g||(g=(E==null?void 0:E.glType)||5121),a=YN(a,g,d,l,c),g=g||LN(a);const M=b.bindFramebuffer(36160,x);return b.readBuffer(36064+s),b.readPixels(t,i,l,c,d,g,a),b.readBuffer(36064),b.bindFramebuffer(36160,M||null),y&&_.destroy(),a}function $N(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:a=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:d}=e||{};const{framebuffer:g,deleteFramebuffer:_}=z3(n);c=c||g.width,f=f||g.height;const y=g;d=d||5121;let b=t;if(!b){const E=L3(a),M=zN(d),N=l+c*f*E*M;b=y.device.createBuffer({byteLength:N})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:n,width:c,height:f,origin:[i,s],destinationBuffer:b,byteOffset:l}),x.destroy(),_&&g.destroy(),b}function z3(n){return n instanceof tu?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:XN(n),deleteFramebuffer:!0}}function XN(n,e){const{device:t,width:i,height:s,id:a}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:i,height:s,colorAttachments:[n]})}function YN(n,e,t,i,s,a){if(n)return n;e||(e=5121);const l=FN(e,{clamped:!1}),c=L3(t);return new l(i*s*c)}class Oo extends lt{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"sampler");T(this,"view");T(this,"mipmaps");T(this,"compressed");T(this,"glTarget");T(this,"glFormat");T(this,"glType");T(this,"glInternalFormat");T(this,"textureUnit",0);const s={...this.props};s.data=i.data,this.device=t,this.gl=this.device.gl,this.glTarget=WN(this.props.dimension);const a=D3(this.props.format);this.glInternalFormat=a.internalFormat,this.glFormat=a.format,this.glType=a.type,this.compressed=a.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:i,height:s}=t;if(!i||!s){const a=lt.getTextureDataSize(t.data);i=(a==null?void 0:a.width)||1,s=(a==null?void 0:a.height)||1}if(this.width=i,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Wr(this.device,{...this.props,texture:this}),this.bind(),HN(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Wr(this.device,{...t,texture:this})}setSampler(t={}){let i;t instanceof Dg?(this.sampler=t,i=t.props):(this.sampler=new Dg(this.device,t),i=t);const s=U3(i);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ae.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){ae.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const i=lt.getExternalImageSize(t.image),s={...lt.defaultCopyExternalImageOptions,...i,...t},{image:a,depth:l,mipLevel:c,x:f,y:d,z:g,flipY:_}=s;let{width:y,height:b}=s;const{dimension:x,glTarget:E,glFormat:M,glInternalFormat:N,glType:V}=this;if(y=Math.min(y,this.width-f),b=Math.min(b,this.height-d),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return wv(this.device.gl,this.handle,a,{dimension:x,mipLevel:c,x:f,y:d,z:g,width:y,height:b,depth:l,glFormat:M,glType:V,glTarget:E,flipY:_}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,i=0){this.bind();const s=lt.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&ae.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let a=0;a<s.length;a++){const l=s[a];this._setMipLevel(i,a,l)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),Ev(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of lt.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ae.warn(`${this.id} has mipmap and multiple LODs.`)();const a=lt.CubeFaces.indexOf(i);this.setTexture2DData(t,a)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:i,width:s,height:a,pixels:l,data:c,format:f=6408,type:d=5121}=t,{gl:g}=this,_=l||c;this.bind(),_ instanceof Promise?_.then(y=>this.setImageDataForFace(Object.assign({},t,{face:i,data:y,pixels:y}))):this.width||this.height?g.texImage2D(i,0,f,s,a,0,f,d,_):g.texImage2D(i,0,f,f,d,_)}_getImageDataMap(t){for(let i=0;i<lt.CubeFaces.length;++i){const s=lt.CubeFaces[i];t[s]&&(t[34069+i]=t[s],delete t[s])}return t}_setSamplerParameters(t){ae.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,s]of Object.entries(t)){const a=Number(i),l=s;switch(a){case 33082:case 33083:this.gl.texParameterf(this.glTarget,a,l);break;case 10241:this.gl.texParameteri(this.glTarget,a,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,a,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,a,l);break;default:this.gl.texParameteri(this.glTarget,a,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,i,s,a=this.glTarget){if(lt.isExternalImage(s)){wv(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:i,glTarget:a,flipY:this.props.flipY});return}if(lt.isTextureLevelData(s)){Ev(this.device.gl,s.data,{...this,depth:t,mipLevel:i,glTarget:a});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,null),t}}const qN=[1,2,4,8];class KN extends og{constructor(t,i){var l;super(t,i);T(this,"device");T(this,"glParameters");this.device=t;let s;if(!((l=i==null?void 0:i.parameters)!=null&&l.viewport))if(i!=null&&i.framebuffer){const{width:c,height:f}=i.framebuffer;s=[0,0,c,f]}else{const[c,f]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,c,f]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const a=this.props.framebuffer;if(a!=null&&a.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((f,d)=>36064+d);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(i.viewport=t.viewport.slice(0,4),i.depthRange=[t.viewport[4],t.viewport[5]]):i.viewport=t.viewport),t.scissorRect&&(i.scissorTest=!0,i.scissor=t.scissorRect),t.blendConstant&&(i.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(i.colorMask=qN.map(s=>!!(s&t.colorMask))),this.glParameters=i,ca(this.device.gl,i)}beginOcclusionQuery(t){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((s,a)=>{s&&this.clearColorBuffer(a,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,t.clearStencil=this.props.clearStencil),i!==0&&du(this.device.gl,t,()=>{this.device.gl.clear(i)})}clearColorBuffer(t=0,i=[0,0,0,0]){du(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function ZN(n){return QN.includes(n)}const QN=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],V3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function H3(n){const e=V3[n];if(!e)throw new Error("uniform");const[t,i,,s]=e;return{format:s,components:i,glType:t}}function GN(n){const e=V3[n];if(!e)throw new Error("attribute");const[,t,,i,s]=e;return{attributeType:i,vertexFormat:s,components:t}}function JN(n,e){const t={attributes:[],bindings:[]};t.attributes=eD(n,e);const i=iD(n,e);for(const c of i){const f=c.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const s=nD(n,e);let a=0;for(const c of s)if(ZN(c.type)){const{viewDimension:f,sampleType:d}=rD(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:a,viewDimension:f,sampleType:d}),c.textureUnit=a,a+=1}s.length&&(t.uniforms=s);const l=tD(n,e);return l!=null&&l.length&&(t.varyings=l),t}function eD(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const a=n.getActiveAttrib(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:c}=a,f=n.getAttribLocation(e,l);if(f>=0){const{attributeType:d}=GN(c),g=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:f,stepMode:g,type:d})}}return t.sort((s,a)=>s.location-a.location),t}function tD(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const a=n.getTransformFeedbackVarying(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:c,size:f}=a,{glType:d,components:g}=H3(c),_={location:s,name:l,type:d,size:f*g};t.push(_)}return t.sort((s,a)=>s.location-a.location),t}function nD(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const a=n.getActiveUniform(e,s);if(!a)throw new Error("activeInfo");const{name:l,size:c,type:f}=a,{name:d,isArray:g}=aD(l);let _=n.getUniformLocation(e,d);const y={location:_,name:d,size:c,type:f,isArray:g};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const x=`${d}[${b}]`;_=n.getUniformLocation(e,x);const E={...y,name:x,location:_};t.push(E)}}return t}function iD(n,e){const t=(a,l)=>n.getActiveUniformBlockParameter(e,a,l),i=[],s=n.getProgramParameter(e,35382);for(let a=0;a<s;a++){const l={name:n.getActiveUniformBlockName(e,a)||"",location:t(a,35391),byteLength:t(a,35392),vertex:t(a,35396),fragment:t(a,35398),uniformCount:t(a,35394),uniforms:[]},c=t(a,35395)||[],f=n.getActiveUniforms(e,c,35383),d=n.getActiveUniforms(e,c,35384),g=n.getActiveUniforms(e,c,35387),_=n.getActiveUniforms(e,c,35388);for(let y=0;y<l.uniformCount;++y){const b=n.getActiveUniform(e,c[y]);if(!b)throw new Error("activeInfo");l.uniforms.push({name:b.name,format:H3(f[y]).format,type:f[y],arrayLength:d[y],byteOffset:g[y],byteStride:_[y]})}i.push(l)}return i.sort((a,l)=>a.location-l.location),i}const sD={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function rD(n){const e=sD[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function aD(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function oD(n,e,t,i){const s=n;let a=i;a===!0&&(a=1),a===!1&&(a=0);const l=typeof a=="number"?[a]:a;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function lD(n){return A3(n)!==null||typeof n=="number"||typeof n=="boolean"}function cD(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];lD(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function uD(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function fD(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const Rv=4;class hD extends Qr{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"vs");T(this,"fs");T(this,"introspectedLayout");T(this,"uniforms",{});T(this,"bindings",{});T(this,"varyings",null);T(this,"_uniformCount",0);T(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:s,bufferMode:a=35981}=i;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,a)),this._linkShaders(),ae.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=JN(this.device.gl,this.handle),ae.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=dD(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,i){for(const[s,a]of Object.entries(t)){const l=this.shaderLayout.bindings.find(c=>c.name===s)||this.shaderLayout.bindings.find(c=>c.name===`${s}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");i!=null&&i.disableWarnings||ae.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${c}`,a)();continue}switch(a||ae.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(a instanceof Mo)&&!(a.buffer instanceof Mo))throw new Error("buffer value");break;case"texture":if(!(a instanceof Wr||a instanceof Oo||a instanceof Co))throw new Error("texture value");break;case"sampler":ae.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(l.type)}this.bindings[s]=a}}draw(t){var M;const{renderPass:i,parameters:s=this.props.parameters,topology:a=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:f,isInstanced:d=!1,firstVertex:g=0,transformFeedback:_}=t,y=uD(a),b=!!l.indexBuffer,x=(M=l.indexBuffer)==null?void 0:M.glIndexType;if(this.linkStatus!=="success")return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const E=i;return IN(this.device,s,E.glParameters,()=>{b&&d?this.device.gl.drawElementsInstanced(y,c||0,x,g,f||0):b?this.device.gl.drawElements(y,c||0,x,g):d?this.device.gl.drawArraysInstanced(y,g,c||0,f||0):this.device.gl.drawArrays(y,g,c||0),_&&_.end()}),l.unbindAfterRender(i),!0}setUniformsWebGL(t){const{bindings:i}=cD(t);Object.keys(i).forEach(s=>{ae.warn(`Unsupported value "${JSON.stringify(i[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ae.time(Rv,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ae.timeEnd(Rv,`linkProgram for ${this.id}`)(),ae.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}ae.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ae.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(t){var i;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(ae.warn(`Binding ${i.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let i=0,s=0;for(const a of this.shaderLayout.bindings){const l=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:c}=a,f=t.getUniformBlockIndex(this.handle,c);if(f===4294967295)throw new Error(`Invalid uniform block name ${c}`);t.uniformBlockBinding(this.handle,s,f),l instanceof Mo?t.bindBufferBase(35345,s,l.handle):t.bindBufferRange(35345,s,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),s+=1;break;case"texture":if(!(l instanceof Wr||l instanceof Oo||l instanceof Co))throw new Error("texture");let d;if(l instanceof Wr)d=l.texture;else if(l instanceof Oo)d=l;else if(l instanceof Co&&l.colorAttachments[0]instanceof Wr)ae.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=l.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+i),t.bindTexture(d.glTarget,d.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:i,location:s,type:a,textureUnit:l}=t,c=this.uniforms[i]??l;c!==void 0&&oD(this.device.gl,s,a,c)}}}function dD(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(a=>a.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):ae.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class gD extends cg{constructor(t){super(t,{});T(this,"device");T(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const i of t)switch(i.name){case"copy-buffer-to-buffer":pD(this.device,i.options);break;case"copy-buffer-to-texture":_D(this.device,i.options);break;case"copy-texture-to-buffer":mD(this.device,i.options);break;case"copy-texture-to-texture":yD(this.device,i.options);break;default:throw new Error(i.name)}}}function pD(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function _D(n,e){throw new Error("Not implemented")}function mD(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:a=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:d,byteOffset:g=0,bytesPerRow:_,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||_||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:x}=W3(t);let E;try{const M=d,N=a||b.width,V=l||b.height,P=D3(b.colorAttachments[0].texture.props.format),H=P.format,X=P.type;n.gl.bindBuffer(35051,M.handle),E=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(f[0],f[1],N,V,H,X,g)}finally{n.gl.bindBuffer(35051,null),E!==void 0&&n.gl.bindFramebuffer(36160,E),x&&b.destroy()}}function yD(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:a=[0,0],destinationTexture:l}=e;let{width:c=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:g}=W3(t),[_,y]=s,[b,x,E]=a,M=n.gl.bindFramebuffer(36160,d.handle);let N=null,V;if(l instanceof Oo)N=l,c=Number.isFinite(c)?c:N.width,f=Number.isFinite(f)?f:N.height,N.bind(0),V=N.glTarget;else throw new Error("invalid destination");switch(V){case 3553:case 34067:n.gl.copyTexSubImage2D(V,i,b,x,_,y,c,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(V,i,b,x,E,_,y,c,f);break}N&&N.unbind(),n.gl.bindFramebuffer(36160,M),g&&d.destroy()}function W3(n){if(n instanceof lt){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class bD extends lg{constructor(t,i){super(t,i);T(this,"device");T(this,"commandBuffer");this.device=t,this.commandBuffer=new gD(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,i,s){}}function vD(n){const{target:e,source:t,start:i=0,count:s=1}=n,a=t.length,l=s*a;let c=0;for(let f=i;c<a;c++)e[f++]=t[c];for(;c<l;)c<l-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+l-c),c=l);return n.target}class Cp extends ug{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"buffer",null);T(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return lS()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const i=t;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(t,i){const s=i;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:l,stride:c,offset:f,normalized:d,integer:g,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),g?this.device.gl.vertexAttribIPointer(t,a,l,c,f):this.device.gl.vertexAttribPointer(t,a,l,d,c,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,i){this._enable(t,!1),this.attributes[t]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const i=this.attributes[t];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(t,i)}}_getAccessor(t){const i=this.attributeInfos[t];if(!i)throw new Error(`Unknown attribute location ${t}`);const s=N3(i.bufferDataType);return{size:i.bufferComponents,type:s,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(t,i=!0){const a=Cp.isConstantAttributeZeroSupported(this.device)||t!==0;(i||a)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,i){const s=TD(i),a=s.byteLength*t,l=s.length*t;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),c=c||!xD(s,this.bufferValue),c){const f=tC(i.constructor,l);vD({target:f,source:s,start:0,count:l}),this.buffer.write(f),this.bufferValue=i}return this.buffer}}function TD(n){return Array.isArray(n)?new Float32Array(n):n}function xD(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class AD extends fg{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"layout");T(this,"buffers",{});T(this,"unusedBuffers",{});T(this,"bindOnUse",!0);T(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fD(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in t)this.setBuffer(i,t[i])})}setBuffer(t,i){const s=this._getVaryingIndex(t),{buffer:a,byteLength:l,byteOffset:c}=this._getBufferRange(i);if(s<0){this.unusedBuffers[t]=a,ae.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:a,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(s,a,c,l)}getBuffer(t){if(Cv(t))return this.buffers[t]||null;const i=this._getVaryingIndex(t);return i>=0?this.buffers[i]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let i;return this._bound?i=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Mo)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:i,byteOffset:s=0,byteLength:a=t.buffer.byteLength}=t;return{buffer:i,byteOffset:s,byteLength:a}}_getVaryingIndex(t){if(Cv(t))return Number(t);for(const i of this.layout.varyings)if(t===i.name)return i.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:i,byteLength:s,byteOffset:a}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),i,a,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,i,s=0,a){const l=i&&i.handle;!l||a===void 0?this.gl.bindBufferBase(35982,t,l):this.gl.bindBufferRange(35982,t,l,s,a)}}function Cv(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class SD extends hg{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"target",null);T(this,"_queryPending",!1);T(this,"_pollingPromise",null);if(this.device=t,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((s,a)=>{const l=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):i++>t?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class jr extends is{constructor(t){var _,y;super({...t,id:t.id||EN("webgl-device")});T(this,"type","webgl");T(this,"handle");T(this,"features");T(this,"limits");T(this,"info");T(this,"canvasContext");T(this,"lost");T(this,"_resolveContextLost");T(this,"gl");T(this,"debug",!1);T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});T(this,"_extensions",{});T(this,"_polyfilled",!1);T(this,"spectorJS");T(this,"renderPass",null);T(this,"_constants");const i=is._getCanvasContextProps(t);if(!i)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(y=(_=i.canvas)==null?void 0:_.gl)==null?void 0:y.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new pN(this,i),this.lost=new Promise(b=>{this._resolveContextLost=b});const a={...t.webgl};i.alphaMode==="premultiplied"&&(a.premultipliedAlpha=!0),t.powerPreference!==void 0&&(a.powerPreference=t.powerPreference);const c=this.props._handle||K4(this.canvasContext.canvas,{onContextLost:b=>{var x;return(x=this._resolveContextLost)==null?void 0:x.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:b=>console.log("WebGL context restored")},a);if(!c)throw new Error("WebGL context creation failed");if(s=c.device,s){if(t._reuseDevices)return ae.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=c,this.gl=c,this.spectorJS=yN({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Z4(this.gl,this._extensions),this.limits=new hN(this.gl),this.features=new fN(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new zs(this.gl,{log:(...b)=>ae.log(1,...b)()}).trackState(this.gl,{copyState:!1});const d=t.debugWebGL||t.debug,g=t.debugWebGL;d&&(this.gl=TN(this.gl,{debugWebGL:d,traceWebGL:g}),ae.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ae.level=Math.max(ae.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const i=this._normalizeBufferProps(t);return new Mo(this,i)}createTexture(t){return new Oo(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Dg(this,t)}createShader(t){return new ON(this,t)}createFramebuffer(t){return new Co(this,t)}createVertexArray(t){return new Cp(this,t)}createTransformFeedback(t){return new AD(this,t)}createQuerySet(t){return new SD(this,t)}createRenderPipeline(t){return new hD(this,t)}beginRenderPass(t){return new KN(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new bD(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,i){return jN(t,i)}readPixelsToBufferWebGL(t,i){return $N(t,i)}setParametersWebGL(t){ca(this.gl,t)}getParametersWebGL(t){return I3(this.gl,t)}withParametersWebGL(t,i){return du(this.gl,t,i)}resetWebGL(){ae.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),j4(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return oN(this.gl,t,this._extensions)}loseDevice(){var a;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(a=this._resolveContextLost)==null||a.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){zs.get(this.gl).push()}popState(){zs.get(this.gl).pop()}setSpectorMetadata(t,i){t.__SPECTOR_Metadata=i}getGLKey(t,i){const s=Number(t);for(const a in this.gl)if(this.gl[a]===s)return`GL.${a}`;return i!=null&&i.emptyIfUnknown?"":String(t)}getGLKeys(t){const i={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[a,l])=>(s[`${a}:${this.getGLKey(a,i)}`]=`${l}:${this.getGLKey(l,i)}`,s),{})}setConstantAttributeWebGL(t,i){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const a=this._constants[t];switch(a&&CD(a,i)&&ae.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=i,i.constructor){case Float32Array:wD(this,t,i);break;case Int32Array:ED(this,t,i);break;case Uint32Array:RD(this,t,i);break;default:throw new Error("constant")}}getExtension(t){return sa(this.gl,t,this._extensions),this._extensions}}function wD(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function ED(n,e,t){n.gl.vertexAttribI4iv(e,t)}function RD(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function CD(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const MD={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},OD=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),ID=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),PD=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function ND(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&DD(s),s}return this.originalGetContext(t,i)}}function DD(n){n.getExtension("EXT_color_buffer_float");const e={...MD,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:OD(n),OES_vertex_array_object:ID(n),ANGLE_instanced_arrays:PD(n)},t=n.getExtension;n.getExtension=function(s){const a=t.call(n,s);return a||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=i.apply(n)||[];return s==null?void 0:s.concat(Object.keys(e))}}const bc=1;class kD extends IR{constructor(){super();T(this,"type","webgl");is.defaultProps={...is.defaultProps,...Rp},jr.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){ND(t)}async attach(t){if(t instanceof jr)return t;if((t==null?void 0:t.device)instanceof is)return t.device;if(!BD(t))throw new Error("Invalid WebGL2RenderingContext");return new jr({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ae.groupCollapsed(bc,"WebGLDevice created")();const i=[];(t.debugWebGL||t.debug)&&i.push(vN()),t.debugSpectorJS&&i.push(mN(t));const s=await Promise.allSettled(i);for(const c of s)c.status==="rejected"&&ae.error(`Failed to initialize debug libraries ${c.reason}`)();const a=new jr(t),l=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return ae.probe(bc,l)(),ae.table(bc,a.info)(),ae.groupEnd(bc)(),a}}function BD(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const Mv=new kD;function qi(){}const UD=({isDragging:n})=>n?"grabbing":"grab",j3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:qi,onWebGLInitialized:qi,onResize:qi,onViewStateChange:qi,onInteractionStateChange:qi,onBeforeRender:qi,onAfterRender:qi,onLoad:qi,onError:n=>De.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:UD,getTooltip:null,debug:!1,drawPickingColors:!1};class Mp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ho({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=xg[i.type],a=i.offsetCenter;if(!s||!a||!this.layerManager)return;const l=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:l,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:f}=c,d=f&&(f[s]||f.props[s]),g=this.props[s];let _=!1;d&&(_=d.call(f,c,i)),_||(g==null||g(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{var l;if(((l=this.device)==null?void 0:l.type)==="webgpu")return;const s=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...j3,...e},e=this.props,e.viewState&&e.initialViewState&&De.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&De.error("WebGL1 context not supported.")(),t=Mv.attach(e.gl)),t||(t=rg.createDevice({type:"best-available",_reuseDevices:!0,adapters:[Mv],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&ta.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,s,a,l,c,f,d,g;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(a=this.effectManager)==null||a.finalize(),this.effectManager=null,(l=this.deckRenderer)==null||l.finalize(),this.deckRenderer=null,(c=this.deckPicker)==null||c.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((g=this.canvas.parentElement)==null||g.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&De.removed("onLayerHover","onHover")(),"onLayerClick"in e&&De.removed("onLayerClick","onClick")(),e.initialViewState&&!Dn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||a||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return It(this.viewManager),this.viewManager.views}getViewports(e){return It(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,i){It(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),a}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),It(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const a=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=a}if(i||i===0){const a=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var s,a;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,(s=this.viewManager)==null||s.setProps({width:t,height:i}),(a=this.layerManager)==null||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s,useDevicePixels:a}=t;return new zP({device:e,useDevicePixels:a,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Ap({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,i,s,a;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:c}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let f=c,d=!1;for(const g of l)f=g,d=((i=g.layer)==null?void 0:i.onHover(g,e.event))||d;d||((a=(s=this.props).onHover)==null||a.call(s,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,a;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new x3;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new xI(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Zb).map(l=>{var b;const[c,f,d,g]=Zb[l],_=(b=this.props.eventRecognizerOptions)==null?void 0:b[l],y={...f,..._,event:l};return{recognizer:new c(y),recognizeWith:d,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in xg)this.eventManager.on(l,this._onEvent);this.viewManager=new u4({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new c4(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new E4({deck:this,device:this.device}),this.deckRenderer=new M4(this.device),this.deckPicker=new k4(this.device),this.widgetManager=new L4({deck:this,parentElement:(a=this.canvas)==null?void 0:a.parentElement}),this.widgetManager.addDefault(new z4),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var l;const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(l=this.deckRenderer)==null||l.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),De.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=rg.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Mp.defaultProps=j3;Mp.VERSION=BE;function LD(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return mT(n)}}const FD=_T;function vc(n,e){return{attribute:n,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Bs(n){return n.stride||n.size*n.bytesPerElement}function zD(n,e){return n.type===e.type&&n.size===e.size&&Bs(n)===Bs(e)&&(n.offset||0)===(e.offset||0)}function kg(n,e){e.offset&&De.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Bs(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,a=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:a,stride:t}}function VD(n,e){const t=kg(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class HD{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,a=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;a?c="float32":!s&&t.isIndexed?c="uint32":c=s||"float32";let f=LD(s||c);this.doublePrecision=a,a&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:l,logicalType:s,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Bs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ta.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const a=kg(this.getAccessor(),t),l=a.offset/s.BYTES_PER_ELEMENT,c=a.size||this.size;i[e]=s.subarray(l,l+c)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],a={name:this.id,byteStride:Bs(i),attributes:s};if(this.doublePrecision){const l=VD(i,t||{});s.push(vc(e,{...i,...l.high}),vc(`${e}64Low`,{...i,...l.low}))}else if(t){const l=kg(i,t);s.push(vc(e,{...i,...l}))}else s.push(vc(e,i));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,a=i*s;if(t&&a&&t.length>=a){const l=new Array(s).fill(1/0),c=new Array(s).fill(-1/0);for(let f=0;f<a;)for(let d=0;d<s;d++){const g=t[f++];g<l[d]&&(l[d]=g),g>c[d]&&(c[d]=g)}e=[l,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Je?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=FD(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Bs(s)}if(t.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!t.constant||!this._areValuesEqual(a,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;t.externalBuffer=a,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;t.externalBuffer=null,t.constant=!1,this.value=a;let{buffer:l}=this;const c=Bs(s),f=(s.vertexOffset||0)*c;if(this.doublePrecision&&a instanceof Float64Array&&(a=Nd(a,s)),this.settings.isIndexed){const g=this.settings.defaultType;a.constructor!==g&&(a=new g(a))}const d=a.byteLength+f+c*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(a,f)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Nd(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,a=ta.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=a;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<a.byteLength+l)&&(c=this._createBuffer(a.byteLength+l),t&&s&&c.write(s instanceof Float64Array?Nd(s,this):s,l)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&De.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:a}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=a;for(;--l>=0;)t[i+l]=s[l];return t}switch(a){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=a;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(t?Je.INDEX:Je.VERTEX)|Je.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const Ov=[],Iv=[];function zu(n,e=0,t=1/0){let i=Ov;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Iv.length=n.length,i=Iv):i=Ov,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function $3(n){return n&&n[Symbol.asyncIterator]}function X3(n,e){const{size:t,stride:i,offset:s,startIndices:a,nested:l}=e,c=n.BYTES_PER_ELEMENT,f=i?i/c:t,d=s?s/c:0,g=Math.floor((n.length-d)/f);return(_,{index:y,target:b})=>{if(!a){const N=y*f+d;for(let V=0;V<t;V++)b[V]=n[N+V];return b}const x=a[y],E=a[y+1]||g;let M;if(l){M=new Array(E-x);for(let N=x;N<E;N++){const V=N*f+d;b=new Array(t);for(let P=0;P<t;P++)b[P]=n[V+P];M[N-x]=b}}else if(f===t)M=n.subarray(x*t+d,E*t+d);else{M=new n.constructor((E-x)*t);let N=0;for(let V=x;V<E;V++){const P=V*f+d;for(let H=0;H<t;H++)M[N++]=n[P+H]}}return M}}const WD=[],Lc=[[0,1/0]];function jD(n,e){if(n===Lc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let a=0;a<i;a++){const l=n[a];l[1]<e[0]?(t.push(l),s=a+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const $D={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Y3(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...$D[t],...e,...n,type:t}}class q3 extends HD{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Lc}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!zD(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(a=>e[a])]:e[t];return Y3(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=jD(this.state.updateRanges,[i,s])}else this.state.updateRanges=Lc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=WD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==Lc),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:l,noAlloc:c}}=this;let f=!0;if(l){for(const[d,g]of a)l.call(s,this,{data:t,startRow:d,endRow:g,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,g]of a){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(g)?this.getVertexOffset(g):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;It(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const c=!!l.size&&l.size!==this.size;return i.binaryAccessor=X3(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const a in t){const l=super._getBufferLayout(a,t[a]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:a,numInstances:l}){if(e.constant)return;const{settings:c,state:f,value:d,size:g,startIndices:_}=e,{accessor:y,transform:b}=c,x=f.binaryAccessor||(typeof y=="function"?y:a[y]);It(typeof x=="function",`accessor "${y}" is not a function`);let E=e.getVertexOffset(i);const{iterable:M,objectInfo:N}=zu(t,i,s);for(const V of M){N.index++;let P=x(V,N);if(b&&(P=b.call(this,P)),_){const H=(N.index<_.length-1?_[N.index+1]:l)-_[N.index];if(P&&Array.isArray(P[0])){let X=E;for(const Z of P)e._normalizeValue(Z,d,X),X+=g}else P&&P.length>g?d.set(P,E):(e._normalizeValue(P,N.target,0),s4({target:d,source:N.target,start:E,count:H}));E+=H*g}else e._normalizeValue(P,d,E),E+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Hd(n){const{source:e,target:t,start:i=0,size:s,getData:a}=n,l=n.end||t.length,c=e.length,f=l-i;if(c>f){t.set(e.subarray(0,f),i);return}if(t.set(e,i),!a)return;let d=c;for(;d<f;){const g=a(d,e);for(let _=0;_<s;_++)t[i+d]=g[_]||0,d++}}function XD({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:a}){if(!s||!a)return Hd({source:n,target:e,size:t,getData:i}),e;let l=0,c=0;const f=i&&((g,_)=>i(g+c,_)),d=Math.min(s.length,a.length);for(let g=1;g<d;g++){const _=s[g]*t,y=a[g]*t;Hd({source:n.subarray(l,_),target:e,start:c,end:y,size:t,getData:f}),l=_,c=y}return c<e.length&&Hd({source:[],target:e,start:c,size:t,getData:f}),e}function YD(n){const{device:e,settings:t,value:i}=n,s=new q3(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function K3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function Z3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Q3(n){n.push(n.shift())}function qD(n,e){const{doublePrecision:t,settings:i,value:s,size:a}=n,l=t&&s instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=n.settings;if(f)for(const d of Object.values(f))c=Math.max(c,d.vertexOffset??0);return(i.noAlloc?s.length:(e+c)*a)*l}function G3({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function J3({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:a,getData:l=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*c,d=t.byteOffset,g=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,_=t.startIndices,y=a&&_,b=t.isConstant;if(!y&&e&&i>=s)return e;const x=t.value instanceof Float64Array?Float32Array:t.value.constructor,E=b?t.value:new x(t.getBuffer().readSyncWebGL(d,s*x.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const P=l;l=(H,X)=>t.normalizeConstant(P(H,X))}const M=b?(P,H)=>l(E,H):(P,H)=>l(E.subarray(P+d,P+d+f),H),N=e?new Float32Array(e.readSyncWebGL(g,i*4).buffer):new Float32Array(0),V=new Float32Array(s);return XD({source:N,target:V,sourceStartIndices:a,targetStartIndices:_,size:f,getData:M}),(!e||e.byteLength<V.byteLength+g)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:V.byteLength+g,usage:35050})),e.write(V,g),e}class e2{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Fu(i),this.attribute=t,this.attributeInTransition=YD(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=qD(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class KD extends e2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=JD(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:l}=this;Q3(a),a[0]=J3({device:this.device,buffer:a[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),a[1]=G3({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:c}=this,f=c.model;let d=Math.floor(this.currentLength/l.size);t2(l)&&(d/=2),f.setVertexCount(d),l.isConstant?(f.setAttributes({aFrom:a[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:a[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:a}=this.transform,l={time:s};a.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ZD=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Pv={name:"interpolation",vs:ZD,uniformTypes:{time:"f32"}},QD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,GD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function t2(n){return n.doublePrecision&&n.value instanceof Float64Array}function JD(n,e){const t=e.size,i=K3(t),s=Z3(t),a=e.getBufferLayout();return t2(e)?new Uo(n,{vs:GD,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[gO,Pv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Uo(n,{vs:QD,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:a.attributes[0].format}],modules:[Pv],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class ek extends e2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=ak(e),this.framebuffer=ok(e,this.texture),this.transform=rk(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:a,attribute:l}=this;for(let f=0;f<2;f++)a[f]=J3({device:this.device,buffer:a[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});a[2]=G3({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,a=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:a.stiffness,damping:a.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Q3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const tk=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,nk={name:"spring",vs:tk,uniformTypes:{damping:"f32",stiffness:"f32"}},ik=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,sk=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function rk(n,e){const t=K3(e.size),i=Z3(e.size);return new Uo(n,{vs:ik,fs:sk,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[nk],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function ak(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function ok(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const lk={interpolation:KD,spring:ek};class ck{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const a=e[s],l=a.getTransitionSetting(t);l&&this._updateAttribute(s,a,l)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let a=!s||s.type!==i.type;if(a){s&&this._removeTransition(e);const l=lk[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(De.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Nv="attributeManager.invalidate",uk="attributeManager.updateStart",fk="attributeManager.updateEnd",hk="attribute.updateStart",dk="attribute.allocate",gk="attribute.updateEnd";class pk{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=$o(RP),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new ck(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);zt(Nv,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);zt(Nv,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:a={},buffers:l={},context:c={}}){let f=!1;zt(uk,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const g=this.attributes[d],_=g.settings.accessor;g.startIndices=i,g.numInstances=t,a[d]&&De.removed(`props.${d}`,`data.attributes.${d}`)(),g.setExternalBuffer(l[d])||g.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&g.setConstantValue(a[_])||g.needsUpdate()&&(f=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:a,context:c})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}f&&zt(fk,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>{var s;return(s=this.attributes[i])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const a in t){const l=t[a];l.needsRedraw(e)&&!i.hasAttribute(a)&&(s[a]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],a={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new q3(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,a=s[e];return a&&a.forEach(l=>{const c=i[l];c&&c.setNeedsUpdate(c.id,t)}),a}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(zt(hk,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&zt(dk,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,zt(gk,t,i))}}class _k extends Fu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:a}}=this,l=a(e/s);this._value=Ls(t,i,l)}}const Dv=1e-5;function kv(n,e,t,i,s){const a=e-n,c=(t-e)*s,f=-a*i;return c+f+a+e}function mk(n,e,t,i,s){if(Array.isArray(t)){const a=[];for(let l=0;l<t.length;l++)a[l]=kv(n[l],e[l],t[l],i,s);return a}return kv(n,e,t,i,s)}function Bv(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class yk extends Fu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:a=e,_currValue:l=e}=this;let c=mk(a,l,t,i,s);const f=Bv(c,t),d=Bv(c,l);f<Dv&&d<Dv&&(c=t,this.end()),this._prevValue=l,this._currValue=c}}const bk={interpolation:_k,spring:yk};class vk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:a}=this;if(a.has(e)){const f=a.get(e),{value:d=f.settings.fromValue}=f;t=d,this.remove(e)}if(s=Y3(s),!s)return;const l=bk[s.type];if(!l){De.error(`unsupported transition type '${s.type}'`)();return}const c=new l(this.timeline);c.start({...s,fromValue:t,toValue:i}),a.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Tk(n){const e=n[rs];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function xk(n,e){const t=n2({newProps:n,oldProps:e,propTypes:n[rs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Sk(n,e);let s=!1;return i||(s=wk(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:Ek(n,e),transitionsChanged:Ak(n,e)}}function Ak(n,e){if(!n.transitions)return!1;const t={},i=n[rs];let s=!1;for(const a in n.transitions){const l=i[a],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&Bg(n[a],e[a],l)&&(t[a]=!0,s=!0)}return s?t:!1}function n2({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const a of Object.keys(n))if(!(a in t)){if(!(a in e))return`${s}.${a} added`;const l=Bg(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}for(const a of Object.keys(e))if(!(a in t)){if(!(a in n))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(n,a)){const l=Bg(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}}return!1}function Bg(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function Sk(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function wk(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Uv(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Uv(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function Ek(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function Uv(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},n2({oldProps:s,newProps:i,triggerName:t})}const Rk="count(): argument not an object",Ck="count(): argument not a container";function Mk(n){if(!Ik(n))throw new Error(Rk);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(Ok(n))return Object.keys(n).length;throw new Error(Ck)}function Ok(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Ik(n){return n!==null&&typeof n=="object"}function Lv(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const Pk={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ug={};function Nk(n,e,t,i){if(t instanceof lt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const a=e.createTexture({...t,sampler:{...Pk,...s,...i},mipmaps:!0});return Ug[a.id]=n,a}function Dk(n,e){!e||!(e instanceof lt)||Ug[e.id]===n&&(e.delete(),delete Ug[e.id])}const kk={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Lg(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Dn(n,e,1)}},accessor:{validate(n,e){const t=gu(n);return t==="function"||t===gu(e.value)},equal(n,e,t){return typeof e=="function"?!0:Dn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Lg(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Dn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Dn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:Nk(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{Dk(t.id,n)}}};function Bk(n){const e={},t={},i={};for(const[s,a]of Object.entries(n)){const l=a==null?void 0:a.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const c=Uk(s,a);e[s]=c,t[s]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function Uk(n,e){switch(gu(e)){case"object":return fo(n,e);case"array":return fo(n,{type:"array",value:e,compare:!1});case"boolean":return fo(n,{type:"boolean",value:e});case"number":return fo(n,{type:"number",value:e});case"function":return fo(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function fo(n,e){return"type"in e?{name:n,...kk[e.type],...e}:"value"in e?{name:n,type:gu(e.value),...e}:{name:n,type:"object",value:e}}function Lg(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function gu(n){return Lg(n)?"array":n===null?"null":typeof n}function Lk(n,e){let t;for(let a=e.length-1;a>=0;a--){const l=e[a];"extensions"in l&&(t=l.extensions)}const i=Fg(n.constructor,t),s=Object.create(i);s[hu]=n,s[Xs]={},s[ts]={};for(let a=0;a<e.length;++a){const l=e[a];for(const c in l)s[c]=l[c]}return Object.freeze(s),s}const Fk="_mergedDefaultProps";function Fg(n,e){if(!(n instanceof Vu.constructor))return{};let t=Fk;if(e)for(const s of e){const a=s.constructor;a&&(t+=`:${a.extensionName||a.name}`)}const i=i2(n,t);return i||(n[t]=zk(n,e||[]))}function zk(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Fg(i),a=i2(n,"defaultProps")||{},l=Bk(a),c=Object.assign(Object.create(null),s,l.defaultProps),f=Object.assign(Object.create(null),s==null?void 0:s[rs],l.propTypes),d=Object.assign(Object.create(null),s==null?void 0:s[Ud],l.deprecatedProps);for(const g of e){const _=Fg(g.constructor);_&&(Object.assign(c,_),Object.assign(f,_[rs]),Object.assign(d,_[Ud]))}return Vk(c,n),Wk(c,f),Hk(c,d),c[rs]=f,c[Ud]=d,e.length===0&&!Op(n,"_propTypes")&&(n._propTypes=f),c}function Vk(n,e){const t=$k(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function Hk(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const a of e[t])Op(this,a)||(this[a]=i);De.deprecated(s,e[t].join("/"))()}})}function Wk(n,e){const t={},i={};for(const s in e){const a=e[s],{name:l,value:c}=a;a.async&&(t[l]=c,i[l]=jk(l))}n[Kr]=t,n[Xs]={},Object.defineProperties(n,i)}function jk(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||$3(e)?this[Xs][n]=e:this[ts][n]=e},get(){if(this[ts]){if(n in this[ts])return this[ts][n]||this[Kr][n];if(n in this[Xs]){const e=this[hu]&&this[hu].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Kr][n]}}return this[Kr][n]}}}function Op(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function i2(n,e){return Op(n,e)&&n[e]}function $k(n){const e=n.componentName;return e||De.warn(`${n.name}.componentName not specified`)(),e||n.name}let Xk=0;class Vu{constructor(...e){this.props=Lk(this,e),this.id=this.props.id,this.count=Xk++}clone(e){const{props:t}=this,i={};for(const s in t[Kr])s in t[ts]?i[s]=t[ts][s]:s in t[Xs]&&(i[s]=t[Xs][s]);return new this.constructor({...t,...i,...e})}}Vu.componentName="Component";Vu.defaultProps={};const Yk=Object.freeze({});class qk{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Yk}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[hu]||this.component;const t=e[ts]||{},i=e[Xs]||e,s=e[Kr]||{};for(const a in t){const l=t[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l),t[a]=this.getAsyncProp(a)}for(const a in i){const l=i[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if($3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,s),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let a=[],l=0;for await(const c of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?a=f(c,a):a=a.concat(c),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:l,endRow:a.length}]}),l=a.length,this._setAsyncPropValue(e,a,s)}this._onResolve(e,a)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[rs];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Kk extends qk{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const Zk="layer.changeFlag",Qk="layer.initialize",Gk="layer.update",Jk="layer.finalize",e6="layer.matched",Fv=2**24-1,t6=Object.freeze([]),n6=$o(({oldViewport:n,viewport:e})=>n.equals(e));let Mn=new Uint8ClampedArray(0);const i6={data:{type:"data",value:t6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:a})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,a&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:a}});let c=l.contains(n);return!c&&!s&&(l.add({resourceId:n,data:qc(n,i),persistent:!1}),c=!0),c?l.subscribe({resourceId:n,onChange:f=>{var d;return(d=t.internalState)==null?void 0:d.reloadAsyncProp(e,f)},consumerId:t.id,requestId:e}):qc(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Le.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Zn extends Vu{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Lr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){It(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=T3(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,a,l]=m3(i,t.pixelProjectionMatrix);return e.length===2?[s,a]:[s,a,l]}unproject(e){return It(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){It(this.internalState);const i=this.internalState.viewport||this.context.viewport;return NP(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Le.DEFAULT||e===Le.LNGLAT||e===Le.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){It(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Mk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Lv(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Lv(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,a=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(a!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:f}=t.attributes,d=c||f;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var i,s,a,l;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(i=this.props).onError)!=null&&s.call(i,e)||(l=(a=this.context)==null?void 0:a.onError)==null||l.call(a,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!n6({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Mn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>Fv&&De.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Mn=ta.allocate(Mn,t,{size:4,copy:!0,maxCount:Math.max(t,Fv)});const s=Math.floor(Mn.length/4),a=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,a),Mn[l*4+0]=a[0],Mn[l*4+1]=a[1],Mn[l*4+2]=a[2],Mn[l*4+3]=0}e.value=Mn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){var c;if(!Object.keys(t).length)return;if(i){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),t=f.getAttributes()}const s=((c=e.userData)==null?void 0:c.excludeAttributes)||{},a={},l={};for(const f in t){if(s[f])continue;const d=t[f].getValue();for(const g in d){const _=d[g];_ instanceof Je?t[f].settings.isIndexed?e.setIndexBuffer(_):a[g]=_:_&&(l[g]=_)}}e.setAttributes(a),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,a=i||s,l=a&&t.attributes&&t.attributes[a.id];if(l&&l.value){const c=l.value,f=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const g=a.getVertexOffset(d);c[g]===f[0]&&c[g+1]===f[1]&&c[g+2]===f[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const a=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Mn.buffer&&(i.value=Mn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){It(!this.internalState),It(Number.isFinite(this.props.coordinateSystem)),zt(Qk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Kk({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(De.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new vk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){zt(e6,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(zt(Gk,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,a=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||a,this.props=l;try{const c=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const g of this.props.extensions)g.updateState.call(this,c,g);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==f[0];this._postUpdate(c,d)}finally{i.viewport=a,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){zt(Jk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const a=this.props,l=this.context;this.props=this.internalState.propsInTransition||a;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:c}=this.props,f=c&&c(i)||[0,0];l.device instanceof jr&&l.device.setParametersWebGL({polygonOffset:f});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof jr)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)}}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let a=!1;switch(s){case"dataChanged":const l=e[s],c=t[s];l&&Array.isArray(c)&&(t.dataChanged=Array.isArray(l)?c.concat(l):l,a=!0);default:t[s]||(t[s]=e[s],a=!0)}a&&zt(Zk,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const i=xk(e,t);if(i.updateTriggersChanged)for(const a in i.updateTriggersChanged)i.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(i.transitionsChanged)for(const a in i.transitionsChanged)this.internalState.uniformTransitions.add(a,t[a],e[a],(s=e.transitions)==null?void 0:s[a]);return this.setChangeFlags(i)}validateProps(){Tk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new pk(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,a=this.state.model;a!=null&&a.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:f}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==c||s.highlightColor!==f){const d={};Array.isArray(f)&&(d.highlightColor=f),(t||s.autoHighlight!==l||c!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Zn.defaultProps=i6;Zn.layerName="Layer";const s6="compositeLayer.renderLayers";class Hu extends Zn{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){var he;const{opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:d,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:y,positionFormat:b,modelMatrix:x,extensions:E,fetch:M,operation:N,_subLayerProps:V}=this.props,P={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:d,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:y,positionFormat:b,modelMatrix:x,extensions:E,fetch:M,operation:N},H=V&&e.id&&V[e.id],X=H&&H.updateTriggers,Z=e.id||"sublayer";if(H){const ue=this.props[rs],J=e.type?e.type._propTypes:{};for(const oe in H){const de=J[oe]||ue[oe];de&&de.type==="accessor"&&(H[oe]=this.getSubLayerAccessor(H[oe]))}}Object.assign(P,e,H),P.id=`${this.props.id}-${Z}`,P.updateTriggers={all:(he=this.props.updateTriggers)==null?void 0:he.all,...e.updateTriggers,...X};for(const ue of E){const J=ue.getSubLayerProps.call(this,ue);J&&Object.assign(P,J,{updateTriggers:Object.assign(P.updateTriggers,J.updateTriggers)})}return P}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const a=this.renderLayers();i=Lu(a,Boolean),this.internalState.subLayers=i}zt(s6,this,s,i);for(const a of i)a.parent=this}}Hu.layerName="CompositeLayer";const Tc=Math.PI/180,zv=180/Math.PI,Fc=6370972,$r=256;function r6(){const n=$r/Fc,e=Math.PI/180*$r;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class a6 extends la{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:s=.5,farZMultiplier:a=1,resolution:l=10}=e;let{latitude:c=0,height:f,altitude:d=1.5,fovy:g}=e;c=Math.max(Math.min(c,wg),-85.051129),f=f||1,g?d=vp(g):g=Bo(d);const _=1/Math.PI/Math.cos(c*Math.PI/180),y=Math.pow(2,i)*_,b=e.nearZ??s,x=e.farZ??(d+$r*2*y/f)*a,E=new $t().lookAt({eye:[0,-d,0],up:[0,0,1]});E.rotateX(c*Tc),E.rotateZ(-t*Tc),E.scale(y/f),super({...e,height:f,viewMatrix:E,longitude:t,latitude:c,zoom:i,distanceScales:r6(),fovy:g,focalDistance:d,near:b,far:x}),this.scale=y,this.latitude=c,this.longitude=t,this.resolution=l}get projectionMode(){return Pn.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),a=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return a[0]<this.longitude&&(a[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],a[0],s[0],l[0]),Math.min(i[1],a[1],s[1],l[1]),Math.max(i[0],a[0],s[0],l[0]),Math.max(i[1],a[1],s[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,c=t?a:this.height-a,{pixelUnprojectionMatrix:f}=this;let d;if(Number.isFinite(l))d=Wd(f,[s,c,l,1]);else{const b=Wd(f,[s,c,-1,1]),x=Wd(f,[s,c,1,1]),E=((i||0)/Fc+1)*$r,M=wd(YT([],b,x)),N=wd(b),V=wd(x),H=4*((4*N*V-(M-N-V)**2)/16)/M,X=Math.sqrt(N-H),Z=Math.sqrt(Math.max(0,E*E-H)),he=(X-Z)/Math.sqrt(M);d=iM([],b,x,he)}const[g,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[g,_,y]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){const[t,i,s=0]=e,a=t*Tc,l=i*Tc,c=Math.cos(l),f=(s/Fc+1)*$r;return[Math.sin(a)*c*f,-Math.cos(a)*c*f,Math.sin(l)*f]}unprojectPosition(e){const[t,i,s]=e,a=qT(e),l=Math.asin(s/a),f=Math.atan2(t,-i)*zv,d=l*zv,g=(a/$r-1)*Fc;return[f,d,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function Wd(n,e){const t=ra([],e,n);return mp(t,t,1/t[3]),t}class s2{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=ta,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:s,geometryBuffer:a,positionFormat:l,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=a&&a.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,a&&(It(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),f||(i.vertexPositions=a)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(const d of c)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?X3(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:s,_attributeDefs:a,typedArrayManager:l}=this;for(const c in a)if(c in s)l.release(i[c]),i[c]=null;else{const f=a[c];f.copy=t,i[c]=l.allocate(i[c],e,f)}}_forEachGeometry(e,t,i){const{data:s,getGeometry:a}=this,{iterable:l,objectInfo:c}=zu(s,t,i);for(const f of l){c.index++;const d=a?a(f,c):null;e(d,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this;const{data:a,geometryBuffer:l}=this,{startRow:c=0,endRow:f=1/0}=e||{},d={};if(e||(t=[0],i=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const b=_&&this.normalizeGeometry(_);d[y]=b,i[y+1]=i[y]+(b?this.getGeometrySize(b):0)},c,f),s=i[i.length-1];else if(i=a.startIndices,s=i[a.length]||0,ArrayBuffer.isView(l))s=s||l.length/this.positionSize;else if(l instanceof Je){const _=this.positionSize*4;s=s||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;s=s||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;s=s||_.length/y}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;const g={};this._forEachGeometry((_,y)=>{const b=d[y]||_;g.vertexStart=i[y],g.indexStart=t[y];const x=y<i.length-1?i[y+1]:s;g.geometrySize=x-i[y],g.geometryIndex=y,this.updateGeometryAttributes(b,g)},c,f),this.vertexCount=t[t.length-1]}}const o6=typeof window<"u"?it.useLayoutEffect:it.useEffect;function pu(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const l6={position:"absolute",zIndex:-1};function r2(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>r2(t,e));if(Wu(n)){if(c6(n))return e.style=l6,it.cloneElement(n,e);if(u6(n))return it.cloneElement(n,e)}return n}function Wu(n){return n&&typeof n=="object"&&"type"in n||!1}function c6(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function u6(n){const e=n.type;return e&&e.deckGLViewProps}function zg(n){if(typeof n=="function")return it.createElement(ia,{},n);if(Array.isArray(n))return n.map(zg);if(Wu(n)){if(n.type===it.Fragment)return zg(n.props.children);if(pu(n.type,ia))return n}return n}function f6({children:n,layers:e=[],views:t=null}){const i=[],s=[],a={};return it.Children.forEach(zg(n),l=>{if(Wu(l)){const c=l.type;if(pu(c,Zn)){const f=h6(c,l.props);s.push(f)}else i.push(l);if(pu(c,ia)&&c!==ia&&l.props.id){const f=new c(l.props);a[f.id]=f}}else l&&i.push(l)}),Object.keys(a).length>0&&(Array.isArray(t)?t.forEach(l=>{a[l.id]=l}):t&&(a[t.id]=t),t=Object.values(a)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function h6(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const d6=it.createContext();function g6({children:n,deck:e,ContextProvider:t=d6.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},a=i.views[0].id;for(const l of n){let c=a,f=l;Wu(l)&&pu(l.type,ia)&&(c=l.props.id||a,f=l.props.children);const d=i.getViewport(c),g=i.getViewState(c);if(d){g.padding=d.padding;const{x:_,y,width:b,height:x}=d;f=r2(f,{x:_,y,width:b,height:x,viewport:d,viewState:g}),s[c]||(s[c]={viewport:d,children:[]}),s[c].children.push(f)}}return Object.keys(s).map(l=>{const{viewport:c,children:f}=s[l],{x:d,y:g,width:_,height:y}=c,b={position:"absolute",left:d,top:g,width:_,height:y},x=`view-${l}`,E=it.createElement("div",{key:x,id:x,style:b},...f),M={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:V=>{V.viewId=l,e._onViewStateChange(V)},widgets:[]},N=`view-${l}-context`;return it.createElement(t,{key:N,value:M},E)})}const p6={mixBlendMode:null};function _6({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const a in t)a in p6?s[a]=t[a]:i[a]=t[a];return{containerStyle:i,canvasStyle:s}}function m6(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function a2(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function y6(n,e,t){var s,a,l;const i=new e({...t,_customRender:((l=(a=(s=t.deviceProps)==null?void 0:s.adapters)==null?void 0:a[0])==null?void 0:l.type)==="webgpu"?void 0:c=>{n.redrawReason=c;const f=i.getViewports();n.lastRenderedViewports!==f?n.forceUpdate():a2(n)}});return i}function b6(n,e){const[t,i]=it.useState(0),a=it.useRef({control:null,version:t,forceUpdate:()=>i(X=>X+1)}).current,l=it.useRef(null),c=it.useRef(null),f=it.useMemo(()=>f6(n),[n.layers,n.views,n.children]);let d=!0;const g=X=>{var Z;return d&&n.viewState?(a.viewStateUpdateRequested=X,null):(a.viewStateUpdateRequested=null,(Z=n.onViewStateChange)==null?void 0:Z.call(n,X))},_=X=>{var Z;d?a.interactionStateUpdateRequested=X:(a.interactionStateUpdateRequested=null,(Z=n.onInteractionStateChange)==null||Z.call(n,X))},y=it.useMemo(()=>{const X={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:g,onInteractionStateChange:_};return delete X._customRender,a.deck&&a.deck.setProps(X),X},[n]);it.useEffect(()=>{const X=n.Deck||Mp;return a.deck=y6(a,X,{...y,parent:l.current,canvas:c.current}),()=>{var Z;return(Z=a.deck)==null?void 0:Z.finalize()}},[]),o6(()=>{a2(a);const{viewStateUpdateRequested:X,interactionStateUpdateRequested:Z}=a;X&&g(X),Z&&_(Z)}),it.useImperativeHandle(e,()=>m6(a),[]);const b=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:x,width:E="100%",height:M="100%",id:N,style:V}=n,{containerStyle:P,canvasStyle:H}=it.useMemo(()=>_6({width:E,height:M,style:V}),[E,M,V]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===b||a.version!==t){a.lastRenderedViewports=b,a.version=t;const X=g6({children:f.children,deck:a.deck,ContextProvider:x}),Z=it.createElement("canvas",{key:"canvas",id:N||"deckgl-overlay",ref:c,style:H});a.control=it.createElement("div",{id:`${N||"deckgl"}-wrapper`,ref:l,style:P},[Z,X])}return d=!1,a.control}const v6=it.forwardRef(b6),T6=new Uint32Array([0,2,1,0,3,2]),x6=new Float32Array([0,1,0,0,1,0,1,1]);function A6(n,e){if(!e)return S6(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),i=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),s=Math.ceil(t/e)+1,a=Math.ceil(i/e)+1,l=(s-1)*(a-1)*6,c=new Uint32Array(l),f=new Float32Array(s*a*2),d=new Float64Array(s*a*3);let g=0,_=0;for(let y=0;y<s;y++){const b=y/(s-1);for(let x=0;x<a;x++){const E=x/(a-1),M=w6(n,b,E);d[g*3+0]=M[0],d[g*3+1]=M[1],d[g*3+2]=M[2]||0,f[g*2+0]=b,f[g*2+1]=1-E,y>0&&x>0&&(c[_++]=g-a,c[_++]=g-a-1,c[_++]=g-1,c[_++]=g-a,c[_++]=g-1,c[_++]=g),g++}}return{vertexCount:l,positions:d,indices:c,texCoords:f}}function S6(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:T6,texCoords:x6}}function w6(n,e,t){return Ls(Ls(n[0],n[1],t),Ls(n[3],n[2],t),e)}const Vv=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,E6={name:"bitmap",vs:Vv,fs:Vv,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},R6=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,C6=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,M6=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${C6}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,O6={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Le.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Ip extends Zn{getShaders(){return super.getShaders({vs:R6,fs:M6,modules:[aa,oa,E6]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){var a;const s=this.getAttributeManager();if(i.extensionsChanged&&((a=this.state.model)==null||a.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==t.bounds){const l=this.state.mesh,c=this._createMesh();this.state.model.setVertexCount(c.vertexCount);for(const f in c)l&&l[f]!==c[f]&&s.invalidate(f);this.setState({mesh:c,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;const{width:s,height:a}=t;i.index=0;const l=I6(i.color);return i.bitmap={size:{width:s,height:a},uv:l,pixel:[Math.floor(l[0]*s),Math.floor(l[1]*a)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return Hv(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),A6(t,this.context.viewport.resolution)}_getModel(){return new vn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:i,coordinateConversion:s,bounds:a,disablePicking:l}=this.state,{image:c,desaturate:f,transparentColor:d,tintColor:g}=this.props;if(!(t.picking.isActive&&l)&&c&&i){const _={bitmapTexture:c,bounds:a,coordinateConversion:s,desaturate:f,tintColor:g.slice(0,3).map(y=>y/255),transparentColor:d.map(y=>y/255)};i.shaderInputs.setProps({bitmap:_}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=Le;let{_imageCoordinateSystem:s}=this.props;if(s!==i){const{bounds:a}=this.props;if(!Hv(a))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const l=this.context.viewport.resolution?e:t;if(s=s===e?e:t,s===e&&l===t)return{coordinateConversion:-1,bounds:a};if(s===t&&l===e){const c=os([a[0],a[1]]),f=os([a[2],a[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],f[0],f[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Ip.layerName="BitmapLayer";Ip.defaultProps=O6;function I6(n){const[e,t,i]=n,s=(i&240)/256,a=(i&15)/16;return[(e+a)/256,(t+s)/256]}function Hv(n){return Number.isFinite(n[0])}const Wv=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,P6={name:"icon",vs:Wv,fs:Wv,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},N6=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,D6=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,k6=1024,B6=4,jv=()=>{},$v={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},U6={x:0,y:0,width:0,height:0};function L6(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function F6(n,e,t,i){const s=Math.min(t/e.width,i/e.height),a=Math.floor(e.width*s),l=Math.floor(e.height*s);return s===1?{image:e,width:a,height:l}:(n.canvas.height=l,n.canvas.width=a,n.clearRect(0,0,a,l),n.drawImage(e,0,0,e.width,e.height,0,0,a,l),{image:n.canvas,width:a,height:l})}function Lo(n){return n&&(n.id||n.url)}function z6(n,e,t,i){const{width:s,height:a,device:l}=n,c=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipmaps:!0}),f=l.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:n,destinationTexture:c,width:s,height:a}),f.finish(),n.destroy(),c}function Xv(n,e,t){for(let i=0;i<e.length;i++){const{icon:s,xOffset:a}=e[i],l=Lo(s);n[l]={...s,x:a,y:t}}}function V6({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:a=0,canvasWidth:l}){let c=[];for(let f=0;f<n.length;f++){const d=n[f],g=Lo(d);if(!t[g]){const{height:_,width:y}=d;i+y+e>l&&(Xv(t,c,s),i=0,s=a+s+e,a=0,c=[]),c.push({icon:d,xOffset:i}),i=i+y+e,a=Math.max(a,_)}}return c.length>0&&Xv(t,c,s),{mapping:t,rowHeight:a,xOffset:i,yOffset:s,canvasWidth:l,canvasHeight:L6(a+s+e)}}function H6(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:s,objectInfo:a}=zu(n);for(const l of s){a.index++;const c=e(l,a),f=Lo(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[f]&&(!t[f]||c.url!==t[f].url)&&(i[f]={...c,source:l,sourceIndex:a.index})}return i}class W6{constructor(e,{onUpdate:t=jv,onError:i=jv}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=B6,this._canvasWidth=k6,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Lo(e):e;return this._mapping[t]||U6}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:a}){var l;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i&&((l=this._texture)==null||l.delete(),this._texture=null,this._externalTexture=i),a&&(this._samplerParameters=a)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(H6(e,t,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:a,yOffset:l,rowHeight:c,canvasHeight:f}=V6({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=s,this._xOffset=a,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||$v,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=z6(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||$v)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,qc(i.url,this._loadOptions).then(s=>{var x;const a=Lo(i),l=this._mapping[a],{x:c,y:f,width:d,height:g}=l,{image:_,width:y,height:b}=F6(t,s,d,g);(x=this._texture)==null||x.copyExternalImage({image:_,x:c+(d-y)/2,y:f+(g-b)/2,width:y,height:b}),l.width=y,l.height=b,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const o2=[0,0,0,255],j6={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:o2},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class ju extends Zn{getShaders(){return super.getShaders({vs:N6,fs:D6,modules:[aa,oa,P6]})}initializeState(){this.state={iconManager:new W6(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:o2},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var b;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,a=this.getAttributeManager(),{iconAtlas:l,iconMapping:c,data:f,getIcon:d,textureParameters:g}=t,{iconManager:_}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?c:null,textureParameters:g}),y?i.iconMapping!==t.iconMapping&&a.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&_.packIcons(f,d),s.extensionsChanged&&((b=this.state.model)==null||b.destroy(),this.state.model=this._getModel(),a.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:a,billboard:l,alphaCutoff:c}=this.props,{iconManager:f}=this.state,d=f.getTexture();if(d){const g=this.state.model,_={iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:$s[a],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,billboard:l,alphaCutoff:c};g.shaderInputs.setProps({icon:_}),g.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new vn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new na({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const t=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;t?t(e):De.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:s=t/2,anchorY:a=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-a]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:s,height:a}=this.state.iconManager.getIconMapping(e);return[t,i,s,a]}}ju.defaultProps=j6;ju.layerName="IconLayer";const Yv=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,$6={name:"scatterplot",vs:Yv,fs:Yv,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},X6=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Y6=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qv=[0,0,0,255],q6={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:qv},getLineColor:{type:"accessor",value:qv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Pp extends Zn{getShaders(){return super.getShaders({vs:X6,fs:Y6,modules:[aa,oa,$6]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,stroked:l,filled:c,billboard:f,antialiasing:d,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,x={stroked:l,filled:c,billboard:f,antialiasing:d,radiusUnits:$s[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,lineWidthUnits:$s[g],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b},E=this.state.model;E.shaderInputs.setProps({scatterplot:x}),E.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new vn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new na({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Pp.defaultProps=q6;Pp.layerName="ScatterplotLayer";const l2={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function c2(n,e,t={}){return K6(n,t)!==e?(Q6(n,t),!0):!1}function K6(n,e={}){return Math.sign(Z6(n,e))}const Kv={x:0,y:1,z:2};function Z6(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,a=e.size||2;let l=0;const c=Kv[s[0]],f=Kv[s[1]];for(let d=t,g=i-a;d<i;d+=a)l+=(n[d+c]-n[g+c])*(n[d+f]+n[g+f]),g=d;return l/2}function Q6(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,a=(i-t)/s,l=Math.floor(a/2);for(let c=0;c<l;++c){const f=t+c*s,d=t+(a-1-c)*s;for(let g=0;g<s;++g){const _=n[f+g];n[f+g]=n[d+g],n[d+g]=_}}}function kn(n,e){const t=e.length,i=n.length;if(i>0){let s=!0;for(let a=0;a<t;a++)if(n[i-t+a]!==e[a]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function Vg(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function Fo(n,e,t,i,s=[]){const a=i+e*t;for(let l=0;l<t;l++)s[l]=n[a+l];return s}function Hg(n,e,t,i,s=[]){let a,l;if(t&8)a=(i[3]-n[1])/(e[1]-n[1]),l=3;else if(t&4)a=(i[1]-n[1])/(e[1]-n[1]),l=1;else if(t&2)a=(i[2]-n[0])/(e[0]-n[0]),l=2;else if(t&1)a=(i[0]-n[0])/(e[0]-n[0]),l=0;else return null;for(let c=0;c<n.length;c++)s[c]=(l&1)===c?i[l]:a*(e[c]-n[c])+n[c];return s}function zc(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function u2(n,e){const{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:a=[0,0],startIndex:l=0,endIndex:c=n.length}=e||{},f=(c-l)/t;let d=[];const g=[d],_=Fo(n,0,t,l);let y,b;const x=h2(_,s,a,[]),E=[];kn(d,_);for(let M=1;M<f;M++){for(y=Fo(n,M,t,l,y),b=zc(y,x);b;){Hg(_,y,b,x,E);const N=zc(E,x);N&&(Hg(_,E,N,x,E),b=N),kn(d,E),Vg(_,E),J6(x,s,b),i&&d.length>t&&(d=[],g.push(d),kn(d,_)),b=zc(y,x)}kn(d,y),Vg(_,y)}return i?g:g[0]}const Zv=0,G6=1;function f2(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:a=[0,0],edgeTypes:l=!1}=t||{},c=[],f=[{pos:n,types:l?new Array(n.length/i).fill(G6):null,holes:e||[]}],d=[[],[]];let g=[];for(;f.length;){const{pos:_,types:y,holes:b}=f.shift();eB(_,i,b[0]||_.length,d),g=h2(d[0],s,a,g);const x=zc(d[1],g);if(x){let E=Qv(_,y,i,0,b[0]||_.length,g,x);const M={pos:E[0].pos,types:E[0].types,holes:[]},N={pos:E[1].pos,types:E[1].types,holes:[]};f.push(M,N);for(let V=0;V<b.length;V++)E=Qv(_,y,i,b[V],b[V+1]||_.length,g,x),E[0]&&(M.holes.push(M.pos.length),M.pos=xc(M.pos,E[0].pos),l&&(M.types=xc(M.types,E[0].types))),E[1]&&(N.holes.push(N.pos.length),N.pos=xc(N.pos,E[1].pos),l&&(N.types=xc(N.types,E[1].types)))}else{const E={positions:_};l&&(E.edgeTypes=y),b.length&&(E.holeIndices=b),c.push(E)}}return c}function Qv(n,e,t,i,s,a,l){const c=(s-i)/t,f=[],d=[],g=[],_=[],y=[];let b,x,E;const M=Fo(n,c-1,t,i);let N=Math.sign(l&8?M[1]-a[3]:M[0]-a[2]),V=e&&e[c-1],P=0,H=0;for(let X=0;X<c;X++)b=Fo(n,X,t,i,b),x=Math.sign(l&8?b[1]-a[3]:b[0]-a[2]),E=e&&e[i/t+X],x&&N&&N!==x&&(Hg(M,b,l,a,y),kn(f,y)&&g.push(V),kn(d,y)&&_.push(V)),x<=0?(kn(f,b)&&g.push(E),P-=x):g.length&&(g[g.length-1]=Zv),x>=0?(kn(d,b)&&_.push(E),H+=x):_.length&&(_[_.length-1]=Zv),Vg(M,b),N=x,V=E;return[P?{pos:f,types:e&&g}:null,H?{pos:d,types:e&&_}:null]}function h2(n,e,t,i){const s=Math.floor((n[0]-t[0])/e)*e+t[0],a=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=a,i[2]=s+e,i[3]=a+e,i}function J6(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function eB(n,e,t,i){let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let f=0;f<t;f+=e){const d=n[f],g=n[f+1];s=d<s?d:s,a=d>a?d:a,l=g<l?g:l,c=g>c?g:c}return i[0][0]=s,i[0][1]=l,i[1][0]=a,i[1][1]=c,i}function xc(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const tB=85.051129;function nB(n,e){const{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:a=!0}=e||{},l=n.slice(i,s);d2(l,t,0,s-i);const c=u2(l,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const f of c)g2(f,t);return c}function iB(n,e=null,t){const{size:i=2,normalize:s=!0,edgeTypes:a=!1}=t||{};e=e||[];const l=[],c=[];let f=0,d=0;for(let _=0;_<=e.length;_++){const y=e[_]||n.length,b=d,x=sB(n,i,f,y);for(let E=x;E<y;E++)l[d++]=n[E];for(let E=f;E<x;E++)l[d++]=n[E];d2(l,i,b,d),rB(l,i,b,d,t==null?void 0:t.maxLatitude),f=y,c[_]=d}c.pop();const g=f2(l,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(s)for(const _ of g)g2(_.positions,i);return g}function sB(n,e,t,i){let s=-1,a=-1;for(let l=t+1;l<i;l+=e){const c=Math.abs(n[l]);c>s&&(s=c,a=l-1)}return a}function rB(n,e,t,i,s=tB){const a=n[t],l=n[i-e];if(Math.abs(a-l)>180){const c=Fo(n,0,e,t);c[0]+=Math.round((l-a)/360)*360,kn(n,c),c[1]=Math.sign(c[1])*s,kn(n,c),c[0]=a,kn(n,c)}}function d2(n,e,t,i){let s=n[0],a;for(let l=t;l<i;l+=e){a=n[l];const c=a-s;(c>180||c<-180)&&(a-=Math.round(c/360)*360),n[l]=s=a}}function g2(n,e){let t;const i=n.length/e;for(let a=0;a<i&&(t=n[a*e],(t+180)%360===0);a++);const s=-Math.round(t/360)*360;if(s!==0)for(let a=0;a<i;a++)n[a*e]+=s}function aB(n,e,t,i){let s;if(Array.isArray(n[0])){const a=n.length*e;s=new Array(a);for(let l=0;l<n.length;l++)for(let c=0;c<e;c++)s[l*e+c]=n[l][c]||0}else s=n;return t?u2(s,{size:e,gridResolution:t}):i?nB(s,{size:e}):s}const oB=1,lB=2,jd=4;class cB extends s2{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?aB(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Gv(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&Gv(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:l}=t;i.fill(0,a,a+l),s?(i[a]=jd,i[a+l-2]=jd):(i[a]+=oB,i[a+l-2]+=lB),i[a+l-1]=jd}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:a}=t,l=new Array(3);for(let c=s,f=0;f<a;c++,f++)this.getPointOnPath(e,f,l),i[c*3]=l[0],i[c*3+1]=l[1],i[c*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const a=t*s;return i[0]=e[a],i[1]=e[a+1],i[2]=s===3&&e[a+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function Gv(n){return Array.isArray(n[0])}const Jv=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,uB={name:"path",vs:Jv,fs:Jv,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},fB=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hB=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,p2=[0,0,0,255],dB={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:p2},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},$d={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class $u extends Zn{getShaders(){return super.getShaders({vs:fB,fs:hB,modules:[aa,oa,uB]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:$d,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:$d,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:$d,defaultValue:p2},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:a})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,a)}}),this.setState({pathTesselator:new cB({fp64:this.use64bitPositions()})})}updateState(e){var l;super.updateState(e);const{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,f=t.data.attributes||{};c.updateGeometry({data:t.data,geometryBuffer:f.getPath,buffers:f,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&((l=this.state.model)==null||l.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(a=>a.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:s,miterLimit:a,widthUnits:l,widthScale:c,widthMinPixels:f,widthMaxPixels:d}=this.props,g=this.state.model,_={jointType:Number(t),capType:Number(i),billboard:s,widthUnits:$s[l],widthScale:c,miterLimit:a,widthMinPixels:f,widthMaxPixels:d};g.shaderInputs.setProps({path:_}),g.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new vn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new na({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}$u.defaultProps=dB;$u.layerName="PathLayer";var Ac={exports:{}},e1;function gB(){if(e1)return Ac.exports;e1=1,Ac.exports=n,Ac.exports.default=n;function n(R,D,I){I=I||2;var Q=D&&D.length,S=Q?D[0]*I:R.length,B=e(R,0,S,I,!0),K=[];if(!B||B.next===B.prev)return K;var ee,ie,le,pe,Re,_e,Ie;if(Q&&(B=f(R,D,B,I)),R.length>80*I){ee=le=R[0],ie=pe=R[1];for(var Te=I;Te<S;Te+=I)Re=R[Te],_e=R[Te+1],Re<ee&&(ee=Re),_e<ie&&(ie=_e),Re>le&&(le=Re),_e>pe&&(pe=_e);Ie=Math.max(le-ee,pe-ie),Ie=Ie!==0?32767/Ie:0}return i(B,K,I,ee,ie,Ie,0),K}function e(R,D,I,Q,S){var B,K;if(S===We(R,D,I,Q)>0)for(B=D;B<I;B+=Q)K=ve(B,R[B],R[B+1],K);else for(B=I-Q;B>=D;B-=Q)K=ve(B,R[B],R[B+1],K);return K&&H(K,K.next)&&(be(K),K=K.next),K}function t(R,D){if(!R)return R;D||(D=R);var I=R,Q;do if(Q=!1,!I.steiner&&(H(I,I.next)||P(I.prev,I,I.next)===0)){if(be(I),I=D=I.prev,I===I.next)break;Q=!0}else I=I.next;while(Q||I!==D);return D}function i(R,D,I,Q,S,B,K){if(R){!K&&B&&b(R,Q,S,B);for(var ee=R,ie,le;R.prev!==R.next;){if(ie=R.prev,le=R.next,B?a(R,Q,S,B):s(R)){D.push(ie.i/I|0),D.push(R.i/I|0),D.push(le.i/I|0),be(R),R=le.next,ee=le.next;continue}if(R=le,R===ee){K?K===1?(R=l(t(R),D,I),i(R,D,I,Q,S,B,2)):K===2&&c(R,D,I,Q,S,B):i(t(R),D,I,Q,S,B,1);break}}}}function s(R){var D=R.prev,I=R,Q=R.next;if(P(D,I,Q)>=0)return!1;for(var S=D.x,B=I.x,K=Q.x,ee=D.y,ie=I.y,le=Q.y,pe=S<B?S<K?S:K:B<K?B:K,Re=ee<ie?ee<le?ee:le:ie<le?ie:le,_e=S>B?S>K?S:K:B>K?B:K,Ie=ee>ie?ee>le?ee:le:ie>le?ie:le,Te=Q.next;Te!==D;){if(Te.x>=pe&&Te.x<=_e&&Te.y>=Re&&Te.y<=Ie&&N(S,ee,B,ie,K,le,Te.x,Te.y)&&P(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function a(R,D,I,Q){var S=R.prev,B=R,K=R.next;if(P(S,B,K)>=0)return!1;for(var ee=S.x,ie=B.x,le=K.x,pe=S.y,Re=B.y,_e=K.y,Ie=ee<ie?ee<le?ee:le:ie<le?ie:le,Te=pe<Re?pe<_e?pe:_e:Re<_e?Re:_e,Nt=ee>ie?ee>le?ee:le:ie>le?ie:le,An=pe>Re?pe>_e?pe:_e:Re>_e?Re:_e,Sn=E(Ie,Te,D,I,Q),cs=E(Nt,An,D,I,Q),ke=R.prevZ,Pe=R.nextZ;ke&&ke.z>=Sn&&Pe&&Pe.z<=cs;){if(ke.x>=Ie&&ke.x<=Nt&&ke.y>=Te&&ke.y<=An&&ke!==S&&ke!==K&&N(ee,pe,ie,Re,le,_e,ke.x,ke.y)&&P(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Pe.x>=Ie&&Pe.x<=Nt&&Pe.y>=Te&&Pe.y<=An&&Pe!==S&&Pe!==K&&N(ee,pe,ie,Re,le,_e,Pe.x,Pe.y)&&P(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;ke&&ke.z>=Sn;){if(ke.x>=Ie&&ke.x<=Nt&&ke.y>=Te&&ke.y<=An&&ke!==S&&ke!==K&&N(ee,pe,ie,Re,le,_e,ke.x,ke.y)&&P(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Pe&&Pe.z<=cs;){if(Pe.x>=Ie&&Pe.x<=Nt&&Pe.y>=Te&&Pe.y<=An&&Pe!==S&&Pe!==K&&N(ee,pe,ie,Re,le,_e,Pe.x,Pe.y)&&P(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function l(R,D,I){var Q=R;do{var S=Q.prev,B=Q.next.next;!H(S,B)&&X(S,Q,Q.next,B)&&J(S,B)&&J(B,S)&&(D.push(S.i/I|0),D.push(Q.i/I|0),D.push(B.i/I|0),be(Q),be(Q.next),Q=R=B),Q=Q.next}while(Q!==R);return t(Q)}function c(R,D,I,Q,S,B){var K=R;do{for(var ee=K.next.next;ee!==K.prev;){if(K.i!==ee.i&&V(K,ee)){var ie=de(K,ee);K=t(K,K.next),ie=t(ie,ie.next),i(K,D,I,Q,S,B,0),i(ie,D,I,Q,S,B,0);return}ee=ee.next}K=K.next}while(K!==R)}function f(R,D,I,Q){var S=[],B,K,ee,ie,le;for(B=0,K=D.length;B<K;B++)ee=D[B]*Q,ie=B<K-1?D[B+1]*Q:R.length,le=e(R,ee,ie,Q,!1),le===le.next&&(le.steiner=!0),S.push(M(le));for(S.sort(d),B=0;B<S.length;B++)I=g(S[B],I);return I}function d(R,D){return R.x-D.x}function g(R,D){var I=_(R,D);if(!I)return D;var Q=de(I,R);return t(Q,Q.next),t(I,I.next)}function _(R,D){var I=D,Q=R.x,S=R.y,B=-1/0,K;do{if(S<=I.y&&S>=I.next.y&&I.next.y!==I.y){var ee=I.x+(S-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(ee<=Q&&ee>B&&(B=ee,K=I.x<I.next.x?I:I.next,ee===Q))return K}I=I.next}while(I!==D);if(!K)return null;var ie=K,le=K.x,pe=K.y,Re=1/0,_e;I=K;do Q>=I.x&&I.x>=le&&Q!==I.x&&N(S<pe?Q:B,S,le,pe,S<pe?B:Q,S,I.x,I.y)&&(_e=Math.abs(S-I.y)/(Q-I.x),J(I,R)&&(_e<Re||_e===Re&&(I.x>K.x||I.x===K.x&&y(K,I)))&&(K=I,Re=_e)),I=I.next;while(I!==ie);return K}function y(R,D){return P(R.prev,R,D.prev)<0&&P(D.next,R,R.next)<0}function b(R,D,I,Q){var S=R;do S.z===0&&(S.z=E(S.x,S.y,D,I,Q)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==R);S.prevZ.nextZ=null,S.prevZ=null,x(S)}function x(R){var D,I,Q,S,B,K,ee,ie,le=1;do{for(I=R,R=null,B=null,K=0;I;){for(K++,Q=I,ee=0,D=0;D<le&&(ee++,Q=Q.nextZ,!!Q);D++);for(ie=le;ee>0||ie>0&&Q;)ee!==0&&(ie===0||!Q||I.z<=Q.z)?(S=I,I=I.nextZ,ee--):(S=Q,Q=Q.nextZ,ie--),B?B.nextZ=S:R=S,S.prevZ=B,B=S;I=Q}B.nextZ=null,le*=2}while(K>1);return R}function E(R,D,I,Q,S){return R=(R-I)*S|0,D=(D-Q)*S|0,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,D=(D|D<<8)&16711935,D=(D|D<<4)&252645135,D=(D|D<<2)&858993459,D=(D|D<<1)&1431655765,R|D<<1}function M(R){var D=R,I=R;do(D.x<I.x||D.x===I.x&&D.y<I.y)&&(I=D),D=D.next;while(D!==R);return I}function N(R,D,I,Q,S,B,K,ee){return(S-K)*(D-ee)>=(R-K)*(B-ee)&&(R-K)*(Q-ee)>=(I-K)*(D-ee)&&(I-K)*(B-ee)>=(S-K)*(Q-ee)}function V(R,D){return R.next.i!==D.i&&R.prev.i!==D.i&&!ue(R,D)&&(J(R,D)&&J(D,R)&&oe(R,D)&&(P(R.prev,R,D.prev)||P(R,D.prev,D))||H(R,D)&&P(R.prev,R,R.next)>0&&P(D.prev,D,D.next)>0)}function P(R,D,I){return(D.y-R.y)*(I.x-D.x)-(D.x-R.x)*(I.y-D.y)}function H(R,D){return R.x===D.x&&R.y===D.y}function X(R,D,I,Q){var S=he(P(R,D,I)),B=he(P(R,D,Q)),K=he(P(I,Q,R)),ee=he(P(I,Q,D));return!!(S!==B&&K!==ee||S===0&&Z(R,I,D)||B===0&&Z(R,Q,D)||K===0&&Z(I,R,Q)||ee===0&&Z(I,D,Q))}function Z(R,D,I){return D.x<=Math.max(R.x,I.x)&&D.x>=Math.min(R.x,I.x)&&D.y<=Math.max(R.y,I.y)&&D.y>=Math.min(R.y,I.y)}function he(R){return R>0?1:R<0?-1:0}function ue(R,D){var I=R;do{if(I.i!==R.i&&I.next.i!==R.i&&I.i!==D.i&&I.next.i!==D.i&&X(I,I.next,R,D))return!0;I=I.next}while(I!==R);return!1}function J(R,D){return P(R.prev,R,R.next)<0?P(R,D,R.next)>=0&&P(R,R.prev,D)>=0:P(R,D,R.prev)<0||P(R,R.next,D)<0}function oe(R,D){var I=R,Q=!1,S=(R.x+D.x)/2,B=(R.y+D.y)/2;do I.y>B!=I.next.y>B&&I.next.y!==I.y&&S<(I.next.x-I.x)*(B-I.y)/(I.next.y-I.y)+I.x&&(Q=!Q),I=I.next;while(I!==R);return Q}function de(R,D){var I=new Se(R.i,R.x,R.y),Q=new Se(D.i,D.x,D.y),S=R.next,B=D.prev;return R.next=D,D.prev=R,I.next=S,S.prev=I,Q.next=I,I.prev=Q,B.next=Q,Q.prev=B,Q}function ve(R,D,I,Q){var S=new Se(R,D,I);return Q?(S.next=Q.next,S.prev=Q,Q.next.prev=S,Q.next=S):(S.prev=S,S.next=S),S}function be(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function Se(R,D,I){this.i=R,this.x=D,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(R,D,I,Q){var S=D&&D.length,B=S?D[0]*I:R.length,K=Math.abs(We(R,0,B,I));if(S)for(var ee=0,ie=D.length;ee<ie;ee++){var le=D[ee]*I,pe=ee<ie-1?D[ee+1]*I:R.length;K-=Math.abs(We(R,le,pe,I))}var Re=0;for(ee=0;ee<Q.length;ee+=3){var _e=Q[ee]*I,Ie=Q[ee+1]*I,Te=Q[ee+2]*I;Re+=Math.abs((R[_e]-R[Te])*(R[Ie+1]-R[_e+1])-(R[_e]-R[Ie])*(R[Te+1]-R[_e+1]))}return K===0&&Re===0?0:Math.abs((Re-K)/K)};function We(R,D,I,Q){for(var S=0,B=D,K=I-Q;B<I;B+=Q)S+=(R[K]-R[B])*(R[B+1]+R[K+1]),K=B;return S}return n.flatten=function(R){for(var D=R[0][0].length,I={vertices:[],holes:[],dimensions:D},Q=0,S=0;S<R.length;S++){for(var B=0;B<R[S].length;B++)for(var K=0;K<D;K++)I.vertices.push(R[S][B][K]);S>0&&(Q+=R[S-1].length,I.holes.push(Q))}return I},Ac.exports}var pB=gB();const _B=ZA(pB),Sc=l2.CLOCKWISE,t1=l2.COUNTER_CLOCKWISE,ns={};function mB(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function vo(n){return"positions"in n?n.positions:n}function Vc(n){return"holeIndices"in n?n.holeIndices:null}function yB(n){return Array.isArray(n[0])}function bB(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function vB(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function TB(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function n1(n,e,t,i,s){let a=e;const l=t.length;for(let c=0;c<l;c++)for(let f=0;f<i;f++)n[a++]=t[c][f]||0;if(!vB(t))for(let c=0;c<i;c++)n[a++]=t[0][c]||0;return ns.start=e,ns.end=a,ns.size=i,c2(n,s,ns),a}function i1(n,e,t,i,s=0,a,l){a=a||t.length;const c=a-s;if(c<=0)return e;let f=e;for(let d=0;d<c;d++)n[f++]=t[s+d];if(!TB(t,i,s,a))for(let d=0;d<i;d++)n[f++]=t[s+d];return ns.start=e,ns.end=f,ns.size=i,c2(n,l,ns),f}function xB(n,e){mB(n);const t=[],i=[];if("positions"in n){const{positions:s,holeIndices:a}=n;if(a){let l=0;for(let c=0;c<=a.length;c++)l=i1(t,l,s,e,a[c-1],a[c],c===0?Sc:t1),i.push(l);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!yB(n))return i1(t,0,n,e,0,t.length,Sc),t;if(!bB(n)){let s=0;for(const[a,l]of n.entries())s=n1(t,s,l,e,a===0?Sc:t1),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return n1(t,0,n,e,Sc),t}function Xd(n,e,t){const i=n.length/3;let s=0;for(let a=0;a<i;a++){const l=(a+1)%i;s+=n[a*3+e]*n[l*3+t],s-=n[l*3+e]*n[a*3+t]}return Math.abs(s/2)}function s1(n,e,t,i){const s=n.length/3;for(let a=0;a<s;a++){const l=a*3,c=n[l+0],f=n[l+1],d=n[l+2];n[l+e]=c,n[l+t]=f,n[l+i]=d}}function AB(n,e,t,i){let s=Vc(n);s&&(s=s.map(c=>c/e));let a=vo(n);const l=i&&e===3;if(t){const c=a.length;a=a.slice();const f=[];for(let d=0;d<c;d+=e){f[0]=a[d],f[1]=a[d+1],l&&(f[2]=a[d+2]);const g=t(f);a[d]=g[0],a[d+1]=g[1],l&&(a[d+2]=g[2])}}if(l){const c=Xd(a,0,1),f=Xd(a,0,2),d=Xd(a,1,2);if(!c&&!f&&!d)return[];c>f&&c>d||(f>d?(t||(a=a.slice()),s1(a,0,2,1)):(t||(a=a.slice()),s1(a,2,0,1)))}return _B(a,s,e)}class SB extends s2{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=xB(e,this.positionSize);return this.opts.resolution?f2(vo(t),Vc(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?iB(vo(t),Vc(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(r1(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return vo(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&r1(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){const{attributes:a,indexStarts:l,typedArrayManager:c}=this;let f=a.indices;if(!f||!e)return;let d=s;const g=AB(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=c.allocate(f,s+g.length,{copy:!0});for(let _=0;_<g.length;_++)f[d++]=g[_]+i;l[t+1]=s+g.length,a.indices=f}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:s},positionSize:a}=this;if(!s||!e)return;const l=vo(e);for(let c=t,f=0;f<i;c++,f++){const d=l[f*a],g=l[f*a+1],_=a>2?l[f*a+2]:0;s[c*3]=d,s[c*3+1]=g,s[c*3+2]=_}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:s}=this,a=this.attributes.vertexValid,l=e&&Vc(e);if(e&&e.edgeTypes?a.set(e.edgeTypes,t):a.fill(1,t,t+i),l)for(let c=0;c<l.length;c++)a[t+l[c]/s-1]=0;a[t+i-1]=0}}function r1(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const a1=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,wB={name:"solidPolygon",vs:a1,fs:a1,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},_2=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,EB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${_2}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,RB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${_2}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,CB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,_u=[0,0,0,255],MB={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:_u},getLineColor:{type:"accessor",value:_u},material:!0},wc={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Np extends Zn{getShaders(e){return super.getShaders({vs:e==="top"?EB:RB,fs:CB,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[aa,i3,oa,wB]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===Le.DEFAULT&&(t=Le.LNGLAT);let s;t===Le.LNGLAT&&(i?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new SB({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const a=this.getAttributeManager(),l=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:wc,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:wc,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:wc,accessor:"getFillColor",defaultValue:_u},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:wc,accessor:"getLineColor",defaultValue:_u},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:f,target:d})=>this.encodePickingColor(c&&c.__source?c.__source.index:f,d)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(a=>a.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:s,elevationScale:a}=this.props,{topModel:l,sideModel:c,wireframeModel:f,polygonTesselator:d}=this.state,g={extruded:!!t,elevationScale:a,isWireframe:!1};f&&s&&(f.setInstanceCount(d.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...g,isWireframe:!0}}),f.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(d.instanceCount-1),c.shaderInputs.setProps({solidPolygon:g}),c.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:g}),l.draw(this.context.renderPass))}updateState(e){var c;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:s}=e,a=this.getAttributeManager();(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&((c=this.state.models)==null||c.forEach(f=>f.destroy()),this.setState(this._getModels()),a.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:a}=this.state,l=e.data.attributes||{};a.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let s,a,l;if(t){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new vn(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});a=new vn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new na({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new vn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new na({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[a,l,s].filter(Boolean),topModel:s,sideModel:a,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Np.defaultProps=MB;Np.layerName="SolidPolygonLayer";function OB({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:s=0,endRow:a=1/0}=t,l=n.length;let c=l,f=l;for(let y=0;y<l;y++){const b=e(n[y]);if(c>y&&b>=s&&(c=y),b>=a){f=y;break}}let d=c;const _=f-c!==i.length?n.slice(f):void 0;for(let y=0;y<i.length;y++)n[d++]=i[y];if(_){for(let y=0;y<_.length;y++)n[d++]=_[y];n.length=d}return{startRow:c,endRow:c+i.length}}function IB(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?PB(n,i,t):null}function PB(n,e,t){const i={properties:{...n.properties[e]}};for(const s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function NB(n,e){const t={points:null,lines:null,polygons:null};for(const i in t){const s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*4);const a=[];for(let l=0;l<s.length;l++)e(s[l],a),t[i][l*4+0]=a[0],t[i][l*4+1]=a[1],t[i][l*4+2]=a[2],t[i][l*4+3]=255}return t}const o1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,DB={name:"sdf",vs:o1,fs:o1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},kB=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yd=192/256,l1=[],BB={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Dp extends ju{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,DB],fs:kB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;let{outlineColor:s}=t;s!==i.outlineColor&&(s=s.map(a=>a/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&De.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:a}=this.state,l=s?Math.max(i,Yd*(1-s)):-1,c=this.state.model,f={buffer:Yd,outlineBuffer:l,gamma:i,enabled:!!t,outlineColor:a};if(c.shaderInputs.setProps({sdf:f}),super.draw(e),t&&s){const{iconManager:d}=this.state;d.getTexture()&&(c.shaderInputs.setProps({sdf:{...f,outlineBuffer:Yd}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):l1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):l1}}Dp.defaultProps=BB;Dp.layerName="MultiIconLayer";const mu=1e20;class UB{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const f=this.size=e+t*4,d=this._createCanvas(f),g=this.ctx=d.getContext("2d",{willReadFrequently:!0});g.font=`${c} ${l} ${e}px ${a}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(e),c=Math.ceil(i),f=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),g=Math.min(this.size-this.buffer,c+Math.ceil(s)),_=d+2*this.buffer,y=g+2*this.buffer,b=Math.max(_*y,0),x=new Uint8ClampedArray(b),E={data:x,width:_,height:y,glyphWidth:d,glyphHeight:g,glyphTop:c,glyphLeft:f,glyphAdvance:t};if(d===0||g===0)return E;const{ctx:M,buffer:N,gridInner:V,gridOuter:P}=this;M.clearRect(N,N,d,g),M.fillText(e,N,N+c);const H=M.getImageData(N,N,d,g);P.fill(mu,0,b),V.fill(0,0,b);for(let X=0;X<g;X++)for(let Z=0;Z<d;Z++){const he=H.data[4*(X*d+Z)+3]/255;if(he===0)continue;const ue=(X+N)*_+Z+N;if(he===1)P[ue]=0,V[ue]=mu;else{const J=.5-he;P[ue]=J>0?J*J:0,V[ue]=J<0?J*J:0}}c1(P,0,0,_,y,_,this.f,this.v,this.z),c1(V,N,N,d,g,_,this.f,this.v,this.z);for(let X=0;X<b;X++){const Z=Math.sqrt(P[X])-Math.sqrt(V[X]);x[X]=Math.round(255-255*(Z/this.radius+this.cutoff))}return E}}function c1(n,e,t,i,s,a,l,c,f){for(let d=e;d<e+i;d++)u1(n,t*a+d,a,s,l,c,f);for(let d=t;d<t+s;d++)u1(n,d*a+e,1,i,l,c,f)}function u1(n,e,t,i,s,a,l){a[0]=0,l[0]=-1e20,l[1]=mu,s[0]=n[e];for(let c=1,f=0,d=0;c<i;c++){s[c]=n[e+c*t];const g=c*c;do{const _=a[f];d=(s[c]-s[_]+g-_*_)/(c-_)/2}while(d<=l[f]&&--f>-1);f++,a[f]=c,l[f]=d,l[f+1]=mu}for(let c=0,f=0;c<i;c++){for(;l[f+1]<c;)f++;const d=a[f],g=c-d;n[e+c*t]=s[d]+g*g}}const LB=32,FB=[];function zB(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function VB({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:a={},xOffset:l=0,yOffset:c=0}){let f=0,d=l;const g=t+i*2;for(const _ of n)if(!a[_]){const y=e(_);d+y+i*2>s&&(d=0,f++),a[_]={x:d+i,y:c+f*g+i,width:y,height:g,layoutWidth:y,layoutHeight:t},d+=y+i*2}return{mapping:a,xOffset:d,yOffset:c+f*g,canvasHeight:zB(c+(f+1)*g)}}function m2(n,e,t,i){var a;let s=0;for(let l=e;l<t;l++){const c=n[l];s+=((a=i[c])==null?void 0:a.layoutWidth)||0}return s}function y2(n,e,t,i,s,a){let l=e,c=0;for(let f=e;f<t;f++){const d=m2(n,f,f+1,s);c+d>i&&(l<f&&a.push(f),l=f,c=0),c+=d}return c}function HB(n,e,t,i,s,a){let l=e,c=e,f=e,d=0;for(let g=e;g<t;g++)if((n[g]===" "||n[g+1]===" "||g+1===t)&&(f=g+1),f>c){let _=m2(n,c,f,s);d+_>i&&(l<c&&(a.push(c),l=c,d=0),_>i&&(_=y2(n,c,f,i,s,a),l=a[a.length-1])),c=f,d+=_}return d}function WB(n,e,t,i,s=0,a){a===void 0&&(a=n.length);const l=[];return e==="break-all"?y2(n,s,a,t,i,l):HB(n,s,a,t,i,l),l}function jB(n,e,t,i,s,a){let l=0,c=0;for(let f=e;f<t;f++){const d=n[f],g=i[d];g?(c||(c=g.layoutHeight),s[f]=l+g.layoutWidth/2,l+=g.layoutWidth):(De.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),s[f]=l,l+=LB)}a[0]=l,a[1]=c}function $B(n,e,t,i,s){var M;const a=Array.from(n),l=a.length,c=new Array(l),f=new Array(l),d=new Array(l),g=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,_=[0,0],y=[0,0];let b=0,x=0,E=0;for(let N=0;N<=l;N++){const V=a[N];if((V===`
`||N===l)&&(E=N),E>x){const P=g?WB(a,t,i,s,x,E):FB;for(let H=0;H<=P.length;H++){const X=H===0?x:P[H-1],Z=H<P.length?P[H]:E;jB(a,X,Z,s,c,y);for(let he=X;he<Z;he++){const ue=a[he],J=((M=s[ue])==null?void 0:M.layoutOffsetY)||0;f[he]=b+y[1]/2+J,d[he]=y[0]}b=b+y[1]*e,_[0]=Math.max(_[0],y[0])}x=E}V===`
`&&(c[x]=0,f[x]=0,d[x]=0,x++)}return _[1]=b,{x:c,y:f,rowWidth:d,size:_}}function XB({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:a}){const l=n.BYTES_PER_ELEMENT,c=t?t/l:1,f=i?i/l:0,d=s[e]||Math.ceil((n.length-f)/c),g=a&&new Set,_=new Array(e);let y=n;if(c>1||f>0){const b=n.constructor;y=new b(d);for(let x=0;x<d;x++)y[x]=n[x*c+f]}for(let b=0;b<e;b++){const x=s[b],E=s[b+1]||d,M=y.subarray(x,E);_[b]=String.fromCodePoint.apply(null,M),g&&M.forEach(g.add,g)}if(g)for(const b of g)a.add(String.fromCodePoint(b));return{texts:_,characterCount:d}}class b2{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function YB(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Zr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:YB(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},f1=1024,h1=.9,d1=1.2,v2=3;let yu=new b2(v2);function qB(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const i=yu.get(n);if(!i)return t;for(const s in i.mapping)t.has(s)&&t.delete(s);return t}function KB(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function g1(n,e,t,i){n.font=`${i} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function ZB(n){De.assert(Number.isFinite(n)&&n>=v2,"Invalid cache limit"),yu=new b2(n)}class QB{constructor(){this.props={...Zr}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*d1+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=qB(this._key,this.props.characterSet),i=yu.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(t,i);this._atlas=s,yu.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:s,fontSize:a,buffer:l,sdf:c,radius:f,cutoff:d}=this.props;let g=t&&t.data;g||(g=document.createElement("canvas"),g.width=f1);const _=g.getContext("2d",{willReadFrequently:!0});g1(_,i,a,s);const{mapping:y,canvasHeight:b,xOffset:x,yOffset:E}=VB({getFontWidth:M=>_.measureText(M).width,fontHeight:a*d1,buffer:l,characterSet:e,maxCanvasWidth:f1,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(g.height!==b){const M=_.getImageData(0,0,g.width,g.height);g.height=b,_.putImageData(M,0,0)}if(g1(_,i,a,s),c){const M=new UB({fontSize:a,buffer:l,radius:f,cutoff:d,fontFamily:i,fontWeight:`${s}`});for(const N of e){const{data:V,width:P,height:H,glyphTop:X}=M.draw(N);y[N].width=P,y[N].layoutOffsetY=a*h1-X;const Z=_.createImageData(P,H);KB(V,Z),_.putImageData(Z,y[N].x,y[N].y)}}else for(const M of e)_.fillText(M,y[M].x,y[M].y+l+a*h1);return{xOffset:x,yOffset:E,mapping:y,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:a,radius:l,cutoff:c}=this.props;return a?`${e} ${t} ${i} ${s} ${l} ${c}`:`${e} ${t} ${i} ${s}`}}const p1=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,GB={name:"textBackground",vs:p1,fs:p1,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},JB=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,eU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,tU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class kp extends Zn{getShaders(){return super.getShaders({vs:JB,fs:eU,modules:[aa,oa,GB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:a,sizeMaxPixels:l,getLineWidth:c}=this.props;let{padding:f}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]);const d=this.state.model,g={billboard:t,stroked:!!c,padding:f,sizeUnits:$s[s],sizeScale:i,sizeMinPixels:a,sizeMaxPixels:l};d.shaderInputs.setProps({textBackground:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new vn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new na({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}kp.defaultProps=tU;kp.layerName="TextBackgroundLayer";const _1={start:1,middle:0,end:-1},m1={top:1,center:0,bottom:-1},qd=[0,0,0,255],nU=1,iU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:qd},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Zr.characterSet},fontFamily:Zr.fontFamily,fontWeight:Zr.fontWeight,lineHeight:nU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:qd},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:qd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Bp extends Hu{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,s]}=this.transformParagraph(e,t);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,s/=a;const{getTextAnchor:l,getAlignmentBaseline:c}=this.props,f=_1[typeof l=="function"?l(e,t):l],d=m1[typeof c=="function"?c(e,t):c];return[(f-1)*i/2,(d-1)*s/2,i,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:a,y:l,rowWidth:c,size:[f,d]}=this.transformParagraph(e,t),g=_1[typeof i=="function"?i(e,t):i],_=m1[typeof s=="function"?s(e,t):s],y=a.length,b=new Array(y*2);let x=0;for(let E=0;E<y;E++){const M=(1-g)*(f-c[E])/2;b[x++]=(g-1)*f/2+M+a[E],b[x++]=(_-1)*d/2+l[E]}return b}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new QB},this.props.maxWidth>0&&De.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:a}=this.state,l={...e,characterSet:a,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(l),!0;for(const c in l)if(l[c]!==s.props[c])return s.setProps(l),!0;return!1}_updateText(){var f;const{data:e,characterSet:t}=this.props,i=(f=e.attributes)==null?void 0:f.getText;let{getText:s}=this.props,a=e.startIndices,l;const c=t==="auto"&&new Set;if(i&&a){const{texts:d,characterCount:g}=XB({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:a,characterSet:c});l=g,s=(_,{index:y})=>d[y]}else{const{iterable:d,objectInfo:g}=zu(e);a=[0],l=0;for(const _ of d){g.index++;const y=Array.from(s(_,g)||"");c&&y.forEach(c.add,c),l+=y.length,a.push(l)}}this.setState({getText:s,startIndices:a,numInstances:l,characterSet:c||t})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,s=i.mapping,a=this.state.getText,{wordBreak:l,lineHeight:c,maxWidth:f}=this.props,d=a(e,t)||"";return $B(d,c,l,f*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,atlas:a,mapping:l},styleVersion:c}=this.state,{data:f,_dataDiff:d,getPosition:g,getColor:_,getSize:y,getAngle:b,getPixelOffset:x,getBackgroundColor:E,getBorderColor:M,getBorderWidth:N,backgroundPadding:V,background:P,billboard:H,fontSettings:X,outlineWidth:Z,outlineColor:he,sizeScale:ue,sizeUnits:J,sizeMinPixels:oe,sizeMaxPixels:de,transitions:ve,updateTriggers:be}=this.props,Se=this.getSubLayerClass("characters",Dp),We=this.getSubLayerClass("background",kp);return[P&&new We({getFillColor:E,getLineColor:M,getLineWidth:N,padding:V,getPosition:g,getSize:y,getAngle:b,getPixelOffset:x,billboard:H,sizeScale:ue,sizeUnits:J,sizeMinPixels:oe,sizeMaxPixels:de,transitions:ve&&{getPosition:ve.getPosition,getAngle:ve.getAngle,getSize:ve.getSize,getFillColor:ve.getBackgroundColor,getLineColor:ve.getBorderColor,getLineWidth:ve.getBorderWidth,getPixelOffset:ve.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:be.getPosition,getAngle:be.getAngle,getSize:be.getSize,getFillColor:be.getBackgroundColor,getLineColor:be.getBorderColor,getLineWidth:be.getBorderWidth,getPixelOffset:be.getPixelOffset,getBoundingRect:{getText:be.getText,getTextAnchor:be.getTextAnchor,getAlignmentBaseline:be.getAlignmentBaseline,styleVersion:c}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Se({sdf:X.sdf,smoothing:Number.isFinite(X.smoothing)?X.smoothing:Zr.smoothing,outlineWidth:Z/(X.radius||Zr.radius),outlineColor:he,iconAtlas:a,iconMapping:l,getPosition:g,getColor:_,getSize:y,getAngle:b,getPixelOffset:x,billboard:H,sizeScale:ue*s,sizeUnits:J,sizeMinPixels:oe*s,sizeMaxPixels:de*s,transitions:ve&&{getPosition:ve.getPosition,getAngle:ve.getAngle,getColor:ve.getColor,getSize:ve.getSize,getPixelOffset:ve.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:be.getText,getPosition:be.getPosition,getAngle:be.getAngle,getColor:be.getColor,getSize:be.getSize,getPixelOffset:be.getPixelOffset,getIconOffsets:{getTextAnchor:be.getTextAnchor,getAlignmentBaseline:be.getAlignmentBaseline,styleVersion:c}}}),{data:f,_dataDiff:d,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){ZB(e)}}Bp.defaultProps=iU;Bp.layerName="TextLayer";const Hc={circle:{type:Pp,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:ju,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Bp,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Wc={type:$u,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Wg={type:Np,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ho({type:n,props:e}){const t={};for(const i in e)t[i]=n.defaultProps[e[i]];return t}function Kd(n,e){const{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const a in e){const l=e[a];let c=n.props[a];a.startsWith("get")&&(c=n.getSubLayerAccessor(c),s.updateTriggers[l]=i[a],t&&(s.transitions[l]=t[a])),s[l]=c}return s}function sU(n){if(Array.isArray(n))return n;switch(De.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return De.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function y1(n,e,t={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:a=n.length}=t;for(let l=s;l<a;l++){const c=n[l],{geometry:f}=c;if(f)if(f.type==="GeometryCollection"){De.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:d}=f;for(let g=0;g<d.length;g++){const _=d[g];b1(_,i,e,c,l)}}else b1(f,i,e,c,l)}return i}function b1(n,e,t,i,s){const{type:a,coordinates:l}=n,{pointFeatures:c,lineFeatures:f,polygonFeatures:d,polygonOutlineFeatures:g}=e;if(!aU(a,l)){De.warn(`${a} coordinates are malformed`)();return}switch(a){case"Point":c.push(t({geometry:n},i,s));break;case"MultiPoint":l.forEach(_=>{c.push(t({geometry:{type:"Point",coordinates:_}},i,s))});break;case"LineString":f.push(t({geometry:n},i,s));break;case"MultiLineString":l.forEach(_=>{f.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"Polygon":d.push(t({geometry:n},i,s)),l.forEach(_=>{g.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"MultiPolygon":l.forEach(_=>{d.push(t({geometry:{type:"Polygon",coordinates:_}},i,s)),_.forEach(y=>{g.push(t({geometry:{type:"LineString",coordinates:y}},i,s))})});break}}const rU={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function aU(n,e){let t=rU[n];for(De.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function T2(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Ec(n){return n.geometry.coordinates}function oU(n,e){const t=T2(),{pointFeatures:i,lineFeatures:s,polygonFeatures:a,polygonOutlineFeatures:l}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=Ec,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=Ec,t.polygons.data=a,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=Ec,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=Ec,t}function lU(n,e){const t=T2(),{points:i,lines:s,polygons:a}=n,l=NB(n,e);return t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{...a.attributes,getPolygon:a.positions,pickingColors:{size:4,value:l.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},t.polygons._normalize=!1,a.triangles&&(t.polygons.data.attributes.indices=a.triangles.value),t.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:4,value:l.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},t.polygonsOutline._pathType="open",t}const cU=["points","linestrings","polygons"],uU={...ho(Hc.circle),...ho(Hc.icon),...ho(Hc.text),...ho(Wc),...ho(Wg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Up extends Hu{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const i=lU(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){const i=sU(e.data),s=this.getSubLayerRow.bind(this);let a={};const l={};if(Array.isArray(t.dataChanged)){const f=this.state.features;for(const d in f)a[d]=f[d].slice(),l[d]=[];for(const d of t.dataChanged){const g=y1(i,s,d);for(const _ in f)l[_].push(OB({data:a[_],getIndex:y=>y.__source.index,dataRange:d,replace:g[_]}))}}else a=y1(i,s);const c=oU(a,l);this.setState({features:a,featuresDiff:l,layerProps:c})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=cU.find(a=>s.id.startsWith(`${this.id}-${a}-`)),i>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var l;const{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",a=this.shouldRenderSubLayer(s,(l=i.polygons)==null?void 0:l.data)&&this.getSubLayerClass(s,Wg.type);if(a){const c=Kd(this,Wg.props),f=e&&t;return f||delete c.getLineColor,c.updateTriggers.lineColors=f,new a(c,this.getSubLayerProps({id:s,updateTriggers:c.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var f,d;const{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",a="linestrings",l=!e&&t&&this.shouldRenderSubLayer(s,(f=i.polygonsOutline)==null?void 0:f.data)&&this.getSubLayerClass(s,Wc.type),c=this.shouldRenderSubLayer(a,(d=i.lines)==null?void 0:d.data)&&this.getSubLayerClass(a,Wc.type);if(l||c){const g=Kd(this,Wc.props);return[l&&new l(g,this.getSubLayerProps({id:s,updateTriggers:g.updateTriggers}),i.polygonsOutline),c&&new c(g,this.getSubLayerProps({id:a,updateTriggers:g.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var c;const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(f=>f.__source.index===s));const a=new Set(e.split("+")),l=[];for(const f of a){const d=`points-${f}`,g=Hc[f],_=g&&this.shouldRenderSubLayer(d,(c=t.points)==null?void 0:c.data)&&this.getSubLayerClass(d,g.type);if(_){const y=Kd(this,g.props);let b=t.points;if(f==="text"&&i){const{instancePickingColors:x,...E}=b.data.attributes;b={...b,data:{...b.data,attributes:E}}}l.push(new _(y,this.getSubLayerProps({id:d,updateTriggers:y.updateTriggers,highlightedObjectIndex:s}),b))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:a,index:l}=s,c=IB(a,l);return e(c,s)}}}Up.layerName="GeoJsonLayer";Up.defaultProps=uU;class fU{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:s}){const{index:a,id:l,bbox:c,userData:f,zoom:d}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,y=await t.scheduleRequest(this,E=>E.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let b=null,x;try{b=await e({index:a,id:l,bbox:c,userData:f,zoom:d,signal:_})}catch(E){x=E||!0}finally{y.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=b,this._isCancelled&&!b){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,x?s(x,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Vt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},v1=new fe,hU=new fe;class Lp{constructor(e=[0,0,0],t=[0,0,0],i){i=i||v1.copy(e).add(t).scale(.5),this.center=new fe(i),this.halfDiagonal=new fe(t).subtract(this.center),this.minimum=new fe(e),this.maximum=new fe(t)}clone(){return new Lp(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=hU.from(e.normal),s=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),a=this.center.dot(i)+e.distance;return a-s>0?Vt.INSIDE:a+s<0?Vt.OUTSIDE:Vt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=v1.from(e).subtract(this.center),{halfDiagonal:i}=this;let s=0,a;return a=Math.abs(t.x)-i.x,a>0&&(s+=a*a),a=Math.abs(t.y)-i.y,a>0&&(s+=a*a),a=Math.abs(t.z)-i.z,a>0&&(s+=a*a),s}}const go=new fe,T1=new fe;class Fp{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new fe,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=go.from(t),this.center=new fe().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Fp(this.center,this.radius)}union(e){const t=this.center,i=this.radius,s=e.center,a=e.radius,l=go.copy(s).subtract(t),c=l.magnitude();if(i>=c+a)return this.clone();if(a>=c+i)return e.clone();const f=(i+c+a)*.5;return T1.copy(l).scale((-i+f)/c).add(t),this.center.copy(T1),this.radius=f,this}expand(e){const i=go.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const t=AM(go,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const i=go.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const t=this.center,i=this.radius,a=e.normal.dot(t)+e.distance;return a<-i?Vt.OUTSIDE:a<i?Vt.INTERSECTING:Vt.INSIDE}}const dU=new fe,gU=new fe,Rc=new fe,Cc=new fe,Mc=new fe,pU=new fe,_U=new fe,gi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class zp{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new fe().from(e),this.halfAxes=new Pt(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new fe(e).len(),new fe(t).len(),new fe(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new fe(e).normalize(),a=new fe(t).normalize(),l=new fe(i).normalize();return new Pb().fromMatrix3(new Pt([...s,...a,...l]))}fromCenterHalfSizeQuaternion(e,t,i){const s=new Pb(i),a=new Pt().fromQuaternion(s);return a[0]=a[0]*t[0],a[1]=a[1]*t[0],a[2]=a[2]*t[0],a[3]=a[3]*t[1],a[4]=a[4]*t[1],a[5]=a[5]*t[1],a[6]=a[6]*t[2],a[7]=a[7]*t[2],a[8]=a[8]*t[2],this.center=new fe().from(e),this.halfAxes=a,this}clone(){return new zp(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Fp){const t=this.halfAxes,i=t.getColumn(0,Rc),s=t.getColumn(1,Cc),a=t.getColumn(2,Mc),l=dU.copy(i).add(s).add(a);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,i=e.normal,s=this.halfAxes,a=i.x,l=i.y,c=i.z,f=Math.abs(a*s[gi.COLUMN0ROW0]+l*s[gi.COLUMN0ROW1]+c*s[gi.COLUMN0ROW2])+Math.abs(a*s[gi.COLUMN1ROW0]+l*s[gi.COLUMN1ROW1]+c*s[gi.COLUMN1ROW2])+Math.abs(a*s[gi.COLUMN2ROW0]+l*s[gi.COLUMN2ROW1]+c*s[gi.COLUMN2ROW2]),d=i.dot(t)+e.distance;return d<=-f?Vt.OUTSIDE:d>=f?Vt.INSIDE:Vt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=gU.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,Rc),a=i.getColumn(1,Cc),l=i.getColumn(2,Mc),c=s.magnitude(),f=a.magnitude(),d=l.magnitude();s.normalize(),a.normalize(),l.normalize();let g=0,_;return _=Math.abs(t.dot(s))-c,_>0&&(g+=_*_),_=Math.abs(t.dot(a))-f,_>0&&(g+=_*_),_=Math.abs(t.dot(l))-d,_>0&&(g+=_*_),g}computePlaneDistances(e,t,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;const l=this.center,c=this.halfAxes,f=c.getColumn(0,Rc),d=c.getColumn(1,Cc),g=c.getColumn(2,Mc),_=pU.copy(f).add(d).add(g).add(l),y=_U.copy(_).subtract(e);let b=t.dot(y);return s=Math.min(b,s),a=Math.max(b,a),_.copy(l).add(f).add(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),_.copy(l).add(f).subtract(d).add(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),_.copy(l).add(f).subtract(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),l.copy(_).subtract(f).add(d).add(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),l.copy(_).subtract(f).add(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),l.copy(_).subtract(f).subtract(d).add(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),l.copy(_).subtract(f).subtract(d).subtract(g),y.copy(_).subtract(e),b=t.dot(y),s=Math.min(b,s),a=Math.max(b,a),i[0]=s,i[1]=a,i}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Rc);t.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Cc);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,Mc);return s.transformAsPoint(e),this.halfAxes=new Pt([...t,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const x1=new fe,A1=new fe;class zo{constructor(e=[0,0,1],t=0){this.normal=new fe,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Do(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=x1.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,s){return this.normal.set(e,t,i),Do(bi(this.normal.len(),1)),this.distance=s,this}clone(){return new zo(this.normal,this.distance)}equals(e){return bi(this.distance,e.distance)&&bi(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=A1.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){const i=x1.from(e),s=this.getPointDistance(i),a=A1.copy(this.normal).scale(s);return i.subtract(a).to(t)}}const S1=[new fe([1,0,0]),new fe([0,1,0]),new fe([0,0,1])],w1=new fe,mU=new fe;class yi{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*S1.length;const t=e.center,i=e.radius;let s=0;for(const a of S1){let l=this.planes[s],c=this.planes[s+1];l||(l=this.planes[s]=new zo),c||(c=this.planes[s+1]=new zo);const f=w1.copy(a).scale(-i).add(t);l.fromPointNormal(f,a);const d=w1.copy(a).scale(i).add(t),g=mU.copy(a).negate();c.fromPointNormal(d,g),s+=2}return this}computeVisibility(e){let t=Vt.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Vt.OUTSIDE:return Vt.OUTSIDE;case Vt.INTERSECTING:t=Vt.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Do(Number.isFinite(t),"parentPlaneMask is required."),t===yi.MASK_OUTSIDE||t===yi.MASK_INSIDE)return t;let i=yi.MASK_INSIDE;const s=this.planes;for(let a=0;a<this.planes.length;++a){const l=a<31?1<<a:0;if(a<31&&(t&l)===0)continue;const c=s[a],f=e.intersectPlane(c);if(f===Vt.OUTSIDE)return yi.MASK_OUTSIDE;f===Vt.INTERSECTING&&(i|=l)}return i}}yi.MASK_OUTSIDE=4294967295;yi.MASK_INSIDE=0;yi.MASK_INDETERMINATE=2147483647;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;const $n=new Pt,yU=new Pt,bU=new Pt,Oc=new Pt,E1=new Pt;function vU(n,e={}){const t=oO,i=10;let s=0,a=0;const l=yU,c=bU;l.identity(),c.copy(n);const f=t*TU(c);for(;a<i&&xU(c)>f;)AU(c,Oc),E1.copy(Oc).transpose(),c.multiplyRight(Oc),c.multiplyLeft(E1),l.multiplyRight(Oc),++s>2&&(++a,s=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function TU(n){let e=0;for(let t=0;t<9;++t){const i=n[t];e+=i*i}return Math.sqrt(e)}const jg=[1,0,0],$g=[2,2,1];function xU(n){let e=0;for(let t=0;t<3;++t){const i=n[$n.getElementIndex($g[t],jg[t])];e+=2*i*i}return Math.sqrt(e)}function AU(n,e){const t=aO;let i=0,s=1;for(let d=0;d<3;++d){const g=Math.abs(n[$n.getElementIndex($g[d],jg[d])]);g>i&&(s=d,i=g)}const a=jg[s],l=$g[s];let c=1,f=0;if(Math.abs(n[$n.getElementIndex(l,a)])>t){const d=n[$n.getElementIndex(l,l)],g=n[$n.getElementIndex(a,a)],_=n[$n.getElementIndex(l,a)],y=(d-g)/2/_;let b;y<0?b=-1/(-y+Math.sqrt(1+y*y)):b=1/(y+Math.sqrt(1+y*y)),c=1/Math.sqrt(1+b*b),f=b*c}return Pt.IDENTITY.to(e),e[$n.getElementIndex(a,a)]=e[$n.getElementIndex(l,l)]=c,e[$n.getElementIndex(l,a)]=f,e[$n.getElementIndex(a,l)]=-f,e}const Ki=new fe,SU=new fe,wU=new fe,EU=new fe,RU=new fe,CU=new Pt,MU={diagonal:new Pt,unitary:new Pt};function OU(n,e=new zp){if(!n||n.length===0)return e.halfAxes=new Pt([0,0,0,0,0,0,0,0,0]),e.center=new fe,e;const t=n.length,i=new fe(0,0,0);for(const J of n)i.add(J);const s=1/t;i.multiplyByScalar(s);let a=0,l=0,c=0,f=0,d=0,g=0;for(const J of n){const oe=Ki.copy(J).subtract(i);a+=oe.x*oe.x,l+=oe.x*oe.y,c+=oe.x*oe.z,f+=oe.y*oe.y,d+=oe.y*oe.z,g+=oe.z*oe.z}a*=s,l*=s,c*=s,f*=s,d*=s,g*=s;const _=CU;_[0]=a,_[1]=l,_[2]=c,_[3]=l,_[4]=f,_[5]=d,_[6]=c,_[7]=d,_[8]=g;const{unitary:y}=vU(_,MU),b=e.halfAxes.copy(y);let x=b.getColumn(0,wU),E=b.getColumn(1,EU),M=b.getColumn(2,RU),N=-Number.MAX_VALUE,V=-Number.MAX_VALUE,P=-Number.MAX_VALUE,H=Number.MAX_VALUE,X=Number.MAX_VALUE,Z=Number.MAX_VALUE;for(const J of n)Ki.copy(J),N=Math.max(Ki.dot(x),N),V=Math.max(Ki.dot(E),V),P=Math.max(Ki.dot(M),P),H=Math.min(Ki.dot(x),H),X=Math.min(Ki.dot(E),X),Z=Math.min(Ki.dot(M),Z);x=x.multiplyByScalar(.5*(H+N)),E=E.multiplyByScalar(.5*(X+V)),M=M.multiplyByScalar(.5*(Z+P)),e.center.copy(x).add(E).add(M);const he=SU.set(N-H,V-X,P-Z).multiplyByScalar(.5),ue=new Pt([he[0],0,0,0,he[1],0,0,0,he[2]]);return e.halfAxes.multiplyRight(ue),e}const Xr=512,IU=3,x2=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],A2=x2.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),PU=A2.concat([[.25,.5],[.75,.5]]);class Yr{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){const e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new Yr(e,t,i),new Yr(e,t+1,i),new Yr(e+1,t,i),new Yr(e+1,t+1,i)]}return this._children}update(e){const{viewport:t,cullingVolume:i,elevationBounds:s,minZ:a,maxZ:l,bounds:c,offset:f,project:d}=e,g=this.getBoundingVolume(s,f,d);if(c&&!this.insideBounds(c)||i.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<l&&y>=a){const b=g.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(b))}if(y>=l)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,s]){const a=Math.pow(2,this.z),l=Xr/a;return this.x*l<i&&this.y*l<s&&(this.x+1)*l>e&&(this.y+1)*l>t}getBoundingVolume(e,t,i){if(i){const f=this.z<1?PU:this.z<2?A2:x2,d=[];for(const g of f){const _=Yg(this.x+g[0],this.y+g[1],this.z);_[2]=e[0],d.push(i(_)),e[0]!==e[1]&&(_[2]=e[1],d.push(i(_)))}return OU(d)}const s=Math.pow(2,this.z),a=Xr/s,l=this.x*a+t*Xr,c=Xr-(this.y+1)*a;return new Lp([l,c,e[0]],[l+a,c+a,e[1]])}}function NU(n,e,t,i){const s=n instanceof a6&&n.resolution?n.projectPosition:null,a=Object.values(n.getFrustumPlanes()).map(({normal:b,distance:x})=>new zo(b.clone().negate(),x)),l=new yi(a),c=n.distanceScales.unitsPerMeter[2],f=t&&t[0]*c||0,d=t&&t[1]*c||0,g=n instanceof ls&&n.pitch<=60?e:0;if(i){const[b,x,E,M]=i,N=os([b,M]),V=os([E,x]);i=[N[0],Xr-N[1],V[0],Xr-V[1]]}const _=new Yr(0,0,0),y={viewport:n,project:s,cullingVolume:l,elevationBounds:[f,d],minZ:g,maxZ:e,bounds:i,offset:0};if(_.update(y),n instanceof ls&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;_.update(y)&&!(--y.offset<-3););for(y.offset=1;_.update(y)&&!(++y.offset>IU););}return _.getSelected()}const Ti=512,DU=[-1/0,-1/0,1/0,1/0],kU={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}};function S2(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function BU(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function UU(n,e){if(!n||!n.length)return null;const{index:t,id:i}=e;if(Array.isArray(n)){const a=BU(i)%n.length;n=n[a]}let s=n;for(const a of Object.keys(t)){const l=new RegExp(`{${a}}`,"g");s=s.replace(l,String(t[a]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function LU(n,e,t){let i;return i=n.getBounds(),n.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function FU({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(s=>Xg(s,e||0,t))}function Xg(n,e,t){if(!Array.isArray(e)){const a=t.x-n.x,l=t.y-n.y,{width:c,height:f}=t,d={targetZ:e},g=n.unproject([a,l],d),_=n.unproject([a+c,l],d),y=n.unproject([a,l+f],d),b=n.unproject([a+c,l+f],d);return[Math.min(g[0],_[0],y[0],b[0]),Math.min(g[1],_[1],y[1],b[1]),Math.max(g[0],_[0],y[0],b[0]),Math.max(g[1],_[1],y[1],b[1])]}const i=Xg(n,e[0],t),s=Xg(n,e[1],t);return[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[2],s[2]),Math.max(i[3],s[3])]}function zU(n,e,t){return t?S2(n,t).map(s=>s*e/Ti):n.map(i=>i*e/Ti)}function Vp(n,e){return Math.pow(2,n)*Ti/e}function Yg(n,e,t){const i=Vp(t,Ti),s=n/i*360-180,a=Math.PI-2*Math.PI*e/i,l=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[s,l]}function R1(n,e,t,i){const s=Vp(t,i);return[n/s*Ti,e/s*Ti]}function VU(n,e,t,i,s=Ti){if(n.isGeospatial){const[d,g]=Yg(e,t,i),[_,y]=Yg(e+1,t+1,i);return{west:d,north:g,east:_,south:y}}const[a,l]=R1(e,t,i,s),[c,f]=R1(e+1,t+1,i,s);return{left:a,top:l,right:c,bottom:f}}function HU(n,e,t,i,s){const a=LU(n,null,i),l=Vp(e,t),[c,f,d,g]=zU(a,l,s),_=[];for(let y=Math.floor(c);y<d;y++)for(let b=Math.floor(f);b<g;b++)_.push({x:y,y:b,z:e});return _}function WU({viewport:n,maxZoom:e,minZoom:t,zRange:i,extent:s,tileSize:a=Ti,modelMatrix:l,modelMatrixInverse:c,zoomOffset:f=0}){let d=n.isGeospatial?Math.round(n.zoom+Math.log2(Ti/a))+f:Math.ceil(n.zoom)+f;if(typeof t=="number"&&Number.isFinite(t)&&d<t){if(!s)return[];d=t}typeof e=="number"&&Number.isFinite(e)&&d>e&&(d=e);let g=s;return l&&c&&s&&!n.isGeospatial&&(g=S2(s,l)),n.isGeospatial?NU(n,d,i,s):HU(n,d,a,g||DU,c)}function jU(n){let e={},t;return i=>{for(const s in i)if(!$U(i[s],e[s])){t=n(i),e=i;break}return t}}function $U(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}const C1=1,Xu=2,XU="never",YU="no-overlap",Hp="best-available",qU=5,KU={[Hp]:GU,[YU]:JU,[XU]:()=>{}},ZU={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class QU{constructor(e){this._getCullBounds=jU(FU),this.opts={...ZU,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var i,s;(s=(i=this.opts).onTileLoad)==null||s.call(i,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new qS({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new $t,this._modelMatrixInverse=new $t}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){const s=i?new $t(i):new $t,a=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!bi(this._zRange,t)||a){a&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;const c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(f=>this._getTile(f,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:s}=e;for(const[a,l,c,f]of i){let d;if("west"in s)d=s.west<c&&s.east>a&&s.south<f&&s.north>l;else{const g=Math.min(s.top,s.bottom),_=Math.max(s.top,s.bottom);d=s.left<c&&s.right>a&&g<f&&_>l}if(d)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:s,modelMatrix:a,modelMatrixInverse:l}){const{tileSize:c,extent:f,zoomOffset:d}=this.opts;return WU({viewport:e,maxZoom:t,minZoom:i,zRange:s,tileSize:c,extent:f,modelMatrix:a,modelMatrixInverse:l,zoomOffset:d})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:VU(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),i=Math.floor(e.y/2),s=e.z-1;return{x:t,y:i,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||Hp,t=new Array(this._cache.size);let i=0;for(const s of this._cache.values())t[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:KU[e])(Array.from(this._cache.values())),i=0;for(const s of this._cache.values())if(t[i++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let i=0;for(const s of this._cache.values())s.isLoading&&(i++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const i=this._getNearestAncestor(t);t.parent=i,i!=null&&i.children&&i.children.push(t)}}_resizeCache(){var l,c;const{_cache:e,opts:t}=this,i=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:qU*this.selectedTiles.length),s=t.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>s){for(const[f,d]of e)if(!d.isVisible&&!d.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?d.byteLength:0,e.delete(f),(c=(l=this.opts).onTileUnload)==null||c.call(l,d)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((f,d)=>f.zoom-d.zoom),this._dirty=!1)}_getTile(e,t){const i=this.getTileId(e);let s=this._cache.get(i),a=!1;return!s&&t?(s=new fU(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:i,zoom:this.getTileZoom(s.index)}),a=!0,this._cache.set(i,s),this._dirty=!0):s&&s.needsReload&&(a=!0),s&&a&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:t=0}=this;let i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);const s=this._getTile(i);if(s)return s}return null}}function GU(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!w2(e)&&Wp(e);for(const e of n)e.isVisible=!!(e.state&Xu)}function JU(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&w2(t);const e=Array.from(n).sort((t,i)=>t.zoom-i.zoom);for(const t of e)if(t.isVisible=!!(t.state&Xu),t.children&&(t.isVisible||t.state&C1))for(const i of t.children)i.state=C1;else t.isSelected&&Wp(t)}function w2(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=Xu,!0;e=e.parent}return!1}function Wp(n){for(const e of n.children)e.isLoaded||e.content?e.state|=Xu:Wp(e)}const eL={TilesetClass:QU,data:{type:"data",value:[]},dataComparator:kU.equal,renderSubLayers:{type:"function",value:n=>new Up(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Hp,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class jp extends Hu{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,i;return!!((i=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&i.every(s=>s.isLoaded&&s.layers&&s.layers.every(a=>a.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():t.tiles.forEach(a=>{a.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:s,extent:a,maxZoom:l,minZoom:c,maxRequests:f,debounceTime:d,zoomOffset:g}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:l,minZoom:c,tileSize:e,refinementStrategy:s,extent:a,maxRequests:f,debounceTime:d,zoomOffset:g,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:a}=e,l=this.state.isLoaded!==a,c=this.state.frameNumber!==s;a&&(l||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:s}),this.state.isLoaded=a}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:i,fetch:s}=this.props,{signal:a}=e;return e.url=typeof t=="string"||Array.isArray(t)?UU(t,e):null,i?i(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:a}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,i=t.props.tile,s=e.info;return s.picked&&(s.tile=i),s.sourceTile=i,s.sourceTileSubLayer=t,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Lu(i,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,t)}}jp.defaultProps=eL;jp.layerName="TileLayer";const tL={latitude:44.9346984280946,longitude:-93.27211595909854,zoom:10,maxZoom:20,maxPitch:89,bearing:0},nL={position:"absolute",right:0,bottom:0,backgroundColor:"hsla(0,0%,100%,.5)",padding:"0 5px",font:"12px/20px Helvetica Neue,Arial,Helvetica,sans-serif"},iL={textDecoration:"none",color:"rgba(0,0,0,.75)",cursor:"grab"},sL=typeof window<"u"&&window.devicePixelRatio||1;function rL(n){return null}function aL({showBorder:n=!1,onTilesLoad:e}){const t=new jp({data:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],maxRequests:20,pickable:!0,onViewportLoad:e,autoHighlight:n,highlightColor:[60,60,60,40],minZoom:0,maxZoom:19,tileSize:256,zoomOffset:sL===1?-1:0,renderSubLayers:i=>{const[[s,a],[l,c]]=i.tile.boundingBox,{data:f,...d}=i;return[new Ip(d,{image:f,bounds:[s,a,l,c]}),n&&new $u({id:`${i.id}-border`,data:[[[s,c],[s,a],[l,a],[l,c],[s,c]]],getPath:g=>g,getColor:[255,0,0],widthMinPixels:4})]}});return To.jsx(v6,{layers:[t],views:new Ap({repeat:!0}),initialViewState:tL,controller:!0,getTooltip:rL,children:To.jsxs("div",{style:nL,children:[" ",To.jsx("a",{style:iL,href:"https://www.openstreetmap.org/copyright",target:"blank",children:"OpenStreetMap contributors"})]})})}aS.createRoot(document.getElementById("root")).render(To.jsx(it.StrictMode,{children:To.jsx(aL,{})}));
